!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Geom={})}(this,(function(t){function r(t,e,r,n){var i,s=arguments.length,o=3>s?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(3>s?i(o):s>3?i(e,r,o):i(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o}function n(){return j||(j=1,function(t,e){!function(t){function e(t){return t in n}class r{constructor(t,e){this.first=t,this.second=e}get(t){if(this.first===t)return this.second}dump(){return`{${JSON.stringify(this.first)},${JSON.stringify(this.second)}}`}}const n={};var i;t.BasicSerializeType=void 0,(i=t.BasicSerializeType||(t.BasicSerializeType={})).Other="-1",i.Array="-2",i.Set="-3",i.Pair="-4",i.Map="-5",i.HashTable="-6";class s{getClassName(){return t.BasicSerializeType.Array}isSerializable(t){return t instanceof Array}serialize(t,e){const r=this.getClassName(),n=[];return e.forEach((e=>n.push(t.serializeAny(e)))),{class:r,array:n}}deserialize(t,e){if(void 0===e)return;const{array:r}=e,n=[];return r.forEach((e=>n.push(t.deserializeAny(e)))),n}}class o{getClassName(){return t.BasicSerializeType.Set}isSerializable(t){return t instanceof Set}serialize(t,e){const r=this.getClassName(),n=[];return e.forEach((e=>n.push(t.serializeAny(e)))),{class:r,set:n}}deserialize(t,e){if(void 0===e)return;const{set:r}=e,n=new Set;return r.forEach((e=>n.add(t.deserializeAny(e)))),n}}class a{getClassName(){return t.BasicSerializeType.Pair}isSerializable(t){return t instanceof r}serialize(t,e){return{class:this.getClassName(),first:t.serializeAny(e.first),second:t.serializeAny(e.second)}}deserialize(t,e){if(void 0===e)return;const{first:n,second:i}=e;return new r(t.deserializeAny(n),t.deserializeAny(i))}}class u{getClassName(){return t.BasicSerializeType.Map}isSerializable(t){return t instanceof Map}serialize(e,n){const i=this.getClassName(),s=[],o=e.findSerializer(t.BasicSerializeType.Pair);return n.forEach(((t,n)=>s.push(null==o?void 0:o.serialize(e,new r(n,t))))),{class:i,map:s}}deserialize(e,r){if(void 0===r)return;const{map:n}=r,i=new Map,s=e.findSerializer(t.BasicSerializeType.Pair);return n.forEach((t=>{const r=null==s?void 0:s.deserialize(e,t);r&&i.set(r.first,r.second)})),i}}class h{constructor(){this.serializers=[],this.serializers.splice(0)}static construct(){return(new h).registerSerializer(new s).registerSerializer(new o).registerSerializer(new a).registerSerializer(new u)}findSerializer(t){return this.serializers.find((e=>e.getClassName()===t))}registerSerializer(t){return this.serializers.push(t),this}serializeAny(t){if(void 0===t)return;const{className:r}=t;if(e(r))return this.serializeObject(t);for(let e=0;e<this.serializers.length;e+=1){const r=this.serializers[e];if(r.isSerializable(t))return r.serialize(this,t)}return t}deserializeAny(t){if(void 0===t)return;const r=t.class;if(e(r))return this.deserializeObject(t);for(let e=0;e<this.serializers.length;e+=1){const n=this.serializers[e];if(r===n.getClassName())return n.deserialize(this,t)}return t}serializeObject(t){const e={},{className:r}=t,n=Object.keys(t.getHashObject());for(let r=0;r<n.length;r+=1){const i=t.getHashObject()[n[r]];e[n[r]]=this.serializeAny(i)}return{class:r,body:e}}deserializeObject(t){if(void 0===t)return;const e=(r=t.class,new n[r]);var r;const{body:i}=t,s=Object.keys(i);for(let t=0;t<s.length;t+=1){const r=s[t];r in e&&(e[r]=this.deserializeAny(i[r]))}return e}}t.DeclareObject=t=>e=>{n[t]=e,e.prototype.className=t},t.DeclareProperty=(t,e)=>{t.serializableFields&&Array.isArray(t.serializableFields)||(t.serializableFields=[]),t.serializableFields.push(e),Object.defineProperty(t,e,{get(){return this.getProp(e)},set(t){this.setProp(e,t)}})},t.Pair=r,t.Serialization=h,t.isDeclared=e}(e)}(0,N.exports)),N.exports}function i(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(st[255&t]+st[t>>8&255]+st[t>>16&255]+st[t>>24&255]+"-"+st[255&e]+st[e>>8&255]+"-"+st[e>>16&15|64]+st[e>>24&255]+"-"+st[63&r|128]+st[r>>8&255]+"-"+st[r>>16&255]+st[r>>24&255]+st[255&n]+st[n>>8&255]+st[n>>16&255]+st[n>>24&255]).toLowerCase()}function s(t,e,r){return Math.max(e,Math.min(r,t))}function e(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw Error("Invalid component type.")}}function o(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw Error("Invalid component type.")}}function h(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function u(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function a(t){t in ut||(ut[t]=!0)}function c(t){return.04045>t?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function f(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?ct.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:{}}function l(t,e,r,n,i){for(let s=0,o=t.length-3;o>=s;s+=3){Ct.fromArray(t,s);const o=i.x*Math.abs(Ct.x)+i.y*Math.abs(Ct.y)+i.z*Math.abs(Ct.z),a=e.dot(Ct),u=r.dot(Ct),h=n.dot(Ct);if(Math.max(-Math.max(a,u,h),Math.min(a,u,h))>o)return!1}return!0}function v(t,e,r=_r){return 0===t?r>Math.abs(e):0===e?r>Math.abs(t):t>0&&0>e||0>t&&e>0?r>Math.abs(t-e):r>Math.abs(t-e)/Math.min(Math.abs(t),Math.abs(e))}function d(t,e,r){return v(t.x*e.y,t.y*e.x,r)&&v(t.y*e.z,t.z*e.y,r)&&v(t.x*e.z,t.z*e.x,r)}function w(t,e,r,n){return r.dot(e.clone().cross(t))>(n||_r)}function p(t,e,r,n){return!w(t,e,r,n)&&!w(e,t,r,n)}function m(t,e){if(!0!==t())throw Error(e)}function y(t){t()}function M(e,r){if(e.parallelTo(r))return[];const n=e.dir.as().cross(r.dir.as()),i=(e,r)=>{const i=t.Plane.createByOriginAndNormal(e.origin,n).projectPnt(r.origin);if(e.isPointOnCurve(i))return e.parameter(i);const s=e.projectPnt(i).sub(i.as()),o=s.length()/r.dir.dot(s.normalize().as()),a=(new t.Point3d).copy(r.dir.as()).multiplyScalar(o).add(i.as());return m((()=>e.isPointOnCurve(a)),"Exception: X is not on the line."),e.parameter(a)};return[{tA:i(e,r),tB:i(r,e)}]}function g(t,e){return!!t.parallelTo(e)&&t.isPointOnCurve(e.origin)&&e.isPointOnCurve(t.origin)}function b(){return Or||(Or=1,function(t,r){var n;n=function(t){function r(t,e,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(t):n?n.value:e.get(t)}function n(t,e,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(t,r):i?i.value=r:e.set(t,r),r}function i(t,e,r){return Math.min(r,Math.max(t,e))}function s(t,e){return o(t.x,t.y,t.z,e.x,e.y,e.z)}function e(t,e){return o(t.x,t.y,t.z,-e.x,-e.y,-e.z)}function o(t,e,r,n,i,s){const o=t-n,a=e-i,u=r-s;return o*o+a*a+u*u}function h(t,e,r){return r>Math.abs(t-e)}function u(t,e,r){return h(s(t,e),0,r)}function a(t,r,n){return h(e(t,r),0,n)}function c(t,e,r){return h(o(t[0],t[1],t[2],e[0],e[1],e[2]),0,r)}function f(t,e){return u(t,e,Yn)}function l(t,e){return h(t,e,zn)}function v(t,e){return h(t,e,Gn)}function d(t,e){return h(t,e,Jn)}function w(t,e){return h(t,e,Qn)}function p(t,e){return u(t,e,Jn)}function m(t,e){return a(t,e,Jn)}function y(t,e){return c(t,e,Jn)}function M(t,e,r,n,i,s){return o(t,e,r,n,i,s)<Jn}function g(t,e){return h(t,e,Kn)}function b(t){return t&&t.__esModule&&{}.hasOwnProperty.call(t,"default")?t.default:t}function _(){return ni||(ni=1,function(t){var r=t;void 0!==ti&&(ti.numeric=r),r.version="1.2.6",r.bench=function(t,e){var r,n,i;for(void 0===e&&(e=15),n=.5,r=new Date;;){for(i=n*=2;i>3;i-=4)t(),t(),t(),t();for(;i>0;)t(),i--;if(new Date-r>e)break}for(i=n;i>3;i-=4)t(),t(),t(),t();for(;i>0;)t(),i--;return 1e3*(3*n-1)/(new Date-r)},r._myIndexOf=function(t){var e,r=this.length;for(e=0;r>e;++e)if(this[e]===t)return e;return-1},r.myIndexOf=[].indexOf?[].indexOf:r._myIndexOf,r.Function=Function,r.precision=4,r.largeArray=50,r.prettyPrint=function(t){function e(t){if(0===t)return"0";if(isNaN(t))return"NaN";if(0>t)return"-"+e(-t);if(isFinite(t)){var n=Math.floor(Math.log(t)/Math.log(10)),i=t/Math.pow(10,n),s=i.toPrecision(r.precision);return 10===parseFloat(s)&&(n++,s=(i=1).toPrecision(r.precision)),parseFloat(s).toString()+"e"+n.toString()}return"Infinity"}var n=[];return function t(i){var s;if(void 0===i)return n.push(Array(r.precision+8).join(" ")),!1;if("string"==typeof i)return n.push('"'+i+'"'),!1;if("boolean"==typeof i)return n.push(i.toString()),!1;if("number"==typeof i){var o=e(i),a=i.toPrecision(r.precision),u=parseFloat(i.toString()).toString(),h=[o,a,u,parseFloat(a).toString(),parseFloat(u).toString()];for(s=1;h.length>s;s++)h[s].length<o.length&&(o=h[s]);return n.push(Array(r.precision+8-o.length).join(" ")+o),!1}if(null===i)return n.push("null"),!1;if("function"==typeof i){n.push(i.toString());var c=!1;for(s in i)i.hasOwnProperty(s)&&(c?n.push(",\n"):n.push("\n{"),c=!0,n.push(s),n.push(": \n"),t(i[s]));return c&&n.push("}\n"),!0}if(i instanceof Array){if(i.length>r.largeArray)return n.push("...Large Array..."),!0;for(c=!1,n.push("["),s=0;s<i.length;s++)s>0&&(n.push(","),c&&n.push("\n ")),c=t(i[s]);return n.push("]"),!0}for(s in n.push("{"),c=!1,i)i.hasOwnProperty(s)&&(c&&n.push(",\n"),c=!0,n.push(s),n.push(": \n"),t(i[s]));return n.push("}"),!0}(t),n.join("")},r.parseDate=function(t){return function t(e){if("string"==typeof e)return Date.parse(e.replace(/-/g,"/"));if(!(e instanceof Array))throw Error("parseDate: parameter must be arrays of strings");var r,n=[];for(r=0;r<e.length;r++)n[r]=t(e[r]);return n}(t)},r.parseFloat=function(t){return function t(e){if("string"==typeof e)return parseFloat(e);if(!(e instanceof Array))throw Error("parseFloat: parameter must be arrays of strings");var r,n=[];for(r=0;r<e.length;r++)n[r]=t(e[r]);return n}(t)},r.parseCSV=function(t){var e,r,n,i=t.split("\n"),s=[],o=/(([^'",]*)|('[^']*')|("[^"]*")),/g,a=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,u=0;for(r=0;r<i.length;r++){var h,c=(i[r]+",").match(o);if(c.length>0){for(s[u]=[],e=0;e<c.length;e++)h=(n=c[e]).substr(0,n.length-1),a.test(h)?s[u][e]=parseFloat(h):s[u][e]=h;u++}}return s},r.toCSV=function(t){var e,n,i,s,o,a=r.dim(t);for(i=a[0],a[1],o=[],e=0;i>e;e++){for(s=[],n=0;i>n;n++)s[n]=t[e][n].toString();o[e]=s.join(", ")}return o.join("\n")+"\n"},r.getURL=function(t){var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(),e},r.imageURL=function(t){function e(t,e,r){void 0===e&&(e=0),void 0===r&&(r=t.length);var n,i=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],s=-1;for(t.length,n=e;r>n;n++)s=s>>>8^i[255&(s^t[n])];return~s}var r,n,i,s,o,a,u,h,c,l,f=t[0].length,d=t[0][0].length,p=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,d>>24&255,d>>16&255,d>>8&255,255&d,f>>24&255,f>>16&255,f>>8&255,255&f,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];for(l=e(p,12,29),p[29]=l>>24&255,p[30]=l>>16&255,p[31]=l>>8&255,p[32]=255&l,r=1,n=0,u=0;f>u;u++){for(f-1>u?p.push(0):p.push(1),o=3*d+1+(0===u)&255,a=3*d+1+(0===u)>>8&255,p.push(o),p.push(a),p.push(255&~o),p.push(255&~a),0===u&&p.push(0),h=0;d>h;h++)for(i=0;3>i;i++)n=(n+(r=(r+(o=(o=t[i][u][h])>255?255:0>o?0:Math.round(o)))%65521))%65521,p.push(o);p.push(0)}return c=(n<<16)+r,p.push(c>>24&255),p.push(c>>16&255),p.push(c>>8&255),p.push(255&c),s=p.length-41,p[33]=s>>24&255,p[34]=s>>16&255,p[35]=s>>8&255,p[36]=255&s,l=e(p,37),p.push(l>>24&255),p.push(l>>16&255),p.push(l>>8&255),p.push(255&l),p.push(0),p.push(0),p.push(0),p.push(0),p.push(73),p.push(69),p.push(78),p.push(68),p.push(174),p.push(66),p.push(96),p.push(130),"data:image/png;base64,"+function(t){var e,r,n,i,s,o,a,u=t.length,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="";for(e=0;u>e;e+=3)s=((3&(r=t[e]))<<4)+((n=t[e+1])>>4),o=((15&n)<<2)+((i=t[e+2])>>6),a=63&i,u>e+1?u>e+2||(a=64):o=a=64,c+=h.charAt(r>>2)+h.charAt(s)+h.charAt(o)+h.charAt(a);return c}(p)},r._dim=function(t){for(var e=[];"object"==typeof t;)e.push(t.length),t=t[0];return e},r.dim=function(t){var e;return"object"==typeof t?"object"==typeof(e=t[0])?"object"==typeof e[0]?r._dim(t):[t.length,e.length]:[t.length]:[]},r.mapreduce=function(t,e){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+e+';\nif(typeof x === "number") { var xi = x; '+t+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+t+";\n    xi = x[i-1];\n    "+t+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+t+"\n}\nreturn accum;")},r.mapreduce2=function(t,e){return Function("x","var n = x.length;\nvar i,xi;\n"+e+";\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+t+";\n}\nreturn accum;")},r.same=function t(e,r){var n,i;if(!(e instanceof Array&&r instanceof Array))return!1;if((i=e.length)!==r.length)return!1;for(n=0;i>n;n++)if(e[n]!==r[n]){if("object"!=typeof e[n])return!1;if(!t(e[n],r[n]))return!1}return!0},r.rep=function(t,e,n){void 0===n&&(n=0);var i,s=t[n],o=Array(s);if(n===t.length-1){for(i=s-2;i>=0;i-=2)o[i+1]=e,o[i]=e;return-1===i&&(o[0]=e),o}for(i=s-1;i>=0;i--)o[i]=r.rep(t,e,n+1);return o},r.dotMMsmall=function(t,e){var r,n,i,s,o,a,u,h,c,l,f;for(s=t.length,o=e.length,a=e[0].length,u=Array(s),r=s-1;r>=0;r--){for(h=Array(a),c=t[r],i=a-1;i>=0;i--){for(l=c[o-1]*e[o-1][i],n=o-2;n>=1;n-=2)f=n-1,l+=c[n]*e[n][i]+c[f]*e[f][i];0===n&&(l+=c[0]*e[0][i]),h[i]=l}u[r]=h}return u},r._getCol=function(t,e,r){var n;for(n=t.length-1;n>0;--n)r[n]=t[n][e],r[--n]=t[n][e];0===n&&(r[0]=t[0][e])},r.dotMMbig=function(t,e){var n,i,s,o=r._getCol,a=e.length,u=Array(a),h=t.length,c=e[0].length,l=Array(h),f=r.dotVV;for(--a,i=--h;-1!==i;--i)l[i]=Array(c);for(i=--c;-1!==i;--i)for(o(e,i,u),s=h;-1!==s;--s)n=t[s],l[s][i]=f(n,u);return l},r.dotMV=function(t,e){var n,i=t.length;e.length;var s=Array(i),o=r.dotVV;for(n=i-1;n>=0;n--)s[n]=o(t[n],e);return s},r.dotVM=function(t,e){var r,n,i,s,o,a,u;for(i=t.length,s=e[0].length,o=Array(s),n=s-1;n>=0;n--){for(a=t[i-1]*e[i-1][n],r=i-2;r>=1;r-=2)u=r-1,a+=t[r]*e[r][n]+t[u]*e[u][n];0===r&&(a+=t[0]*e[0][n]),o[n]=a}return o},r.dotVV=function(t,e){var r,n,i=t.length,s=t[i-1]*e[i-1];for(r=i-2;r>=1;r-=2)n=r-1,s+=t[r]*e[r]+t[n]*e[n];return 0===r&&(s+=t[0]*e[0]),s},r.dot=function(t,e){var n=r.dim;switch(1e3*n(t).length+n(e).length){case 2002:return 10>e.length?r.dotMMsmall(t,e):r.dotMMbig(t,e);case 2001:return r.dotMV(t,e);case 1002:return r.dotVM(t,e);case 1001:return r.dotVV(t,e);case 1e3:return r.mulVS(t,e);case 1:return r.mulSV(t,e);case 0:return t*e;default:throw Error("numeric.dot only works on vectors and matrices")}},r.diag=function(t){var e,r,n,i,s=t.length,o=Array(s);for(e=s-1;e>=0;e--){for(i=Array(s),r=e+2,n=s-1;n>=r;n-=2)i[n]=0,i[n-1]=0;for(n>e&&(i[n]=0),i[e]=t[e],n=e-1;n>=1;n-=2)i[n]=0,i[n-1]=0;0===n&&(i[0]=0),o[e]=i}return o},r.getDiag=function(t){var e,r=Math.min(t.length,t[0].length),n=Array(r);for(e=r-1;e>=1;--e)n[e]=t[e][e],n[--e]=t[e][e];return 0===e&&(n[0]=t[0][0]),n},r.identity=function(t){return r.diag(r.rep([t],1))},r.pointwise=function(t,e,r){void 0===r&&(r="");var n,i,s=[],o=/\[i\]$/,a="",u=!1;for(n=0;n<t.length;n++)o.test(t[n])?a=i=t[n].substring(0,t[n].length-3):i=t[n],"ret"===i&&(u=!0),s.push(i);return s[t.length]="_s",s[t.length+1]="_k",s[t.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+a+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(u?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+t.join(",")+",_s,_k+1);\n    return ret;\n}\n"+r+"\nfor(i=_n-1;i!==-1;--i) {\n    "+e+"\n}\nreturn ret;",Function.apply(null,s)},r.pointwise2=function(t,e,r){void 0===r&&(r="");var n,i,s=[],o=/\[i\]$/,a="",u=!1;for(n=0;n<t.length;n++)o.test(t[n])?a=i=t[n].substring(0,t[n].length-3):i=t[n],"ret"===i&&(u=!0),s.push(i);return s[t.length]="var _n = "+a+".length;\nvar i"+(u?"":", ret = Array(_n)")+";\n"+r+"\nfor(i=_n-1;i!==-1;--i) {\n"+e+"\n}\nreturn ret;",Function.apply(null,s)},r._biforeach=function t(e,r,n,i,s){var o;if(i!==n.length-1)for(o=n[i]-1;o>=0;o--)t("object"==typeof e?e[o]:e,"object"==typeof r?r[o]:r,n,i+1,s);else s(e,r)},r._biforeach2=function t(e,r,n,i,s){if(i===n.length-1)return s(e,r);var o,a=n[i],u=Array(a);for(o=a-1;o>=0;--o)u[o]=t("object"==typeof e?e[o]:e,"object"==typeof r?r[o]:r,n,i+1,s);return u},r._foreach=function t(e,r,n,i){var s;if(n!==r.length-1)for(s=r[n]-1;s>=0;s--)t(e[s],r,n+1,i);else i(e)},r._foreach2=function t(e,r,n,i){if(n===r.length-1)return i(e);var s,o=r[n],a=Array(o);for(s=o-1;s>=0;s--)a[s]=t(e[s],r,n+1,i);return a},r.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},r.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},r.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],r.mathfuns2=["atan2","pow","max","min"],r.ops1={neg:"-",not:"!",bnot:"~",clone:""},r.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){var t,e;for(t=0;t<r.mathfuns2.length;++t)e=r.mathfuns2[t],r.ops2[e]=e;for(t in r.ops2)if(r.ops2.hasOwnProperty(t)){e=r.ops2[t];var n,i,s="";-1!==r.myIndexOf.call(r.mathfuns2,t)?(s="var "+e+" = Math."+e+";\n",n=function(t,r,n){return t+" = "+e+"("+r+","+n+")"},i=function(t,r){return t+" = "+e+"("+t+","+r+")"}):(n=function(t,r,n){return t+" = "+r+" "+e+" "+n},i=r.opseq.hasOwnProperty(t+"eq")?function(t,r){return t+" "+e+"= "+r}:function(t,r){return t+" = "+t+" "+e+" "+r}),r[t+"VV"]=r.pointwise2(["x[i]","y[i]"],n("ret[i]","x[i]","y[i]"),s),r[t+"SV"]=r.pointwise2(["x","y[i]"],n("ret[i]","x","y[i]"),s),r[t+"VS"]=r.pointwise2(["x[i]","y"],n("ret[i]","x[i]","y"),s),r[t]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+t+"VV, VS = numeric."+t+"VS, SV = numeric."+t+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+i("x","y")+"\n}\nreturn x;\n"),r[e]=r[t],r[t+"eqV"]=r.pointwise2(["ret[i]","x[i]"],i("ret[i]","x[i]"),s),r[t+"eqS"]=r.pointwise2(["ret[i]","x"],i("ret[i]","x"),s),r[t+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+t+"eqV, S = numeric."+t+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n')}for(t=0;t<r.mathfuns2.length;++t)e=r.mathfuns2[t],delete r.ops2[e];for(t=0;t<r.mathfuns.length;++t)e=r.mathfuns[t],r.ops1[e]=e;for(t in r.ops1)r.ops1.hasOwnProperty(t)&&(s="",e=r.ops1[t],-1!==r.myIndexOf.call(r.mathfuns,t)&&Math.hasOwnProperty(e)&&(s="var "+e+" = Math."+e+";\n"),r[t+"eqV"]=r.pointwise2(["ret[i]"],"ret[i] = "+e+"(ret[i]);",s),r[t+"eq"]=Function("x",'if(typeof x !== "object") return '+e+"x\nvar i;\nvar V = numeric."+t+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),r[t+"V"]=r.pointwise2(["x[i]"],"ret[i] = "+e+"(x[i]);",s),r[t]=Function("x",'if(typeof x !== "object") return '+e+"(x)\nvar i;\nvar V = numeric."+t+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));for(t=0;t<r.mathfuns.length;++t)e=r.mathfuns[t],delete r.ops1[e];for(t in r.mapreducers)r.mapreducers.hasOwnProperty(t)&&(e=r.mapreducers[t],r[t+"V"]=r.mapreduce2(e[0],e[1]),r[t]=Function("x","s","k",e[1]+'if(typeof x !== "object") {    xi = x;\n'+e[0]+';\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+t+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+e[0]+";\n}\nreturn accum;\n"))}(),r.truncVV=r.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;"),r.truncVS=r.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;"),r.truncSV=r.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;"),r.trunc=function(t,e){return"object"==typeof t?"object"==typeof e?r.truncVV(t,e):r.truncVS(t,e):"object"==typeof e?r.truncSV(t,e):Math.round(t/e)*e},r.inv=function(t){var e,n,i,s,o,a,u,h=r.dim(t),c=Math.abs,l=h[0],f=h[1],d=r.clone(t),p=r.identity(l);for(a=0;f>a;++a){var m=-1,v=-1;for(o=a;o!==l;++o)(u=c(d[o][a]))>v&&(m=o,v=u);for(n=d[m],d[m]=d[a],d[a]=n,s=p[m],p[m]=p[a],p[a]=s,t=n[a],u=a;u!==f;++u)n[u]/=t;for(u=f-1;-1!==u;--u)s[u]/=t;for(o=l-1;-1!==o;--o)if(o!==a){for(e=d[o],i=p[o],t=e[a],u=a+1;u!==f;++u)e[u]-=n[u]*t;for(u=f-1;u>0;--u)i[u]-=s[u]*t,i[--u]-=s[u]*t;0===u&&(i[0]-=s[0]*t)}}return p},r.det=function(t){var e=r.dim(t);if(2!==e.length||e[0]!==e[1])throw Error("numeric: det() only works on square matrices");var n,i,s,o,a,u,h,c,l=e[0],f=1,d=r.clone(t);for(i=0;l-1>i;i++){for(s=i,n=i+1;l>n;n++)Math.abs(d[n][i])>Math.abs(d[s][i])&&(s=n);for(s!==i&&(h=d[s],d[s]=d[i],d[i]=h,f*=-1),o=d[i],n=i+1;l>n;n++){for(u=(a=d[n])[i]/o[i],s=i+1;l-1>s;s+=2)c=s+1,a[s]-=o[s]*u,a[c]-=o[c]*u;s!==l&&(a[s]-=o[s]*u)}if(0===o[i])return 0;f*=o[i]}return f*d[i][i]},r.transpose=function(t){var e,r,n,i,s,o=t.length,a=t[0].length,u=Array(a);for(r=0;a>r;r++)u[r]=Array(o);for(e=o-1;e>=1;e-=2){for(i=t[e],n=t[e-1],r=a-1;r>=1;--r)(s=u[r])[e]=i[r],s[e-1]=n[r],(s=u[--r])[e]=i[r],s[e-1]=n[r];0===r&&((s=u[0])[e]=i[0],s[e-1]=n[0])}if(0===e){for(n=t[0],r=a-1;r>=1;--r)u[r][0]=n[r],u[--r][0]=n[r];0===r&&(u[0][0]=n[0])}return u},r.negtranspose=function(t){var e,r,n,i,s,o=t.length,a=t[0].length,u=Array(a);for(r=0;a>r;r++)u[r]=Array(o);for(e=o-1;e>=1;e-=2){for(i=t[e],n=t[e-1],r=a-1;r>=1;--r)(s=u[r])[e]=-i[r],s[e-1]=-n[r],(s=u[--r])[e]=-i[r],s[e-1]=-n[r];0===r&&((s=u[0])[e]=-i[0],s[e-1]=-n[0])}if(0===e){for(n=t[0],r=a-1;r>=1;--r)u[r][0]=-n[r],u[--r][0]=-n[r];0===r&&(u[0][0]=-n[0])}return u},r._random=function t(e,r){var n,i,s=e[r],o=Array(s);if(r===e.length-1){for(i=Math.random,n=s-1;n>=1;n-=2)o[n]=i(),o[n-1]=i();return 0===n&&(o[0]=i()),o}for(n=s-1;n>=0;n--)o[n]=t(e,r+1);return o},r.random=function(t){return r._random(t,0)},r.norm2=function(t){return Math.sqrt(r.norm2Squared(t))},r.linspace=function(t,e,r){if(void 0===r&&(r=Math.max(Math.round(e-t)+1,1)),2>r)return 1===r?[t]:[];var n,i=Array(r);for(n=--r;n>=0;n--)i[n]=(n*e+(r-n)*t)/r;return i},r.getBlock=function(t,e,n){var i=r.dim(t);return function t(r,s){var o,a=e[s],u=n[s]-a,h=Array(u);if(s===i.length-1){for(o=u;o>=0;o--)h[o]=r[o+a];return h}for(o=u;o>=0;o--)h[o]=t(r[o+a],s+1);return h}(t,0)},r.setBlock=function(t,e,n,i){var s=r.dim(t);return function t(r,i,o){var a,u=e[o],h=n[o]-u;if(o===s.length-1)for(a=h;a>=0;a--)r[a+u]=i[a];for(a=h;a>=0;a--)t(r[a+u],i[a],o+1)}(t,i,0),t},r.getRange=function(t,e,r){var n,i,s,o,a=e.length,u=r.length,h=Array(a);for(n=a-1;-1!==n;--n)for(h[n]=Array(u),s=h[n],o=t[e[n]],i=u-1;-1!==i;--i)s[i]=o[r[i]];return h},r.blockMatrix=function(t){var e=r.dim(t);if(4>e.length)return r.blockMatrix([t]);var n,i,s,o,a,u=e[0],h=e[1];for(n=0,i=0,s=0;u>s;++s)n+=t[s][0].length;for(o=0;h>o;++o)i+=t[0][o][0].length;var c=Array(n);for(s=0;n>s;++s)c[s]=Array(i);var l,f,d,p,m,v=0;for(s=0;u>s;++s){for(l=i,o=h-1;-1!==o;--o)for(l-=(a=t[s][o])[0].length,d=a.length-1;-1!==d;--d)for(m=a[d],f=c[v+d],p=m.length-1;-1!==p;--p)f[l+p]=m[p];v+=t[s][0].length}return c},r.tensor=function(t,e){if("number"==typeof t||"number"==typeof e)return r.mul(t,e);var n=r.dim(t),i=r.dim(e);if(1!==n.length||1!==i.length)throw Error("numeric: tensor product is only defined for vectors");var s,o,a,u,h=n[0],c=i[0],l=Array(h);for(o=h-1;o>=0;o--){for(s=Array(c),u=t[o],a=c-1;a>=3;--a)s[a]=u*e[a],s[--a]=u*e[a],s[--a]=u*e[a],s[--a]=u*e[a];for(;a>=0;)s[a]=u*e[a],--a;l[o]=s}return l},r.T=function(t,e){this.x=t,this.y=e},r.t=function(t,e){return new r.T(t,e)},r.Tbinop=function(t,e,n,i,s){var o;if(r.indexOf,"string"!=typeof s)for(o in s="",r)!r.hasOwnProperty(o)||0>t.indexOf(o)&&0>e.indexOf(o)&&0>n.indexOf(o)&&0>i.indexOf(o)||1>=o.length||(s+="var "+o+" = numeric."+o+";\n");return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+s+"\nif(x.y) {  if(y.y) {    return new numeric.T("+i+");\n  }\n  return new numeric.T("+n+");\n}\nif(y.y) {\n  return new numeric.T("+e+");\n}\nreturn new numeric.T("+t+");\n")},r.T.prototype.add=r.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)"),r.T.prototype.sub=r.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)"),r.T.prototype.mul=r.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))"),r.T.prototype.reciprocal=function(){var t=r.mul,e=r.div;if(this.y){var n=r.add(t(this.x,this.x),t(this.y,this.y));return new r.T(e(this.x,n),e(r.neg(this.y),n))}return new T(e(1,this.x))},r.T.prototype.div=function(t){if(t instanceof r.T||(t=new r.T(t)),t.y)return this.mul(t.reciprocal());var e=r.div;return this.y?new r.T(e(this.x,t.x),e(this.y,t.x)):new r.T(e(this.x,t.x))},r.T.prototype.dot=r.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))"),r.T.prototype.transpose=function(){var t=r.transpose,e=this.x,n=this.y;return n?new r.T(t(e),t(n)):new r.T(t(e))},r.T.prototype.transjugate=function(){var t=r.transpose,e=this.x,n=this.y;return n?new r.T(t(e),r.negtranspose(n)):new r.T(t(e))},r.Tunop=function(t,e,r){return"string"!=typeof r&&(r=""),Function("var x = this;\n"+r+"\nif(x.y) {  "+e+";\n}\n"+t+";\n")},r.T.prototype.exp=r.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;"),r.T.prototype.conj=r.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));"),r.T.prototype.neg=r.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;"),r.T.prototype.sin=r.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));"),r.T.prototype.cos=r.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);"),r.T.prototype.abs=r.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;"),r.T.prototype.log=r.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);"),r.T.prototype.norm2=r.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));"),r.T.prototype.inv=function(){var t=this;if(void 0===t.y)return new r.T(r.inv(t.x));var e,n,i,s,o,a,u,h,c,l,f,d,p,m,v,g,y,x,_=t.x.length,b=r.identity(_),w=r.rep([_,_],0),S=r.clone(t.x),z=r.clone(t.y);for(c=0;_>c;c++){for(d=(m=S[c][c])*m+(v=z[c][c])*v,f=c,l=c+1;_>l;l++)(p=(m=S[l][c])*m+(v=z[l][c])*v)>d&&(f=l,d=p);for(f!==c&&(x=S[c],S[c]=S[f],S[f]=x,x=z[c],z[c]=z[f],z[f]=x,x=b[c],b[c]=b[f],b[f]=x,x=w[c],w[c]=w[f],w[f]=x),e=S[c],n=z[c],o=b[c],a=w[c],m=e[c],v=n[c],l=c+1;_>l;l++)g=e[l],y=n[l],e[l]=(g*m+y*v)/d,n[l]=(y*m-g*v)/d;for(l=0;_>l;l++)g=o[l],y=a[l],o[l]=(g*m+y*v)/d,a[l]=(y*m-g*v)/d;for(l=c+1;_>l;l++){for(i=S[l],s=z[l],u=b[l],h=w[l],m=i[c],v=s[c],f=c+1;_>f;f++)g=e[f],y=n[f],i[f]-=g*m-y*v,s[f]-=y*m+g*v;for(f=0;_>f;f++)g=o[f],y=a[f],u[f]-=g*m-y*v,h[f]-=y*m+g*v}}for(c=_-1;c>0;c--)for(o=b[c],a=w[c],l=c-1;l>=0;l--)for(u=b[l],h=w[l],m=S[l][c],v=z[l][c],f=_-1;f>=0;f--)g=o[f],y=a[f],u[f]-=m*g-v*y,h[f]-=m*y+v*g;return new r.T(b,w)},r.T.prototype.get=function(t){var e,n=this.x,i=this.y,s=0,o=t.length;if(i){for(;o>s;)n=n[e=t[s]],i=i[e],s++;return new r.T(n,i)}for(;o>s;)n=n[e=t[s]],s++;return new r.T(n)},r.T.prototype.set=function(t,e){var n,i=this.x,s=this.y,o=0,a=t.length,u=e.x,h=e.y;if(0===a)return h?this.y=h:s&&(this.y=void 0),this.x=i,this;if(h){for(s||(s=r.rep(r.dim(i),0),this.y=s);a-1>o;)i=i[n=t[o]],s=s[n],o++;return i[n=t[o]]=u,s[n]=h,this}if(s){for(;a-1>o;)i=i[n=t[o]],s=s[n],o++;return i[n=t[o]]=u,s[n]=u instanceof Array?r.rep(r.dim(u),0):0,this}for(;a-1>o;)i=i[n=t[o]],o++;return i[n=t[o]]=u,this},r.T.prototype.getRows=function(t,e){var n,i,s=e-t+1,o=Array(s),a=this.x,u=this.y;for(n=t;e>=n;n++)o[n-t]=a[n];if(u){for(i=Array(s),n=t;e>=n;n++)i[n-t]=u[n];return new r.T(o,i)}return new r.T(o)},r.T.prototype.setRows=function(t,e,n){var i,s=this.x,o=this.y,a=n.x,u=n.y;for(i=t;e>=i;i++)s[i]=a[i-t];if(u)for(o||(o=r.rep(r.dim(s),0),this.y=o),i=t;e>=i;i++)o[i]=u[i-t];else if(o)for(i=t;e>=i;i++)o[i]=r.rep([a[i-t].length],0);return this},r.T.prototype.getRow=function(t){var e=this.x,n=this.y;return n?new r.T(e[t],n[t]):new r.T(e[t])},r.T.prototype.setRow=function(t,e){var n=this.x,i=this.y,s=e.x,o=e.y;return n[t]=s,o?(i||(i=r.rep(r.dim(n),0),this.y=i),i[t]=o):i&&(i=r.rep([s.length],0)),this},r.T.prototype.getBlock=function(t,e){var n=this.x,i=this.y,s=r.getBlock;return i?new r.T(s(n,t,e),s(i,t,e)):new r.T(s(n,t,e))},r.T.prototype.setBlock=function(t,e,n){n instanceof r.T||(n=new r.T(n));var i=this.x,s=this.y,o=r.setBlock,a=n.x,u=n.y;if(u)return s||(this.y=r.rep(r.dim(this),0),s=this.y),o(i,t,e,a),o(s,t,e,u),this;o(i,t,e,a),s&&o(s,t,e,r.rep(r.dim(a),0))},r.T.rep=function(t,e){var n=r.T;e instanceof n||(e=new n(e));var i=e.x,s=e.y,o=r.rep;return s?new n(o(t,i),o(t,s)):new n(o(t,i))},r.T.diag=function(t){t instanceof r.T||(t=new r.T(t));var e=t.x,n=t.y,i=r.diag;return n?new r.T(i(e),i(n)):new r.T(i(e))},r.T.eig=function(){if(this.y)throw Error("eig: not implemented for complex matrices.");return r.eig(this.x)},r.T.identity=function(t){return new r.T(r.identity(t))},r.T.prototype.getDiag=function(){var t=r,e=this.x,n=this.y;return n?new t.T(t.getDiag(e),t.getDiag(n)):new t.T(t.getDiag(e))},r.house=function(t){var e=r.clone(t),n=(0>t[0]?-1:1)*r.norm2(t);e[0]+=n;var i=r.norm2(e);if(0===i)throw Error("eig: internal error");return r.div(e,i)},r.toUpperHessenberg=function(t){var e=r.dim(t);if(2!==e.length||e[0]!==e[1])throw Error("numeric: toUpperHessenberg() only works on square matrices");var n,i,s,o,a,u,h,c,l,f,d=e[0],p=r.clone(t),m=r.identity(d);for(i=0;d-2>i;i++){for(o=Array(d-i-1),n=i+1;d>n;n++)o[n-i-1]=p[n][i];if(r.norm2(o)>0){for(a=r.house(o),u=r.getBlock(p,[i+1,i],[d-1,d-1]),h=r.tensor(a,r.dot(a,u)),n=i+1;d>n;n++)for(c=p[n],l=h[n-i-1],s=i;d>s;s++)c[s]-=2*l[s-i];for(u=r.getBlock(p,[0,i+1],[d-1,d-1]),h=r.tensor(r.dot(u,a),a),n=0;d>n;n++)for(c=p[n],l=h[n],s=i+1;d>s;s++)c[s]-=2*l[s-i-1];for(u=Array(d-i-1),n=i+1;d>n;n++)u[n-i-1]=m[n];for(h=r.tensor(a,r.dot(a,u)),n=i+1;d>n;n++)for(f=m[n],l=h[n-i-1],s=0;d>s;s++)f[s]-=2*l[s]}}return{H:p,Q:m}},r.epsilon=2220446049250313e-31,r.QRFrancis=function(t,e){void 0===e&&(e=1e4),t=r.clone(t),r.clone(t);var n,i,s,o,a,u,h,c,l,f,d,p,m,v,g,y,x,_,b=r.dim(t)[0],w=r.identity(b);if(3>b)return{Q:w,B:[[0,b-1]]};var S=r.epsilon;for(_=0;e>_;_++){for(y=0;b-1>y;y++)if(Math.abs(t[y+1][y])<S*(Math.abs(t[y][y])+Math.abs(t[y+1][y+1]))){var z=r.QRFrancis(r.getBlock(t,[0,0],[y,y]),e),M=r.QRFrancis(r.getBlock(t,[y+1,y+1],[b-1,b-1]),e);for(p=Array(y+1),g=0;y>=g;g++)p[g]=w[g];for(m=r.dot(z.Q,p),g=0;y>=g;g++)w[g]=m[g];for(p=Array(b-y-1),g=y+1;b>g;g++)p[g-y-1]=w[g];for(m=r.dot(M.Q,p),g=y+1;b>g;g++)w[g]=m[g-y-1];return{Q:w,B:z.B.concat(r.add(M.B,y+1))}}var C,P,A;for(s=t[b-2][b-2],o=t[b-2][b-1],a=t[b-1][b-2],c=s+(u=t[b-1][b-1]),h=s*u-o*a,l=r.getBlock(t,[0,0],[2,2]),4*h>c*c?l=r.add(r.sub(r.dot(l,l),r.mul(l,c)),r.diag(r.rep([3],h))):(C=.5*(c+Math.sqrt(c*c-4*h)),P=.5*(c-Math.sqrt(c*c-4*h)),l=r.add(r.sub(r.dot(l,l),r.mul(l,C+P)),r.diag(r.rep([3],C*P)))),n=[l[0][0],l[1][0],l[2][0]],i=r.house(n),p=[t[0],t[1],t[2]],m=r.tensor(i,r.dot(i,p)),g=0;3>g;g++)for(d=t[g],v=m[g],x=0;b>x;x++)d[x]-=2*v[x];for(p=r.getBlock(t,[0,0],[b-1,2]),m=r.tensor(r.dot(p,i),i),g=0;b>g;g++)for(d=t[g],v=m[g],x=0;3>x;x++)d[x]-=2*v[x];for(p=[w[0],w[1],w[2]],m=r.tensor(i,r.dot(i,p)),g=0;3>g;g++)for(f=w[g],v=m[g],x=0;b>x;x++)f[x]-=2*v[x];for(y=0;b-2>y;y++){for(x=y;y+1>=x;x++)if(Math.abs(t[x+1][x])<S*(Math.abs(t[x][x])+Math.abs(t[x+1][x+1]))){for(z=r.QRFrancis(r.getBlock(t,[0,0],[x,x]),e),M=r.QRFrancis(r.getBlock(t,[x+1,x+1],[b-1,b-1]),e),p=Array(x+1),g=0;x>=g;g++)p[g]=w[g];for(m=r.dot(z.Q,p),g=0;x>=g;g++)w[g]=m[g];for(p=Array(b-x-1),g=x+1;b>g;g++)p[g-x-1]=w[g];for(m=r.dot(M.Q,p),g=x+1;b>g;g++)w[g]=m[g-x-1];return{Q:w,B:z.B.concat(r.add(M.B,x+1))}}for(n=Array((A=Math.min(b-1,y+3))-y),g=y+1;A>=g;g++)n[g-y-1]=t[g][y];for(i=r.house(n),p=r.getBlock(t,[y+1,y],[A,b-1]),m=r.tensor(i,r.dot(i,p)),g=y+1;A>=g;g++)for(d=t[g],v=m[g-y-1],x=y;b>x;x++)d[x]-=2*v[x-y];for(p=r.getBlock(t,[0,y+1],[b-1,A]),m=r.tensor(r.dot(p,i),i),g=0;b>g;g++)for(d=t[g],v=m[g],x=y+1;A>=x;x++)d[x]-=2*v[x-y-1];for(p=Array(A-y),g=y+1;A>=g;g++)p[g-y-1]=w[g];for(m=r.tensor(i,r.dot(i,p)),g=y+1;A>=g;g++)for(f=w[g],v=m[g-y-1],x=0;b>x;x++)f[x]-=2*v[x]}}throw Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")},r.eig=function(t,e){var n,i,s,o,a,u,h,c,l,f,d,p,m,v,g,y,x=r.toUpperHessenberg(t),_=r.QRFrancis(x.H,e),b=r.T,w=t.length,S=_.B,z=r.dot(_.Q,r.dot(x.H,r.transpose(_.Q))),M=new b(r.dot(_.Q,x.Q)),C=S.length,P=Math.sqrt;for(i=0;C>i;i++)if((n=S[i][0])===S[i][1]);else{if(o=n+1,a=z[n][n],u=z[n][o],h=z[o][n],c=z[o][o],0===u&&0===h)continue;0>(f=(l=-a-c)*l-4*(a*c-u*h))?(d=-.5*l,p=.5*P(-f),(g=(a-d)*(a-d)+u*u)>(y=h*h+(c-d)*(c-d))?(m=(a-d)/(g=P(g+p*p)),v=u/g,d=0,p/=g):(m=h/(y=P(y+p*p)),v=(c-d)/y,d=p/y,p=0),s=new b([[v,-m],[m,v]],[[d,p],[p,-d]]),M.setRows(n,o,s.dot(M.getRows(n,o)))):((g=(a-(d=0>l?-.5*(l-P(f)):-.5*(l+P(f))))*(a-d)+u*u)>(y=h*h+(c-d)*(c-d))?(m=(a-d)/(g=P(g)),v=u/g):(m=h/(y=P(y)),v=(c-d)/y),s=new b([[v,-m],[m,v]]),M.setRows(n,o,s.dot(M.getRows(n,o))))}var A=M.dot(t).dot(M.transjugate()),E=(w=t.length,r.T.identity(w));for(o=0;w>o;o++)if(o>0)for(i=o-1;i>=0;i--){var k=A.get([i,i]),T=A.get([o,o]);r.neq(k.x,T.x)||r.neq(k.y,T.y)?(d=A.getRow(i).getBlock([i],[o-1]),p=E.getRow(o).getBlock([i],[o-1]),E.set([o,i],A.get([i,o]).neg().sub(d.dot(p)).div(k.sub(T)))):E.setRow(o,E.getRow(i))}for(o=0;w>o;o++)d=E.getRow(o),E.setRow(o,d.div(d.norm2()));return E=E.transpose(),E=M.transjugate().dot(E),{lambda:A.getDiag(),E:E}},r.ccsSparse=function(t){var e,r,n,i=t.length,s=[];for(r=i-1;-1!==r;--r)for(n in e=t[r]){for(n=parseInt(n);n>=s.length;)s[s.length]=0;0!==e[n]&&s[n]++}var o=s.length,a=Array(o+1);for(a[0]=0,r=0;o>r;++r)a[r+1]=a[r]+s[r];var u=Array(a[o]),h=Array(a[o]);for(r=i-1;-1!==r;--r)for(n in e=t[r])0!==e[n]&&(s[n]--,u[a[n]+s[n]]=r,h[a[n]+s[n]]=e[n]);return[a,u,h]},r.ccsFull=function(t){var e,n,i,s,o=t[0],a=t[1],u=t[2],h=r.ccsDim(t),c=h[0],l=h[1],f=r.rep([c,l],0);for(e=0;l>e;e++)for(i=o[e],s=o[e+1],n=i;s>n;++n)f[a[n]][e]=u[n];return f},r.ccsTSolve=function(t,e,n,i,s){function o(t){var e;if(0===n[t]){for(n[t]=1,e=p[t];e<p[t+1];++e)o(m[e]);s[x]=t,++x}}var a,u,h,c,l,f,d,p=t[0],m=t[1],v=t[2],g=p.length-1,y=Math.max,x=0;for(void 0===i&&(n=r.rep([g],0)),void 0===i&&(i=r.linspace(0,n.length-1)),void 0===s&&(s=[]),a=i.length-1;-1!==a;--a)o(i[a]);for(s.length=x,a=s.length-1;-1!==a;--a)n[s[a]]=0;for(a=i.length-1;-1!==a;--a)u=i[a],n[u]=e[u];for(a=s.length-1;-1!==a;--a){for(u=s[a],h=p[u],c=y(p[u+1],h),l=h;l!==c;++l)if(m[l]===u){n[u]/=v[l];break}for(d=n[u],l=h;l!==c;++l)(f=m[l])!==u&&(n[f]-=d*v[l])}return n},r.ccsDFS=function(t){this.k=Array(t),this.k1=Array(t),this.j=Array(t)},r.ccsDFS.prototype.dfs=function(t,e,r,n,i,s){var o,a,u,h=0,c=i.length,l=this.k,f=this.k1,d=this.j;if(0===n[t])for(n[t]=1,d[0]=t,l[0]=a=e[t],f[0]=u=e[t+1];;)if(u>a)0===n[o=s[r[a]]]?(n[o]=1,l[h]=a,d[++h]=o,a=e[o],f[h]=u=e[o+1]):++a;else{if(i[c]=d[h],0===h)return;++c,a=l[--h],u=f[h]}},r.ccsLPSolve=function(t,e,r,n,i,s,o){var a=t[0],u=t[1],h=t[2];a.length;var c,l,f,d,p,m,v,g,y,x=e[0],_=e[1],b=e[2];for(l=x[i],f=x[i+1],n.length=0,c=l;f>c;++c)o.dfs(s[_[c]],a,u,r,n,s);for(c=n.length-1;-1!==c;--c)r[n[c]]=0;for(c=l;c!==f;++c)r[d=s[_[c]]]=b[c];for(c=n.length-1;-1!==c;--c){for(p=a[d=n[c]],m=a[d+1],v=p;m>v;++v)if(s[u[v]]===d){r[d]/=h[v];break}for(y=r[d],v=p;m>v;++v)(g=s[u[v]])!==d&&(r[g]-=y*h[v])}return r},r.ccsLUP1=function(t,e){var n,i,s,o,a,u,h,c=t[0].length-1,l=[r.rep([c+1],0),[],[]],f=[r.rep([c+1],0),[],[]],d=l[0],p=l[1],m=l[2],v=f[0],g=f[1],y=f[2],x=r.rep([c],0),_=r.rep([c],0),b=r.ccsLPSolve,w=Math.abs,S=r.linspace(0,c-1),z=r.linspace(0,c-1),M=new r.ccsDFS(c);for(void 0===e&&(e=1),n=0;c>n;++n){for(b(l,t,x,_,n,z,M),o=-1,a=-1,i=_.length-1;-1!==i;--i)(s=_[i])>n&&(u=w(x[s]))>o&&(a=s,o=u);for(w(x[n])<e*o&&(i=S[n],o=S[a],S[n]=o,z[o]=n,S[a]=i,z[i]=a,o=x[n],x[n]=x[a],x[a]=o),o=d[n],a=v[n],h=x[n],p[o]=S[n],m[o]=1,++o,i=_.length-1;-1!==i;--i)u=x[s=_[i]],_[i]=0,x[s]=0,s>n?(p[o]=S[s],m[o]=u/h,++o):(g[a]=s,y[a]=u,++a);d[n+1]=o,v[n+1]=a}for(i=p.length-1;-1!==i;--i)p[i]=z[p[i]];return{L:l,U:f,P:S,Pinv:z}},r.ccsDFS0=function(t){this.k=Array(t),this.k1=Array(t),this.j=Array(t)},r.ccsDFS0.prototype.dfs=function(t,e,r,n,i,s){var o,a,u,h=0,c=i.length,l=this.k,f=this.k1,d=this.j;if(0===n[t])for(n[t]=1,d[0]=t,l[0]=a=e[s[t]],f[0]=u=e[s[t]+1];;){if(isNaN(a))throw Error("Ow!");if(u>a)0===n[o=r[a]]?(n[o]=1,l[h]=a,d[++h]=o,a=e[o=s[o]],f[h]=u=e[o+1]):++a;else{if(i[c]=s[d[h]],0===h)return;++c,a=l[--h],u=f[h]}}},r.ccsLPSolve0=function(t,e,r,n,i,s,o,a){var u=t[0],h=t[1],c=t[2];u.length;var l,f,d,p,m,v,g,y,x,_=e[0],b=e[1],w=e[2];for(f=_[i],d=_[i+1],n.length=0,l=f;d>l;++l)a.dfs(b[l],u,h,r,n,s,o);for(l=n.length-1;-1!==l;--l)r[o[p=n[l]]]=0;for(l=f;l!==d;++l)r[p=b[l]]=w[l];for(l=n.length-1;-1!==l;--l){for(y=o[p=n[l]],m=u[p],v=u[p+1],g=m;v>g;++g)if(h[g]===y){r[y]/=c[g];break}for(x=r[y],g=m;v>g;++g)r[h[g]]-=x*c[g];r[y]=x}},r.ccsLUP0=function(t,e){var n,i,s,o,a,u,h,c=t[0].length-1,l=[r.rep([c+1],0),[],[]],f=[r.rep([c+1],0),[],[]],d=l[0],p=l[1],m=l[2],v=f[0],g=f[1],y=f[2],x=r.rep([c],0),_=r.rep([c],0),b=r.ccsLPSolve0,w=Math.abs,S=r.linspace(0,c-1),z=r.linspace(0,c-1),M=new r.ccsDFS0(c);for(void 0===e&&(e=1),n=0;c>n;++n){for(b(l,t,x,_,n,z,S,M),o=-1,a=-1,i=_.length-1;-1!==i;--i)(s=_[i])>n&&(u=w(x[S[s]]))>o&&(a=s,o=u);for(w(x[S[n]])<e*o&&(i=S[n],o=S[a],S[n]=o,z[o]=n,S[a]=i,z[i]=a),o=d[n],a=v[n],h=x[S[n]],p[o]=S[n],m[o]=1,++o,i=_.length-1;-1!==i;--i)u=x[S[s=_[i]]],_[i]=0,x[S[s]]=0,s>n?(p[o]=S[s],m[o]=u/h,++o):(g[a]=s,y[a]=u,++a);d[n+1]=o,v[n+1]=a}for(i=p.length-1;-1!==i;--i)p[i]=z[p[i]];return{L:l,U:f,P:S,Pinv:z}},r.ccsLUP=r.ccsLUP0,r.ccsDim=function(t){return[r.sup(t[1])+1,t[0].length-1]},r.ccsGetBlock=function(t,e,n){var i=r.ccsDim(t),s=i[0],o=i[1];void 0===e?e=r.linspace(0,s-1):"number"==typeof e&&(e=[e]),void 0===n?n=r.linspace(0,o-1):"number"==typeof n&&(n=[n]);var a,u,h,c,l=e.length,f=n.length,d=r.rep([o],0),p=[],m=[],v=[d,p,m],g=t[0],y=t[1],x=t[2],_=r.rep([s],0),b=0,w=r.rep([s],0);for(u=0;f>u;++u){var S=g[c=n[u]],z=g[c+1];for(a=S;z>a;++a)w[h=y[a]]=1,_[h]=x[a];for(a=0;l>a;++a)w[e[a]]&&(p[b]=a,m[b]=_[e[a]],++b);for(a=S;z>a;++a)w[h=y[a]]=0;d[u+1]=b}return v},r.ccsDot=function(t,e){var n=t[0],i=t[1],s=t[2],o=e[0],a=e[1],u=e[2],h=r.ccsDim(t),c=r.ccsDim(e),l=h[0];h[1];var f,d,p,m,v,g,y,x,_,b,w,S=c[1],z=r.rep([l],0),M=r.rep([l],0),C=Array(l),P=r.rep([S],0),A=[],E=[],k=[P,A,E];for(p=0;p!==S;++p){for(m=o[p],v=o[p+1],_=0,d=m;v>d;++d)for(b=a[d],w=u[d],g=n[b],y=n[b+1],f=g;y>f;++f)0===M[x=i[f]]&&(C[_]=x,M[x]=1,_+=1),z[x]=z[x]+s[f]*w;for(v=(m=P[p])+_,P[p+1]=v,d=_-1;-1!==d;--d)w=m+d,f=C[d],A[w]=f,E[w]=z[f],M[f]=0,z[f]=0;P[p+1]=P[p]+_}return k},r.ccsLUPSolve=function(t,e){var n=t.L,i=t.U;t.P;var s=e[0],o=!1;"object"!=typeof s&&(s=(e=[[0,e.length],r.linspace(0,e.length-1),e])[0],o=!0);var a,u,h,c,l,f,d=e[1],p=e[2],m=n[0].length-1,v=s.length-1,g=r.rep([m],0),y=Array(m),x=r.rep([m],0),_=Array(m),b=r.rep([v+1],0),w=[],S=[],z=r.ccsTSolve,M=0;for(a=0;v>a;++a){for(l=0,h=s[a],c=s[a+1],u=h;c>u;++u)f=t.Pinv[d[u]],_[l]=f,x[f]=p[u],++l;for(_.length=l,z(n,x,g,_,y),u=_.length-1;-1!==u;--u)x[_[u]]=0;if(z(i,g,x,y,_),o)return x;for(u=y.length-1;-1!==u;--u)g[y[u]]=0;for(u=_.length-1;-1!==u;--u)f=_[u],w[M]=f,S[M]=x[f],x[f]=0,++M;b[a+1]=M}return[b,w,S]},r.ccsbinop=function(t,e){return void 0===e&&(e=""),Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+e+"for(i=0;i<n;++i) {\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Xj[j];\n    x[k] = 1;\n    Zj[p] = k;\n    ++p;\n  }\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Yj[j];\n    y[k] = Yv[j];\n    if(x[k] === 0) {\n      Zj[p] = k;\n      ++p;\n    }\n  }\n  Zi[i+1] = p;\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n  j0 = Zi[i]; j1 = Zi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Zj[j];\n    xk = x[k];\n    yk = y[k];\n"+t+"\n    Zv[j] = zk;\n  }\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n}\nreturn [Zi,Zj,Zv];")},function(){var t,n,i,s;for(t in r.ops2)n=isFinite(eval("1"+r.ops2[t]+"0"))?"[Y[0],Y[1],numeric."+t+"(X,Y[2])]":"NaN",i=isFinite(eval("0"+r.ops2[t]+"1"))?"[X[0],X[1],numeric."+t+"(X[2],Y)]":"NaN",s=isFinite(eval("1"+r.ops2[t]+"0"))&&isFinite(eval("0"+r.ops2[t]+"1"))?"numeric.ccs"+t+"MM(X,Y)":"NaN",r["ccs"+t+"MM"]=r.ccsbinop("zk = xk "+r.ops2[t]+"yk;"),r["ccs"+t]=Function("X","Y",'if(typeof X === "number") return '+n+';\nif(typeof Y === "number") return '+i+";\nreturn "+s+";\n")}(),r.ccsScatter=function(t){var e,n=t[0],i=t[1],s=t[2],o=r.sup(i)+1,a=n.length,u=r.rep([o],0),h=Array(a),c=Array(a),l=r.rep([o],0);for(e=0;a>e;++e)l[i[e]]++;for(e=0;o>e;++e)u[e+1]=u[e]+l[e];var f,d,p=u.slice(0);for(e=0;a>e;++e)h[f=p[d=i[e]]]=n[e],c[f]=s[e],p[d]=p[d]+1;return[u,h,c]},r.ccsGather=function(t){var e,r,n,i,s,o=t[0],a=t[1],u=t[2],h=o.length-1,c=a.length,l=Array(c),f=Array(c),d=Array(c);for(s=0,e=0;h>e;++e)for(n=o[e],i=o[e+1],r=n;r!==i;++r)f[s]=e,l[s]=a[r],d[s]=u[r],++s;return[l,f,d]},r.sdim=function t(e,r,n){if(void 0===r&&(r=[]),"object"!=typeof e)return r;var i;for(i in void 0===n&&(n=0),n in r||(r[n]=0),e.length>r[n]&&(r[n]=e.length),e)e.hasOwnProperty(i)&&t(e[i],r,n+1);return r},r.sclone=function t(e,n,i){void 0===n&&(n=0),void 0===i&&(i=r.sdim(e).length);var s,o=Array(e.length);if(n===i-1){for(s in e)e.hasOwnProperty(s)&&(o[s]=e[s]);return o}for(s in e)e.hasOwnProperty(s)&&(o[s]=t(e[s],n+1,i));return o},r.sdiag=function(t){var e,r,n=t.length,i=Array(n);for(e=n-1;e>=1;e-=2)r=e-1,i[e]=[],i[e][e]=t[e],i[r]=[],i[r][r]=t[r];return 0===e&&(i[0]=[],i[0][0]=t[e]),i},r.sidentity=function(t){return r.sdiag(r.rep([t],1))},r.stranspose=function(t){var e,r,n,i=[];for(e in t.length,t)if(t.hasOwnProperty(e))for(r in n=t[e])n.hasOwnProperty(r)&&("object"!=typeof i[r]&&(i[r]=[]),i[r][e]=n[r]);return i},r.sLUP=function(){throw Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")},r.sdotMM=function(t,e){var n=t.length;e.length;var i,s,o,a,u,h,c,l=r.stranspose(e),f=l.length,d=Array(n);for(o=n-1;o>=0;o--){for(c=[],i=t[o],u=f-1;u>=0;u--){for(a in h=0,s=l[u],i)i.hasOwnProperty(a)&&a in s&&(h+=i[a]*s[a]);h&&(c[u]=h)}d[o]=c}return d},r.sdotMV=function(t,e){var r,n,i,s,o=t.length,a=Array(o);for(n=o-1;n>=0;n--){for(i in s=0,r=t[n])r.hasOwnProperty(i)&&e[i]&&(s+=r[i]*e[i]);s&&(a[n]=s)}return a},r.sdotVM=function(t,e){var r,n,i,s,o=[];for(r in t)if(t.hasOwnProperty(r))for(n in i=e[r],s=t[r],i)i.hasOwnProperty(n)&&(o[n]||(o[n]=0),o[n]+=s*i[n]);return o},r.sdotVV=function(t,e){var r,n=0;for(r in t)t[r]&&e[r]&&(n+=t[r]*e[r]);return n},r.sdot=function(t,e){var n=r.sdim(t).length,i=r.sdim(e).length;switch(1e3*n+i){case 0:return t*e;case 1001:return r.sdotVV(t,e);case 2001:return r.sdotMV(t,e);case 1002:return r.sdotVM(t,e);case 2002:return r.sdotMM(t,e);default:throw Error("numeric.sdot not implemented for tensors of order "+n+" and "+i)}},r.sscatter=function(t){var e,r,n,i,s=t[0].length,o=t.length,a=[];for(r=s-1;r>=0;--r)if(t[o-1][r]){for(i=a,n=0;o-2>n;n++)i[e=t[n][r]]||(i[e]=[]),i=i[e];i[t[n][r]]=t[n+1][r]}return a},r.sgather=function t(e,r,n){var i,s,o;for(s in void 0===r&&(r=[]),void 0===n&&(n=[]),i=n.length,e)if(e.hasOwnProperty(s))if(n[i]=parseInt(s),"number"==typeof(o=e[s])){if(o){if(0===r.length)for(s=i+1;s>=0;--s)r[s]=[];for(s=i;s>=0;--s)r[s].push(n[s]);r[i+1].push(o)}}else t(o,r,n);return n.length>i&&n.pop(),r},r.cLU=function(t){var e,n,i,s,o,a,u=t[0],h=t[1],c=t[2],l=u.length,f=0;for(e=0;l>e;e++)u[e]>f&&(f=u[e]);f++;var d,p=Array(f),m=Array(f),v=r.rep([f],1/0),g=r.rep([f],-1/0);for(i=0;l>i;i++)e=u[i],(n=h[i])<v[e]&&(v[e]=n),n>g[e]&&(g[e]=n);for(e=0;f-1>e;e++)g[e]>g[e+1]&&(g[e+1]=g[e]);for(e=f-1;e>=1;e--)v[e]<v[e-1]&&(v[e-1]=v[e]);for(e=0;f>e;e++)m[e]=r.rep([g[e]-v[e]+1],0),p[e]=r.rep([e-v[e]],0),v[e],g[e];for(i=0;l>i;i++)m[e=u[i]][h[i]-v[e]]=c[i];for(e=0;f-1>e;e++)for(s=e-v[e],_=m[e],n=e+1;v[n]<=e&&f>n;n++)if(o=e-v[n],a=g[e]-e,d=(b=m[n])[o]/_[s]){for(i=1;a>=i;i++)b[i+o]-=d*_[i+s];p[n][e-v[n]]=d}var y,x,_=[],b=[],w=[],S=[],z=[],M=[];for(l=0,y=0,e=0;f>e;e++){for(s=v[e],o=g[e],x=m[e],n=e;o>=n;n++)x[n-s]&&(_[l]=e,b[l]=n,w[l]=x[n-s],l++);for(x=p[e],n=s;e>n;n++)x[n-s]&&(S[y]=e,z[y]=n,M[y]=x[n-s],y++);S[y]=e,z[y]=e,M[y]=1,y++}return{U:[_,b,w],L:[S,z,M]}},r.cLUsolve=function(t,e){var n=t.L,i=t.U,s=r.clone(e),o=n[0],a=n[1],u=n[2],h=i[0],c=i[1],l=i[2],f=h.length;o.length;var d,p,m=s.length;for(p=0,d=0;m>d;d++){for(;a[p]<d;)s[d]-=u[p]*s[a[p]],p++;p++}for(p=f-1,d=m-1;d>=0;d--){for(;c[p]>d;)s[d]-=l[p]*s[c[p]],p--;s[d]/=l[p],p--}return s},r.cgrid=function(t,e){"number"==typeof t&&(t=[t,t]);var n,i,s,o=r.rep(t,-1);for("function"!=typeof e&&(e="L"===e?function(e,r){return e>=t[0]/2||r<t[1]/2}:function(){return!0}),s=0,n=1;n<t[0]-1;n++)for(i=1;i<t[1]-1;i++)e(n,i)&&(o[n][i]=s,s++);return o},r.cdelsq=function(t){var e,n,i,s,o,a=[[-1,0],[0,-1],[0,1],[1,0]],u=r.dim(t),h=u[0],c=u[1],l=[],f=[],d=[];for(e=1;h-1>e;e++)for(n=1;c-1>n;n++)if(t[e][n]>=0){for(i=0;4>i;i++)s=e+a[i][0],o=n+a[i][1],0>t[s][o]||(l.push(t[e][n]),f.push(t[s][o]),d.push(-1));l.push(t[e][n]),f.push(t[e][n]),d.push(4)}return[l,f,d]},r.cdotMV=function(t,e){var n,i,s,o=t[0],a=t[1],u=t[2],h=o.length;for(s=0,i=0;h>i;i++)o[i]>s&&(s=o[i]);for(s++,n=r.rep([s],0),i=0;h>i;i++)n[o[i]]+=u[i]*e[a[i]];return n},r.Spline=function(t,e,r,n,i){this.x=t,this.yl=e,this.yr=r,this.kl=n,this.kr=i},r.Spline.prototype._at=function(t,e){var n,i,s,o=this.x,a=this.yl,u=this.yr,h=this.kl,c=this.kr,l=r.add,f=r.sub,d=r.mul;n=f(d(h[e],o[e+1]-o[e]),f(u[e+1],a[e])),i=l(d(c[e+1],o[e]-o[e+1]),f(u[e+1],a[e]));var p=(s=(t-o[e])/(o[e+1]-o[e]))*(1-s);return l(l(l(d(1-s,a[e]),d(s,u[e+1])),d(n,p*(1-s))),d(i,p*s))},r.Spline.prototype.at=function(t){if("number"==typeof t){var e,r,n,i=this.x,s=i.length,o=Math.floor;for(e=0,r=s-1;r-e>1;)i[n=o((e+r)/2)]>t?r=n:e=n;return this._at(t,e)}s=t.length;var a,u=Array(s);for(a=s-1;-1!==a;--a)u[a]=this.at(t[a]);return u},r.Spline.prototype.diff=function(){var t,e,n,i=this.x,s=this.yl,o=this.yr,a=this.kl,u=this.kr,h=s.length,c=a,l=u,f=Array(h),d=Array(h),p=r.add,m=r.mul,v=r.div,g=r.sub;for(t=h-1;-1!==t;--t)e=i[t+1]-i[t],n=g(o[t+1],s[t]),f[t]=v(p(m(n,6),m(a[t],-4*e),m(u[t+1],-2*e)),e*e),d[t+1]=v(p(m(n,-6),m(a[t],2*e),m(u[t+1],4*e)),e*e);return new r.Spline(i,c,l,f,d)},r.Spline.prototype.roots=function(){function t(t){return t*t}var e=[],r=this.x,n=this.yl,i=this.yr,s=this.kl,o=this.kr;"number"==typeof n[0]&&(n=[n],i=[i],s=[s],o=[o]);var a,u,h,c,l,f,d,p,m,v,g,y,x,_,b,w,S,z,M,C,P,A,E,k=n.length,T=r.length-1,N=(e=Array(k),Math.sqrt);for(a=0;a!==k;++a){for(c=n[a],l=i[a],f=s[a],d=o[a],p=[],u=0;u!==T;u++){for(u>0&&0>l[u]*c[u]&&p.push(r[u]),w=r[u+1]-r[u],r[u],g=c[u],y=l[u+1],m=f[u]/w,x=(v=d[u+1]/w)+3*g+2*m-3*y,_=3*(v+m+2*(g-y)),(b=t(m-v+3*(g-y))+12*v*g)>0?(z=(x-N(b))/_,M=(x+N(b))/_,S=[r[u]],z>r[u]&&z<r[u+1]&&S.push(z),M>r[u]&&M<r[u+1]&&S.push(M),S.push(r[u+1])):S=(z=x/_)>r[u]&&z<r[u+1]?[r[u],z,r[u+1]]:[r[u],r[u+1]],P=S[0],z=this._at(P,u),h=0;h<S.length-1;h++)if(A=S[h+1],M=this._at(A,u),0!==z)if(0===M||z*M>0)P=A,z=M;else{for(var I=0;P<(E=(z*A-M*P)/(z-M))&&A>E;)if((C=this._at(E,u))*M>0)A=E,M=C,-1===I&&(z*=.5),I=-1;else{if(0>=C*z)break;P=E,z=C,1===I&&(M*=.5),I=1}p.push(E),P=S[h+1],z=this._at(P,u)}else p.push(P),P=A,z=M;0===M&&p.push(A)}e[a]=p}return"number"==typeof this.yl[0]?e[0]:e},r.spline=function(t,e,n,i){var s,o=t.length,a=[],u=[],h=[],c=r.sub,l=r.mul,f=r.add;for(s=o-2;s>=0;s--)u[s]=t[s+1]-t[s],h[s]=c(e[s+1],e[s]);"string"!=typeof n&&"string"!=typeof i||(n=i="periodic");var d=[[],[],[]];switch(typeof n){case"undefined":a[0]=l(3/(u[0]*u[0]),h[0]),d[0].push(0,0),d[1].push(0,1),d[2].push(2/u[0],1/u[0]);break;case"string":a[0]=f(l(3/(u[o-2]*u[o-2]),h[o-2]),l(3/(u[0]*u[0]),h[0])),d[0].push(0,0,0),d[1].push(o-2,0,1),d[2].push(1/u[o-2],2/u[o-2]+2/u[0],1/u[0]);break;default:a[0]=n,d[0].push(0),d[1].push(0),d[2].push(1)}for(s=1;o-1>s;s++)a[s]=f(l(3/(u[s-1]*u[s-1]),h[s-1]),l(3/(u[s]*u[s]),h[s])),d[0].push(s,s,s),d[1].push(s-1,s,s+1),d[2].push(1/u[s-1],2/u[s-1]+2/u[s],1/u[s]);switch(typeof i){case"undefined":a[o-1]=l(3/(u[o-2]*u[o-2]),h[o-2]),d[0].push(o-1,o-1),d[1].push(o-2,o-1),d[2].push(1/u[o-2],2/u[o-2]);break;case"string":d[1][d[1].length-1]=0;break;default:a[o-1]=i,d[0].push(o-1),d[1].push(o-1),d[2].push(1)}a="number"!=typeof a[0]?r.transpose(a):[a];var p=Array(a.length);if("string"==typeof n)for(s=p.length-1;-1!==s;--s)p[s]=r.ccsLUPSolve(r.ccsLUP(r.ccsScatter(d)),a[s]),p[s][o-1]=p[s][0];else for(s=p.length-1;-1!==s;--s)p[s]=r.cLUsolve(r.cLU(d),a[s]);return p="number"==typeof e[0]?p[0]:r.transpose(p),new r.Spline(t,e,e,p,p)},r.fftpow2=function t(e,r){var n=e.length;if(1!==n){var i,s,o=Math.cos,a=Math.sin,u=Array(n/2),h=Array(n/2),c=Array(n/2),l=Array(n/2);for(s=n/2,i=n-1;-1!==i;--i)c[--s]=e[i],l[s]=r[i],--i,u[s]=e[i],h[s]=r[i];t(u,h),t(c,l),s=n/2;var f,d,p,m=-6.283185307179586/n;for(i=n-1;-1!==i;--i)-1==--s&&(s=n/2-1),d=o(f=m*i),p=a(f),e[i]=u[s]+d*c[s]-p*l[s],r[i]=h[s]+d*l[s]+p*c[s]}},r._ifftpow2=function t(e,r){var n=e.length;if(1!==n){var i,s,o=Math.cos,a=Math.sin,u=Array(n/2),h=Array(n/2),c=Array(n/2),l=Array(n/2);for(s=n/2,i=n-1;-1!==i;--i)c[--s]=e[i],l[s]=r[i],--i,u[s]=e[i],h[s]=r[i];t(u,h),t(c,l),s=n/2;var f,d,p,m=6.283185307179586/n;for(i=n-1;-1!==i;--i)-1==--s&&(s=n/2-1),d=o(f=m*i),p=a(f),e[i]=u[s]+d*c[s]-p*l[s],r[i]=h[s]+d*l[s]+p*c[s]}},r.ifftpow2=function(t,e){r._ifftpow2(t,e),r.diveq(t,t.length),r.diveq(e,e.length)},r.convpow2=function(t,e,n,i){var s,o,a,u,h;for(r.fftpow2(t,e),r.fftpow2(n,i),s=t.length-1;-1!==s;--s)o=t[s],u=e[s],a=n[s],h=i[s],t[s]=o*a-u*h,e[s]=o*h+u*a;r.ifftpow2(t,e)},r.T.prototype.fft=function(){var t,e,n=this.x,i=this.y,s=n.length,o=Math.log,a=o(2),u=Math.ceil(o(2*s-1)/a),h=Math.pow(2,u),c=r.rep([h],0),l=r.rep([h],0),f=Math.cos,d=Math.sin,p=-3.141592653589793/s,m=r.rep([h],0),v=r.rep([h],0);for(t=0;s>t;t++)m[t]=n[t];if(void 0!==i)for(t=0;s>t;t++)v[t]=i[t];for(c[0]=1,t=1;h/2>=t;t++)e=p*t*t,c[t]=f(e),l[t]=d(e),c[h-t]=f(e),l[h-t]=d(e);var g=new r.T(m,v),y=new r.T(c,l);return g=g.mul(y),r.convpow2(g.x,g.y,r.clone(y.x),r.neg(y.y)),(g=g.mul(y)).x.length=s,g.y.length=s,g},r.T.prototype.ifft=function(){var t,e,n=this.x,i=this.y,s=n.length,o=Math.log,a=o(2),u=Math.ceil(o(2*s-1)/a),h=Math.pow(2,u),c=r.rep([h],0),l=r.rep([h],0),f=Math.cos,d=Math.sin,p=3.141592653589793/s,m=r.rep([h],0),v=r.rep([h],0);for(t=0;s>t;t++)m[t]=n[t];if(void 0!==i)for(t=0;s>t;t++)v[t]=i[t];for(c[0]=1,t=1;h/2>=t;t++)e=p*t*t,c[t]=f(e),l[t]=d(e),c[h-t]=f(e),l[h-t]=d(e);var g=new r.T(m,v),y=new r.T(c,l);return g=g.mul(y),r.convpow2(g.x,g.y,r.clone(y.x),r.neg(y.y)),(g=g.mul(y)).x.length=s,g.y.length=s,g.div(s)},r.gradient=function(t,e){var n=e.length,i=t(e);if(isNaN(i))throw Error("gradient: f(x) is a NaN!");var s,o,a,u=Math.max,h=r.clone(e),c=Array(n);r.div,r.sub,u=Math.max;var l,f,d,p,m,v,g=Math.abs,y=Math.min,x=0;for(s=0;n>s;s++)for(var _=u(1e-6*i,1e-8);;){if(++x>20)throw Error("Numerical gradient fails");if(h[s]=e[s]+_,o=t(h),h[s]=e[s]-_,a=t(h),h[s]=e[s],isNaN(o)||isNaN(a))_/=16;else{if(c[s]=(o-a)/(2*_),l=e[s]-_,f=e[s],d=e[s]+_,p=(o-i)/_,m=(i-a)/_,v=u(g(c[s]),g(i),g(o),g(a),g(l),g(f),g(d),1e-8),.001>=y(u(g(p-c[s]),g(m-c[s]),g(p-m))/v,_/v))break;_/=16}}return c},r.uncmin=function(t,e,n,i,s,o,a){var u=r.gradient;void 0===a&&(a={}),void 0===n&&(n=1e-8),void 0===i&&(i=function(e){return u(t,e)}),void 0===s&&(s=1e3);var h,c,l=(e=r.clone(e)).length,f=t(e);if(isNaN(f))throw Error("uncmin: f(x0) is a NaN!");var d=Math.max,p=r.norm2;n=d(n,r.epsilon);var m,v,g,y=a.Hinv||r.identity(l),x=r.dot;r.inv;var _,b,w,S,z,M,C,P=r.sub,A=r.add,E=r.tensor,k=r.div,T=r.mul,N=r.all,I=r.isFinite,V=r.neg,D=0,B="";for(v=i(e);s>D;){if("function"==typeof o&&o(D,e,f,v,y)){B="Callback returned true";break}if(!N(I(v))){B="Gradient has Infinity or NaN";break}if(!N(I(m=V(x(y,v))))){B="Search direction has Infinity or NaN";break}if(n>(C=p(m))){B="Newton step smaller than tol";break}for(M=1,c=x(v,m),b=e;s>D&&M*C>=n&&(b=A(e,_=T(m,M)),.1*M*c<=(h=t(b))-f||isNaN(h));)M*=.5,++D;if(n>M*C){B="Line search step size smaller than tol";break}if(D===s){B="maxit reached during line search";break}z=x(w=P(g=i(b),v),_),S=x(y,w),y=P(A(y,T((z+x(w,S))/(z*z),E(_,_))),k(A(E(S,_),E(_,S)),z)),e=b,f=h,v=g,++D}return{solution:e,f:f,gradient:v,invHessian:y,iterations:D,message:B}},r.Dopri=function(t,e,r,n,i,s,o){this.x=t,this.y=e,this.f=r,this.ymid=n,this.iterations=i,this.events=o,this.message=s},r.Dopri.prototype._at=function(t,e){function n(t){return t*t}var i,s,o,a,u,h,c=this,l=c.x,f=c.y,d=c.f,p=c.ymid;l.length;var m,v,g,y=r.add,x=r.mul,_=r.sub;return i=l[e],s=l[e+1],a=f[e],u=f[e+1],o=i+.5*(s-i),h=p[e],m=_(d[e],x(a,1/(i-o)+2/(i-s))),v=_(d[e+1],x(u,1/(s-o)+2/(s-i))),y(y(y(y(x(a,(g=[n(t-s)*(t-o)/n(i-s)/(i-o),n(t-i)*n(t-s)/n(i-o)/n(s-o),n(t-i)*(t-o)/n(s-i)/(s-o),(t-i)*n(t-s)*(t-o)/n(i-s)/(i-o),(t-s)*n(t-i)*(t-o)/n(i-s)/(s-o)])[0]),x(h,g[1])),x(u,g[2])),x(m,g[3])),x(v,g[4]))},r.Dopri.prototype.at=function(t){var e,r,n,i=Math.floor;if("number"!=typeof t){var s=t.length,o=Array(s);for(e=s-1;-1!==e;--e)o[e]=this.at(t[e]);return o}var a=this.x;for(e=0,r=a.length-1;r-e>1;)a[n=i(.5*(e+r))]>t?r=n:e=n;return this._at(t,e)},r.dopri=function(t,e,n,i,s,o,a){void 0===s&&(s=1e-6),void 0===o&&(o=1e3);var u,h,c,l,f,d,p,m,v,g,y,x,_,b=[t],w=[n],S=[i(t,n)],z=[],M=[44/45,-56/15,32/9],C=[19372/6561,-25360/2187,64448/6561,-212/729],P=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],A=[35/384,0,500/1113,125/192,-2187/6784,11/84],E=[.10013431883002395,0,.3918321794184259,-.02982460176594817,.05893268337240795,-.04497888809104361,5618549.5/235043384],k=[.2,.3,.8,8/9,1,1],T=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,1/40],N=0,I=(e-t)/10,V=0,D=r.add,B=r.mul,L=Math.min,O=Math.abs,U=r.norminf,F=Math.pow,R=r.any,j=r.lt,q=r.and;r.sub;var X=new r.Dopri(b,w,S,z,-1,"");for("function"==typeof a&&(y=a(t,n));e>t&&o>V;)if(++V,t+I>e&&(I=e-t),u=i(t+.2*I,D(n,B(.2*I,S[N]))),h=i(t+.3*I,D(D(n,B(.075*I,S[N])),B(.225*I,u))),c=i(t+.8*I,D(D(D(n,B(M[0]*I,S[N])),B(M[1]*I,u)),B(M[2]*I,h))),l=i(t+k[3]*I,D(D(D(D(n,B(C[0]*I,S[N])),B(C[1]*I,u)),B(C[2]*I,h)),B(C[3]*I,c))),f=i(t+1*I,D(D(D(D(D(n,B(P[0]*I,S[N])),B(P[1]*I,u)),B(P[2]*I,h)),B(P[3]*I,c)),B(P[4]*I,l))),d=i(t+I,v=D(D(D(D(D(n,B(S[N],I*A[0])),B(h,I*A[2])),B(c,I*A[3])),B(l,I*A[4])),B(f,I*A[5]))),(g="number"==typeof(p=D(D(D(D(D(B(S[N],I*T[0]),B(h,I*T[2])),B(c,I*T[3])),B(l,I*T[4])),B(f,I*T[5])),B(d,I*T[6])))?O(p):U(p))>s){if(t+(I=.2*I*F(s/g,.25))===t){X.msg="Step size became too small";break}}else{if(z[N]=D(D(D(D(D(D(n,B(S[N],I*E[0])),B(h,I*E[2])),B(c,I*E[3])),B(l,I*E[4])),B(f,I*E[5])),B(d,I*E[6])),b[++N]=t+I,w[N]=v,S[N]=d,"function"==typeof a){var Y,W,Z=t,H=t+.5*I;if(x=a(H,z[N-1]),R(_=q(j(y,0),j(0,x)))||(Z=H,y=x,x=a(H=t+I,v),_=q(j(y,0),j(0,x))),R(_)){for(var $,G,K=0,Q=1,J=1;;){if("number"==typeof y)W=(J*x*Z-Q*y*H)/(J*x-Q*y);else for(W=H,m=y.length-1;-1!==m;--m)0>y[m]&&x[m]>0&&(W=L(W,(J*x[m]*Z-Q*y[m]*H)/(J*x[m]-Q*y[m])));if(Z>=W||W>=H)break;G=a(W,Y=X._at(W,N-1)),R($=q(j(y,0),j(0,G)))?(H=W,x=G,_=$,J=1,-1===K?Q*=.5:Q=1,K=-1):(Z=W,y=G,Q=1,1===K?J*=.5:J=1,K=1)}return v=X._at(.5*(t+W),N-1),X.f[N]=i(W,Y),X.x[N]=W,X.y[N]=Y,X.ymid[N-1]=v,X.events=_,X.iterations=V,X}}t+=I,n=v,y=x,I=L(.8*I*F(s/g,.25),4*I)}return X.iterations=V,X},r.LU=function(t,e){e=e||!1;var n,i,s,o,a,u,h,c,l,f=Math.abs,d=t.length,p=d-1,m=Array(d);for(e||(t=r.clone(t)),s=0;d>s;++s){for(h=s,l=f((u=t[s])[s]),i=s+1;d>i;++i)(o=f(t[i][s]))>l&&(l=o,h=i);for(m[s]=h,h!=s&&(t[s]=t[h],t[h]=u,u=t[s]),a=u[s],n=s+1;d>n;++n)t[n][s]/=a;for(n=s+1;d>n;++n){for(c=t[n],i=s+1;p>i;++i)c[i]-=c[s]*u[i],c[++i]-=c[s]*u[i];i===p&&(c[i]-=c[s]*u[i])}}return{LU:t,P:m}},r.LUsolve=function(t,e){var n,i,s,o,a,u=t.LU,h=u.length,c=r.clone(e),l=t.P;for(n=h-1;-1!==n;--n)c[n]=e[n];for(n=0;h>n;++n)for(s=l[n],l[n]!==n&&(a=c[n],c[n]=c[s],c[s]=a),o=u[n],i=0;n>i;++i)c[n]-=c[i]*o[i];for(n=h-1;n>=0;--n){for(o=u[n],i=n+1;h>i;++i)c[n]-=c[i]*o[i];c[n]/=o[n]}return c},r.solve=function(t,e,n){return r.LUsolve(r.LU(t,n),e)},r.echelonize=function(t){var e,n,i,s,o,a,u,h,c=r.dim(t),l=c[0],f=c[1],d=r.identity(l),p=Array(l),m=Math.abs,v=r.diveq;for(t=r.clone(t),e=0;l>e;++e){for(i=0,o=t[e],a=d[e],n=1;f>n;++n)m(o[i])<m(o[n])&&(i=n);for(p[e]=i,v(a,o[i]),v(o,o[i]),n=0;l>n;++n)if(n!==e){for(h=(u=t[n])[i],s=f-1;-1!==s;--s)u[s]-=o[s]*h;for(u=d[n],s=l-1;-1!==s;--s)u[s]-=a[s]*h}}return{I:d,A:t,P:p}},r.__solveLP=function(t,e,n,i,s,o,a){var u=r.sum;r.log;var h,c=r.mul,l=r.sub,f=r.dot,d=r.div,p=r.add,m=t.length,v=n.length,g=!1,y=1;r.transpose(e),r.svd;var x=r.transpose;r.leq;var _=Math.sqrt,b=Math.abs;r.muleq,r.norminf,r.any;var w,S=Math.min,z=r.all,M=r.gt,C=Array(m),P=Array(v);r.rep([v],1);var A,E,k=r.solve,T=l(n,f(e,o)),N=f(t,t);for(A=0;s>A;++A){var I,V;for(I=v-1;-1!==I;--I)P[I]=d(e[I],T[I]);var D=x(P);for(I=m-1;-1!==I;--I)C[I]=u(D[I]);y=.25*b(N/f(t,C));var B=100*_(N/f(C,C));for(isFinite(y)&&B>=y||(y=B),E=p(t,c(y,C)),w=f(D,P),I=m-1;-1!==I;--I)w[I][I]+=1;V=k(w,d(E,y),!0);var L=d(T,f(e,V)),O=1;for(I=v-1;-1!==I;--I)0>L[I]&&(O=S(O,-.999*L[I]));if(h=l(o,c(V,O)),!z(M(T=l(n,f(e,h)),0)))return{solution:o,message:"",iterations:A};if(o=h,i>y)return{solution:h,message:"",iterations:A};if(a){var U=f(t,E),F=f(e,E);for(g=!0,I=v-1;-1!==I;--I)if(0>U*F[I]){g=!1;break}}else g=0>o[m-1];if(g)return{solution:h,message:"Unbounded",iterations:A}}return{solution:o,message:"maximum iteration count exceeded",iterations:A}},r._solveLP=function(t,e,n,i,s){var o=t.length,a=n.length;r.sum,r.log,r.mul;var u=r.sub,h=r.dot;r.div,r.add;var c=r.rep([o],0).concat([1]),l=r.rep([a,1],-1),f=r.blockMatrix([[e,l]]),d=n,p=r.rep([o],0).concat(Math.max(0,r.sup(r.neg(n)))+1),m=r.__solveLP(c,f,d,i,s,p,!1),v=r.clone(m.solution);if(v.length=o,0>r.inf(u(n,h(e,v))))return{solution:NaN,message:"Infeasible",iterations:m.iterations};var g=r.__solveLP(t,e,n,i,s-m.iterations,v,!0);return g.iterations+=m.iterations,g},r.solveLP=function(t,e,n,i,s,o,a){if(void 0===a&&(a=1e3),void 0===o&&(o=r.epsilon),void 0===i)return r._solveLP(t,e,n,o,a);var u,h=i.length,c=i[0].length,l=e.length,f=r.echelonize(i),d=r.rep([c],0),p=f.P,m=[];for(u=p.length-1;-1!==u;--u)d[p[u]]=1;for(u=c-1;-1!==u;--u)0===d[u]&&m.push(u);var v=r.getRange,g=r.linspace(0,h-1),y=r.linspace(0,l-1),x=v(i,g,m),_=v(e,y,p),b=v(e,y,m),w=r.dot,S=r.sub,z=w(_,f.I),M=S(b,w(z,x)),C=S(n,w(z,s)),P=Array(p.length),A=Array(m.length);for(u=p.length-1;-1!==u;--u)P[u]=t[p[u]];for(u=m.length-1;-1!==u;--u)A[u]=t[m[u]];var E=S(A,w(P,w(f.I,x))),k=r._solveLP(E,M,C,o,a),T=k.solution;if(T!=T)return k;var N=w(f.I,S(s,w(x,T))),I=Array(t.length);for(u=p.length-1;-1!==u;--u)I[p[u]]=N[u];for(u=m.length-1;-1!==u;--u)I[m[u]]=T[u];return{solution:I,message:k.message,iterations:k.iterations}},r.MPStoLP=function(t){function e(e){throw Error("MPStoLP: "+e+"\nLine "+n+": "+t[n]+"\nCurrent state: "+u[a]+"\n")}t instanceof String&&t.split("\n");var n,i,s,o,a=0,u=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"],h=t.length,c=0,l={},f=[],d=0,p={},m=0,v=[],g=[],y=[];for(n=0;h>n;++n){var x=(s=t[n]).match(/\S*/g),_=[];for(i=0;i<x.length;++i)""!==x[i]&&_.push(x[i]);if(0!==_.length){for(i=0;u.length>i&&s.substr(0,u[i].length)!==u[i];++i);if(i<u.length){if(a=i,1===i&&(o=_[1]),6===i)return{name:o,c:v,A:r.transpose(g),b:y,rows:l,vars:p}}else switch(a){case 0:case 1:e("Unexpected line");case 2:switch(_[0]){case"N":0===c?c=_[1]:e("Two or more N rows");break;case"L":l[_[1]]=d,f[d]=1,y[d]=0,++d;break;case"G":l[_[1]]=d,f[d]=-1,y[d]=0,++d;break;case"E":l[_[1]]=d,f[d]=0,y[d]=0,++d;break;default:e("Parse error "+r.prettyPrint(_))}break;case 3:p.hasOwnProperty(_[0])||(p[_[0]]=m,v[m]=0,g[m]=r.rep([d],0),++m);var b=p[_[0]];for(i=1;i<_.length;i+=2)if(_[i]!==c){var w=l[_[i]];g[b][w]=(0>f[w]?-1:1)*parseFloat(_[i+1])}else v[b]=parseFloat(_[i+1]);break;case 4:for(i=1;i<_.length;i+=2)y[l[_[i]]]=(0>f[l[_[i]]]?-1:1)*parseFloat(_[i+1]);break;case 5:break;case 6:e("Internal error")}}}e("Reached end of file without ENDATA")},r.seedrandom={pow:Math.pow,random:Math.random},function(t,e,r,n,i,s,o){function a(t){var e,n,i=this,s=t.length,o=0,a=i.i=i.j=i.m=0;for(i.S=[],i.c=[],s||(t=[s++]);r>o;)i.S[o]=o++;for(o=0;r>o;o++)a=c(a+(e=i.S[o])+t[o%s]),n=i.S[a],i.S[o]=n,i.S[a]=e;i.g=function(t){var e=i.S,n=c(i.i+1),s=e[n],o=c(i.j+s),a=e[o];e[n]=a,e[o]=s;for(var u=e[c(s+a)];--t;)n=c(n+1),a=e[o=c(o+(s=e[n]))],e[n]=a,e[o]=s,u=u*r+e[c(s+a)];return i.i=n,i.j=o,u},i.g(r)}function u(t,e,r,n,i){if(r=[],i=typeof t,e&&"object"==i)for(n in t)if(5>n.indexOf("S"))try{r.push(u(t[n],e-1))}catch(t){}return r.length?r:t+("string"!=i?"\0":"")}function h(t,e,r,n){for(t+="",r=0,n=0;n<t.length;n++)e[c(n)]=c((r^=19*e[c(n)])+t.charCodeAt(n));for(n in t="",e)t+=String.fromCharCode(e[n]);return t}function c(t){return 255&t}e.seedrandom=function(n,c){var l,f=[];return n=h(u(c?[n,t]:arguments.length?n:[(new Date).getTime(),t,window],3),f),h((l=new a(f)).S,t),e.random=function(){for(var t=l.g(6),e=o,n=0;i>t;)t=(t+n)*r,e*=r,n=l.g(1);for(;t>=s;)t/=2,e/=2,n>>>=1;return(t+n)/e},n},o=e.pow(r,6),i=e.pow(2,i),s=2*i,h(e.random(),t)}([],r.seedrandom,256,0,52),function(t){function e(t){if("object"!=typeof t)return t;var r,n=[],i=t.length;for(r=0;i>r;r++)n[r+1]=e(t[r]);return n}function r(t){if("object"!=typeof t)return t;var e,n=[],i=t.length;for(e=1;i>e;e++)n[e-1]=r(t[e]);return n}t.solveQP=function(t,n,i,s,o,a){t=e(t),n=e(n),i=e(i);var u,h,c,l,f,d=[],p=[],m=[],v=[],g=[];if(o=o||0,a=a?e(a):[void 0,0],s=s?e(s):[],h=t.length-1,c=i[1].length-1,!s)for(u=1;c>=u;u+=1)s[u]=0;for(u=1;c>=u;u+=1)p[u]=0;for(l=Math.min(h,c),u=1;h>=u;u+=1)m[u]=0;for(d[1]=0,u=1;2*h+l*(l+5)/2+2*c+1>=u;u+=1)v[u]=0;for(u=1;2>=u;u+=1)g[u]=0;return function(t,e,r,n,i,s,o,a,u,h,c,l,f,d,p,m){function v(){for(d[1]=d[1]+1,S=k,b=1;h>=b;b+=1){for(S+=1,B=-a[b],w=1;n>=w;w+=1)B+=o[w][b]*i[w];if(X>Math.abs(B)&&(B=0),b>c)p[S]=B;else if(p[S]=-Math.abs(B),B>0){for(w=1;n>=w;w+=1)o[w][b]=-o[w][b];a[b]=-a[b]}}for(b=1;f>=b;b+=1)p[k+l[b]]=0;for(N=0,D=0,b=1;h>=b;b+=1)p[k+b]<D*p[V+b]&&(N=b,D=p[k+b]/p[V+b]);return 0===N?999:0}function g(){for(b=1;n>=b;b+=1){for(B=0,w=1;n>=w;w+=1)B+=t[w][b]*o[w][N];p[b]=B}for(z=P,b=1;n>=b;b+=1)p[z+b]=0;for(w=f+1;n>=w;w+=1)for(b=1;n>=b;b+=1)p[z+b]=p[z+b]+t[b][w]*p[w];for(j=!0,b=f;b>=1;b-=1){for(B=p[b],z=(S=E+b*(b+3)/2)-b,w=b+1;f>=w;w+=1)B-=p[S]*p[A+w],S+=w;if(B/=p[z],p[A+b]=B,l[b]<c)break;if(0>B)break;j=!1,C=b}if(!j)for(L=p[T+C]/p[A+C],b=1;f>=b&&l[b]>=c&&p[A+b]>=0;b+=1)D=p[T+b]/p[A+b],L>D&&(L=D,C=b);for(B=0,b=P+1;P+n>=b;b+=1)B+=p[b]*p[b];if(X>=Math.abs(B)){if(j)return m[1]=1,999;for(b=1;f>=b;b+=1)p[T+b]=p[T+b]-L*p[A+b];return p[T+f+1]=p[T+f+1]+L,700}for(B=0,b=1;n>=b;b+=1)B+=p[P+b]*o[b][N];for(O=-p[k+N]/B,q=!0,j||O>L&&(O=L,q=!1),b=1;n>=b;b+=1)i[b]=i[b]+O*p[P+b],Math.abs(i[b])<X&&(i[b]=0);for(s[1]=s[1]+O*B*(O/2+p[T+f+1]),b=1;f>=b;b+=1)p[T+b]=p[T+b]-O*p[A+b];if(p[T+f+1]=p[T+f+1]+O,!q){for(B=-a[N],w=1;n>=w;w+=1)B+=i[w]*o[w][N];if(N>c)p[k+N]=B;else if(p[k+N]=-Math.abs(B),B>0){for(w=1;n>=w;w+=1)o[w][N]=-o[w][N];a[N]=-a[N]}return 700}for(l[f+=1]=N,S=E+(f-1)*f/2+1,b=1;f-1>=b;b+=1)p[S]=p[b],S+=1;if(f===n)p[S]=p[n];else{for(b=n;b>=f+1&&0!==p[b]&&(U=Math.max(Math.abs(p[b-1]),Math.abs(p[b])),F=Math.min(Math.abs(p[b-1]),Math.abs(p[b])),D=0>p[b-1]?-Math.abs(U*Math.sqrt(1+F*F/(U*U))):Math.abs(U*Math.sqrt(1+F*F/(U*U))),U=p[b-1]/D,F=p[b]/D,1!==U);b-=1)if(0===U)for(p[b-1]=F*D,w=1;n>=w;w+=1)D=t[w][b-1],t[w][b-1]=t[w][b],t[w][b]=D;else for(p[b-1]=D,R=F/(1+U),w=1;n>=w;w+=1)D=U*t[w][b-1]+F*t[w][b],t[w][b]=R*(t[w][b-1]+D)-t[w][b],t[w][b-1]=D;p[S]=p[f]}return 0}function y(){if(0===p[z=(S=E+C*(C+1)/2+1)+C])return 798;if(U=Math.max(Math.abs(p[z-1]),Math.abs(p[z])),F=Math.min(Math.abs(p[z-1]),Math.abs(p[z])),D=0>p[z-1]?-Math.abs(U*Math.sqrt(1+F*F/(U*U))):Math.abs(U*Math.sqrt(1+F*F/(U*U))),U=p[z-1]/D,F=p[z]/D,1===U)return 798;if(0===U){for(b=C+1;f>=b;b+=1)D=p[z-1],p[z-1]=p[z],p[z]=D,z+=b;for(b=1;n>=b;b+=1)D=t[b][C],t[b][C]=t[b][C+1],t[b][C+1]=D}else{for(R=F/(1+U),b=C+1;f>=b;b+=1)D=U*p[z-1]+F*p[z],p[z]=R*(p[z-1]+D)-p[z],p[z-1]=D,z+=b;for(b=1;n>=b;b+=1)D=U*t[b][C]+F*t[b][C+1],t[b][C+1]=R*(t[b][C]+D)-t[b][C+1],t[b][C]=D}return 0}function x(){for(z=S-C,b=1;C>=b;b+=1)p[z]=p[S],S+=1,z+=1;return p[T+C]=p[T+C+1],l[C]=l[C+1],f>(C+=1)?797:0}function _(){return p[T+f]=p[T+f+1],p[T+f+1]=0,l[f]=0,f-=1,d[2]=d[2]+1,0}var b,w,S,z,M,C,P,A,E,k,T,N,I,V,D,B,L,O,U,F,R,j,q,X,Y,W,Z;S=2*n+(I=Math.min(n,h))*(I+5)/2+2*h+1,X=1e-60;do{Y=1+.1*(X+=X),W=1+.2*X}while(1>=Y||1>=W);for(b=1;n>=b;b+=1)p[b]=e[b];for(b=n+1;S>=b;b+=1)p[b]=0;for(b=1;h>=b;b+=1)l[b]=0;if(M=[],0===m[1]){if(function(t,e,r,n){var i,s,o,a,u,h;for(s=1;r>=s;s+=1){if(n[1]=s,h=0,1>(o=s-1)){if(0>=(h=t[s][s]-h))break;t[s][s]=Math.sqrt(h)}else{for(a=1;o>=a;a+=1){for(u=t[a][s],i=1;a>i;i+=1)u-=t[i][s]*t[i][a];u/=t[a][a],t[a][s]=u,h+=u*u}if(0>=(h=t[s][s]-h))break;t[s][s]=Math.sqrt(h)}n[1]=0}}(t,0,n,M),0!==M[1])return void(m[1]=2);!function(t,e,r,n){var i,s,o,a;for(s=1;r>=s;s+=1){for(a=0,i=1;s>i;i+=1)a+=t[i][s]*n[i];n[s]=(n[s]-a)/t[s][s]}for(o=1;r>=o;o+=1)for(n[s=r+1-o]=n[s]/t[s][s],a=-n[s],i=1;s>i;i+=1)n[i]=n[i]+a*t[i][s]}(t,0,n,e),function(t,e,r){var n,i,s,o,a;for(s=1;r>=s;s+=1){for(t[s][s]=1/t[s][s],a=-t[s][s],n=1;s>n;n+=1)t[n][s]=a*t[n][s];if((o=s+1)>r)break;for(i=o;r>=i;i+=1)for(a=t[s][i],t[s][i]=0,n=1;s>=n;n+=1)t[n][i]=t[n][i]+a*t[n][s]}}(t,0,n)}else{for(w=1;n>=w;w+=1)for(i[w]=0,b=1;w>=b;b+=1)i[w]=i[w]+t[b][w]*e[b];for(w=1;n>=w;w+=1)for(e[w]=0,b=w;n>=b;b+=1)e[w]=e[w]+t[w][b]*i[b]}for(s[1]=0,w=1;n>=w;w+=1)for(i[w]=e[w],s[1]=s[1]+p[w]*i[w],p[w]=0,b=w+1;n>=b;b+=1)t[b][w]=0;for(s[1]=-s[1]/2,m[1]=0,V=(k=(E=(T=(A=(P=n)+n)+I)+I+1)+I*(I+1)/2)+h,b=1;h>=b;b+=1){for(B=0,w=1;n>=w;w+=1)B+=o[w][b]*o[w][b];p[V+b]=Math.sqrt(B)}for(f=0,d[1]=0,d[2]=0,Z=0;;){if(999===(Z=v()))return;for(;0!==(Z=g());){if(999===Z)return;if(700===Z)if(C===f)_();else{for(;y(),797===(Z=x()););_()}}}}(t,n,0,h,m,d,i,s,0,c,o,p,0,g,v,a),f="",1===a[1]&&(f="constraints are inconsistent, no solution!"),2===a[1]&&(f="matrix D in quadratic function is not positive definite!"),{solution:r(m),value:r(d),unconstrained_solution:r(n),iterations:r(g),iact:r(p),message:f}}}(r),r.svd=function(t){function e(t,e){return(t=Math.abs(t))>(e=Math.abs(e))?t*Math.sqrt(1+e*e/t/t):0==e?t:e*Math.sqrt(1+t*t/e/e)}var n,i=r.epsilon,s=1e-64/i,o=0,a=0,u=0,h=0,c=0,l=r.clone(t),f=l.length,d=l[0].length;if(d>f)throw"Need more rows than columns";var p=Array(d),m=Array(d);for(a=0;d>a;a++)p[a]=m[a]=0;var v=r.rep([d,d],0),g=0,y=0,x=0,_=0,b=0,w=0,S=0;for(a=0;d>a;a++){for(p[a]=y,S=0,c=a+1,u=a;f>u;u++)S+=l[u][a]*l[u][a];if(S>s)for(g=l[a][a],y=Math.sqrt(S),0>g||(y=-y),x=g*y-S,l[a][a]=g-y,u=c;d>u;u++){for(S=0,h=a;f>h;h++)S+=l[h][a]*l[h][u];for(g=S/x,h=a;f>h;h++)l[h][u]+=g*l[h][a]}else y=0;for(m[a]=y,S=0,u=c;d>u;u++)S+=l[a][u]*l[a][u];if(S>s){for(g=l[a][a+1],y=Math.sqrt(S),0>g||(y=-y),x=g*y-S,l[a][a+1]=g-y,u=c;d>u;u++)p[u]=l[a][u]/x;for(u=c;f>u;u++){for(S=0,h=c;d>h;h++)S+=l[u][h]*l[a][h];for(h=c;d>h;h++)l[u][h]+=S*p[h]}}else y=0;(b=Math.abs(m[a])+Math.abs(p[a]))>_&&(_=b)}for(a=d-1;-1!=a;a+=-1){if(0!=y){for(x=y*l[a][a+1],u=c;d>u;u++)v[u][a]=l[a][u]/x;for(u=c;d>u;u++){for(S=0,h=c;d>h;h++)S+=l[a][h]*v[h][u];for(h=c;d>h;h++)v[h][u]+=S*v[h][a]}}for(u=c;d>u;u++)v[a][u]=0,v[u][a]=0;v[a][a]=1,y=p[a],c=a}for(a=d-1;-1!=a;a+=-1){for(c=a+1,y=m[a],u=c;d>u;u++)l[a][u]=0;if(0!=y){for(x=l[a][a]*y,u=c;d>u;u++){for(S=0,h=c;f>h;h++)S+=l[h][a]*l[h][u];for(g=S/x,h=a;f>h;h++)l[h][u]+=g*l[h][a]}for(u=a;f>u;u++)l[u][a]=l[u][a]/y}else for(u=a;f>u;u++)l[u][a]=0;l[a][a]+=1}for(i*=_,h=d-1;-1!=h;h+=-1)for(var z=0;50>z;z++){var M=!1;for(c=h;-1!=c;c+=-1){if(Math.abs(p[c])<=i){M=!0;break}if(Math.abs(m[c-1])<=i)break}if(!M){o=0,S=1;var C=c-1;for(a=c;h+1>a&&(g=S*p[a],p[a]=o*p[a],Math.abs(g)>i);a++)for(x=e(g,y=m[a]),m[a]=x,o=y/x,S=-g/x,u=0;f>u;u++)b=l[u][C],w=l[u][a],l[u][C]=b*o+w*S,l[u][a]=-b*S+w*o}if(w=m[h],c==h){if(0>w)for(m[h]=-w,u=0;d>u;u++)v[u][h]=-v[u][h];break}if(z>=49)throw"Error: no convergence.";for(_=m[c],y=e(g=(((b=m[h-1])-w)*(b+w)+((y=p[h-1])-(x=p[h]))*(y+x))/(2*x*b),1),g=0>g?((_-w)*(_+w)+x*(b/(g-y)-x))/_:((_-w)*(_+w)+x*(b/(g+y)-x))/_,o=1,S=1,a=c+1;h+1>a;a++){for(y=p[a],b=m[a],x=S*y,y*=o,w=e(g,x),p[a-1]=w,g=_*(o=g/w)+y*(S=x/w),y=-_*S+y*o,x=b*S,b*=o,u=0;d>u;u++)_=v[u][a-1],w=v[u][a],v[u][a-1]=_*o+w*S,v[u][a]=-_*S+w*o;for(w=e(g,x),m[a-1]=w,g=(o=g/w)*y+(S=x/w)*b,_=-S*y+o*b,u=0;f>u;u++)b=l[u][a-1],w=l[u][a],l[u][a-1]=b*o+w*S,l[u][a]=-b*S+w*o}p[c]=0,p[h]=g,m[h]=_}for(a=0;a<m.length;a++)m[a]<i&&(m[a]=0);for(a=0;d>a;a++)for(u=a-1;u>=0;u--)if(m[u]<m[a]){for(o=m[u],m[u]=m[a],m[a]=o,h=0;h<l.length;h++)n=l[h][a],l[h][a]=l[h][u],l[h][u]=n;for(h=0;h<v.length;h++)n=v[h][a],v[h][a]=v[h][u],v[h][u]=n;a=u}return{U:l,S:m,V:v}}}(ri)),ri}function x(t,e,r){for(let n=0;n<t.length;n+=1)e[n]=r(t[n]);return e}function A(t,e,r,n){for(let i=0;i<t.length;i+=1)r[i]=n(t[i],e[i]);return r}function S(t,e,r){return x(t,r,(t=>t*e))}function k(t,e){return S(t,e,q(t.length))}function N(t,e,r){return x(t,r,(t=>t/e))}function j(t,e){return N(t,e,t)}function C(t,e,r){return A(t,e,r,((t,e)=>t+e))}function P(t,e){return C(t,e,t)}function I(t,e){return C(t,e,q(t.length))}function O(t,e,r){return A(t,e,r,((t,e)=>t-e))}function D(t,e){return O(t,e,q(t.length))}function F(t,e){return x(t,e,(t=>-t))}function B(t){return F(t,t)}function L(t){return F(t,q(t.length))}function V(t,e){let r=0;for(let n=0;n<t.length;n+=1)r+=t[n]*e[n];return r}function $(t,e,r){return r[0]=t[1]*e[2]-t[2]*e[1],r[1]=t[2]*e[0]-t[0]*e[2],r[2]=t[0]*e[1]-t[1]*e[0],r}function R(t,e){return $(t,e,q(t.length))}function U(t,e){const r=X(t);return 0===r&&(e[0]=e[1]=e[2]=0),N(t,r,e)}function z(t){return U(t,t)}function Y(t){return V(t,t)}function X(t){return Math.sqrt(Y(t))}function q(t){const e=Array(t);return e.fill(0),e}function Z(t){const e=t[0],r=t[1],n=t[2];return z(R(D(r,e),D(n,e)))}function H(t,e=Zn.Y,r=Zn.Z){let n;n=.5>Math.abs(t.dot(e))?t.cross(e):t.cross(r);const i=n.cross(t).normalize();return[i.cross(t).normalize(),i,t]}function W(t){const e=t.length;let r=0;for(let n=e-1,i=0;e>i;n=i++)r+=t[n].x*t[i].y-t[i].x*t[n].y;return.5*r}function G(t){return W(t)>=0}function J(t){let e=0;for(let r=1;r<t.length;++r){const n=t[r],i=t[e];(n.y<i.y||i.y==n.y&&n.x<i.x)&&(e=r)}return e}function*Q(t){const{length:e}=t;for(let r=0;r<t.length;r+=1){const n=(r+1)%e,i=t[r],s=t[n];if(i.vertexB!==s.vertexA)throw __DEBUG__.AddHalfEdge(i,16716185),__DEBUG__.AddHalfEdge(s,10092305),Error("using enclose generator on invalid Loop");yield[i,s,i.vertexB]}}function K(t,e,r){function n(t,e){return h(t,e,r)}function i(t,e){return n(t.x,e.x)&&n(t.y,e.y)}function s(t,e){function r(t){this.inside=!0,this.vertex=t}function s(t){this.inside=!0,this.edge=t}function o(t){for(let e=0;e<u.length;++e){const r=(e+t+1)%u.length;if(0!==u[r])return u[r]}}function a(t){for(let e=0;e<u.length;++e){const r=(t-e-1+u.length)%u.length;if(0!==u[r])return u[r]}}for(const n of e)if(i(t,n))return new r(n);const u=[],h=e.length;for(let t=0;h>t;++t){const r=(t+1)%h,i=e[t],s=e[r].y-i.y;n(s,0)?u.push(0):s>0?u.push(1):u.push(-1)}const c=new Set;let l=!1;for(let r=0;h>r;++r){const f=(r+1)%h,d=e[r],p=e[f],m=c.has(d)||c.has(p),v=n(t.y,d.y),g=n(t.y,p.y);v&&c.add(d),g&&c.add(p),i(d,p);let y=d,x=p,_=x.x-y.x,b=x.y-y.y;if(v&&g){if(x.x<=t.x&&t.x<=y.x||y.x<=t.x&&t.x<=x.x)return new s([d,p]);continue}if(m)continue;if(0>b&&(y=p,_=-_,x=d,b=-b),!v&&!g&&(t.y<y.y||t.y>x.y))continue;if(g){if(0>u[r]*o(r))continue}else if(v&&0>u[r]*a(r))continue;const w=_*(t.y-y.y)-b*(t.x-y.x);if(n(w,0))return new s([d,p]);0>w||(l=!l)}return{inside:l}}return r=r||1e-6,function(r){const n=s(r,t);if(n.inside&&(n.vertex||n.edge))return n;if(e)for(const t of e){const e=s(r,t);if(e.vertex||e.edge)return e;if(e.inside)return{inside:!1}}return n}}function tt(t,e,r){return t.cross(e).dot(r)>0}function*rt(t){null!==t.outerLoop&&(yield t.outerLoop);for(const e of t.innerLoops)yield e}function*nt(t){for(const e of t.loops)for(const t of e.halfEdges)yield t}function*it(t){const e=new Set;for(const r of t.faces)for(const t of r.edges)e.has(t.vertexA)||(e.add(t.vertexA),yield t.vertexA)}function*st(t){const e=new Set;for(const r of t)for(const t of r.edges)e.has(t.edge)||(e.add(t.edge),yield t.edge)}function et(t,e,r,n,i,s,o){const a=si.gradient;void 0===o&&(o={}),void 0===r&&(r=1e-8),void 0===n&&(n=e=>a(t,e)),void 0===i&&(i=1e3);const u=(e=si.clone(e)).length;let h,c,l=t(e);if(Number.isNaN(l))throw Error("uncmin: f(x0) is a NaN!");const{max:f}=Math,{norm2:d}=si;let p,m,v;r=f(r,si.epsilon);let g=o.Hinv||si.identity(u);const{dot:y}=si,{sub:x}=si,{add:_}=si,b=si.tensor,{div:w}=si,{mul:S}=si,{all:z}=si,M=si.isFinite,{neg:C}=si;let P,A,E,k,T,N,I,V=0,D="";for(m=n(e);i>V;){if("function"==typeof s&&s(V,e,l,m,g)){D="Callback returned true";break}if(!z(M(m))){D="Gradient has Infinity or NaN";break}if(p=C(y(g,m)),!z(M(p))){D="Search direction has Infinity or NaN";break}if(I=d(p),r>I){D="Newton step smaller than tol";break}N=1,c=y(m,p),A=e;let o=0,a=100;for(;i>V&&N*I>=r;)if(P=S(p,N),A=_(e,P),h=t(A),h-l>=.1*N*c||Number.isNaN(h))a=N,N=.5*(o+a),++V;else{const t=y(n(A),p);if(.9*Math.abs(c)>=t)break;.9*c>t?(o=N,N=.5*(o+a)):(a=N,N=.5*(o+a))}if(r>N*I){D="Line search step size smaller than tol";break}if(V===i){D="maxit reached during line search";break}v=n(A),E=x(v,m),T=y(E,P),k=y(g,E),g=x(_(g,S((T+y(E,k))/(T*T),b(P,P))),w(_(b(k,P),b(P,k)),T)),e=A,l=h,m=v,++V}return{solution:e,f:l,gradient:m,invHessian:g,iterations:V,message:D}}function ot(){return _i||(_i=1,function(t){t.exports=function(){var t={};return function(t,e,r){function n(t,e){function r(){}r.prototype=t;var n=new r;for(var i in e)n[i]=e[i];return e.toString!=={}.toString&&(n.toString=e.toString),n}function i(t){return 0===t?1e-5:t}function s(t){return t instanceof Array?function(){return u.iter(t)}:"function"==typeof t.iterator?function(t,e){return null==e?null:(null==e.__id__&&(e.__id__=Kt++),null==t.hx__closures__?t.hx__closures__={}:r=t.hx__closures__[e.__id__],null==r&&(r=function(){return r.method.apply(r.scope,arguments)},r.scope=t,r.method=e,t.hx__closures__[e.__id__]=r),r);var r}(t,t.iterator):t.iterator}e.geom=e.geom||{},e.eval=e.eval||{},e.core=e.core||{};var o={},a=function(){return E.__string_rec(this,"")},u=function(){};o.HxOverrides=u,u.__name__=["HxOverrides"],u.strDate=function(t){switch(t.length){case 8:var e=t.split(":"),r=new Date;return r.setTime(0),r.setUTCHours(e[0]),r.setUTCMinutes(e[1]),r.setUTCSeconds(e[2]),r;case 10:var n=t.split("-");return new Date(n[0],n[1]-1,n[2],0,0,0);case 19:var i=t.split(" "),s=i[0].split("-"),o=i[1].split(":");return new Date(s[0],s[1]-1,s[2],o[0],o[1],o[2]);default:throw new A("Invalid date format : "+t)}},u.cca=function(t,e){var r=t.charCodeAt(e);if(r==r)return r},u.substr=function(t,e,r){return null!=e&&0!=e&&null!=r&&0>r?"":(null==r&&(r=t.length),0>e?0>(e=t.length+e)&&(e=0):0>r&&(r=t.length+r-e),t.substr(e,r))},u.iter=function(t){return{cur:0,arr:t,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var h=function(){};o.Lambda=h,h.__name__=["Lambda"],h.fold=function(t,e,r){for(var n=s(t)();n.hasNext();)r=e(n.next(),r);return r};var c=function(){this.length=0};o.List=c,c.__name__=["List"],c.prototype={add:function(t){var e=[t];null==this.h?this.h=e:this.q[1]=e,this.q=e,this.length++},pop:function(){if(null==this.h)return null;var t=this.h[0];return this.h=this.h[1],null==this.h&&(this.q=null),this.length--,t},isEmpty:function(){return null==this.h},__class__:c},Math.__name__=["Math"];var l=function(){};o.Reflect=l,l.__name__=["Reflect"],l.field=function(t,e){try{return t[e]}catch(t){return t instanceof A&&(t=t.val),null}},l.callMethod=function(t,e,r){return e.apply(t,r)},l.fields=function(t){var e=[];if(null!=t){var r={}.hasOwnProperty;for(var n in t)"__id__"!=n&&"hx__closures__"!=n&&r.call(t,n)&&e.push(n)}return e},l.isFunction=function(t){return"function"==typeof t&&!(t.__name__||t.__ename__)},l.deleteField=function(t,e){return!!{}.hasOwnProperty.call(t,e)&&(delete t[e],!0)};var f=function(){};o.Std=f,f.__name__=["Std"],f.string=function(t){return E.__string_rec(t,"")},f.parseFloat=function(t){return parseFloat(t)};var d=function(){this.b=""};o.StringBuf=d,d.__name__=["StringBuf"],d.prototype={add:function(t){this.b+=f.string(t)},__class__:d};var p=function(){};o.StringTools=p,p.__name__=["StringTools"],p.fastCodeAt=function(t,e){return t.charCodeAt(e)};var m=o.ValueType={__ename__:["ValueType"],__constructs__:["TNull","TInt","TFloat","TBool","TObject","TFunction","TClass","TEnum","TUnknown"]};m.TNull=["TNull",0],m.TNull.toString=a,m.TNull.__enum__=m,m.TInt=["TInt",1],m.TInt.toString=a,m.TInt.__enum__=m,m.TFloat=["TFloat",2],m.TFloat.toString=a,m.TFloat.__enum__=m,m.TBool=["TBool",3],m.TBool.toString=a,m.TBool.__enum__=m,m.TObject=["TObject",4],m.TObject.toString=a,m.TObject.__enum__=m,m.TFunction=["TFunction",5],m.TFunction.toString=a,m.TFunction.__enum__=m,m.TClass=function(t){var e=["TClass",6,t];return e.__enum__=m,e.toString=a,e},m.TEnum=function(t){var e=["TEnum",7,t];return e.__enum__=m,e.toString=a,e},m.TUnknown=["TUnknown",8],m.TUnknown.toString=a,m.TUnknown.__enum__=m;var v=function(){};o.Type=v,v.__name__=["Type"],v.getClassName=function(t){var e=t.__name__;return null==e?null:e.join(".")},v.getEnumName=function(t){return t.__ename__.join(".")},v.resolveClass=function(t){var e=o[t];return null!=e&&e.__name__?e:null},v.resolveEnum=function(t){var e=o[t];return null!=e&&e.__ename__?e:null},v.createEmptyInstance=function(t){function e(){}return e.prototype=t.prototype,new e},v.createEnum=function(t,e,r){var n=l.field(t,e);if(null==n)throw new A("No such constructor "+e);if(l.isFunction(n)){if(null==r)throw new A("Constructor "+e+" need parameters");return l.callMethod(t,n,r)}if(null!=r&&0!=r.length)throw new A("Constructor "+e+" does not need parameters");return n},v.getEnumConstructs=function(t){return t.__constructs__.slice()},v.typeof=function(t){switch(typeof t){case"boolean":return m.TBool;case"string":return m.TClass(String);case"number":return Math.ceil(t)==t%2147483648?m.TInt:m.TFloat;case"object":if(null==t)return m.TNull;var e=t.__enum__;if(null!=e)return m.TEnum(e);var r=E.getClass(t);return null!=r?m.TClass(r):m.TObject;case"function":return t.__name__||t.__ename__?m.TObject:m.TFunction;case"undefined":return m.TNull;default:return m.TUnknown}};var g=function(){};o["haxe.IMap"]=g,g.__name__=["haxe","IMap"];var y=function(t,e){this.high=t,this.low=e};o["haxe._Int64.___Int64"]=y,y.__name__=["haxe","_Int64","___Int64"],y.prototype={__class__:y};var x=function(){this.buf=new d,this.cache=[],this.useCache=x.USE_CACHE,this.useEnumIndex=x.USE_ENUM_INDEX,this.shash=new z,this.scount=0};o["haxe.Serializer"]=x,x.__name__=["haxe","Serializer"],x.prototype={toString:function(){return this.buf.b},serializeString:function(t){var e=this.shash.get(t);if(null!=e)return this.buf.b+="R",void(this.buf.b+=null==e?"null":""+e);this.shash.set(t,this.scount++),this.buf.b+="y",null==(t=encodeURIComponent(t)).length?this.buf.b+="null":this.buf.b+=""+t.length,this.buf.b+=":",this.buf.b+=null==t?"null":""+t},serializeRef:function(t){for(var e=typeof t,r=0,n=this.cache.length;n>r;){var i=r++,s=this.cache[i];if(typeof s==e&&s==t)return this.buf.b+="r",this.buf.b+=null==i?"null":""+i,!0}return this.cache.push(t),!1},serializeFields:function(t){for(var e=0,r=l.fields(t);e<r.length;){var n=r[e];++e,this.serializeString(n),this.serialize(l.field(t,n))}this.buf.b+="g"},serialize:function(t){var e=v.typeof(t);switch(e[1]){case 0:this.buf.b+="n";break;case 1:var r=t;if(0==r)return void(this.buf.b+="z");this.buf.b+="i",this.buf.b+=null==r?"null":""+r;break;case 2:var n=t;isNaN(n)?this.buf.b+="k":isFinite(n)?(this.buf.b+="d",this.buf.b+=null==n?"null":""+n):this.buf.b+=0>n?"m":"p";break;case 3:this.buf.b+=t?"t":"f";break;case 6:var i=e[2];if(i==String)return void this.serializeString(t);if(this.useCache&&this.serializeRef(t))return;switch(i){case Array:var s=0;this.buf.b+="a";for(var o=t.length,a=0;o>a;){var u=a++;null==t[u]?s++:(s>0&&(1==s?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==s?"null":""+s),s=0),this.serialize(t[u]))}s>0&&(1==s?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==s?"null":""+s)),this.buf.b+="h";break;case c:this.buf.b+="l";for(var h=t.h,p=null;null!=h;){var m;p=h[0],h=h[1],m=p,this.serialize(m)}this.buf.b+="h";break;case Date:var g=t;this.buf.b+="v",this.buf.add(g.getTime());break;case z:this.buf.b+="b";for(var y=t,_=y.keys();_.hasNext();){var S=_.next();this.serializeString(S),this.serialize(null!=ie[S]?y.getReserved(S):y.h[S])}this.buf.b+="h";break;case b:this.buf.b+="q";for(var C=t,P=C.keys();P.hasNext();){var k=P.next();this.buf.b+=":",this.buf.b+=null==k?"null":""+k,this.serialize(C.h[k])}this.buf.b+="h";break;case w:this.buf.b+="M";for(var T=t,N=T.keys();N.hasNext();){var I=N.next(),V=l.field(I,"__id__");l.deleteField(I,"__id__"),this.serialize(I),I.__id__=V,this.serialize(T.h[I.__id__])}this.buf.b+="h";break;case M:for(var D=t,B=0,L=D.length-2,O=new d,U=x.BASE64;L>B;){var F=D.get(B++),R=D.get(B++),j=D.get(B++);O.add(U.charAt(F>>2)),O.add(U.charAt(63&(F<<4|R>>4))),O.add(U.charAt(63&(R<<2|j>>6))),O.add(U.charAt(63&j))}if(B==L){var q=D.get(B++),X=D.get(B++);O.add(U.charAt(q>>2)),O.add(U.charAt(63&(q<<4|X>>4))),O.add(U.charAt(X<<2&63))}else if(B==L+1){var Y=D.get(B++);O.add(U.charAt(Y>>2)),O.add(U.charAt(Y<<4&63))}var W=O.b;this.buf.b+="s",null==W.length?this.buf.b+="null":this.buf.b+=""+W.length,this.buf.b+=":",this.buf.b+=null==W?"null":""+W;break;default:this.useCache&&this.cache.pop(),null!=t.hxSerialize?(this.buf.b+="C",this.serializeString(v.getClassName(i)),this.useCache&&this.cache.push(t),t.hxSerialize(this),this.buf.b+="g"):(this.buf.b+="c",this.serializeString(v.getClassName(i)),this.useCache&&this.cache.push(t),this.serializeFields(t))}break;case 4:if(E.__instanceof(t,re)){var Z=v.getClassName(t);this.buf.b+="A",this.serializeString(Z)}else if(E.__instanceof(t,ne))this.buf.b+="B",this.serializeString(v.getEnumName(t));else{if(this.useCache&&this.serializeRef(t))return;this.buf.b+="o",this.serializeFields(t)}break;case 7:var H=e[2];if(this.useCache){if(this.serializeRef(t))return;this.cache.pop()}this.useEnumIndex?this.buf.b+="j":this.buf.b+="w",this.serializeString(v.getEnumName(H)),this.useEnumIndex?(this.buf.b+=":",this.buf.b+=f.string(t[1])):this.serializeString(t[0]),this.buf.b+=":";var $=t.length;this.buf.b+=f.string($-2);for(var G=2;$>G;){var K=G++;this.serialize(t[K])}this.useCache&&this.cache.push(t);break;case 5:throw new A("Cannot serialize function");default:throw new A("Cannot serialize "+f.string(t))}},__class__:x};var _=function(t){this.buf=t,this.length=t.length,this.pos=0,this.scache=[],this.cache=[];var e=_.DEFAULT_RESOLVER;null==e&&(e=v,_.DEFAULT_RESOLVER=e),this.setResolver(e)};o["haxe.Unserializer"]=_,_.__name__=["haxe","Unserializer"],_.initCodes=function(){for(var t=[],e=0,r=_.BASE64.length;r>e;){var n=e++;t[_.BASE64.charCodeAt(n)]=n}return t},_.prototype={setResolver:function(t){this.resolver=null==t?{resolveClass:function(){return null},resolveEnum:function(){return null}}:t},get:function(t){return this.buf.charCodeAt(t)},readDigits:function(){for(var t=0,e=!1,r=this.pos;;){var n=this.buf.charCodeAt(this.pos);if(n!=n)break;if(45!=n){if(48>n||n>57)break;t=10*t+(n-48),this.pos++}else{if(this.pos!=r)break;e=!0,this.pos++}}return e&&(t*=-1),t},readFloat:function(){for(var t=this.pos;;){var e=this.buf.charCodeAt(this.pos);if((43>e||e>=58)&&101!=e&&69!=e)break;this.pos++}return f.parseFloat(u.substr(this.buf,t,this.pos-t))},unserializeObject:function(t){for(;;){if(this.pos>=this.length)throw new A("Invalid object");if(103==this.buf.charCodeAt(this.pos))break;var e=this.unserialize();if("string"!=typeof e)throw new A("Invalid object key");var r=this.unserialize();t[e]=r}this.pos++},unserializeEnum:function(t,e){if(58!=this.get(this.pos++))throw new A("Invalid enum format");var r=this.readDigits();if(0==r)return v.createEnum(t,e);for(var n=[];r-- >0;)n.push(this.unserialize());return v.createEnum(t,e,n)},unserialize:function(){switch(this.get(this.pos++)){case 110:return null;case 116:return!0;case 102:return!1;case 122:return 0;case 105:return this.readDigits();case 100:return this.readFloat();case 121:var t=this.readDigits();if(58!=this.get(this.pos++)||this.length-this.pos<t)throw new A("Invalid string length");var e=u.substr(this.buf,this.pos,t);return this.pos+=t,e=decodeURIComponent(e.split("+").join(" ")),this.scache.push(e),e;case 107:return NaN;case 109:return-1/0;case 112:return 1/0;case 97:this.buf;var r=[];for(this.cache.push(r);;){var n=this.buf.charCodeAt(this.pos);if(104==n){this.pos++;break}if(117==n){this.pos++;var i=this.readDigits();r[r.length+i-1]=null}else r.push(this.unserialize())}return r;case 111:var s={};return this.cache.push(s),this.unserializeObject(s),s;case 114:var o=this.readDigits();if(0>o||o>=this.cache.length)throw new A("Invalid reference");return this.cache[o];case 82:var a=this.readDigits();if(0>a||a>=this.scache.length)throw new A("Invalid string reference");return this.scache[a];case 120:throw new A(this.unserialize());case 99:var h=this.unserialize(),l=this.resolver.resolveClass(h);if(null==l)throw new A("Class not found "+h);var f=v.createEmptyInstance(l);return this.cache.push(f),this.unserializeObject(f),f;case 119:var d=this.unserialize(),m=this.resolver.resolveEnum(d);if(null==m)throw new A("Enum not found "+d);var g=this.unserializeEnum(m,this.unserialize());return this.cache.push(g),g;case 106:var y=this.unserialize(),x=this.resolver.resolveEnum(y);if(null==x)throw new A("Enum not found "+y);this.pos++;var S=this.readDigits(),C=v.getEnumConstructs(x)[S];if(null==C)throw new A("Unknown enum index "+y+"@"+S);var P=this.unserializeEnum(x,C);return this.cache.push(P),P;case 108:var E=new c;for(this.cache.push(E),this.buf;104!=this.buf.charCodeAt(this.pos);)E.add(this.unserialize());return this.pos++,E;case 98:var k=new z;for(this.cache.push(k),this.buf;104!=this.buf.charCodeAt(this.pos);){var T=this.unserialize();k.set(T,this.unserialize())}return this.pos++,k;case 113:var N=new b;this.cache.push(N),this.buf;for(var I=this.get(this.pos++);58==I;){var V=this.readDigits();N.set(V,this.unserialize()),I=this.get(this.pos++)}if(104!=I)throw new A("Invalid IntMap format");return N;case 77:var D=new w;for(this.cache.push(D),this.buf;104!=this.buf.charCodeAt(this.pos);){var B=this.unserialize();D.set(B,this.unserialize())}return this.pos++,D;case 118:var L;if(48>this.buf.charCodeAt(this.pos)||this.buf.charCodeAt(this.pos)>57||48>this.buf.charCodeAt(this.pos+1)||this.buf.charCodeAt(this.pos+1)>57||48>this.buf.charCodeAt(this.pos+2)||this.buf.charCodeAt(this.pos+2)>57||48>this.buf.charCodeAt(this.pos+3)||this.buf.charCodeAt(this.pos+3)>57||45!=this.buf.charCodeAt(this.pos+4)){var O=this.readFloat(),U=new Date;U.setTime(O),L=U}else{var F=u.substr(this.buf,this.pos,19);L=u.strDate(F),this.pos+=19}return this.cache.push(L),L;case 115:var R=this.readDigits(),j=this.buf;if(58!=this.get(this.pos++)||this.length-this.pos<R)throw new A("Invalid bytes length");var q=_.CODES;null==q&&(q=_.initCodes(),_.CODES=q);var X,Y=this.pos,W=3&R;X=3*(R>>2)+(2>W?0:W-1);for(var Z=Y+(R-W),H=M.alloc(X),$=0;Z>Y;){var G=q[p.fastCodeAt(j,Y++)],K=q[p.fastCodeAt(j,Y++)];H.set($++,G<<2|K>>4);var Q=q[p.fastCodeAt(j,Y++)];H.set($++,K<<4|Q>>2);var J=q[p.fastCodeAt(j,Y++)];H.set($++,Q<<6|J)}if(W>=2){var tt=q[p.fastCodeAt(j,Y++)],et=q[p.fastCodeAt(j,Y++)];if(H.set($++,tt<<2|et>>4),3==W){var rt=q[p.fastCodeAt(j,Y++)];H.set($++,et<<4|rt>>2)}}return this.pos+=R,this.cache.push(H),H;case 67:var nt=this.unserialize(),it=this.resolver.resolveClass(nt);if(null==it)throw new A("Class not found "+nt);var st=v.createEmptyInstance(it);if(this.cache.push(st),st.hxUnserialize(this),103!=this.get(this.pos++))throw new A("Invalid custom data");return st;case 65:var ot=this.unserialize(),at=this.resolver.resolveClass(ot);if(null==at)throw new A("Class not found "+ot);return at;case 66:var ut=this.unserialize(),ht=this.resolver.resolveEnum(ut);if(null==ht)throw new A("Enum not found "+ut);return ht}throw this.pos--,new A("Invalid char "+this.buf.charAt(this.pos)+" at position "+this.pos)},__class__:_};var b=function(){this.h={}};o["haxe.ds.IntMap"]=b,b.__name__=["haxe","ds","IntMap"],b.__interfaces__=[g],b.prototype={set:function(t,e){this.h[t]=e},remove:function(t){return!!this.h.hasOwnProperty(t)&&(delete this.h[t],!0)},keys:function(){var t=[];for(var e in this.h)this.h.hasOwnProperty(e)&&t.push(0|e);return u.iter(t)},__class__:b};var w=function(){this.h={},this.h.__keys__={}};o["haxe.ds.ObjectMap"]=w,w.__name__=["haxe","ds","ObjectMap"],w.__interfaces__=[g],w.prototype={set:function(t,e){var r=t.__id__||(t.__id__=++w.count);this.h[r]=e,this.h.__keys__[r]=t},keys:function(){var t=[];for(var e in this.h.__keys__)this.h.hasOwnProperty(e)&&t.push(this.h.__keys__[e]);return u.iter(t)},__class__:w};var S=o["haxe.ds.Option"]={__ename__:["haxe","ds","Option"],__constructs__:["Some","None"]};S.Some=function(t){var e=["Some",0,t];return e.__enum__=S,e.toString=a,e},S.None=["None",1],S.None.toString=a,S.None.__enum__=S;var z=function(){this.h={}};o["haxe.ds.StringMap"]=z,z.__name__=["haxe","ds","StringMap"],z.__interfaces__=[g],z.prototype={set:function(t,e){null!=ie[t]?this.setReserved(t,e):this.h[t]=e},get:function(t){return null!=ie[t]?this.getReserved(t):this.h[t]},setReserved:function(t,e){null==this.rh&&(this.rh={}),this.rh["$"+t]=e},getReserved:function(t){return null==this.rh?null:this.rh["$"+t]},keys:function(){var t=this.arrayKeys();return u.iter(t)},arrayKeys:function(){var t=[];for(var e in this.h)this.h.hasOwnProperty(e)&&t.push(e);if(null!=this.rh)for(var e in this.rh)36==e.charCodeAt(0)&&t.push(e.substr(1));return t},__class__:z};var M=function(t){this.length=t.byteLength,this.b=new oe(t),this.b.bufferValue=t,t.hxBytes=this,t.bytes=this.b};o["haxe.io.Bytes"]=M,M.__name__=["haxe","io","Bytes"],M.alloc=function(t){return new M(new se(t))},M.prototype={get:function(t){return this.b[t]},set:function(t,e){this.b[t]=255&e},__class__:M};var C=o["haxe.io.Error"]={__ename__:["haxe","io","Error"],__constructs__:["Blocked","Overflow","OutsideBounds","Custom"]};C.Blocked=["Blocked",0],C.Blocked.toString=a,C.Blocked.__enum__=C,C.Overflow=["Overflow",1],C.Overflow.toString=a,C.Overflow.__enum__=C,C.OutsideBounds=["OutsideBounds",2],C.OutsideBounds.toString=a,C.OutsideBounds.__enum__=C,C.Custom=function(t){var e=["Custom",3,t];return e.__enum__=C,e.toString=a,e};var P=function(){};o["haxe.io.FPHelper"]=P,P.__name__=["haxe","io","FPHelper"],P.i32ToFloat=function(t){var e=t>>>23&255,r=8388607&t;return 0==r&&0==e?0:(1-(t>>>31<<1))*(1+Math.pow(2,-23)*r)*Math.pow(2,e-127)},P.floatToI32=function(t){if(0==t)return 0;var e,r=Math.floor(Math.log(e=0>t?-t:t)/.6931471805599453);return-127>r?r=-127:r>128&&(r=128),(0>t?-2147483648:0)|r+127<<23|8388607&Math.round(8388608*(e/Math.pow(2,r)-1))},P.i64ToDouble=function(t,e){var r=(e>>20&2047)-1023,n=4294967296*(1048575&e)+2147483648*(t>>>31)+(2147483647&t);return 0==n&&-1023==r?0:(1-(e>>>31<<1))*(1+Math.pow(2,-52)*n)*Math.pow(2,r)},P.doubleToI64=function(t){var e=P.i64tmp;if(0==t)e.low=0,e.high=0;else{var r,n,i=Math.floor(Math.log(r=0>t?-t:t)/.6931471805599453),s=0|(n=Math.round(4503599627370496*(r/Math.pow(2,i)-1))),o=n/4294967296|0;e.low=s,e.high=(0>t?-2147483648:0)|i+1023<<20|o}return e};var A=function(t){Error.call(this),this.val=t,this.message=t+"",Error.captureStackTrace&&Error.captureStackTrace(this,A)};o["js._Boot.HaxeError"]=A,A.__name__=["js","_Boot","HaxeError"],A.__super__=Error,A.prototype=n(Error.prototype,{__class__:A});var E=function(){};o["js.Boot"]=E,E.__name__=["js","Boot"],E.getClass=function(t){if(t instanceof Array&&null==t.__enum__)return Array;var e=t.__class__;if(null!=e)return e;var r=E.__nativeClassName(t);return null!=r?E.__resolveNativeClass(r):null},E.__string_rec=function(t,e){if(null==t)return"null";if(e.length>=5)return"<...>";var r=typeof t;switch("function"==r&&(t.__name__||t.__ename__)&&(r="object"),r){case"object":if(t instanceof Array){if(t.__enum__){if(2==t.length)return t[0];var n=t[0]+"(";e+="\t";for(var i=2,s=t.length;s>i;){var o=i++;n+=2!=o?","+E.__string_rec(t[o],e):E.__string_rec(t[o],e)}return n+")"}var a=t.length,u="[";e+="\t";for(var h=0;a>h;){var c=h++;u+=(c>0?",":"")+E.__string_rec(t[c],e)}return u+"]"}var l;try{l=t.toString}catch(t){return t instanceof A&&(t=t.val),"???"}if(null!=l&&l!=Object.toString&&"function"==typeof l){var f=t.toString();if("[object Object]"!=f)return f}var d=null,p="{\n";e+="\t";var m=null!=t.hasOwnProperty;for(var d in t)m&&!t.hasOwnProperty(d)||"prototype"!=d&&"__class__"!=d&&"__super__"!=d&&"__interfaces__"!=d&&"__properties__"!=d&&(2!=p.length&&(p+=", \n"),p+=e+d+" : "+E.__string_rec(t[d],e));return p+"\n"+(e=e.substring(1))+"}";case"function":return"<function>";case"string":return t;default:return t+""}},E.__interfLoop=function(t,e){if(null==t)return!1;if(t==e)return!0;var r=t.__interfaces__;if(null!=r)for(var n=0,i=r.length;i>n;){var s=r[n++];if(s==e||E.__interfLoop(s,e))return!0}return E.__interfLoop(t.__super__,e)},E.__instanceof=function(t,e){if(null==e)return!1;switch(e){case Qt:return(0|t)===t;case te:return"number"==typeof t;case ee:return"boolean"==typeof t;case String:return"string"==typeof t;case Array:return t instanceof Array&&null==t.__enum__;case Jt:return!0;default:if(null==t)return!1;if("function"==typeof e){if(t instanceof e)return!0;if(E.__interfLoop(E.getClass(t),e))return!0}else if("object"==typeof e&&E.__isNativeObj(e)&&t instanceof e)return!0;return e==re&&null!=t.__name__||e==ne&&null!=t.__ename__||t.__enum__==e}},E.__nativeClassName=function(t){var e=E.__toStr.call(t).slice(8,-1);return"Object"==e||"Function"==e||"Math"==e||"JSON"==e?null:e},E.__isNativeObj=function(t){return null!=E.__nativeClassName(t)},E.__resolveNativeClass=function(t){return r[t]};var k=function(t){if(t instanceof Array&&null==t.__enum__)this.a=t,this.byteLength=t.length;else{var e=t;this.a=[];for(var r=0;e>r;){var n=r++;this.a[n]=0}this.byteLength=e}};o["js.html.compat.ArrayBuffer"]=k,k.__name__=["js","html","compat","ArrayBuffer"],k.sliceImpl=function(t,e){var r=new oe(this,t,null==e?null:e-t),n=new se(r.byteLength);return new oe(n).set(r),n},k.prototype={slice:function(t,e){return new k(this.a.slice(t,e))},__class__:k};var T=function(t,e,r){if(this.buf=t,this.offset=null==e?0:e,this.length=null==r?t.byteLength-this.offset:r,0>this.offset||0>this.length||this.offset+this.length>t.byteLength)throw new A(C.OutsideBounds)};o["js.html.compat.DataView"]=T,T.__name__=["js","html","compat","DataView"],T.prototype={getInt8:function(t){var e=this.buf.a[this.offset+t];return 128>e?e:e-256},getUint8:function(t){return this.buf.a[this.offset+t]},getInt16:function(t,e){var r=this.getUint16(t,e);return 32768>r?r:r-65536},getUint16:function(t,e){return e?this.buf.a[this.offset+t]|this.buf.a[this.offset+t+1]<<8:this.buf.a[this.offset+t]<<8|this.buf.a[this.offset+t+1]},getInt32:function(t,e){var r=this.offset+t,n=this.buf.a[r++],i=this.buf.a[r++],s=this.buf.a[r++],o=this.buf.a[r++];return e?n|i<<8|s<<16|o<<24:o|s<<8|i<<16|n<<24},getUint32:function(t,e){var r=this.getInt32(t,e);return 0>r?r+4294967296:r},getFloat32:function(t,e){return P.i32ToFloat(this.getInt32(t,e))},getFloat64:function(t,e){var r=this.getInt32(t,e),n=this.getInt32(t+4,e);return P.i64ToDouble(e?r:n,e?n:r)},setInt8:function(t,e){this.buf.a[t+this.offset]=0>e?e+128&255:255&e},setUint8:function(t,e){this.buf.a[t+this.offset]=255&e},setInt16:function(t,e,r){this.setUint16(t,0>e?e+65536:e,r)},setUint16:function(t,e,r){var n=t+this.offset;r?(this.buf.a[n]=255&e,this.buf.a[n++]=e>>8&255):(this.buf.a[n++]=e>>8&255,this.buf.a[n]=255&e)},setInt32:function(t,e,r){this.setUint32(t,e,r)},setUint32:function(t,e,r){var n=t+this.offset;r?(this.buf.a[n++]=255&e,this.buf.a[n++]=e>>8&255,this.buf.a[n++]=e>>16&255,this.buf.a[n++]=e>>>24):(this.buf.a[n++]=e>>>24,this.buf.a[n++]=e>>16&255,this.buf.a[n++]=e>>8&255,this.buf.a[n++]=255&e)},setFloat32:function(t,e,r){this.setUint32(t,P.floatToI32(e),r)},setFloat64:function(t,e,r){var n=P.doubleToI64(e);r?(this.setUint32(t,n.low),this.setUint32(t,n.high)):(this.setUint32(t,n.high),this.setUint32(t,n.low))},__class__:T};var N=function(){};o["js.html.compat.Uint8Array"]=N,N.__name__=["js","html","compat","Uint8Array"],N._new=function(t,e,r){var n;if("number"==typeof t){n=[];for(var i=0;t>i;)n[i++]=0;n.byteLength=n.length,n.byteOffset=0,n.buffer=new k(n)}else if(E.__instanceof(t,k)){var s=t;null==e&&(e=0),null==r&&(r=s.byteLength-e),(n=0==e?s.a:s.a.slice(e,e+r)).byteLength=n.length,n.byteOffset=e,n.buffer=s}else{if(!(t instanceof Array&&null==t.__enum__))throw new A("TODO "+f.string(t));(n=t.slice()).byteLength=n.length,n.byteOffset=0,n.buffer=new k(n)}return n.subarray=N._subarray,n.set=N._set,n},N._set=function(t,e){var r=this;if(E.__instanceof(t.buffer,k)){var n=t;if(t.byteLength+e>r.byteLength)throw new A("set() outside of range");for(var i=0,s=t.byteLength;s>i;){var o=i++;r[o+e]=n[o]}}else{if(!(t instanceof Array&&null==t.__enum__))throw new A("TODO");var a=t;if(a.length+e>r.byteLength)throw new A("set() outside of range");for(var u=0,h=a.length;h>u;){var c=u++;r[c+e]=a[c]}}},N._subarray=function(t,e){var r=N._new(this.slice(t,e));return r.byteOffset=t,r};var I=function(){};o["verb.Verb"]=I,I.__name__=["verb","Verb"],I.main=function(){t.log("verb 2.0.0")};var V=function(){};o["verb.core.ArrayExtensions"]=e.core.ArrayExtensions=V,V.__name__=["verb","core","ArrayExtensions"],V.alloc=function(t,e){if(e>=0)for(;t.length<e;)t.push(null)},V.reversed=function(t){var e=t.slice();return e.reverse(),e},V.last=function(t){return t[t.length-1]},V.first=function(t){return t[0]},V.spliceAndInsert=function(t,e,r,n){t.splice(e,r),t.splice(e,0,n)},V.left=function(t){if(0==t.length)return[];var e=Math.ceil(t.length/2);return t.slice(0,e)},V.right=function(t){if(0==t.length)return[];var e=Math.ceil(t.length/2);return t.slice(e)},V.rightWithPivot=function(t){if(0==t.length)return[];var e=Math.ceil(t.length/2);return t.slice(e-1)},V.unique=function(t,e){if(0==t.length)return[];for(var r=[t.pop()];t.length>0;){for(var n=t.pop(),i=!0,s=0;s<r.length;){var o=r[s];if(++s,e(n,o)){i=!1;break}}i&&r.push(n)}return r};var D=function(){};o["verb.core.Binomial"]=D,D.__name__=["verb","core","Binomial"],D.get=function(t,e){if(0==e)return 1;if(0==t||e>t)return 0;if(e>t-e&&(e=t-e),D.memo_exists(t,e))return D.get_memo(t,e);for(var r=1,n=t,i=1,s=e+1;s>i;){var o=i++;D.memo_exists(n,o)?(t--,r=D.get_memo(n,o)):(r*=t--,D.memoize(n,o,r/=o))}return r},D.get_no_memo=function(t,e){if(0==e)return 1;if(0==t||e>t)return 0;e>t-e&&(e=t-e);for(var r=1,n=1,i=e+1;i>n;)r*=t--,r/=n++;return r},D.memo_exists=function(t,e){return D.memo.h.hasOwnProperty(t)&&D.memo.h[t].h.hasOwnProperty(e)},D.get_memo=function(t,e){return D.memo.h[t].h[e]},D.memoize=function(t,e,r){D.memo.h.hasOwnProperty(t)||D.memo.set(t,new b),D.memo.h[t].h[e]=r};var B=e.core.BoundingBox=function(t){this.max=null,this.min=null,this.dim=3,this.initialized=!1,null!=t&&this.addRange(t)};o["verb.core.BoundingBox"]=B,B.__name__=["verb","core","BoundingBox"],B.intervalsOverlap=function(t,e,r,n,i){var s;null==i&&(i=-1),s=-.5>i?L.TOLERANCE:i;var o=Math.min(t,e)-s,a=Math.max(t,e)+s,u=Math.min(r,n)-s,h=Math.max(r,n)+s;return o>=u&&h>=o||a>=u&&h>=a||u>=o&&a>=u||h>=o&&a>=h},B.prototype={fromPoint:function(t){return new B([t])},add:function(t){if(!this.initialized)return this.dim=t.length,this.min=t.slice(0),this.max=t.slice(0),this.initialized=!0,this;for(var e=0,r=this.dim;r>e;){var n=e++;t[n]>this.max[n]&&(this.max[n]=t[n]),t[n]<this.min[n]&&(this.min[n]=t[n])}return this},addRange:function(t){for(var e=t.length,r=0;e>r;){var n=r++;this.add(t[n])}return this},contains:function(t,e){return null==e&&(e=-1),!!this.initialized&&this.intersects(new B([t]),e)},intersects:function(t,e){if(null==e&&(e=-1),!this.initialized||!t.initialized)return!1;for(var r=this.min,n=this.max,i=t.min,s=t.max,o=0,a=this.dim;a>o;){var u=o++;if(!B.intervalsOverlap(r[u],n[u],i[u],s[u],e))return!1}return!0},clear:function(){return this.initialized=!1,this},getLongestAxis:function(){for(var t=0,e=0,r=0,n=this.dim;n>r;){var i=r++,s=this.getAxisLength(i);s>t&&(t=s,e=i)}return e},getAxisLength:function(t){return 0>t||t>this.dim-1?0:Math.abs(this.min[t]-this.max[t])},intersect:function(t,e){if(!this.initialized)return null;var r=this.min,n=this.max,i=t.min,s=t.max;if(!this.intersects(t,e))return null;for(var o=[],a=[],u=0,h=this.dim;h>u;){var c=u++;o.push(Math.min(n[c],s[c])),a.push(Math.max(r[c],i[c]))}return new B([a,o])},__class__:B};var L=e.core.Constants=function(){};o["verb.core.Constants"]=L,L.__name__=["verb","core","Constants"];var O=e.core.SerializableBase=function(){};o["verb.core.SerializableBase"]=O,O.__name__=["verb","core","SerializableBase"],O.prototype={serialize:function(){var t=new x;return t.serialize(this),t.toString()},__class__:O};var U=e.core.Plane=function(t,e){this.origin=t,this.normal=e};o["verb.core.Plane"]=U,U.__name__=["verb","core","Plane"],U.__super__=O,U.prototype=n(O.prototype,{__class__:U});var F=e.core.Ray=function(t,e){this.origin=t,this.dir=e};o["verb.core.Ray"]=F,F.__name__=["verb","core","Ray"],F.__super__=O,F.prototype=n(O.prototype,{__class__:F});var R=e.core.NurbsCurveData=function(t,e,r){this.degree=t,this.controlPoints=r,this.knots=e};o["verb.core.NurbsCurveData"]=R,R.__name__=["verb","core","NurbsCurveData"],R.__super__=O,R.prototype=n(O.prototype,{__class__:R});var j=e.core.NurbsSurfaceData=function(t,e,r,n,i){this.degreeU=t,this.degreeV=e,this.knotsU=r,this.knotsV=n,this.controlPoints=i};o["verb.core.NurbsSurfaceData"]=j,j.__name__=["verb","core","NurbsSurfaceData"],j.__super__=O,j.prototype=n(O.prototype,{__class__:j});var q=e.core.MeshData=function(t,e,r,n){this.faces=t,this.points=e,this.normals=r,this.uvs=n};o["verb.core.MeshData"]=q,q.__name__=["verb","core","MeshData"],q.empty=function(){return new q([],[],[],[])},q.__super__=O,q.prototype=n(O.prototype,{__class__:q});var X=e.core.PolylineData=function(t,e){this.points=t,this.params=e};o["verb.core.PolylineData"]=X,X.__name__=["verb","core","PolylineData"],X.__super__=O,X.prototype=n(O.prototype,{__class__:X});var Y=e.core.VolumeData=function(t,e,r,n,i,s,o){this.degreeU=t,this.degreeV=e,this.degreeW=r,this.knotsU=n,this.knotsV=i,this.knotsW=s,this.controlPoints=o};o["verb.core.VolumeData"]=Y,Y.__name__=["verb","core","VolumeData"],Y.__super__=O,Y.prototype=n(O.prototype,{__class__:Y});var W=e.core.Pair=function(t,e){this.item0=t,this.item1=e};o["verb.core.Pair"]=W,W.__name__=["verb","core","Pair"],W.prototype={__class__:W};var Z=e.core.Interval=function(t,e){this.min=t,this.max=e};o["verb.core.Interval"]=Z,Z.__name__=["verb","core","Interval"],Z.prototype={__class__:Z};var H=e.core.CurveCurveIntersection=function(t,e,r,n){this.point0=t,this.point1=e,this.u0=r,this.u1=n};o["verb.core.CurveCurveIntersection"]=H,H.__name__=["verb","core","CurveCurveIntersection"],H.prototype={__class__:H};var $=e.core.CurveSurfaceIntersection=function(t,e,r,n){this.u=t,this.uv=e,this.curvePoint=r,this.surfacePoint=n};o["verb.core.CurveSurfaceIntersection"]=$,$.__name__=["verb","core","CurveSurfaceIntersection"],$.prototype={__class__:$};var G=e.core.MeshIntersectionPoint=function(t,e,r){this.visited=!1,this.adj=null,this.opp=null,this.uv0=t,this.uv1=e,this.point=r,this.faceIndex0,this.faceIndex1};o["verb.core.MeshIntersectionPoint"]=G,G.__name__=["verb","core","MeshIntersectionPoint"],G.prototype={__class__:G};var K=e.core.PolylineMeshIntersection=function(t,e,r,n,i){this.point=t,this.u=e,this.uv=r,this.polylineIndex=n,this.faceIndex=i};o["verb.core.PolylineMeshIntersection"]=K,K.__name__=["verb","core","PolylineMeshIntersection"],K.prototype={__class__:K};var Q=e.core.SurfaceSurfaceIntersectionPoint=function(t,e,r,n){this.uv0=t,this.uv1=e,this.point=r,this.dist=n};o["verb.core.SurfaceSurfaceIntersectionPoint"]=Q,Q.__name__=["verb","core","SurfaceSurfaceIntersectionPoint"],Q.prototype={__class__:Q};var J=e.core.TriSegmentIntersection=function(t,e,r,n){this.point=t,this.s=e,this.t=r,this.p=n};o["verb.core.TriSegmentIntersection"]=J,J.__name__=["verb","core","TriSegmentIntersection"],J.prototype={__class__:J};var tt=e.core.CurveTriPoint=function(t,e,r){this.u=t,this.point=e,this.uv=r};o["verb.core.CurveTriPoint"]=tt,tt.__name__=["verb","core","CurveTriPoint"],tt.prototype={__class__:tt};var et=function(t,e,r,n,i){null==i&&(i=!1),null==n&&(n=-1),this.uv=r,this.point=t,this.normal=e,this.id=n,this.degen=i};o["verb.core.SurfacePoint"]=et,et.__name__=["verb","core","SurfacePoint"],et.fromUv=function(t,e){return new et(null,null,[t,e])},et.prototype={__class__:et};var rt=e.core.CurvePoint=function(t,e){this.u=t,this.pt=e};o["verb.core.CurvePoint"]=rt,rt.__name__=["verb","core","CurvePoint"],rt.prototype={__class__:rt};var nt=e.core.KdTree=function(t,e){this.dim=3,this.points=t,this.distanceFunction=e,this.dim=t[0].point.length,this.root=this.buildTree(t,0,null)};o["verb.core.KdTree"]=nt,nt.__name__=["verb","core","KdTree"],nt.prototype={buildTree:function(t,e,r){var n,i,s=e%this.dim;return 0==t.length?null:1==t.length?new ot(t[0],s,r):(t.sort((function(t,e){var r=t.point[s]-e.point[s];return 0==r?0:r>0?1:-1})),n=Math.floor(t.length/2),(i=new ot(t[n],s,r)).left=this.buildTree(t.slice(0,n),e+1,i),i.right=this.buildTree(t.slice(n+1),e+1,i),i)},nearest:function(t,e,r){var n,i=this,s=new it((function(t){return-t.item1})),o=null;n=o=function(r){for(var n,a,u,h,c=r.dimension,l=i.distanceFunction(t,r.kdPoint.point),f=[],d=0,p=i.dim;p>d;)d++,f.push(0);a=f;for(var m=function(t,r){s.push(new W(t,r)),s.size()>e&&s.pop()},v=0,g=i.dim;g>v;){var y=v++;y==r.dimension?a[y]=t[y]:a[y]=r.kdPoint.point[y]}u=i.distanceFunction(a,r.kdPoint.point),null!=r.right||null!=r.left?(n=null==r.right?r.left:null==r.left?r.right:t[c]<r.kdPoint.point[c]?r.left:r.right,o(n),(s.size()<e||l<s.peek().item1)&&m(r,l),(s.size()<e||Math.abs(u)<s.peek().item1)&&null!=(h=n==r.left?r.right:r.left)&&o(h)):(s.size()<e||l<s.peek().item1)&&m(r,l)};for(var a=0;e>a;)a++,s.push(new W(null,r));n(this.root);for(var u=[],h=0;e>h;){var c=h++;null!=s.content[c].item0&&u.push(new W(s.content[c].item0.kdPoint,s.content[c].item1))}return u},__class__:nt};var it=function(t){this.content=[],this.scoreFunction=t};o["verb.core.BinaryHeap"]=it,it.__name__=["verb","core","BinaryHeap"],it.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},peek:function(){return this.content[0]},remove:function(t){for(var e=this.content.length,r=0;e>r;){var n=r++;if(this.content[n]==t){var i=this.content.pop();return void(n!=e-1&&(this.content[n]=i,this.scoreFunction(i)<this.scoreFunction(t)?this.bubbleUp(n):this.sinkDown(n)))}}throw new A("Node not found.")},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t];t>0;){var r=Math.floor((t+1)/2)-1,n=this.content[r];if(this.scoreFunction(e)>=this.scoreFunction(n))break;this.content[r]=e,this.content[t]=n,t=r}},sinkDown:function(t){for(var e=this.content.length,r=this.content[t],n=this.scoreFunction(r);;){var i=2*(t+1),s=i-1,o=-1,a=0;if(e>s){var u=this.content[s];n>(a=this.scoreFunction(u))&&(o=s)}if(e>i){var h=this.content[i];(-1==o?n:a)>this.scoreFunction(h)&&(o=i)}if(-1==o)break;this.content[t]=this.content[o],this.content[o]=r,t=o}},__class__:it};var st=e.core.KdPoint=function(t,e){this.point=t,this.obj=e};o["verb.core.KdPoint"]=st,st.__name__=["verb","core","KdPoint"],st.prototype={__class__:st};var ot=e.core.KdNode=function(t,e,r){this.kdPoint=t,this.left=null,this.right=null,this.parent=r,this.dimension=e};o["verb.core.KdNode"]=ot,ot.__name__=["verb","core","KdNode"],ot.prototype={__class__:ot};var at=function(){};o["verb.eval.IBoundingBoxTree"]=at,at.__name__=["verb","eval","IBoundingBoxTree"],at.prototype={__class__:at};var ut=function(t,e){this._boundingBox=null,this._curve=t,null==e&&(e=bt.domain(this._curve.knots)/64),this._knotTol=e};o["verb.core.LazyCurveBoundingBoxTree"]=ut,ut.__name__=["verb","core","LazyCurveBoundingBoxTree"],ut.__interfaces__=[at],ut.prototype={split:function(){var t=V.first(this._curve.knots),e=V.last(this._curve.knots),r=e-t,n=Mt.curveSplit(this._curve,(e+t)/2+.1*r*Math.random());return new W(new ut(n[0],this._knotTol),new ut(n[1],this._knotTol))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=new B(Pt.dehomogenize1d(this._curve.controlPoints))),this._boundingBox},yield:function(){return this._curve},indivisible:function(){return bt.domain(this._curve.knots)<this._knotTol},empty:function(){return!1},__class__:ut};var ht=e.core.LazyMeshBoundingBoxTree=function(t,e){if(this._boundingBox=null,this._mesh=t,null==e){for(var r=[],n=0,i=t.faces.length;i>n;){var s=n++;r.push(s)}e=r}this._faceIndices=e};o["verb.core.LazyMeshBoundingBoxTree"]=ht,ht.__name__=["verb","core","LazyMeshBoundingBoxTree"],ht.__interfaces__=[at],ht.prototype={split:function(){var t=pt.sortTrianglesOnLongestAxis(this.boundingBox(),this._mesh,this._faceIndices),e=V.left(t),r=V.right(t);return new W(new ht(this._mesh,e),new ht(this._mesh,r))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=pt.makeMeshAabb(this._mesh,this._faceIndices)),this._boundingBox},yield:function(){return this._faceIndices[0]},indivisible:function(){return 1==this._faceIndices.length},empty:function(){return 0==this._faceIndices.length},__class__:ht};var ct=function(t,e){this._boundingBox=null,this._polyline=t,null==e&&(e=new Z(0,0!=t.points.length?t.points.length-1:0)),this._interval=e};o["verb.core.LazyPolylineBoundingBoxTree"]=ct,ct.__name__=["verb","core","LazyPolylineBoundingBoxTree"],ct.__interfaces__=[at],ct.prototype={split:function(){var t=this._interval.min,e=this._interval.max,r=t+Math.ceil((e-t)/2),n=new Z(t,r),i=new Z(r,e);return new W(new ct(this._polyline,n),new ct(this._polyline,i))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=new B(this._polyline.points)),this._boundingBox},yield:function(){return this._interval.min},indivisible:function(){return this._interval.max-this._interval.min==1},empty:function(){return this._interval.max-this._interval.min==0},__class__:ct};var lt=function(t,e,r,n){null==e&&(e=!1),this._boundingBox=null,this._surface=t,this._splitV=e,null==r&&(r=bt.domain(t.knotsU)/16),null==n&&(n=bt.domain(t.knotsV)/16),this._knotTolU=r,this._knotTolV=n};o["verb.core.LazySurfaceBoundingBoxTree"]=lt,lt.__name__=["verb","core","LazySurfaceBoundingBoxTree"],lt.__interfaces__=[at],lt.prototype={split:function(){var t,e;this._splitV?(t=V.first(this._surface.knotsV),e=V.last(this._surface.knotsV)):(t=V.first(this._surface.knotsU),e=V.last(this._surface.knotsU));var r=(t+e)/2,n=Mt.surfaceSplit(this._surface,r,this._splitV);return new W(new lt(n[0],!this._splitV,this._knotTolU,this._knotTolV),new lt(n[1],!this._splitV,this._knotTolU,this._knotTolV))},boundingBox:function(){if(null==this._boundingBox){this._boundingBox=new B;for(var t=0,e=this._surface.controlPoints;t<e.length;){var r=e[t];++t,this._boundingBox.addRange(Pt.dehomogenize1d(r))}}return this._boundingBox},yield:function(){return this._surface},indivisible:function(){return bt.domain(this._surface.knotsV)<this._knotTolV&&bt.domain(this._surface.knotsU)<this._knotTolU},empty:function(){return!1},__class__:lt};var ft=e.core.Mat=function(){};o["verb.core.Mat"]=ft,ft.__name__=["verb","core","Mat"],ft.mul=function(t,e){for(var r=[],n=0,i=e.length;i>n;){var s=n++;r.push(bt.mul(t,e[s]))}return r},ft.mult=function(t,e){var r,n,i,s,o,a,u,h;r=t.length,n=e.length,i=e[0].length,s=[];for(var c=r-1,l=0,f=0;c>=0;){for(o=[],a=t[c],f=i-1;f>=0;){for(u=a[n-1]*e[n-1][f],l=n-2;l>=1;)h=l-1,u+=a[l]*e[l][f]+a[h]*e[h][f],l-=2;0==l&&(u+=a[0]*e[0][f]),o[f]=u,f--}s[c]=o,c--}return s},ft.add=function(t,e){for(var r=[],n=0,i=t.length;i>n;){var s=n++;r.push(bt.add(t[s],e[s]))}return r},ft.div=function(t,e){for(var r=[],n=0,i=t.length;i>n;){var s=n++;r.push(bt.div(t[s],e))}return r},ft.sub=function(t,e){for(var r=[],n=0,i=t.length;i>n;){var s=n++;r.push(bt.sub(t[s],e[s]))}return r},ft.dot=function(t,e){for(var r=[],n=0,i=t.length;i>n;){var s=n++;r.push(bt.dot(t[s],e))}return r},ft.identity=function(t){for(var e=bt.zeros2d(t,t),r=0;t>r;){var n=r++;e[n][n]=1}return e},ft.transpose=function(t){if(0==t.length)return[];for(var e=[],r=0,n=t[0].length;n>r;){var i=r++;e.push(function(){for(var e=[],r=0,n=t.length;n>r;){var s=r++;e.push(t[s][i])}return e}())}return e},ft.solve=function(t,e){return ft.LUsolve(ft.LU(t),e)},ft.LUsolve=function(t,e){var r,n,i,s,o,a=t.LU,u=a.length,h=e.slice(),c=t.P;for(r=u-1;-1!=r;)h[r]=e[r],--r;for(r=0;u>r;){for(i=c[r],c[r]!=r&&(o=h[r],h[r]=h[i],h[i]=o),s=a[r],n=0;r>n;)h[r]-=h[n]*s[n],++n;++r}for(r=u-1;r>=0;){for(s=a[r],n=r+1;u>n;)h[r]-=h[n]*s[n],++n;h[r]/=s[r],--r}return h},ft.LU=function(t){for(var e,r,n,i,s,o,a,u,h,c=[],l=0,f=t.length;f>l;){var d=l++;c.push(t[d].slice())}var p=(t=c).length,m=p-1,v=[];for(n=0;p>n;){for(a=n,o=t[n],h=Math.abs(o[n]),r=n+1;p>r;)(i=Math.abs(t[r][n]))>h&&(h=i,a=r),++r;for(v[n]=a,a!=n&&(t[n]=t[a],t[a]=o,o=t[n]),s=o[n],e=n+1;p>e;)t[e][n]/=s,++e;for(e=n+1;p>e;){for(u=t[e],r=n+1;m>r;)u[r]-=u[n]*o[r],u[++r]-=u[n]*o[r],++r;r==m&&(u[r]-=u[n]*o[r]),++e}++n}return new dt(t,v)};var dt=function(t,e){this.LU=t,this.P=e};o["verb.core._Mat.LUDecomp"]=dt,dt.__name__=["verb","core","_Mat","LUDecomp"],dt.prototype={__class__:dt};var pt=e.core.Mesh=function(){};o["verb.core.Mesh"]=pt,pt.__name__=["verb","core","Mesh"],pt.getTriangleNorm=function(t,e){var r=t[e[0]],n=t[e[1]],i=t[e[2]],s=bt.sub(n,r),o=bt.sub(i,r),a=bt.cross(s,o);return bt.mul(1/bt.norm(a),a)},pt.makeMeshAabb=function(t,e){for(var r=new B,n=0;n<e.length;){var i=e[n];++n,r.add(t.points[t.faces[i][0]]),r.add(t.points[t.faces[i][1]]),r.add(t.points[t.faces[i][2]])}return r},pt.sortTrianglesOnLongestAxis=function(t,e,r){for(var n=t.getLongestAxis(),i=[],s=0;s<r.length;){var o=r[s];++s;var a=pt.getMinCoordOnAxis(e.points,e.faces[o],n);i.push(new W(a,o))}i.sort((function(t,e){var r=t.item0,n=e.item0;return r==n?0:r>n?1:-1}));for(var u=[],h=0,c=i.length;c>h;){var l=h++;u.push(i[l].item1)}return u},pt.getMinCoordOnAxis=function(t,e,r){for(var n=1/0,i=0;3>i;){var s=t[e[i++]][r];n>s&&(n=s)}return n},pt.getTriangleCentroid=function(t,e){for(var r=[0,0,0],n=0;3>n;)for(var i=n++,s=0;3>s;){var o=s++;r[o]+=t[e[i]][o]}for(var a=0;3>a;)r[a++]/=3;return r},pt.triangleUVFromPoint=function(t,e,r){var n=t.faces[e],i=t.points[n[0]],s=t.points[n[1]],o=t.points[n[2]],a=t.uvs[n[0]],u=t.uvs[n[1]],h=t.uvs[n[2]],c=bt.sub(i,r),l=bt.sub(s,r),f=bt.sub(o,r),d=bt.norm(bt.cross(bt.sub(i,s),bt.sub(i,o))),p=bt.norm(bt.cross(l,f))/d,m=bt.norm(bt.cross(f,c))/d,v=bt.norm(bt.cross(c,l))/d;return bt.add(bt.mul(p,a),bt.add(bt.mul(m,u),bt.mul(v,h)))};var mt=function(t,e){if(this._empty=!1,this._face=-1,null==e){for(var r=[],n=0,i=t.faces.length;i>n;){var s=n++;r.push(s)}e=r}if(this._boundingBox=pt.makeMeshAabb(t,e),1>e.length)this._empty=!0;else if(2>e.length)this._face=e[0];else{var o=pt.sortTrianglesOnLongestAxis(this._boundingBox,t,e),a=V.left(o),u=V.right(o);this._children=new W(new mt(t,a),new mt(t,u))}};o["verb.core.MeshBoundingBoxTree"]=mt,mt.__name__=["verb","core","MeshBoundingBoxTree"],mt.__interfaces__=[at],mt.prototype={split:function(){return this._children},boundingBox:function(){return this._boundingBox},yield:function(){return this._face},indivisible:function(){return null==this._children},empty:function(){return this._empty},__class__:mt};var vt=e.core.Minimizer=function(){};o["verb.core.Minimizer"]=vt,vt.__name__=["verb","core","Minimizer"],vt.uncmin=function(t,e,r,n,i){null==r&&(r=1e-8),null==n&&(n=function(e){return vt.numericalGradient(t,e)}),null==i&&(i=1e3);var s,o,a,u,h=(e=e.slice(0)).length,c=t(e),l=c;if(isNaN(c))throw new A("uncmin: f(x0) is a NaN!");r=Math.max(r,L.EPSILON);var f,d,p,m,v,g,y=ft.identity(h),x=0,_=[],b="";for(a=n(e);i>x;){if(!bt.all(bt.finite(a))){b="Gradient has Infinity or NaN";break}if(o=bt.neg(ft.dot(y,a)),!bt.all(bt.finite(o))){b="Search direction has Infinity or NaN";break}if(r>(g=bt.norm(o))){b="Newton step smaller than tol";break}for(v=1,s=bt.dot(a,o),f=e;i>x&&v*g>=r&&(_=bt.mul(v,o),f=bt.add(e,_),.1*v*s<=(l=t(f))-c||isNaN(l));)v*=.5,++x;if(r>v*g){b="Line search step size smaller than tol";break}if(x==i){b="maxit reached during line search";break}u=n(f),d=bt.sub(u,a),m=bt.dot(d,_),p=ft.dot(y,d),y=ft.sub(ft.add(y,ft.mul((m+bt.dot(d,p))/(m*m),vt.tensor(_,_))),ft.div(ft.add(vt.tensor(p,_),vt.tensor(_,p)),m)),e=f,c=l,a=u,++x}return new gt(e,c,a,y,x,b)},vt.numericalGradient=function(t,e){var r=e.length,n=t(e);if(NaN==n)throw new A("gradient: f(x) is a NaN!");for(var i,s,o,a,u,h,c,l,f=e.slice(0),d=[],p=0,m=0;r>m;)for(var v=m++,g=Math.max(1e-6*n,1e-8);;){if(++p>20)throw new A("Numerical gradient fails");if(f[v]=e[v]+g,i=t(f),f[v]=e[v]-g,s=t(f),f[v]=e[v],isNaN(i)||isNaN(s))g/=16;else{if(d[v]=(i-s)/(2*g),o=e[v]-g,a=e[v],u=e[v]+g,h=(i-n)/g,c=(n-s)/g,l=bt.max([Math.abs(d[v]),Math.abs(n),Math.abs(i),Math.abs(s),Math.abs(o),Math.abs(a),Math.abs(u),1e-8]),.001>=Math.min(bt.max([Math.abs(h-d[v]),Math.abs(c-d[v]),Math.abs(h-c)])/l,g/l))break;g/=16}}return d},vt.tensor=function(t,e){for(var r,n,i=t.length,s=e.length,o=[],a=i-1;a>=0;){r=[],n=t[a];for(var u=s-1;u>=3;)r[u]=n*e[u],r[--u]=n*e[u],r[--u]=n*e[u],r[--u]=n*e[u],--u;for(;u>=0;)r[u]=n*e[u],--u;o[a]=r,a--}return o};var gt=function(t,e,r,n,i,s){this.solution=t,this.value=e,this.gradient=r,this.invHessian=n,this.iterations=i,this.message=s};o["verb.core.MinimizationResult"]=gt,gt.__name__=["verb","core","MinimizationResult"],gt.prototype={__class__:gt};var yt=function(){};o["verb.core.ISerializable"]=yt,yt.__name__=["verb","core","ISerializable"],yt.prototype={__class__:yt};var xt=e.core.Deserializer=function(){};o["verb.core.Deserializer"]=xt,xt.__name__=["verb","core","Deserializer"],xt.deserialize=function(t){return new _(t).unserialize()};var _t=e.core.Trig=function(){};o["verb.core.Trig"]=_t,_t.__name__=["verb","core","Trig"],_t.isPointInPlane=function(t,e,r){return Math.abs(bt.dot(bt.sub(t,e.origin),e.normal))<r},_t.distToSegment=function(t,e,r){var n=_t.segmentClosestPoint(e,t,r,0,1);return bt.dist(e,n.pt)},_t.rayClosestPoint=function(t,e,r){var n=bt.sub(t,e),i=bt.dot(n,r);return bt.add(e,bt.mul(i,r))},_t.distToRay=function(t,e,r){var n=_t.rayClosestPoint(t,e,r),i=bt.sub(n,t);return bt.norm(i)},_t.threePointsAreFlat=function(t,e,r,n){var i=bt.sub(e,t),s=bt.sub(r,t),o=bt.cross(i,s);return n>bt.dot(o,o)},_t.segmentClosestPoint=function(t,e,r,n,i){var s=bt.sub(r,e),o=bt.norm(s);if(o<L.EPSILON)return{u:n,pt:e};var a=e,u=bt.mul(1/o,s),h=bt.sub(t,a),c=bt.dot(h,u);return 0>c?{u:n,pt:e}:c>o?{u:i,pt:r}:{u:n+(i-n)*c/o,pt:bt.add(a,bt.mul(c,u))}};var bt=e.core.Vec=function(){};o["verb.core.Vec"]=bt,bt.__name__=["verb","core","Vec"],bt.angleBetween=function(t,e){return Math.acos(bt.dot(t,e)/(bt.norm(t)*bt.norm(e)))},bt.positiveAngleBetween=function(t,e,r){var n=bt.cross(t,e),i=bt.norm(t)*bt.norm(e),s=bt.dot(t,e),o=bt.norm(n)/i,a=Math.atan2(o,s/i),u=bt.dot(r,n);return Math.abs(u)<L.EPSILON||u>0?a:-a},bt.signedAngleBetween=function(t,e,r){var n=bt.cross(t,e),i=bt.norm(t)*bt.norm(e),s=bt.dot(t,e),o=bt.norm(n)/i,a=Math.atan2(o,s/i);return bt.dot(r,n)>0?a:2*Math.PI-a},bt.angleBetweenNormalized2d=function(t,e){var r=t[0]*e[1]-t[1]*e[0];return Math.atan2(r,bt.dot(t,e))},bt.domain=function(t){return V.last(t)-V.first(t)},bt.range=function(t){for(var e=[],r=0,n=0;t>n;)n++,e.push(r),r+=1;return e},bt.span=function(t,e,r){if(null==r)return[];if(r<L.EPSILON)return[];if(t>e&&r>0)return[];if(e>t&&0>r)return[];for(var n=[],i=t;e>=i;)n.push(i),i+=r;return n},bt.neg=function(t){return t.map((function(t){return-t}))},bt.min=function(t){return h.fold(t,(function(t,e){return Math.min(t,e)}),1/0)},bt.max=function(t){return h.fold(t,(function(t,e){return Math.max(t,e)}),-1/0)},bt.all=function(t){return h.fold(t,(function(t,e){return e&&t}),!0)},bt.finite=function(t){return t.map((function(t){return isFinite(t)}))},bt.onRay=function(t,e,r){return bt.add(t,bt.mul(r,e))},bt.lerp=function(t,e,r){return bt.add(bt.mul(t,e),bt.mul(1-t,r))},bt.normalized=function(t){return bt.div(t,bt.norm(t))},bt.cross=function(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]},bt.dist=function(t,e){return bt.norm(bt.sub(t,e))},bt.distSquared=function(t,e){return bt.normSquared(bt.sub(t,e))},bt.sum=function(t){return h.fold(t,(function(t,e){return e+t}),0)},bt.addAll=function(t){var e=s(t)();if(!e.hasNext())return null;var r=e.next().length;return h.fold(t,(function(t,e){return bt.add(e,t)}),bt.rep(r,0))},bt.norm=function(t){var e=bt.normSquared(t);return 0!=e?Math.sqrt(e):e},bt.normSquared=function(t){return h.fold(t,(function(t,e){return e+t*t}),0)},bt.rep=function(t,e){for(var r=[],n=0;t>n;)n++,r.push(e);return r},bt.zeros1d=function(t){for(var e=[],r=0;t>r;)r++,e.push(0);return e},bt.zeros2d=function(t,e){for(var r=[],n=0;t>n;)n++,r.push(bt.zeros1d(e));return r},bt.zeros3d=function(t,e,r){for(var n=[],i=0;t>i;)i++,n.push(bt.zeros2d(e,r));return n},bt.dot=function(t,e){for(var r=0,n=0,i=t.length;i>n;){var s=n++;r+=t[s]*e[s]}return r},bt.add=function(t,e){for(var r=[],n=0,i=t.length;i>n;){var s=n++;r.push(t[s]+e[s])}return r},bt.mul=function(t,e){for(var r=[],n=0,i=e.length;i>n;){var s=n++;r.push(t*e[s])}return r},bt.div=function(t,e){for(var r=[],n=0,i=t.length;i>n;){var s=n++;r.push(t[s]/e)}return r},bt.sub=function(t,e){for(var r=[],n=0,i=t.length;i>n;){var s=n++;r.push(t[s]-e[s])}return r},bt.isZero=function(t){for(var e=0,r=t.length;r>e;){var n=e++;if(Math.abs(t[n])>L.TOLERANCE)return!1}return!0},bt.sortedSetUnion=function(t,e){for(var r=[],n=0,i=0;n<t.length||i<e.length;)if(n<t.length)if(i<e.length){var s=t[n]-e[i];Math.abs(s)<L.EPSILON?(r.push(t[n]),n++,i++):s>0?(r.push(e[i]),i++):(r.push(t[n]),n++)}else r.push(t[n]),n++;else r.push(e[i]),i++;return r},bt.sortedSetSub=function(t,e){for(var r=[],n=0,i=0;n<t.length;)i<e.length&&Math.abs(t[n]-e[i])<L.EPSILON?(n++,i++):(r.push(t[n]),n++);return r};var wt=e.eval.Analyze=function(){};o["verb.eval.Analyze"]=wt,wt.__name__=["verb","eval","Analyze"],wt.knotMultiplicities=function(t){for(var e=[new St(t[0],0)],r=e[0],n=0;n<t.length;){var i=t[n];++n,Math.abs(i-r.knot)>L.EPSILON&&(r=new St(i,0),e.push(r)),r.inc()}return e},wt.isRationalSurfaceClosed=function(t,e){var r;null==e&&(e=!0);for(var n=0,i=(r=e?t.controlPoints:ft.transpose(t.controlPoints))[0].length;i>n;){var s=n++;if(bt.dist(V.first(r)[s],V.last(r)[s])>=L.EPSILON)return!1}return!0},wt.rationalSurfaceClosestPoint=function(t,e){var r=wt.rationalSurfaceClosestParam(t,e);return Pt.rationalSurfacePoint(t,r[0],r[1])},wt.rationalSurfaceClosestParam=function(t,e){for(var r,n,i,s=0,o=1e-4,a=5e-4,u=t.knotsU[0],h=V.last(t.knotsU),c=t.knotsV[0],l=V.last(t.knotsV),f=wt.isRationalSurfaceClosed(t),d=wt.isRationalSurfaceClosed(t,!1),p=Tt.rationalSurfaceAdaptive(t,new Nt),m=1/0,v=0,g=p.points.length;g>v;){var y=v++,x=p.points[y],_=bt.normSquared(bt.sub(e,x));m>_&&(m=_,i=p.uvs[y])}for(var b=function(e){return Pt.rationalSurfaceDerivatives(t,e[0],e[1],2)},w=function(t,e,r){var n=e[1][0],i=e[0][1],s=e[2][0],o=e[0][2],a=e[1][1],u=e[1][1],h=[-bt.dot(n,r),-bt.dot(i,r)],c=[[bt.dot(n,n)+bt.dot(s,r),bt.dot(n,i)+bt.dot(a,r)],[bt.dot(n,i)+bt.dot(u,r),bt.dot(i,i)+bt.dot(o,r)]],l=ft.solve(c,h);return bt.add(l,t)};5>s;){r=b(i),n=bt.sub(r[0][0],e);var S=bt.norm(n),z=bt.dot(r[1][0],n),M=bt.norm(r[1][0])*S,C=bt.dot(r[0][1],n),P=bt.norm(r[0][1])*S;if(o>S&&a>z/M&&a>C/P)return i;var A=w(i,r,n);if(A[0]<u?A=f?[h-(A[0]-u),A[1]]:[u+L.EPSILON,A[1]]:A[0]>h&&(A=f?[u+(A[0]-h),A[1]]:[h-L.EPSILON,A[1]]),A[1]<c?A=d?[A[0],l-(A[1]-c)]:[A[0],c+L.EPSILON]:A[1]>l&&(A=d?[A[0],c+(A[0]-l)]:[A[0],l-L.EPSILON]),o>bt.norm(bt.mul(A[0]-i[0],r[1][0]))+bt.norm(bt.mul(A[1]-i[1],r[0][1])))return i;i=A,s++}return i},wt.rationalCurveClosestPoint=function(t,e){return Pt.rationalCurvePoint(t,wt.rationalCurveClosestParam(t,e))},wt.rationalCurveClosestParam=function(t,e){for(var r=1/0,n=0,s=Tt.rationalCurveRegularSample(t,t.controlPoints.length*t.degree,!0),o=0,a=s.length-1;a>o;){var u=o++,h=s[u][0],c=s[u+1][0],l=s[u].slice(1),f=s[u+1].slice(1),d=_t.segmentClosestPoint(e,l,f,h,c),p=bt.norm(bt.sub(e,d.pt));r>p&&(r=p,n=d.u)}for(var m,v,g=0,y=1e-4,x=t.knots[0],_=V.last(t.knots),b=bt.normSquared(bt.sub(t.controlPoints[0],V.last(t.controlPoints)))<L.EPSILON,w=n,S=function(e){return Pt.rationalCurveDerivatives(t,e,2)},z=function(t,e,r){return t-bt.dot(e[1],r)/(bt.dot(e[2],r)+bt.dot(e[1],e[1]))};5>g;){m=S(w),v=bt.sub(m[0],e);var M=bt.norm(v),C=bt.dot(m[1],v)/i(bt.norm(m[1])*M);if(y>M&&5e-4>Math.abs(C))return w;var P=z(w,m,v);x>P?P=b?_-(P-x):x:P>_&&(P=b?x+(P-_):_);var A=bt.norm(bt.mul(P-w,m[1]));if(y>A||Number.isNaN(A))return w;w=P,g++}return w},wt.rationalCurveParamAtArcLength=function(t,e,r,n,i){if(null==r&&(r=.001),e<L.EPSILON)return t.knots[0];var s,o=0;(s=null!=n?n:kt.decomposeCurveIntoBeziers(t))[o];var a,u=-L.EPSILON;for(a=null!=i?i:[];e>u&&o<s.length;){if(o<a.length?a[o]=a[o]:a[o]=wt.rationalBezierCurveArcLength(t),e<(u+=a[o])+L.EPSILON)return wt.rationalBezierCurveParamAtArcLength(t,e,r,a[o]);o++}return-1},wt.rationalBezierCurveParamAtArcLength=function(t,e,r,n){if(0>e)return t.knots[0];var i;if(e>(i=null!=n?n:wt.rationalBezierCurveArcLength(t)))return V.last(t.knots);var s,o=t.knots[0],a=0,u=V.last(t.knots),h=i,c=0,l=0;for(s=null!=r?r:2*L.TOLERANCE;h-a>s;)c=(o+u)/2,(l=wt.rationalBezierCurveArcLength(t,c))>e?(u=c,h=l):(o=c,a=l);return(o+u)/2},wt.rationalCurveArcLength=function(t,e,r){null==r&&(r=16),null==e&&(e=V.last(t.knots));for(var n=kt.decomposeCurveIntoBeziers(t),i=0,s=n[0],o=0;i<n.length&&s.knots[0]+L.EPSILON<e;){var a=Math.min(V.last(s.knots),e);o+=wt.rationalBezierCurveArcLength(s,a,r),s=n[++i]}return o},wt.rationalBezierCurveArcLength=function(t,e,r){null==r&&(r=16);for(var n,i,s=((null==e?V.last(t.knots):e)-t.knots[0])/2,o=0,a=t.degree+r,u=0;a>u;){var h=u++;n=s*wt.Tvalues[a][h]+s+t.knots[0],i=Pt.rationalCurveDerivatives(t,n,1),o+=wt.Cvalues[a][h]*bt.norm(i[1])}return s*o};var St=e.eval.KnotMultiplicity=function(t,e){this.knot=t,this.mult=e};o["verb.eval.KnotMultiplicity"]=St,St.__name__=["verb","eval","KnotMultiplicity"],St.prototype={inc:function(){this.mult++},__class__:St};var zt=e.eval.Check=function(){};o["verb.eval.Check"]=zt,zt.__name__=["verb","eval","Check"],zt.isValidKnotVector=function(t,e){if(0==t.length)return!1;if(t.length<2*(e+1))return!1;for(var r=V.first(t),n=0,i=e+1;i>n;){var s=n++;if(Math.abs(t[s]-r)>L.EPSILON)return!1}r=V.last(t);for(var o=t.length-e-1,a=t.length;a>o;){var u=o++;if(Math.abs(t[u]-r)>L.EPSILON)return!1}return zt.isNonDecreasing(t)},zt.isNonDecreasing=function(t){for(var e=V.first(t),r=0,n=t.length;n>r;){var i=r++;if(t[i]<e-L.EPSILON)return!1;e=t[i]}return!0},zt.isValidNurbsCurveData=function(t){if(null==t.controlPoints)throw new A("Control points array cannot be null!");if(null==t.degree)throw new A("Degree cannot be null!");if(1>t.degree)throw new A("Degree must be greater than 1!");if(null==t.knots)throw new A("Knots cannot be null!");if(t.knots.length!=t.controlPoints.length+t.degree+1)throw new A("controlPoints.length + degree + 1 must equal knots.length!");if(!zt.isValidKnotVector(t.knots,t.degree))throw new A("Invalid knot vector format!  Should begin with degree + 1 repeats and end with degree + 1 repeats!");return t},zt.isValidNurbsSurfaceData=function(t){if(null==t.controlPoints)throw new A("Control points array cannot be null!");if(null==t.degreeU)throw new A("DegreeU cannot be null!");if(null==t.degreeV)throw new A("DegreeV cannot be null!");if(1>t.degreeU)throw new A("DegreeU must be greater than 1!");if(1>t.degreeV)throw new A("DegreeV must be greater than 1!");if(null==t.knotsU)throw new A("KnotsU cannot be null!");if(null==t.knotsV)throw new A("KnotsV cannot be null!");if(t.knotsU.length!=t.controlPoints.length+t.degreeU+1)throw new A("controlPointsU.length + degreeU + 1 must equal knotsU.length!");if(t.knotsV.length!=t.controlPoints[0].length+t.degreeV+1)throw new A("controlPointsV.length + degreeV + 1 must equal knotsV.length!");if(!zt.isValidKnotVector(t.knotsU,t.degreeU)||!zt.isValidKnotVector(t.knotsV,t.degreeV))throw new A("Invalid knot vector format!  Should begin with degree + 1 repeats and end with degree + 1 repeats!");return t};var Mt=e.eval.Divide=function(){};o["verb.eval.Divide"]=Mt,Mt.__name__=["verb","eval","Divide"],Mt.surfaceSplit=function(t,e,r){var n,i,s,o;null==r&&(r=!1),r?(s=t.controlPoints,n=t.knotsV,i=t.degreeV):(s=ft.transpose(t.controlPoints),n=t.knotsU,i=t.degreeU);for(var a=[],u=0,h=i+1;h>u;)u++,a.push(e);o=a;for(var c=[],l=[],f=Pt.knotSpan(i,e,n),d=null,p=0;p<s.length;){var m=s[p];++p,d=kt.curveKnotRefine(new R(i,n,m),o),c.push(d.controlPoints.slice(0,f+1)),l.push(d.controlPoints.slice(f+1))}var v=d.knots.slice(0,f+i+2),g=d.knots.slice(f+1);return r?[new j(t.degreeU,i,t.knotsU.slice(),v,c),new j(t.degreeU,i,t.knotsU.slice(),g,l)]:(c=ft.transpose(c),l=ft.transpose(l),[new j(i,t.degreeV,v,t.knotsV.slice(),c),new j(i,t.degreeV,g,t.knotsV.slice(),l)])},Mt.curveSplit=function(t,e){var r=t.degree;t.controlPoints;for(var n,i=t.knots,s=[],o=0,a=r+1;a>o;)o++,s.push(e);n=s;var u=kt.curveKnotRefine(t,n),h=Pt.knotSpan(r,e,i),c=u.knots.slice(0,h+r+2),l=u.knots.slice(h+1),f=u.controlPoints.slice(0,h+1),d=u.controlPoints.slice(h+1);return[new R(r,c,f),new R(r,l,d)]},Mt.rationalCurveByEqualArcLength=function(t,e){var r=wt.rationalCurveArcLength(t)/e;return Mt.rationalCurveByArcLength(t,r)},Mt.rationalCurveByArcLength=function(t,e){var r=kt.decomposeCurveIntoBeziers(t),n=r.map((function(t){return wt.rationalBezierCurveArcLength(t)})),i=bt.sum(n),s=[new Ct(t.knots[0],0)];if(e>i)return s;for(var o,a=e,u=0,h=a,c=0,l=0;u<r.length;){for(c+=n[u];h<c+L.EPSILON;)o=wt.rationalBezierCurveParamAtArcLength(r[u],h-l,L.TOLERANCE,n[u]),s.push(new Ct(o,h)),h+=a;l+=n[u],u++}return s};var Ct=e.eval.CurveLengthSample=function(t,e){this.u=t,this.len=e};o["verb.eval.CurveLengthSample"]=Ct,Ct.__name__=["verb","eval","CurveLengthSample"],Ct.prototype={__class__:Ct};var Pt=e.eval.Eval=function(){};o["verb.eval.Eval"]=Pt,Pt.__name__=["verb","eval","Eval"],Pt.rationalCurveTangent=function(t,e){return Pt.rationalCurveDerivatives(t,e,1)[1]},Pt.rationalSurfaceNormal=function(t,e,r){var n=Pt.rationalSurfaceDerivatives(t,e,r,1);return bt.cross(n[1][0],n[0][1])},Pt.rationalSurfaceDerivatives=function(t,e,r,n){t.knotsU[t.knotsU.length-1]===e&&(e-=1e-8),t.knotsV[t.knotsV.length-1]===r&&(r-=1e-8),null==n&&(n=1);for(var i=Pt.surfaceDerivatives(t,e,r,n),s=Pt.rational2d(i),o=Pt.weight2d(i),a=[],u=s[0][0].length,h=0,c=n+1;c>h;){var l=h++;a.push([]);for(var f=0,d=n-l+1;d>f;){for(var p=f++,m=s[l][p],v=1,g=p+1;g>v;){var y=v++;m=bt.sub(m,bt.mul(D.get(p,y)*o[0][y],a[l][p-y]))}for(var x=1,_=l+1;_>x;){var b=x++;m=bt.sub(m,bt.mul(D.get(l,b)*o[b][0],a[l-b][p]));for(var w=bt.zeros1d(u),S=1,z=p+1;z>S;){var M=S++;w=bt.add(w,bt.mul(D.get(p,M)*o[b][M],a[l-b][p-M]))}m=bt.sub(m,bt.mul(D.get(l,b),w))}a[l].push(bt.mul(1/o[0][0],m))}}return a},Pt.rationalSurfacePoint=function(t,e,r){return Pt.dehomogenize(Pt.surfacePoint(t,e,r))},Pt.rationalCurveDerivatives=function(t,e,r){null==r&&(r=1);for(var n=Pt.curveDerivatives(t,e,r),s=Pt.rational1d(n),o=Pt.weight1d(n),a=[],u=0,h=r+1;h>u;){for(var c=u++,l=s[c],f=1,d=c+1;d>f;){var p=f++;l=bt.sub(l,bt.mul(D.get(c,p)*o[p],a[c-p]))}a.push(bt.mul(1/i(o[0]),l))}return a},Pt.rationalCurvePoint=function(t,e){return Pt.dehomogenize(Pt.curvePoint(t,e))},Pt.surfaceDerivatives=function(t,e,r,n){var i=t.knotsU.length-t.degreeU-2,s=t.knotsV.length-t.degreeV-2;return Pt.surfaceDerivativesGivenNM(i,s,t,e,r,n)},Pt.surfaceDerivativesGivenNM=function(t,e,r,n,i,s){var o=r.degreeU,a=r.degreeV,u=r.controlPoints,h=r.knotsU,c=r.knotsV;if(!Pt.areValidRelations(o,u.length,h.length)||!Pt.areValidRelations(a,u[0].length,c.length))throw new A("Invalid relations between control points, knot vector, and n");var l,f,d=u[0][0].length;l=o>s?s:o,f=a>s?s:a;for(var p=bt.zeros3d(s+1,s+1,d),m=Pt.knotSpanGivenN(t,o,n,h),v=Pt.knotSpanGivenN(e,a,i,c),g=Pt.derivativeBasisFunctionsGivenNI(m,n,o,t,h),y=Pt.derivativeBasisFunctionsGivenNI(v,i,a,e,c),x=bt.zeros2d(a+1,d),_=0,b=l+1;b>_;){for(var w=_++,S=0,z=a+1;z>S;){var M=S++;x[M]=bt.zeros1d(d);for(var C=0,P=o+1;P>C;){var E=C++;x[M]=bt.add(x[M],bt.mul(g[w][E],u[m-o+E][v-a+M]))}}for(var k=s-w,T=0,N=(f>k?k:f)+1;N>T;){var I=T++;p[w][I]=bt.zeros1d(d);for(var V=0,D=a+1;D>V;){var B=V++;p[w][I]=bt.add(p[w][I],bt.mul(y[I][B],x[B]))}}}return p},Pt.surfacePoint=function(t,e,r){var n=t.knotsU.length-t.degreeU-2,i=t.knotsV.length-t.degreeV-2;return Pt.surfacePointGivenNM(n,i,t,e,r)},Pt.surfacePointGivenNM=function(t,e,r,n,i){var s=r.degreeU,o=r.degreeV,a=r.controlPoints,u=r.knotsU,h=r.knotsV;if(!Pt.areValidRelations(s,a.length,u.length)||!Pt.areValidRelations(o,a[0].length,h.length))throw new A("Invalid relations between control points, knot vector, and n");for(var c=a[0][0].length,l=Pt.knotSpanGivenN(t,s,n,u),f=Pt.knotSpanGivenN(e,o,i,h),d=Pt.basisFunctionsGivenKnotSpanIndex(l,n,s,u),p=Pt.basisFunctionsGivenKnotSpanIndex(f,i,o,h),m=l-s,v=f,g=bt.zeros1d(c),y=bt.zeros1d(c),x=0,_=o+1;_>x;){var b=x++;y=bt.zeros1d(c),v=f-o+b;for(var w=0,S=s+1;S>w;){var z=w++;y=bt.add(y,bt.mul(d[z],a[m+z][v]))}g=bt.add(g,bt.mul(p[b],y))}return g},Pt.curveDerivatives=function(t,e,r){var n=t.knots.length-t.degree-2;return Pt.curveDerivativesGivenN(n,t,e,r)},Pt.curveDerivativesGivenN=function(t,e,r,n){var i=e.degree,s=e.controlPoints,o=e.knots;if(!Pt.areValidRelations(i,s.length,o.length))throw new A("Invalid relations between control points, knot vector, and n");var a,u=s[0].length;a=i>n?n:i;for(var h=bt.zeros2d(n+1,u),c=Pt.knotSpanGivenN(t,i,r,o),l=Pt.derivativeBasisFunctionsGivenNI(c,r,i,a,o),f=0,d=a+1;d>f;)for(var p=f++,m=0,v=i+1;v>m;){var g=m++;h[p]=bt.add(h[p],bt.mul(l[p][g],s[c-i+g]))}return h},Pt.curvePoint=function(t,e){var r=t.knots.length-t.degree-2;return Pt.curvePointGivenN(r,t,e)},Pt.areValidRelations=function(t,e,r){return e+t+1-r==0},Pt.curvePointGivenN=function(t,e,r){var n=e.degree,i=e.controlPoints,s=e.knots;if(!Pt.areValidRelations(n,i.length,s.length))throw new A("Invalid relations between control points, knot Array, and n");for(var o=Pt.knotSpanGivenN(t,n,r,s),a=Pt.basisFunctionsGivenKnotSpanIndex(o,r,n,s),u=bt.zeros1d(i[0].length),h=0,c=n+1;c>h;){var l=h++;u=bt.add(u,bt.mul(a[l],i[o-n+l]))}return u},Pt.volumePoint=function(t,e,r,n){var i=t.knotsU.length-t.degreeU-2,s=t.knotsV.length-t.degreeV-2,o=t.knotsW.length-t.degreeW-2;return Pt.volumePointGivenNML(t,i,s,o,e,r,n)},Pt.volumePointGivenNML=function(t,e,r,n,i,s,o){if(!Pt.areValidRelations(t.degreeU,t.controlPoints.length,t.knotsU.length)||!Pt.areValidRelations(t.degreeV,t.controlPoints[0].length,t.knotsV.length)||!Pt.areValidRelations(t.degreeW,t.controlPoints[0][0].length,t.knotsW.length))throw new A("Invalid relations between control points and knot vector");for(var a=t.controlPoints,u=t.degreeU,h=t.degreeV,c=t.degreeW,l=t.knotsU,f=t.knotsV,d=t.knotsW,p=a[0][0][0].length,m=Pt.knotSpanGivenN(e,u,i,l),v=Pt.knotSpanGivenN(r,h,s,f),g=Pt.knotSpanGivenN(n,c,o,d),y=Pt.basisFunctionsGivenKnotSpanIndex(m,i,u,l),x=Pt.basisFunctionsGivenKnotSpanIndex(v,s,h,f),_=Pt.basisFunctionsGivenKnotSpanIndex(g,o,c,d),b=m-u,w=bt.zeros1d(p),S=bt.zeros1d(p),z=bt.zeros1d(p),M=0,C=c+1;C>M;){var P=M++;z=bt.zeros1d(p);for(var E=g-c+P,k=0,T=h+1;T>k;){var N=k++;S=bt.zeros1d(p);for(var I=v-h+N,V=0,D=u+1;D>V;){var B=V++;S=bt.add(S,bt.mul(y[B],a[b+B][I][E]))}z=bt.add(z,bt.mul(x[N],S))}w=bt.add(w,bt.mul(_[P],z))}return w},Pt.derivativeBasisFunctions=function(t,e,r){var n=Pt.knotSpan(e,t,r),i=r.length-1-e-1;return Pt.derivativeBasisFunctionsGivenNI(n,t,e,i,r)},Pt.derivativeBasisFunctionsGivenNI=function(t,e,r,n,s){var o=bt.zeros2d(r+1,r+1),a=bt.zeros1d(r+1),u=bt.zeros1d(r+1),h=0,c=0;o[0][0]=1;for(var l=1,f=r+1;f>l;){var d=l++;a[d]=e-s[t+1-d],u[d]=s[t+d]-e,h=0;for(var p=0;d>p;){var m=p++;o[d][m]=u[m+1]+a[d-m],c=o[m][d-1]/i(o[d][m]),o[m][d]=h+u[m+1]*c,h=a[d-m]*c}o[d][d]=h}for(var v=bt.zeros2d(n+1,r+1),g=bt.zeros2d(2,r+1),y=0,x=1,_=0,b=0,w=0,S=0,z=r+1;z>S;){var M=S++;v[0][M]=o[M][r]}for(var C=0,P=r+1;P>C;){var A=C++;y=0,x=1,g[0][0]=1;for(var E=1,k=n+1;k>E;){var T=E++;_=0,b=A-T,w=r-T,T>A||(g[x][0]=g[y][0]/i(o[w+1][b]),_=g[x][0]*o[b][w]);for(var N=-1>b?-b:1,I=1+(A-1>w?r-A:T-1);I>N;){var V=N++;g[x][V]=(g[y][V]-g[y][V-1])/i(o[w+1][b+V]),_+=g[x][V]*o[b+V][w]}A>w||(g[x][T]=-g[y][T-1]/i(o[w+1][A]),_+=g[x][T]*o[A][w]),v[T][A]=_;var D=y;y=x,x=D}}for(var B=r,L=1,O=n+1;O>L;){for(var U=L++,F=0,R=r+1;R>F;){var j=F++;v[U][j]*=B}B*=r-U}return v},Pt.basisFunctions=function(t,e,r){var n=Pt.knotSpan(e,t,r);return Pt.basisFunctionsGivenKnotSpanIndex(n,t,e,r)},Pt.basisFunctionsGivenKnotSpanIndex=function(t,e,r,n){var i=bt.zeros1d(r+1),s=bt.zeros1d(r+1),o=bt.zeros1d(r+1),a=0,u=0;i[0]=1;for(var h=1,c=r+1;c>h;){var l=h++;s[l]=e-n[t+1-l],o[l]=n[t+l]-e,a=0;for(var f=0;l>f;){var d=f++;u=i[d]/(o[d+1]+s[l-d]),i[d]=a+o[d+1]*u,a=s[l-d]*u}i[l]=a}return function(t){for(var e=0;e<t.length;e++)Number.isFinite(t[e])||(t[e]=1)}(i),i},Pt.knotSpan=function(t,e,r){return Pt.knotSpanGivenN(r.length-t-2,t,e,r)},Pt.knotSpanGivenN=function(t,e,r,n){if(r>n[t+1]-L.EPSILON)return t;if(r<n[e]+L.EPSILON)return e;for(var i=e,s=t+1,o=Math.floor((i+s)/2);r<n[o]||r>=n[o+1];)r<n[o]?s=o:i=o,o=Math.floor((i+s)/2);return o},Pt.dehomogenize=function(t){for(var e=[],r=t[t.length-1],n=t.length-1,i=0;n>i;){var s=i++;e.push(t[s]/r)}return e},Pt.rational1d=function(t){var e=t[0].length-1;return t.map((function(t){return t.slice(0,e)}))},Pt.rational2d=function(t){return t.map(Pt.rational1d)},Pt.weight1d=function(t){var e=t[0].length-1;return t.map((function(t){return t[e]}))},Pt.weight2d=function(t){return t.map(Pt.weight1d)},Pt.dehomogenize1d=function(t){return t.map(Pt.dehomogenize)},Pt.dehomogenize2d=function(t){return t.map(Pt.dehomogenize1d)},Pt.homogenize1d=function(t,e){var r,n=t.length,i=t[0].length,s=[],o=0,a=[];r=null!=e?e:bt.rep(t.length,1);for(var u=0;n>u;){var h=u++,c=[];a=t[h],o=r[h];for(var l=0;i>l;){var f=l++;c.push(a[f]*o)}c.push(o),s.push(c)}return s},Pt.homogenize2d=function(t,e){var r,n=t.length,i=[];if(null!=e)r=e;else{for(var s=[],o=0;n>o;)o++,s.push(bt.rep(t[0].length,1));r=s}for(var a=0;n>a;){var u=a++;i.push(Pt.homogenize1d(t[u],r[u]))}return i};var At=e.eval.Intersect=function(){};o["verb.eval.Intersect"]=At,At.__name__=["verb","eval","Intersect"],At.surfaces=function(t,e,r){var n=Tt.rationalSurfaceAdaptive(t),i=Tt.rationalSurfaceAdaptive(e);return At.meshes(n,i).map((function(n){return n.map((function(n){return At.surfacesAtPointWithEstimate(t,e,n.uv0,n.uv1,r)}))})).map((function(t){return Et.rationalInterpCurve(t.map((function(t){return t.point})),3)}))},At.surfacesAtPointWithEstimate=function(t,e,r,n,i){function s(t,e){t[0]=o(t[0],e.knotsU),t[1]=o(t[1],e.knotsV)}function o(t,e){return Math.min(e[e.length-1],Math.max(e[0],t))}var a,u,h,c,l,f,d,p,m,v,g,y,x,_=0;do{if(u=(a=Pt.rationalSurfaceDerivatives(t,r[0],r[1],1))[0][0],c=a[1][0],l=a[0][1],h=bt.normalized(bt.cross(c,l)),f=bt.dot(h,u),p=(d=Pt.rationalSurfaceDerivatives(e,n[0],n[1],1))[0][0],v=d[1][0],g=d[0][1],m=bt.normalized(bt.cross(v,g)),y=bt.dot(m,p),i*i>(x=bt.distSquared(u,p)))break;var b=bt.normalized(bt.cross(h,m)),w=bt.dot(b,u),S=At.threePlanes(h,f,m,y,b,w);if(null==S)throw new A("panic!");var z=bt.sub(S,u),M=bt.sub(S,p),C=bt.cross(c,h),P=bt.cross(l,h),E=bt.cross(v,m),k=bt.cross(g,m),T=bt.dot(P,z)/bt.dot(P,c),N=bt.dot(C,z)/bt.dot(C,l),I=bt.dot(k,M)/bt.dot(k,v),V=bt.dot(E,M)/bt.dot(E,g),D=bt.add([T,N],r),B=bt.add([I,V],n);if(s(D,t),s(B,e),1e-12>bt.distSquared(D,r)&&1e-12>bt.distSquared(B,n))break;r=D,n=B,_++}while(5>_);return new Q(r,n,u,x)},At.meshes=function(t,e,r,n){null==r&&(r=new ht(t)),null==n&&(n=new ht(e));var i=At.boundingBoxTrees(r,n,0),s=V.unique(i.map((function(r){return At.triangles(t,r.item0,e,r.item1)})).filter((function(t){return null!=t})).filter((function(t){return bt.distSquared(t.min.point,t.max.point)>L.EPSILON})),(function(t,e){var r=bt.sub(t.min.uv0,e.min.uv0),n=bt.dot(r,r),i=bt.sub(t.max.uv0,e.max.uv0),s=bt.dot(i,i),o=bt.sub(t.min.uv0,e.max.uv0),a=bt.dot(o,o),u=bt.sub(t.max.uv0,e.min.uv0),h=bt.dot(u,u);return n<L.EPSILON&&s<L.EPSILON||a<L.EPSILON&&h<L.EPSILON}));return At.makeMeshIntersectionPolylines(s)},At.meshSlices=function(t,e,r,n){for(var i=new mt(t),s=i.boundingBox(),o=s.min[0],a=s.min[1],u=s.max[0],h=s.max[1],c=bt.span(e,r,n),l=[],f=0;f<c.length;){var d=c[f];++f;var p=new q([[0,1,2],[0,2,3]],[[o,a,d],[u,a,d],[u,h,d],[o,h,d]],null,[[0,0],[1,0],[1,1],[0,1]]);l.push(At.meshes(t,p,i))}return l},At.makeMeshIntersectionPolylines=function(t){if(0==t.length)return[];for(var e=0;e<t.length;){var r=t[e];++e,r.max.opp=r.min,r.min.opp=r.max}for(var n=At.kdTreeFromSegments(t),i=[],s=0;s<t.length;){var o=t[s];++s,i.push(o.min),i.push(o.max)}for(var a=0;a<i.length;){var u=i[a];if(++a,null==u.adj){var h=At.lookupAdjacentSegment(u,n,t.length);null!=h&&null==h.adj&&(u.adj=h,h.adj=u)}}var c=i.filter((function(t){return null==t.adj}));0==c.length&&(c=i);for(var l=[],f=0,d=!1;0!=c.length;){var p=c.pop();if(!p.visited){for(var m=[],v=p;null!=v&&!v.visited&&(v.visited=!0,v.opp.visited=!0,m.push(v),f+=2,(v=v.opp.adj)!=p););m.length>0&&(m.push(m[m.length-1].opp),l.push(m))}if(0==c.length&&i.length>0&&(d||f<i.length)){d=!0;var g=i.pop();c.push(g)}}return l},At.kdTreeFromSegments=function(t){for(var e=[],r=0;r<t.length;){var n=t[r];++r,e.push(new st(n.min.point,n.min)),e.push(new st(n.max.point,n.max))}return new nt(e,bt.distSquared)},At.lookupAdjacentSegment=function(t,e,r){var n=e.nearest(t.point,r,L.EPSILON).filter((function(e){return t!=e.item0.obj})).map((function(t){return t.item0.obj}));return 1==n.length?n[0]:null},At.curveAndSurface=function(t,e,r,n,i){null==r&&(r=.001),null!=n||(n=new ut(t)),null!=i||(i=new lt(e));var s=At.boundingBoxTrees(n,i,r);return V.unique(s.map((function(t){var e=t.item0,n=t.item1,i=(V.first(e.knots)+V.last(e.knots))/2,s=[(V.first(n.knotsU)+V.last(n.knotsU))/2,(V.first(n.knotsV)+V.last(n.knotsV))/2];return At.curveAndSurfaceWithEstimate(e,n,[i].concat(s),r)})).filter((function(t){return bt.distSquared(t.curvePoint,t.surfacePoint)<r*r})),(function(t,e){return Math.abs(t.u-e.u)<.5*r}))},At.curveAndSurfaceWithEstimate=function(t,e,r,n){null==n&&(n=.001);var i=vt.uncmin((function(r){var n=Pt.rationalCurvePoint(t,r[0]),i=Pt.rationalSurfacePoint(e,r[1],r[2]),s=bt.sub(n,i);return bt.dot(s,s)}),r,n*n,(function(r){var n=Pt.rationalCurveDerivatives(t,r[0],1),i=Pt.rationalSurfaceDerivatives(e,r[1],r[2],1),s=bt.sub(i[0][0],n[0]),o=bt.mul(-1,n[1]),a=i[1][0],u=i[0][1];return[2*bt.dot(o,s),2*bt.dot(a,s),2*bt.dot(u,s)]})).solution;return new $(i[0],[i[1],i[2]],Pt.rationalCurvePoint(t,i[0]),Pt.rationalSurfacePoint(e,i[1],i[2]))},At.polylineAndMesh=function(t,e,r){for(var n=At.boundingBoxTrees(new ct(t),new ht(e),r),i=[],s=0;s<n.length;){var o=n[s];++s;var a=o.item0,u=o.item1,h=At.segmentWithTriangle(t.points[a],t.points[a+1],e.points,e.faces[u]);if(null!=h){var c=h.point,l=bt.lerp(h.p,[t.params[a]],[t.params[a+1]])[0],f=pt.triangleUVFromPoint(e,u,c);i.push(new K(c,l,f,a,u))}}return i},At.boundingBoxTrees=function(t,e,r){null==r&&(r=1e-9);var n=[],i=[];n.push(t),i.push(e);for(var s=[];n.length>0;){var o=n.pop(),a=i.pop();if(!o.empty()&&!a.empty()&&o.boundingBox().intersects(a.boundingBox(),r)){var u=o.indivisible(r),h=a.indivisible(r);if(u&&h)s.push(new W(o.yield(),a.yield()));else if(!u||h)if(u||!h){var c=o.split(),l=a.split();n.push(c.item1),i.push(l.item1),n.push(c.item1),i.push(l.item0),n.push(c.item0),i.push(l.item1),n.push(c.item0),i.push(l.item0)}else{var f=o.split();n.push(f.item1),i.push(a),n.push(f.item0),i.push(a)}else{var d=a.split();n.push(o),i.push(d.item1),n.push(o),i.push(d.item0)}}}return s},At.curves=function(t,e,r){var n=At.boundingBoxTrees(new ut(t),new ut(e),0);return V.unique(n.map((function(n){return At.curvesWithEstimate(t,e,V.first(n.item0.knots),V.first(n.item1.knots),r)})).filter((function(t){return bt.distSquared(t.point0,t.point1)<r})),(function(t,e){return Math.abs(t.u0-e.u0)<5*r}))},At.curvesWithEstimate=function(t,e,r,n,i){var s=vt.uncmin((function(r){var n=Pt.rationalCurvePoint(t,r[0]),i=Pt.rationalCurvePoint(e,r[1]),s=bt.sub(n,i);return bt.dot(s,s)}),[r,n],i*i,(function(r){var n=Pt.rationalCurveDerivatives(t,r[0],1),i=Pt.rationalCurveDerivatives(e,r[1],1),s=bt.sub(n[0],i[0]),o=n[1],a=bt.mul(-1,i[1]);return[2*bt.dot(o,s),2*bt.dot(a,s)]})),o=s.solution[0],a=s.solution[1],u=Pt.rationalCurvePoint(t,o),h=Pt.rationalCurvePoint(e,a);return new H(u,h,o,a)},At.triangles=function(t,e,r,n){var i=t.faces[e],s=r.faces[n],o=pt.getTriangleNorm(t.points,i),a=pt.getTriangleNorm(r.points,s),u=t.points[i[0]],h=r.points[s[0]],c=At.planes(u,o,h,a);if(null==c)return null;var l=At.clipRayInCoplanarTriangle(c,t,e);if(null==l)return null;var f=At.clipRayInCoplanarTriangle(c,r,n);if(null==f)return null;var d=At.mergeTriangleClipIntervals(l,f,t,e,r,n);return null==d?null:new Z(new G(d.min.uv0,d.min.uv1,d.min.point,e,n),new G(d.max.uv0,d.max.uv1,d.max.point,e,n))},At.clipRayInCoplanarTriangle=function(t,e,r){for(var n=e.faces[r],i=[e.points[n[0]],e.points[n[1]],e.points[n[2]]],s=[e.uvs[n[0]],e.uvs[n[1]],e.uvs[n[2]]],o=[bt.sub(s[1],s[0]),bt.sub(s[2],s[1]),bt.sub(s[0],s[2])],a=[bt.sub(i[1],i[0]),bt.sub(i[2],i[1]),bt.sub(i[0],i[2])],u=a.map(bt.normalized),h=a.map(bt.norm),c=null,l=null,f=0;3>f;){var d=f++,p=i[d],m=u[d],v=At.rays(p,m,t.origin,t.dir);if(null!=v){var g=v.u0,y=v.u1;-.001>g||g>h[d]+.001||((null==c||y<c.u)&&(c=new tt(y,bt.onRay(t.origin,t.dir,y),bt.onRay(s[d],o[d],g/h[d]))),(null==l||y>l.u)&&(l=new tt(y,bt.onRay(t.origin,t.dir,y),bt.onRay(s[d],o[d],g/h[d]))))}}return null==l||null==c?null:new Z(c,l)},At.mergeTriangleClipIntervals=function(t,e,r,n,i,s){if(e.min.u>t.max.u+L.EPSILON||t.min.u>e.max.u+L.EPSILON)return null;var o,a;o=t.min.u>e.min.u?new W(t.min,0):new W(e.min,1),a=t.max.u<e.max.u?new W(t.max,0):new W(e.max,1);var u=new Z(new G(null,null,o.item0.point,n,s),new G(null,null,a.item0.point,n,s));return 0==o.item1?(u.min.uv0=o.item0.uv,u.min.uv1=pt.triangleUVFromPoint(i,s,o.item0.point)):(u.min.uv0=pt.triangleUVFromPoint(r,n,o.item0.point),u.min.uv1=o.item0.uv),0==a.item1?(u.max.uv0=a.item0.uv,u.max.uv1=pt.triangleUVFromPoint(i,s,a.item0.point)):(u.max.uv0=pt.triangleUVFromPoint(r,n,a.item0.point),u.max.uv1=a.item0.uv),u},At.planes=function(t,e,r,n){var i=bt.cross(e,n);if(bt.dot(i,i)<L.EPSILON)return null;var s,o,a,u,h=0,c=Math.abs(i[0]),l=Math.abs(i[1]),f=Math.abs(i[2]);l>c&&(h=1,c=l),f>c&&(h=2,c=f),0==h?(s=e[1],o=e[2],a=n[1],u=n[2]):1==h?(s=e[0],o=e[2],a=n[0],u=n[2]):(s=e[0],o=e[1],a=n[0],u=n[1]);var d=-bt.dot(t,e),p=-bt.dot(r,n),m=s*u-o*a,v=(o*p-d*u)/m,g=(d*a-s*p)/m;return new F(0==h?[0,v,g]:1==h?[v,0,g]:[v,g,0],bt.normalized(i))},At.threePlanes=function(t,e,r,n,i,s){var o=bt.cross(r,i),a=bt.dot(t,o);if(Math.abs(a)<L.EPSILON)return null;var u=bt.sub(bt.mul(s,r),bt.mul(n,i)),h=bt.add(bt.mul(e,o),bt.cross(t,u));return bt.mul(1/a,h)},At.polylines=function(t,e,r){for(var n=At.boundingBoxTrees(new ct(t),new ct(e),r),i=[],s=0;s<n.length;){var o=n[s];++s;var a=o.item0,u=o.item1,h=At.segments(t.points[a],t.points[a+1],e.points[u],e.points[u+1],r);null!=h&&(h.u0=bt.lerp(h.u0,[t.params[a]],[t.params[a+1]])[0],h.u1=bt.lerp(h.u1,[e.params[u]],[e.params[u+1]])[0],i.push(h))}return i},At.segments=function(t,e,r,n,i){var s=bt.sub(e,t),o=Math.sqrt(bt.dot(s,s)),a=bt.mul(1/o,s),u=bt.sub(n,r),h=Math.sqrt(bt.dot(u,u)),c=bt.mul(1/h,u),l=At.rays(t,a,r,c);if(null!=l){var f=Math.min(Math.max(0,l.u0/o),1),d=Math.min(Math.max(0,l.u1/h),1),p=bt.onRay(t,s,f),m=bt.onRay(r,u,d);if(i*i>bt.distSquared(p,m))return new H(p,m,f,d)}return null},At.rays=function(t,e,r,n){var i=bt.dot(e,n),s=bt.dot(e,r),o=bt.dot(e,t),a=bt.dot(n,r),u=bt.dot(n,t),h=bt.dot(e,e),c=h*bt.dot(n,n)-i*i;if(.001>Math.abs(c))return null;var l=(i*(s-o)-h*(a-u))/c,f=(s-o+l*i)/h,d=bt.onRay(t,e,f),p=bt.onRay(r,n,l);return new H(d,p,f,l)},At.segmentWithTriangle=function(t,e,r,n){var i=r[n[0]],s=r[n[1]],o=r[n[2]],a=bt.sub(s,i),u=bt.sub(o,i),h=bt.cross(a,u),c=bt.sub(e,t),l=bt.sub(t,i),f=-bt.dot(h,l),d=bt.dot(h,c);if(Math.abs(d)<L.EPSILON)return null;var p=f/d;if(0>p||p>1)return null;var m=bt.add(t,bt.mul(p,c)),v=bt.dot(a,u),g=bt.dot(a,a),y=bt.dot(u,u),x=bt.sub(m,i),_=bt.dot(x,a),b=bt.dot(x,u),w=v*v-g*y;if(Math.abs(w)<L.EPSILON)return null;var S=(v*b-y*_)/w,z=(v*_-g*b)/w;return S>1+L.EPSILON||z>1+L.EPSILON||z<-L.EPSILON||S<-L.EPSILON||S+z>1+L.EPSILON?null:new J(m,S,z,p)},At.segmentAndPlane=function(t,e,r,n){var i=bt.dot(n,bt.sub(e,t));if(Math.abs(i)<L.EPSILON)return null;var s=bt.dot(n,bt.sub(r,t))/i;return s>1+L.EPSILON||s<-L.EPSILON?null:{p:s}};var Et=e.eval.Make=function(){};o["verb.eval.Make"]=Et,Et.__name__=["verb","eval","Make"],Et.rationalTranslationalSurface=function(t,e){for(var r=Pt.rationalCurvePoint(e,V.first(e.knots)),n=V.first(e.knots),i=V.last(e.knots),s=2*e.controlPoints.length,o=(i-n)/(s-1),a=[],u=0;s>u;){var h=u++,c=bt.sub(Pt.rationalCurvePoint(e,n+h*o),r),l=kt.rationalCurveTransform(t,[[1,0,0,c[0]],[0,1,0,c[1]],[0,0,1,c[2]],[0,0,0,1]]);a.push(l)}return Et.loftedSurface(a)},Et.surfaceBoundaryCurves=function(t){return[Et.surfaceIsocurve(t,V.first(t.knotsU),!1),Et.surfaceIsocurve(t,V.last(t.knotsU),!1),Et.surfaceIsocurve(t,V.first(t.knotsV),!0),Et.surfaceIsocurve(t,V.last(t.knotsV),!0)]},Et.surfaceIsocurve=function(t,e,r){var n,i;null==r&&(r=!1),n=r?t.knotsV:t.knotsU,i=r?t.degreeV:t.degreeU;for(var s=wt.knotMultiplicities(n),o=-1,a=0,u=s.length;u>a;){var h=a++;if(Math.abs(e-s[h].knot)<L.EPSILON){o=h;break}}var c,l=i+1;0>o||(l-=s[o].mult),c=l>0?kt.surfaceKnotRefine(t,bt.rep(l,e),r):t;var f=Pt.knotSpan(i,e,n);return Math.abs(e-V.first(n))<L.EPSILON?f=0:Math.abs(e-V.last(n))<L.EPSILON&&(f=(r?c.controlPoints[0].length:c.controlPoints.length)-1),r?new R(c.degreeU,c.knotsU,function(){for(var t=[],e=0,r=c.controlPoints;e<r.length;){var n=r[e];++e,t.push(n[f])}return t}()):new R(c.degreeV,c.knotsV,c.controlPoints[f])},Et.loftedSurface=function(t,e){var r=(t=kt.unifyCurveKnotVectors(t))[0].degree;null==e&&(e=3),e>t.length-1&&(e=t.length-1);for(var n=t[0].knots,i=[],s=[],o=0,a=t[0].controlPoints.length;a>o;){var u=[o++],h=t.map(function(t){return function(e){return e.controlPoints[t[0]]}}(u)),c=Et.rationalInterpCurve(h,e,!0);s.push(c.controlPoints),i=c.knots}return new j(r,e,n,i,s)},Et.clonedCurve=function(t){return new R(t.degree,t.knots.slice(),t.controlPoints.map((function(t){return t.slice()})))},Et.rationalBezierCurve=function(t,e){for(var r=t.length-1,n=[],i=0,s=r+1;s>i;)i++,n.push(0);for(var o=0,a=r+1;a>o;)o++,n.push(1);return null==e&&(e=bt.rep(t.length,1)),new R(r,n,Pt.homogenize1d(t,e))},Et.fourPointSurface=function(t,e,r,n,i){null==i&&(i=3);for(var s=i,o=[],a=0,u=i+1;u>a;){for(var h=a++,c=[],l=0,f=i+1;f>l;){var d=l++,p=1-h/s,m=bt.lerp(p,t,e),v=bt.lerp(p,n,r),g=bt.lerp(1-d/s,m,v);g.push(1),c.push(g)}o.push(c)}var y=bt.rep(i+1,0),x=bt.rep(i+1,1);return new j(i,i,y.concat(x),y.concat(x),o)},Et.ellipseArc=function(t,e,r,n,i){var s=bt.norm(e),o=bt.norm(r);e=bt.normalized(e),r=bt.normalized(r),n>i&&(i=2*Math.PI+n);var a,u=i-n,h=u/(a=u>Math.PI/2?u>Math.PI?u>3*Math.PI/2?4:3:2:1),c=Math.cos(h/2),l=bt.add(t,bt.add(bt.mul(s*Math.cos(n),e),bt.mul(o*Math.sin(n),r))),f=bt.sub(bt.mul(Math.cos(n),r),bt.mul(Math.sin(n),e)),d=[],p=bt.zeros1d(2*a+3),m=0,v=n,g=bt.zeros1d(2*a);d[0]=l,g[0]=1;for(var y=1,x=a+1;x>y;){var _=y++;v+=h;var b=bt.add(t,bt.add(bt.mul(s*Math.cos(v),e),bt.mul(o*Math.sin(v),r)));g[m+2]=1,d[m+2]=b;var w=bt.sub(bt.mul(Math.cos(v),r),bt.mul(Math.sin(v),e)),S=At.rays(l,bt.mul(1/bt.norm(f),f),b,bt.mul(1/bt.norm(w),w)),z=bt.add(l,bt.mul(S.u0,f));g[m+1]=c,d[m+1]=z,m+=2,a>_&&(l=b,f=w)}for(var M=2*a+1,C=0;3>C;){var P=C++;p[P]=0,p[P+M]=1}switch(a){case 2:p[3]=p[4]=.5;break;case 3:p[3]=p[4]=.3333333333333333,p[5]=p[6]=.6666666666666666;break;case 4:p[3]=p[4]=.25,p[5]=p[6]=.5,p[7]=p[8]=.75}return new R(2,p,Pt.homogenize1d(d,g))},Et.arc=function(t,e,r,n,i,s){return Et.ellipseArc(t,bt.mul(n,bt.normalized(e)),bt.mul(n,bt.normalized(r)),i,s)},Et.polyline=function(t){for(var e,r=[0,0],n=0,i=0,s=t.length-1;s>i;){var o=i++;n+=bt.dist(t[o],t[o+1]),r.push(n)}r.push(n),r=bt.mul(1/n,r);for(var a=[],u=0,h=t.length;h>u;)u++,a.push(1);return e=a,new R(1,r,Pt.homogenize1d(t.slice(0),e))},Et.extrudedSurface=function(t,e,r){for(var n=[[],[],[]],i=[[],[],[]],s=Pt.dehomogenize1d(r.controlPoints),o=Pt.weight1d(r.controlPoints),a=bt.mul(e,t),u=bt.mul(.5*e,t),h=0,c=s.length;c>h;){var l=h++;n[2][l]=s[l],n[1][l]=bt.add(u,s[l]),n[0][l]=bt.add(a,s[l]),i[0][l]=o[l],i[1][l]=o[l],i[2][l]=o[l]}return new j(2,r.degree,[0,0,0,1,1,1],r.knots,Pt.homogenize2d(n,i))},Et.cylindricalSurface=function(t,e,r,n,i){var s=bt.cross(t,e),o=Et.arc(r,e,s,i,0,2*Math.PI);return Et.extrudedSurface(t,n,o)},Et.revolvedSurface=function(t,e,r,n){var i,s,o=Pt.dehomogenize1d(t.controlPoints),a=Pt.weight1d(t.controlPoints);n>Math.PI/2?n>Math.PI?n>3*Math.PI/2?(i=4,(s=bt.zeros1d(6+2*(i-1)))[3]=s[4]=.25,s[5]=s[6]=.5,s[7]=s[8]=.75):(i=3,(s=bt.zeros1d(6+2*(i-1)))[3]=s[4]=.3333333333333333,s[5]=s[6]=.6666666666666666):(i=2,(s=bt.zeros1d(6+2*(i-1)))[3]=s[4]=.5):(i=1,s=bt.zeros1d(6+2*(i-1)));for(var u=n/i,h=3+2*(i-1),c=0;3>c;){var l=c++;s[l]=0,s[h+l]=1}for(var f=Math.cos(u/2),d=0,p=bt.zeros1d(i+1),m=bt.zeros1d(i+1),v=bt.zeros3d(2*i+1,o.length,3),g=bt.zeros2d(2*i+1,o.length),y=1,x=i+1;x>y;){var _=y++;d+=u,m[_]=Math.cos(d),p[_]=Math.sin(d)}for(var b=0,w=o.length;w>b;){var S=b++,z=_t.rayClosestPoint(o[S],e,r),M=bt.sub(o[S],z),C=bt.norm(M),P=bt.cross(r,M);C>L.EPSILON&&(M=bt.mul(1/C,M),P=bt.mul(1/C,P)),v[0][S]=o[S];var A=o[S];g[0][S]=a[S];for(var E=P,k=0,T=1,N=i+1;N>T;){var I,V=T++;I=0==C?z:bt.add(z,bt.add(bt.mul(C*m[V],M),bt.mul(C*p[V],P))),v[k+2][S]=I,g[k+2][S]=a[S];var D=bt.sub(bt.mul(m[V],P),bt.mul(p[V],M));if(0==C)v[k+1][S]=z;else{var B=At.rays(A,bt.mul(1/bt.norm(E),E),I,bt.mul(1/bt.norm(D),D)),O=bt.add(A,bt.mul(B.u0,E));v[k+1][S]=O}g[k+1][S]=f*a[S],k+=2,i>V&&(A=I,E=D)}}return new j(2,t.degree,s,t.knots,Pt.homogenize2d(v,g))},Et.sphericalSurface=function(t,e,r,n){var i=Et.arc(t,bt.mul(-1,e),r,n,0,Math.PI);return Et.revolvedSurface(i,t,e,2*Math.PI)},Et.conicalSurface=function(t,e,r,n,i){var s=2*Math.PI,o=[bt.add(r,bt.mul(n,t)),bt.add(r,bt.mul(i,e))],a=new R(1,[0,0,1,1],Pt.homogenize1d(o,[1,1]));return Et.revolvedSurface(a,r,t,s)},Et.rationalInterpCurve=function(t,e,r,n,i){if(null==r&&(r=!1),null==e&&(e=3),t.length<e+1)throw new A("You need to supply at least degree + 1 points! You only supplied "+t.length+" points.");for(var s=[0],o=1,a=t.length;a>o;){var u=o++,h=bt.norm(bt.sub(t[u],t[u-1])),c=s[s.length-1];s.push(c+h)}for(var l=s[s.length-1],f=0,d=s.length;d>f;){var p=f++;s[p]=s[p]/l}var m,v,g=bt.rep(e+1,0),y=null!=n&&null!=i;m=y?0:1,v=y?s.length-e+1:s.length-e;for(var x=m;v>x;){for(var _=x++,b=0,w=0;e>w;)b+=s[_+w++];g.push(1/e*b)}var S,z,M=g.concat(bt.rep(e+1,1)),C=[];S=y?t.length+1:t.length-1,z=y?t.length-(e-1):t.length-(e+1);for(var P=0;P<s.length;){var E=s[P];++P;var k=Pt.knotSpanGivenN(S,e,E,M),T=Pt.basisFunctionsGivenKnotSpanIndex(k,E,e,M),N=k-e,I=bt.zeros1d(N),D=bt.zeros1d(z-N);C.push(I.concat(T).concat(D))}if(y){var B=C[0].length-2,L=[-1,1].concat(bt.zeros1d(B)),O=bt.zeros1d(B).concat([-1,1]);V.spliceAndInsert(C,1,0,L),V.spliceAndInsert(C,C.length-1,0,O)}for(var U=t[0].length,F=[],j=(1-M[M.length-e-2])/e,q=M[e+1]/e,X=0;U>X;){var Y,W=[X++];if(y){(Y=[t[0][W[0]]]).push(q*n[W[0]]);for(var Z=1,H=t.length-1;H>Z;){var $=Z++;Y.push(t[$][W[0]])}Y.push(j*i[W[0]]),Y.push(V.last(t)[W[0]])}else Y=t.map(function(t){return function(e){return e[t[0]]}}(W));var G=ft.solve(C,Y);F.push(G)}var K=ft.transpose(F);if(!r){var Q=bt.rep(K.length,1);K=Pt.homogenize1d(K,Q)}return new R(e,M,K)};var kt=e.eval.Modify=function(){};o["verb.eval.Modify"]=kt,kt.__name__=["verb","eval","Modify"],kt.curveReverse=function(t){return new R(t.degree,kt.knotsReverse(t.knots),V.reversed(t.controlPoints))},kt.surfaceReverse=function(t,e){return null==e&&(e=!1),e?new j(t.degreeU,t.degreeV,t.knotsU,kt.knotsReverse(t.knotsV),function(){for(var e=[],r=0,n=t.controlPoints;r<n.length;){var i=n[r];++r,e.push(V.reversed(i))}return e}()):new j(t.degreeU,t.degreeV,kt.knotsReverse(t.knotsU),t.knotsV,V.reversed(t.controlPoints))},kt.knotsReverse=function(t){var e=V.first(t);V.last(t);for(var r=[e],n=t.length,i=1;n>i;){var s=i++;r.push(r[s-1]+(t[n-s]-t[n-s-1]))}return r},kt.unifyCurveKnotVectors=function(t){t=t.map(Et.clonedCurve);for(var e,r=h.fold(t,(function(t,e){return kt.imax(t.degree,e)}),0),n=0,i=t.length;i>n;){var s=n++;t[s].degree<r&&(t[s]=kt.curveElevateDegree(t[s],r))}for(var o=[],a=0;a<t.length;){var u=t[a];++a,o.push(new Z(V.first(u.knots),V.last(u.knots)))}e=o;for(var c=0,l=t.length;l>c;){var f=c++,d=[e[f].min];t[f].knots=t[f].knots.map(function(t){return function(e){return e-t[0]}}(d))}for(var p=e.map((function(t){return t.max-t.min})),m=h.fold(p,(function(t,e){return Math.max(t,e)}),0),v=0,g=t.length;g>v;){var y=v++,x=[m/p[y]];t[y].knots=t[y].knots.map(function(t){return function(e){return e*t[0]}}(x))}for(var _=h.fold(t,(function(t,e){return bt.sortedSetUnion(t.knots,e)}),[]),b=0,w=t.length;w>b;){var S=b++,z=bt.sortedSetSub(_,t[S].knots);0==z.length&&(t[S]=t[S]),t[S]=kt.curveKnotRefine(t[S],z)}return t},kt.imin=function(t,e){return e>t?t:e},kt.imax=function(t,e){return t>e?t:e},kt.curveElevateDegree=function(t,e){if(e<=t.degree)return t;var r=t.knots.length-t.degree-2,n=t.degree,i=t.knots,s=t.controlPoints,o=e-t.degree,a=t.controlPoints[0].length,u=bt.zeros2d(n+o+1,n+1),h=[],c=[],l=[],f=r+n+1,d=e,p=Math.floor(d/2),m=[],v=[];u[0][0]=1,u[d][n]=1;for(var g=1,y=p+1;y>g;)for(var x=g++,_=1/D.get(d,x),b=kt.imin(n,x),w=kt.imax(0,x-o),S=b+1;S>w;){var z=w++;u[x][z]=_*D.get(n,z)*D.get(o,x-z)}for(var M=p+1;d>M;)for(var C=M++,P=kt.imin(n,C),A=kt.imax(0,C-o),E=P+1;E>A;){var k=A++;u[C][k]=u[d-C][n-k]}var T=d+1,N=-1,I=n,V=n+1,B=1,L=i[0];m[0]=s[0];for(var O=0,U=d+1;U>O;)v[O++]=L;for(var F=0,j=n+1;j>F;){var q=F++;h[q]=s[q]}for(;f>V;){for(var X=V;f>V&&i[V]==i[V+1];)V+=1;var Y,W,Z=V-X+1,H=i[V],$=N;if(N=n-Z,Y=$>0?Math.floor(($+2)/2):1,W=N>0?Math.floor(d-(N+1)/2):d,N>0){for(var G=H-L,K=[],Q=n;Q>Z;)K[Q-Z-1]=G/(i[I+Q]-L),Q--;for(var J=1,tt=N+1;tt>J;){for(var et=J++,rt=N-et,nt=Z+et,it=n;it>=nt;)h[it]=bt.add(bt.mul(K[it-nt],h[it]),bt.mul(1-K[it-nt],h[it-1])),it--;l[rt]=h[n]}}for(var st=Y,ot=d+1;ot>st;){var at=st++;c[at]=bt.zeros1d(a);for(var ut=kt.imin(n,at),ht=kt.imax(0,at-o),ct=ut+1;ct>ht;){var lt=ht++;c[at]=bt.add(c[at],bt.mul(u[at][lt],h[lt]))}}if($>1)for(var ft=T-2,dt=T,pt=H-L,mt=(H-v[T-1])/pt,vt=1;$>vt;){for(var gt=vt++,yt=ft,xt=dt,_t=xt-T+1;xt-yt>gt;){if(B>yt){var wt=(H-v[yt])/(L-v[yt]);m[yt]=bt.lerp(wt,m[yt],m[yt-1])}if(Y>xt)c[_t]=bt.lerp(mt,c[_t],c[_t+1]);else if(T-d+$>=xt-gt){var St=(H-v[xt-gt])/pt;c[_t]=bt.lerp(St,c[_t],c[_t+1])}yt+=1,xt-=1,_t-=1}ft-=1,dt+=1}if(I!=n)for(var zt=0,Mt=d-$;Mt>zt;)zt++,v[T]=L,T+=1;for(var Ct=Y,Pt=W+1;Pt>Ct;){var At=Ct++;m[B]=c[At],B+=1}if(f>V){for(var Et=0;N>Et;){var Tt=Et++;h[Tt]=l[Tt]}for(var Nt=N,It=n+1;It>Nt;){var Vt=Nt++;h[Vt]=s[V-n+Vt]}I=V,V+=1,L=H}else for(var Dt=0,Bt=d+1;Bt>Dt;)v[T+Dt++]=H}return new R(e,v,m)},kt.rationalSurfaceTransform=function(t,e){for(var r=Pt.dehomogenize2d(t.controlPoints),n=0,i=r.length;i>n;)for(var s=n++,o=0,a=r[s].length;a>o;){var u=o++,h=r[s][u];h.push(1),r[s][u]=ft.dot(e,h).slice(0,h.length-1)}return new j(t.degreeU,t.degreeV,t.knotsU.slice(),t.knotsV.slice(),Pt.homogenize2d(r,Pt.weight2d(t.controlPoints)))},kt.rationalCurveTransform=function(t,e){for(var r=Pt.dehomogenize1d(t.controlPoints),n=0,i=r.length;i>n;){var s=n++,o=r[s];o.push(1),r[s]=ft.dot(e,o).slice(0,o.length-1)}return new R(t.degree,t.knots.slice(),Pt.homogenize1d(r,Pt.weight1d(t.controlPoints)))},kt.surfaceKnotRefine=function(t,e,r){var n,i,s,o=[];r?(s=t.controlPoints,n=t.knotsV,i=t.degreeV):(s=ft.transpose(t.controlPoints),n=t.knotsU,i=t.degreeU);for(var a=null,u=0;u<s.length;){var h=s[u];++u,a=kt.curveKnotRefine(new R(i,n,h),e),o.push(a.controlPoints)}var c=a.knots;return r?new j(t.degreeU,t.degreeV,t.knotsU.slice(),c,o):(o=ft.transpose(o),new j(t.degreeU,t.degreeV,c,t.knotsV.slice(),o))},kt.decomposeCurveIntoBeziers=function(t){for(var e=t.degree,r=t.controlPoints,n=t.knots,i=wt.knotMultiplicities(n),s=e+1,o=0;o<i.length;){var a=i[o];if(++o,a.mult<s){var u=bt.rep(s-a.mult,a.knot),h=kt.curveKnotRefine(new R(e,n,r),u);n=h.knots,r=h.controlPoints}}n.length;for(var c=2*s,l=[],f=0;f<r.length;){var d=n.slice(f,f+c),p=r.slice(f,f+s);l.push(new R(e,d,p)),f+=s}return l},kt.curveKnotRefine=function(t,e){if(0==e.length)return Et.clonedCurve(t);for(var r=t.degree,n=t.controlPoints,i=t.knots,s=n.length-1,o=s+r+1,a=e.length-1,u=Pt.knotSpan(r,e[0],i),h=Pt.knotSpan(r,e[a],i),c=[],l=[],f=0,d=u-r+1;d>f;){var p=f++;c[p]=n[p]}for(var m=h-1,v=s+1;v>m;){var g=m++;c[g+a+1]=n[g]}for(var y=0,x=u+1;x>y;){var _=y++;l[_]=i[_]}for(var b=h+r,w=o+1;w>b;){var S=b++;l[S+a+1]=i[S]}for(var z=h+r-1,M=h+r+a,C=a;C>=0;){for(;e[C]<=i[z]&&z>u;)c[M-r-1]=n[z-r-1],l[M]=i[z],M-=1,z-=1;c[M-r-1]=c[M-r];for(var P=1,A=r+1;A>P;){var E=P++,k=M-r+E,T=l[M+E]-e[C];Math.abs(T)<L.EPSILON?c[k-1]=c[k]:(T/=l[M+E]-i[z-r+E],c[k-1]=bt.add(bt.mul(T,c[k-1]),bt.mul(1-T,c[k])))}l[M]=e[C],M-=1,C--}return new R(r,l,c)},kt.curveKnotInsert=function(t,e,r){for(var n=t.degree,i=t.controlPoints,s=t.knots,o=i.length,a=Pt.knotSpan(n,e,s),u=[],h=[],c=[],l=1,f=a+1;f>l;){var d=l++;h[d]=s[d]}for(var p=1,m=r+1;m>p;)h[a+p++]=e;for(var v=a+1,g=s.length;g>v;){var y=v++;h[y+r]=s[y]}for(var x=0,_=a-n+1;_>x;){var b=x++;c[b]=i[b]}for(var w=a-0;o>w;){var S=w++;c[S+r]=i[S]}for(var z=0,M=n-0+1;M>z;){var C=z++;u[C]=i[a-n+C]}for(var P=0,A=0,E=1,k=r+1;k>E;){var T=E++;P=a-n+T;for(var N=0,I=n-T-0+1;I>N;){var V=N++;A=(e-s[P+V])/(s[V+a+1]-s[P+V]),u[V]=bt.add(bt.mul(A,u[V+1]),bt.mul(1-A,u[V]))}c[P]=u[0],c[a+r-T-0]=u[n-T-0]}for(var D=P+1,B=a-0;B>D;){var L=D++;c[L]=u[L-P]}return new R(n,h,c)};var Tt=e.eval.Tess=function(){};o["verb.eval.Tess"]=Tt,Tt.__name__=["verb","eval","Tess"],Tt.rationalCurveRegularSample=function(t,e,r){return Tt.rationalCurveRegularSampleRange(t,t.knots[0],V.last(t.knots),e,r)},Tt.rationalCurveRegularSampleRange=function(t,e,r,n,i){1>n&&(n=2);for(var s=[],o=(r-e)/(n-1),a=0,u=0;n>u;)a=e+o*u++,i?s.push([a].concat(Pt.rationalCurvePoint(t,a))):s.push(Pt.rationalCurvePoint(t,a));return s},Tt.rationalCurveAdaptiveSample=function(t,e,r){if(null==r&&(r=!1),null==e&&(e=1e-6),1==t.degree){if(r){for(var n=[],i=0,s=t.controlPoints.length;s>i;){var o=i++;n.push([t.knots[o+1]].concat(Pt.dehomogenize(t.controlPoints[o])))}return n}return t.controlPoints.map(Pt.dehomogenize)}return Tt.rationalCurveAdaptiveSampleRange(t,t.knots[0],V.last(t.knots),e,r)},Tt.rationalCurveAdaptiveSampleRange=function(t,e,r,n,i){var s=Pt.rationalCurvePoint(t,e),o=Pt.rationalCurvePoint(t,r),a=e+(r-e)*(.5+.2*Math.random()),u=Pt.rationalCurvePoint(t,a),h=bt.sub(s,o),c=bt.sub(s,u);if(bt.dot(h,h)<n&&bt.dot(c,c)>n||!_t.threePointsAreFlat(s,u,o,n)){var l=e+.5*(r-e),f=Tt.rationalCurveAdaptiveSampleRange(t,e,l,n,i),d=Tt.rationalCurveAdaptiveSampleRange(t,l,r,n,i);return f.slice(0,-1).concat(d)}return i?[[e].concat(s),[r].concat(o)]:[s,o]},Tt.rationalSurfaceNaive=function(t,e,r){1>e&&(e=1),1>r&&(r=1),t.degreeU,t.degreeV,t.controlPoints;for(var n=t.knotsU,i=t.knotsV,s=(V.last(n)-n[0])/e,o=(V.last(i)-i[0])/r,a=[],u=[],h=[],c=0,l=e+1;l>c;)for(var f=c++,d=0,p=r+1;p>d;){var m=f*s,v=d++*o;u.push([m,v]);var g=Pt.rationalSurfaceDerivatives(t,m,v,1),y=g[0][0];a.push(y);var x=bt.normalized(bt.cross(g[1][0],g[0][1]));h.push(x)}for(var _=[],b=0;e>b;)for(var w=b++,S=0;r>S;){var z=S++,M=w*(r+1)+z,C=(w+1)*(r+1)+z,P=C+1,A=[M,C,P],E=[M,P,M+1];_.push(A),_.push(E)}return new q(_,a,h,u)},Tt.divideRationalSurfaceAdaptive=function(t,e){null==e&&(e=new Nt),null!=e.minDivsU?e.minDivsU=e.minDivsU:e.minDivsU=1,null!=e.minDivsV?e.minDivsU=e.minDivsV:e.minDivsU=1,null!=e.refine?e.refine=e.refine:e.refine=!0;var r,n,i=2*(t.controlPoints.length-1),s=2*(t.controlPoints[0].length-1);r=e.minDivsU>i?e.minDivsU=e.minDivsU:e.minDivsU=i,n=e.minDivsV>s?e.minDivsV=e.minDivsV:e.minDivsV=s;for(var o=V.last(t.knotsU),a=t.knotsU[0],u=V.last(t.knotsV),h=t.knotsV[0],c=(o-a)/r,l=(u-h)/n,f=[],d=[],p=0,m=n+1;m>p;){for(var v=p++,g=[],y=0,x=r+1;x>y;){var _=a+c*y++,b=h+l*v,w=Pt.rationalSurfaceDerivatives(t,_,b,1),S=bt.normalized(bt.cross(w[0][1],w[1][0]));g.push(new et(w[0][0],S,[_,b],-1,bt.isZero(S)))}d.push(g)}for(var z=0;n>z;)for(var M=z++,C=0;r>C;){var P=C++,A=[d[n-M-1][P],d[n-M-1][P+1],d[n-M][P+1],d[n-M][P]];f.push(new It(t,A))}if(!e.refine)return f;for(var E=0;n>E;)for(var k=E++,T=0;r>T;){var N=T++,I=k*r+N,D=Tt.north(I,k,N,r,n,f),B=Tt.east(I,k,N,r,n,f),L=Tt.south(I,k,N,r,n,f),O=Tt.west(I,k,N,r,n,f);f[I].neighbors=[L,B,D,O],f[I].divide(e)}return f},Tt.north=function(t,e,r,n,i,s){return 0==e?null:s[t-n]},Tt.south=function(t,e,r,n,i,s){return e==i-1?null:s[t+n]},Tt.east=function(t,e,r,n,i,s){return r==n-1?null:s[t+1]},Tt.west=function(t,e,r,n,i,s){return 0==r?null:s[t-1]},Tt.triangulateAdaptiveRefinementNodeTree=function(t){for(var e=q.empty(),r=0;r<t.length;){var n=t[r];++r,n.triangulate(e)}return e},Tt.rationalSurfaceAdaptive=function(t,e){null!=e||(e=new Nt);var r=Tt.divideRationalSurfaceAdaptive(t,e);return Tt.triangulateAdaptiveRefinementNodeTree(r)};var Nt=e.core.AdaptiveRefinementOptions=function(){this.minDivsV=1,this.minDivsU=1,this.refine=!0,this.maxDepth=10,this.minDepth=0,this.normTol=.025};o["verb.eval.AdaptiveRefinementOptions"]=Nt,Nt.__name__=["verb","eval","AdaptiveRefinementOptions"],Nt.prototype={__class__:Nt};var It=e.core.AdaptiveRefinementNode=function(t,e,r){if(this.srf=t,this.neighbors=null==r?[null,null,null,null]:r,this.corners=e,null==this.corners){var n=t.knotsU[0],i=V.last(t.knotsU),s=t.knotsV[0],o=V.last(t.knotsV);this.corners=[et.fromUv(n,s),et.fromUv(i,s),et.fromUv(i,o),et.fromUv(n,o)]}};o["verb.eval.AdaptiveRefinementNode"]=It,It.__name__=["verb","eval","AdaptiveRefinementNode"],It.prototype={isLeaf:function(){return null==this.children},center:function(){return null!=this.centerPoint?this.centerPoint:this.evalSrf(this.u05,this.v05)},evalCorners:function(){this.u05=(this.corners[0].uv[0]+this.corners[2].uv[0])/2,this.v05=(this.corners[0].uv[1]+this.corners[2].uv[1])/2;for(var t=0;4>t;){var e=t++;if(null==this.corners[e].point){var r=this.corners[e];this.evalSrf(r.uv[0],r.uv[1],r)}}},evalSrf:function(t,e,r){var n=Pt.rationalSurfaceDerivatives(this.srf,t,e,1),i=n[0][0],s=bt.cross(n[0][1],n[1][0]),o=bt.isZero(s);return o||(s=bt.normalized(s)),null!=r?(r.degen=o,r.point=i,r.normal=s,r):new et(i,s,[t,e],-1,o)},getEdgeCorners:function(t){if(this.isLeaf())return[this.corners[t]];if(this.horizontal)switch(t){case 0:return this.children[0].getEdgeCorners(0);case 1:return this.children[0].getEdgeCorners(1).concat(this.children[1].getEdgeCorners(1));case 2:return this.children[1].getEdgeCorners(2);case 3:return this.children[1].getEdgeCorners(3).concat(this.children[0].getEdgeCorners(3))}switch(t){case 0:return this.children[0].getEdgeCorners(0).concat(this.children[1].getEdgeCorners(0));case 1:return this.children[1].getEdgeCorners(1);case 2:return this.children[1].getEdgeCorners(2).concat(this.children[0].getEdgeCorners(2));case 3:return this.children[0].getEdgeCorners(3)}return null},getAllCorners:function(t){var e=[this.corners[t]];if(null==this.neighbors[t])return e;var r=this.neighbors[t].getEdgeCorners((t+2)%4),n=t%2,i=L.EPSILON,s=this,o=[function(t){return t.uv[0]>s.corners[0].uv[0]+i&&t.uv[0]<s.corners[2].uv[0]-i},function(t){return t.uv[1]>s.corners[0].uv[1]+i&&t.uv[1]<s.corners[2].uv[1]-i}],a=r.filter(o[n]);return a.reverse(),e.concat(a)},midpoint:function(t){if(null==this.midPoints&&(this.midPoints=[null,null,null,null]),null!=this.midPoints[t])return this.midPoints[t];switch(t){case 0:this.midPoints[0]=this.evalSrf(this.u05,this.corners[0].uv[1]);break;case 1:this.midPoints[1]=this.evalSrf(this.corners[1].uv[0],this.v05);break;case 2:this.midPoints[2]=this.evalSrf(this.u05,this.corners[2].uv[1]);break;case 3:this.midPoints[3]=this.evalSrf(this.corners[0].uv[0],this.v05)}return this.midPoints[t]},hasBadNormals:function(){return this.corners[0].degen||this.corners[1].degen||this.corners[2].degen||this.corners[3].degen},fixNormals:function(){for(var t=this.corners.length,e=0;t>e;){var r=e++;if(this.corners[r],this.corners[r].degen){var n=this.corners[(r+1)%t],i=this.corners[(r+3)%t];n.degen?this.corners[r].normal=i.normal:this.corners[r].normal=n.normal}}},shouldDivide:function(t,e){if(e<t.minDepth)return!0;if(e>=t.maxDepth)return!1;if(this.hasBadNormals())return this.fixNormals(),!1;if(this.splitVert=bt.normSquared(bt.sub(this.corners[0].normal,this.corners[1].normal))>t.normTol||bt.normSquared(bt.sub(this.corners[2].normal,this.corners[3].normal))>t.normTol,this.splitHoriz=bt.normSquared(bt.sub(this.corners[1].normal,this.corners[2].normal))>t.normTol||bt.normSquared(bt.sub(this.corners[3].normal,this.corners[0].normal))>t.normTol,this.splitVert||this.splitHoriz)return!0;var r=this.center();return bt.normSquared(bt.sub(r.normal,this.corners[0].normal))>t.normTol||bt.normSquared(bt.sub(r.normal,this.corners[1].normal))>t.normTol||bt.normSquared(bt.sub(r.normal,this.corners[2].normal))>t.normTol||bt.normSquared(bt.sub(r.normal,this.corners[3].normal))>t.normTol},divide:function(t){null==t&&(t=new Nt),null==t.normTol&&(t.normTol=.085),null==t.minDepth&&(t.minDepth=0),null==t.maxDepth&&(t.maxDepth=10),this._divide(t,0,!0)},_divide:function(t,e,r){if(this.evalCorners(),this.shouldDivide(t,e)){if(e++,this.splitVert&&!this.splitHoriz?r=!1:!this.splitVert&&this.splitHoriz&&(r=!0),this.horizontal=r,this.horizontal){var n=[this.corners[0],this.corners[1],this.midpoint(1),this.midpoint(3)],i=[this.midpoint(3),this.midpoint(1),this.corners[2],this.corners[3]];this.children=[new It(this.srf,n),new It(this.srf,i)],this.children[0].neighbors=[this.neighbors[0],this.neighbors[1],this.children[1],this.neighbors[3]],this.children[1].neighbors=[this.children[0],this.neighbors[1],this.neighbors[2],this.neighbors[3]]}else{var s=[this.corners[0],this.midpoint(0),this.midpoint(2),this.corners[3]],o=[this.midpoint(0),this.corners[1],this.corners[2],this.midpoint(2)];this.children=[new It(this.srf,s),new It(this.srf,o)],this.children[0].neighbors=[this.neighbors[0],this.children[1],this.neighbors[2],this.neighbors[3]],this.children[1].neighbors=[this.neighbors[0],this.neighbors[1],this.neighbors[2],this.children[0]]}for(var a=0,u=this.children;a<u.length;){var h=u[a];++a,h._divide(t,e,!r)}}},triangulate:function(t){if(null==t&&(t=q.empty()),this.isLeaf())return this.triangulateLeaf(t);for(var e=0,r=this.children;e<r.length;){var n=r[e];if(++e,null==n)break;n.triangulate(t)}return t},triangulateLeaf:function(t){for(var e=t.points.length,r=[],n=[],i=0,s=0;4>s;){var o=s++,a=this.getAllCorners(o);2==a.length&&(i=o+1);for(var u=0,h=a.length;h>u;){var c=u++;r.push(a[c])}}for(var l=0;l<r.length;){var f=r[l];++l,-1==f.id?(t.uvs.push(f.uv),t.points.push(f.point),t.normals.push(f.normal),f.id=e,n.push(e),e++):n.push(f.id)}if(4==r.length)return t.faces.push([n[0],n[3],n[1]]),t.faces.push([n[3],n[2],n[1]]),t;if(5==r.length){var d=n.length;return t.faces.push([n[i],n[(i+2)%d],n[(i+1)%d]]),t.faces.push([n[(i+4)%d],n[(i+3)%d],n[i]]),t.faces.push([n[i],n[(i+3)%d],n[(i+2)%d]]),t}var p=this.center();t.uvs.push(p.uv),t.points.push(p.point),t.normals.push(p.normal);for(var m=t.points.length-1,v=0,g=r.length-1;v<r.length;)t.faces.push([m,n[v],n[g]]),g=v++;return t},__class__:It};var Vt=function(){};o["verb.geom.ICurve"]=Vt,Vt.__name__=["verb","geom","ICurve"],Vt.__interfaces__=[yt],Vt.prototype={__class__:Vt};var Dt=e.geom.NurbsCurve=function(t){this._data=zt.isValidNurbsCurveData(t)};o["verb.geom.NurbsCurve"]=Dt,Dt.__name__=["verb","geom","NurbsCurve"],Dt.__interfaces__=[Vt],Dt.byKnotsControlPointsWeights=function(t,e,r,n){return new Dt(new R(t,e.slice(),Pt.homogenize1d(r,n)))},Dt.byPoints=function(t,e){return null==e&&(e=3),new Dt(Et.rationalInterpCurve(t,e))},Dt.__super__=O,Dt.prototype=n(O.prototype,{degree:function(){return this._data.degree},knots:function(){return this._data.knots.slice(0)},controlPoints:function(){return Pt.dehomogenize1d(this._data.controlPoints)},weights:function(){return Pt.weight1d(this._data.controlPoints)},asNurbs:function(){return new R(this.degree(),this.knots(),Pt.homogenize1d(this.controlPoints(),this.weights()))},clone:function(){return new Dt(this._data)},domain:function(){return new Z(V.first(this._data.knots),V.last(this._data.knots))},transform:function(t){return new Dt(kt.rationalCurveTransform(this._data,t))},transformAsync:function(t){return verb_exe_Dispatcher.dispatchMethod(kt,"rationalCurveTransform",[this._data,t]).then((function(t){return new Dt(t)}))},point:function(t){return Pt.rationalCurvePoint(this._data,t)},pointAsync:function(t){return verb_exe_Dispatcher.dispatchMethod(Pt,"rationalCurvePoint",[this._data,t])},tangent:function(t){return Pt.rationalCurveTangent(this._data,t)},tangentAsync:function(t){return verb_exe_Dispatcher.dispatchMethod(Pt,"rationalCurveTangent",[this._data,t])},derivatives:function(t,e){return null==e&&(e=1),Pt.rationalCurveDerivatives(this._data,t,e)},derivativesAsync:function(t,e){return null==e&&(e=1),verb_exe_Dispatcher.dispatchMethod(Pt,"rationalCurveDerivatives",[this._data,t,e])},closestPoint:function(t){return wt.rationalCurveClosestPoint(this._data,t)},closestPointAsync:function(t){return verb_exe_Dispatcher.dispatchMethod(wt,"rationalCurveClosestPoint",[this._data,t])},closestParam:function(t){return wt.rationalCurveClosestParam(this._data,t)},closestParamAsync:function(t){return verb_exe_Dispatcher.dispatchMethod(wt,"rationalCurveClosestParam",[this._data,t])},length:function(){return wt.rationalCurveArcLength(this._data)},lengthAsync:function(){return verb_exe_Dispatcher.dispatchMethod(wt,"rationalCurveArcLength",[this._data])},lengthAtParam:function(t){return wt.rationalCurveArcLength(this._data,t)},lengthAtParamAsync:function(){return verb_exe_Dispatcher.dispatchMethod(wt,"rationalCurveArcLength",[this._data])},paramAtLength:function(t,e){return wt.rationalCurveParamAtArcLength(this._data,t,e)},paramAtLengthAsync:function(t,e){return verb_exe_Dispatcher.dispatchMethod(wt,"rationalCurveParamAtArcLength",[this._data,t,e])},divideByEqualArcLength:function(t){return Mt.rationalCurveByEqualArcLength(this._data,t)},divideByEqualArcLengthAsync:function(t){return verb_exe_Dispatcher.dispatchMethod(Mt,"rationalCurveByEqualArcLength",[this._data,t])},divideByArcLength:function(t){return Mt.rationalCurveByArcLength(this._data,t)},divideByArcLengthAsync:function(t){return verb_exe_Dispatcher.dispatchMethod(Mt,"rationalCurveByArcLength",[this._data,t])},split:function(t){return Mt.curveSplit(this._data,t).map((function(t){return new Dt(t)}))},splitAsync:function(t){return verb_exe_Dispatcher.dispatchMethod(Mt,"curveSplit",[this._data,t]).then((function(t){return t.map((function(t){return new Dt(t)}))}))},reverse:function(){return new Dt(kt.curveReverse(this._data))},reverseAsync:function(){return verb_exe_Dispatcher.dispatchMethod(kt,"curveReverse",[this._data]).then((function(t){return new Dt(t)}))},tessellate:function(t){return Tt.rationalCurveAdaptiveSample(this._data,t,!1)},tessellateAsync:function(t){return verb_exe_Dispatcher.dispatchMethod(Tt,"rationalCurveAdaptiveSample",[this._data,t,!1])},__class__:Dt});var Bt=e.geom.Arc=function(t,e,r,n,i,s){Dt.call(this,Et.arc(t,e,r,n,i,s)),this._center=t,this._xaxis=e,this._yaxis=r,this._radius=n,this._minAngle=i,this._maxAngle=s};o["verb.geom.Arc"]=Bt,Bt.__name__=["verb","geom","Arc"],Bt.__super__=Dt,Bt.prototype=n(Dt.prototype,{center:function(){return this._center},xaxis:function(){return this._xaxis},yaxis:function(){return this._yaxis},radius:function(){return this._radius},minAngle:function(){return this._minAngle},maxAngle:function(){return this._maxAngle},__class__:Bt});var Lt=e.geom.BezierCurve=function(t,e){Dt.call(this,Et.rationalBezierCurve(t,e))};o["verb.geom.BezierCurve"]=Lt,Lt.__name__=["verb","geom","BezierCurve"],Lt.__super__=Dt,Lt.prototype=n(Dt.prototype,{__class__:Lt});var Ot=e.geom.Circle=function(t,e,r,n){Bt.call(this,t,e,r,n,0,2*Math.PI)};o["verb.geom.Circle"]=Ot,Ot.__name__=["verb","geom","Circle"],Ot.__super__=Bt,Ot.prototype=n(Bt.prototype,{__class__:Ot});var Ut=function(){};o["verb.geom.ISurface"]=Ut,Ut.__name__=["verb","geom","ISurface"],Ut.__interfaces__=[yt],Ut.prototype={__class__:Ut};var Ft=e.geom.NurbsSurface=function(t){this._data=zt.isValidNurbsSurfaceData(t)};o["verb.geom.NurbsSurface"]=Ft,Ft.__name__=["verb","geom","NurbsSurface"],Ft.__interfaces__=[Ut],Ft.byKnotsControlPointsWeights=function(t,e,r,n,i,s){return new Ft(new j(t,e,r,n,Pt.homogenize2d(i,s)))},Ft.byCorners=function(t,e,r,n){return new Ft(Et.fourPointSurface(t,e,r,n))},Ft.byLoftingCurves=function(t,e){return new Ft(Et.loftedSurface(function(){for(var e=[],r=0;r<t.length;){var n=t[r];++r,e.push(n.asNurbs())}return e}(),e))},Ft.__super__=O,Ft.prototype=n(O.prototype,{degreeU:function(){return this._data.degreeU},degreeV:function(){return this._data.degreeV},knotsU:function(){return this._data.knotsU.slice(0)},knotsV:function(){return this._data.knotsV.slice(0)},controlPoints:function(){return Pt.dehomogenize2d(this._data.controlPoints)},weights:function(){return Pt.weight2d(this._data.controlPoints)},asNurbs:function(){return new j(this.degreeU(),this.degreeV(),this.knotsU(),this.knotsV(),Pt.homogenize2d(this.controlPoints(),this.weights()))},clone:function(){return new Ft(this.asNurbs())},domainU:function(){return new Z(V.first(this._data.knotsU),V.last(this._data.knotsU))},domainV:function(){return new Z(V.first(this._data.knotsV),V.last(this._data.knotsV))},point:function(t,e){return Pt.rationalSurfacePoint(this._data,t,e)},pointAsync:function(t,e){return verb_exe_Dispatcher.dispatchMethod(Pt,"rationalSurfacePoint",[this._data,t,e])},normal:function(t,e){return Pt.rationalSurfaceNormal(this._data,t,e)},normalAsync:function(t,e){return verb_exe_Dispatcher.dispatchMethod(Pt,"rationalSurfaceNormal",[this._data,t,e])},derivatives:function(t,e,r){return null==r&&(r=1),Pt.rationalSurfaceDerivatives(this._data,t,e,r)},derivativesAsync:function(t,e,r){return null==r&&(r=1),verb_exe_Dispatcher.dispatchMethod(Pt,"rationalSurfaceDerivatives",[this._data,t,e,r])},closestParam:function(t){return wt.rationalSurfaceClosestParam(this._data,t)},closestParamAsync:function(t){return verb_exe_Dispatcher.dispatchMethod(wt,"rationalSurfaceClosestParam",[this._data,t])},closestPoint:function(t){return wt.rationalSurfaceClosestPoint(this._data,t)},closestPointAsync:function(t){return verb_exe_Dispatcher.dispatchMethod(wt,"rationalSurfaceClosestPoint",[this._data,t])},split:function(t,e){return null==e&&(e=!1),Mt.surfaceSplit(this._data,t,e).map((function(t){return new Ft(t)}))},splitAsync:function(t,e){return null==e&&(e=!1),verb_exe_Dispatcher.dispatchMethod(Mt,"surfaceSplit",[this._data,t,e]).then((function(t){return t.map((function(t){return new Ft(t)}))}))},reverse:function(t){return null==t&&(t=!1),new Ft(kt.surfaceReverse(this._data,t))},reverseAsync:function(t){return null==t&&(t=!1),verb_exe_Dispatcher.dispatchMethod(kt,"surfaceReverse",[this._data,t]).then((function(t){return new Ft(t)}))},isocurve:function(t,e){return null==e&&(e=!1),new Dt(Et.surfaceIsocurve(this._data,t,e))},isocurveAsync:function(t,e){return null==e&&(e=!1),verb_exe_Dispatcher.dispatchMethod(Et,"surfaceIsocurve",[this._data,t,e]).then((function(t){return new Dt(t)}))},boundaries:function(){return Et.surfaceBoundaryCurves(this._data).map((function(t){return new Dt(t)}))},boundariesAsync:function(){return verb_exe_Dispatcher.dispatchMethod(Et,"surfaceBoundaryCurves",[this._data]).then((function(t){return t.map((function(t){return new Dt(t)}))}))},tessellate:function(t){return Tt.rationalSurfaceAdaptive(this._data,t)},tessellateAsync:function(t){return verb_exe_Dispatcher.dispatchMethod(Tt,"rationalSurfaceAdaptive",[this._data,t])},transform:function(t){return new Ft(kt.rationalSurfaceTransform(this._data,t))},transformAsync:function(t){return verb_exe_Dispatcher.dispatchMethod(kt,"rationalSurfaceTransform",[this._data,t]).then((function(t){return new Ft(t)}))},__class__:Ft});var Rt=e.geom.ConicalSurface=function(t,e,r,n,i){Ft.call(this,Et.conicalSurface(t,e,r,n,i)),this._axis=t,this._xaxis=e,this._base=r,this._height=n,this._radius=i};o["verb.geom.ConicalSurface"]=Rt,Rt.__name__=["verb","geom","ConicalSurface"],Rt.__super__=Ft,Rt.prototype=n(Ft.prototype,{axis:function(){return this._axis},xaxis:function(){return this._xaxis},base:function(){return this._base},height:function(){return this._height},radius:function(){return this._radius},__class__:Rt});var jt=e.geom.CylindricalSurface=function(t,e,r,n,i){Ft.call(this,Et.cylindricalSurface(t,e,r,n,i)),this._axis=t,this._xaxis=e,this._base=r,this._height=n,this._radius=i};o["verb.geom.CylindricalSurface"]=jt,jt.__name__=["verb","geom","CylindricalSurface"],jt.__super__=Ft,jt.prototype=n(Ft.prototype,{axis:function(){return this._axis},xaxis:function(){return this._xaxis},base:function(){return this._base},height:function(){return this._height},radius:function(){return this._radius},__class__:jt});var qt=e.geom.EllipseArc=function(t,e,r,n,i){Dt.call(this,Et.ellipseArc(t,e,r,n,i)),this._center=t,this._xaxis=e,this._yaxis=r,this._minAngle=n,this._maxAngle=i};o["verb.geom.EllipseArc"]=qt,qt.__name__=["verb","geom","EllipseArc"],qt.__super__=Dt,qt.prototype=n(Dt.prototype,{center:function(){return this._center},xaxis:function(){return this._xaxis},yaxis:function(){return this._yaxis},minAngle:function(){return this._minAngle},maxAngle:function(){return this._maxAngle},__class__:qt});var Xt=e.geom.Ellipse=function(t,e,r){qt.call(this,t,e,r,0,2*Math.PI)};o["verb.geom.Ellipse"]=Xt,Xt.__name__=["verb","geom","Ellipse"],Xt.__super__=qt,Xt.prototype=n(qt.prototype,{__class__:Xt});var Yt=e.geom.ExtrudedSurface=function(t,e){Ft.call(this,Et.extrudedSurface(bt.normalized(e),bt.norm(e),t.asNurbs())),this._profile=t,this._direction=e};o["verb.geom.ExtrudedSurface"]=Yt,Yt.__name__=["verb","geom","ExtrudedSurface"],Yt.__super__=Ft,Yt.prototype=n(Ft.prototype,{profile:function(){return this._profile},direction:function(){return this._direction},__class__:Yt});var Wt=e.geom.Intersect=function(){};o["verb.geom.Intersect"]=Wt,Wt.__name__=["verb","geom","Intersect"],Wt.curves=function(t,e,r){return null==r&&(r=.001),At.curves(t.asNurbs(),e.asNurbs(),r)},Wt.curvesAsync=function(t,e,r){return null==r&&(r=.001),verb_exe_Dispatcher.dispatchMethod(At,"curves",[t.asNurbs(),e.asNurbs(),r])},Wt.curveAndSurface=function(t,e,r){return null==r&&(r=.001),At.curveAndSurface(t.asNurbs(),e.asNurbs(),r)},Wt.curveAndSurfaceAsync=function(t,e,r){return null==r&&(r=.001),verb_exe_Dispatcher.dispatchMethod(At,"curveAndSurface",[t.asNurbs(),e.asNurbs(),r])},Wt.surfaces=function(t,e,r){return null==r&&(r=.001),At.surfaces(t.asNurbs(),e.asNurbs(),r).map((function(t){return new Dt(t)}))},Wt.surfacesAsync=function(t,e,r){return null==r&&(r=.001),verb_exe_Dispatcher.dispatchMethod(At,"surfaces",[t.asNurbs(),e.asNurbs(),r]).then((function(t){return t.map((function(t){return new Dt(t)}))}))};var Zt=e.geom.Line=function(t,e){Dt.call(this,Et.polyline([t,e])),this._start=t,this._end=e};o["verb.geom.Line"]=Zt,Zt.__name__=["verb","geom","Line"],Zt.__super__=Dt,Zt.prototype=n(Dt.prototype,{start:function(){return this._start},end:function(){return this._end},__class__:Zt});var Ht=e.geom.RevolvedSurface=function(t,e,r,n){Ft.call(this,Et.revolvedSurface(t.asNurbs(),e,r,n)),this._profile=t,this._center=e,this._axis=r,this._angle=n};o["verb.geom.RevolvedSurface"]=Ht,Ht.__name__=["verb","geom","RevolvedSurface"],Ht.__super__=Ft,Ht.prototype=n(Ft.prototype,{profile:function(){return this._profile},center:function(){return this._center},axis:function(){return this._center},angle:function(){return this._angle},__class__:Ht});var $t=e.geom.SphericalSurface=function(t,e){Ft.call(this,Et.sphericalSurface(t,[0,0,1],[1,0,0],e)),this._center=t,this._radius=e};o["verb.geom.SphericalSurface"]=$t,$t.__name__=["verb","geom","SphericalSurface"],$t.__super__=Ft,$t.prototype=n(Ft.prototype,{center:function(){return this._center},radius:function(){return this._radius},__class__:$t});var Gt=e.geom.SweptSurface=function(t,e){Ft.call(this,Et.rationalTranslationalSurface(t.asNurbs(),e.asNurbs())),this._profile=t,this._rail=e};o["verb.geom.SweptSurface"]=Gt,Gt.__name__=["verb","geom","SweptSurface"],Gt.__super__=Ft,Gt.prototype=n(Ft.prototype,{profile:function(){return this._profile},rail:function(){return this._rail},__class__:Gt});var Kt=0;o.Math=Math,String.prototype.__class__=o.String=String,String.__name__=["String"],o.Array=Array,Array.__name__=["Array"],Date.prototype.__class__=o.Date=Date,Date.__name__=["Date"];var Qt=o.Int={__name__:["Int"]},Jt=o.Dynamic={__name__:["Dynamic"]},te=o.Float=Number;te.__name__=["Float"];var ee=o.Bool=Boolean;ee.__ename__=["Bool"];var re=o.Class={__name__:["Class"]},ne={};null==[].map&&(Array.prototype.map=function(t){for(var e=[],r=0,n=this.length;n>r;){var i=r++;e[i]=t(this[i])}return e}),null==[].filter&&(Array.prototype.filter=function(t){for(var e=[],r=0,n=this.length;n>r;){var i=this[r++];t(i)&&e.push(i)}return e});var ie={},se=r.ArrayBuffer||k;null==se.prototype.slice&&(se.prototype.slice=k.sliceImpl),r.DataView;var oe=r.Uint8Array||N._new;!function(t,e){function r(t){return u[a]=n.apply(e,t),a++}function n(t){var r=[].slice.call(arguments,1);return function(){"function"==typeof t?t.apply(e,r):Function(""+t)()}}function i(t){if(h)setTimeout(n(i,t),0);else{var e=u[t];if(e){h=!0;try{e()}finally{s(t),h=!1}}}}function s(t){delete u[t]}if(!t.setImmediate){var o,a=1,u={},h=!1,c=t.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(t);l=l&&l.setTimeout?l:t,"[object process]"==={}.toString.call(t.process)?o=function(){var t=r(arguments);return process.nextTick(n(i,t)),t}:function(){if(t.postMessage&&!t.importScripts){var e=!0,r=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=r,e}}()?function(){var e="setImmediate$"+Math.random()+"$",n=function(r){r.source===t&&"string"==typeof r.data&&0===r.data.indexOf(e)&&i(+r.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),o=function(){var n=r(arguments);return t.postMessage(e+n,"*"),n}}():t.MessageChannel?function(){var t=new MessageChannel;t.port1.onmessage=function(t){i(t.data)},o=function(){var e=r(arguments);return t.port2.postMessage(e),e}}():c&&"onreadystatechange"in c.createElement("script")?function(){var t=c.documentElement;o=function(){var e=r(arguments),n=c.createElement("script");return n.onreadystatechange=function(){i(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n),e}}():o=function(){var t=r(arguments);return setTimeout(n(i,t),0),t},l.setImmediate=o,l.clearImmediate=s}}(Function("","return this")()),x.USE_CACHE=!1,x.USE_ENUM_INDEX=!1,x.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",_.DEFAULT_RESOLVER=v,_.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",w.count=0,P.i64tmp=new y(0,0),E.__toStr={}.toString,N.BYTES_PER_ELEMENT=1,D.memo=new b,L.TOLERANCE=1e-6,L.EPSILON=1e-10,L.VERSION="2.0.0",wt.Tvalues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],wt.Cvalues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],I.main()}(void 0!==console?console:{log:function(){}},t,"undefined"!=typeof window?window:void 0!==this?this:"undefined"!=typeof self?self:this),t}()}(bi)),bi.exports}function ht(t){return[t.knots[0],t.knots[t.knots.length-1]]}function ut(t){const e=[t[0]];for(let r=1;r<t.length;r+=1)e[e.length-1]!==t[r]&&e.push(t[r]);return e}function at(t,e){return Si.eval.Eval.rationalCurvePoint(t,e)}function ct(t,e){function r(t,e){for(let r=0;r<e.points.length;r+=1){const n=e.points[r];if(Number.isNaN(n[0])||Number.isNaN(n[1])||Number.isNaN(n[2])){const[n,i]=e.uvs[r];e.points[r]=Si.eval.Eval.rationalSurfacePoint(t,n,i)}}}const n=Si.eval.Tess.rationalSurfaceAdaptive(t),i=Si.eval.Tess.rationalSurfaceAdaptive(e);r(t,n),r(e,i);const s=ft(n,i,Gn,Jn,Kn).map((function(r){return r.map((function(r){return Si.eval.Intersect.surfacesAtPointWithEstimate(t,e,r.uv0,r.uv1,Gn)}))})),o=Math.max(lt(t),lt(e),0),a=o-1,u=[];for(const r of s){const n=r.map((t=>t.point)),i=Si.eval.Make.polyline(n),[s,h]=ht(i),c=(h-s)/(a+1),l=[n[0]];for(let r=0;a>r;r+=1){const n=at(i,(r+1)*c),s=Si.eval.Analyze.rationalSurfaceClosestParam(t,n),o=Si.eval.Analyze.rationalSurfaceClosestParam(e,n),a=Si.eval.Intersect.surfacesAtPointWithEstimate(t,e,s,o,Gn);l.push(a.point)}l.push(n[n.length-1]);const f=Si.eval.Make.rationalInterpCurve(l,o);u.push(f)}return u}function ft(t,e,r,n,i){const s=new Si.core.LazyMeshBoundingBoxTree(t),o=new Si.core.LazyMeshBoundingBoxTree(e),a=Si.eval.Intersect.boundingBoxTrees(s,o,r),u=Si.core.ArrayExtensions.unique(a.map((function(r){return Si.eval.Intersect.triangles(t,r.item0,e,r.item1)})).filter((t=>null!=t)).filter((t=>Si.core.Vec.distSquared(t.min.point,t.max.point)>n)),(function(t,e){const r=Si.core.Vec.sub(t.min.uv0,e.min.uv0),n=Si.core.Vec.dot(r,r),s=Si.core.Vec.sub(t.max.uv0,e.max.uv0),o=Si.core.Vec.dot(s,s),a=Si.core.Vec.sub(t.min.uv0,e.max.uv0),u=Si.core.Vec.dot(a,a),h=Si.core.Vec.sub(t.max.uv0,e.min.uv0),c=Si.core.Vec.dot(h,h);return i>n&&i>o||i>u&&i>c}));return Si.eval.Intersect.makeMeshIntersectionPolylines(u)}function lt(t){return Math.max(t.degreeU,t.degreeV)}function vt(t){const[e,r]=ht(t),n=r-e;for(let i=0;i<t.knots.length;i+=1){const s=t.knots[i];w(s,e)?t.knots[i]=0:w(s,r)?t.knots[i]=1:t.knots[i]=(s-e)/n}return t}function dt(t){const[e,r]=ht(t);0===e&&1===r||vt(t)}function wt(t){return Si.eval.Modify.curveReverse(t)}function pt(t,e,r,n){return r[t="__cache__:"+t+":"+e.join("/")]||(r[t]=n()),r[t]}function mt(t,e,r){if(!(t instanceof Ei&&e instanceof Ei))throw Error("NurbsSurface wanted.");let n=ct(t.data,e.data);return r&&(n=n.map((t=>wt(t)))),n.forEach((t=>dt(t))),n.map((t=>new ki(new Si.geom.NurbsCurve(t))))}function yt(t,e,r,n,i){const s=[],o=i(t,r[0],r[1]),a=i(e,n[0],n[1]);for(let i=0;i<o.length-1;i++){const u=o[i],c=o[i+1];for(let o=0;o<a.length-1;o++){const l=bt(u,c,a[o],a[o+1]);if(null!==l){const{point1:a,point2:u,l1:c,l2:f}=l;let d=t.param(a),p=e.param(u);if([d,p]=Mt(t,e,d,p),!_t(d,r)||!_t(p,n))continue;s.push({u0:d,u1:p,p0:a,p1:u}),h(d,c,Gn)&&i++,h(p,f,Gn)&&o++}}}return s}function Mt(t,e,r,n){return et((function([r,n]){return Y(D(t.point(r),e.point(n)))}),[r,n],Jn,(function([r,n]){const i=t.eval(r,1),s=e.eval(n,1),o=D(i[0],s[0]),a=i[1],u=k(-1,s[1]);return[2*V(a,o),2*V(u,o)]})).solution}function gt(t,e,r,n){const i=R(r,n),s=z(R(i,r)),o=z(R(i,n));return{u1:V(o,D(e,t))/V(o,r),u2:V(s,D(t,e))/V(s,n)}}function bt(t,e,r,n){const i=D(e,t),s=D(n,r),o=X(i),a=X(s);j(i,o),j(s,a);const{u1:u,u2:c}=gt(t,r,i,s),l=I(t,k(i,u)),f=I(r,k(s,c)),d=Y(D(l,f)),p=(t,e)=>h(t,e,Gn);return u!==1/0&&c!==1/0&&h(d,0,Jn)&&(u>0&&o>u||p(u,0)||p(u,o))&&(c>0&&a>c||p(c,0)||p(c,a))?{point1:l,point2:f,u1:u,u2:c,l1:o,l2:a}:null}function _t(t,e){return t>=e[0]&&t<=e[1]}function xt(t,e,r,n,i){return At(t,e,r,n,i).map((e=>t.point(e)))}function At(t,e,r,n,i){function s(e,r,a){const u=r-e;if(u>=.001&&u>a){const h=e+.5*u;s(e,h,a),o.push(h),s(h,r,St(t,h,n,i))}}const o=[],a=t.knots(),u=[e];for(const t of a)t>e&&r>t&&u.push(t);u.push(r);for(let e=1;e<u.length;e+=1){const r=u[e-1];o.push(r),s(r,u[e],St(t,r,n,i))}return o.push(r),o}function St(t,e,r,n){r=r||1,n=n||1;const i=t.eval(e,2),s=i[1],o=i[2],a=Y(s),u=Math.sqrt(a),h=a*u/X(R(s,o)),c=r/n;return 2*Math.sqrt(c*(2*h-c))/u}function kt(t){return(new Xn).set3(t)}function Et(t,e,r,n,i){return 1===t.degree()?t.knots().map((e=>t.point(e))):xt(t,e,r,n,i)}function Tt(t){return(new Hn).set3(t)}function Nt(t){if(1===Math.max(t.impl.degreeU(),t.impl.degreeV()))return t.tangentPlane(t.uMid,t.vMid)}function jt(t){const e=t[0],r=t[1];for(let n=2;n<t.length;n+=1){const i=t[n],s=r.minus(e).cross(i.minus(e)).normalize();if(!l(s.length(),0))return s.normalize()}throw Error("can not find the normal.")}function Ct(t,e){if(!e){const r=jt(t),n=t[0].dot(r);e=new fi(r,n)}const r=e.get2DTransformation();return Pt(t.map((t=>r.apply(t))),e)}function Pt(t,e,r,n,i=0){const s=new wi;return t.forEach((t=>s.checkPoint(t))),r&&s.width()<r&&(s.checkBounds(.5*r,0),s.checkBounds(.5*-r,0)),n&&s.height()<n&&(s.checkBounds(0,.5*n),s.checkBounds(0,.5*-n)),0!==i&&(s.maxX+=.5*i,s.minX-=.5*i,s.maxY+=.5*i,s.minY-=.5*i),It(s,e)}function It(t,e){const r=e.get3DTransformation(),n=t.toPolygon(),i=n.map((t=>r._apply(t).data())),s=Si.geom.NurbsSurface.byKnotsControlPointsWeights(1,1,[0,0,1,1],[0,0,1,1],[[i[3],i[2]],[i[0],i[1]]]),o=new Ei(s),a=new Di(o);return a.uScale=n[1].distanceTo(n[2]),a.vScale=n[0].distanceTo(n[1]),a}function Ot(t,e){function r(e,o){let a;e.inverted?(null==s&&(s=i.invert()),a=s):a=i;const{loop:u}=e,h=new mi(a);Object.assign(h.data,t.data),h.data.__origin=t,h.outerLoop=u,u.face=h,n.push(h);for(const t of e.nesting)t.level===o+2?r(t,o+2):t.level===o+1&&(e.inverted!==t.inverted?(t.loop.face=h,h.innerLoops.push(t.loop)):r(t,o+1))}const n=[],i=t.surface;let s=null;const o=Dt(t,e);for(const t of o)0===t.level&&r(t,0);return 0!==n.length&&(n[0].id=t.id),n}function Dt(t,e){function r(e){this.loop=e,this.workingPolygon=e.tess().map((e=>t.surface.workingPoint(e))),this.inverted=!G(this.workingPolygon)!==t.surface.inverted,this.pip=K(this.workingPolygon),this.nesting=[],this.level=0}function n(t,e){for(const r of e.workingPolygon)if(!t.pip(r).inside)return!1;return!0}const i=e.map((t=>new r(t)));for(let t=0;t<i.length;++t){const e=i[t];for(let r=0;r<i.length;++r){if(t===r)continue;const s=i[r];n(e,s)&&(e.nesting.push(s),s.level++)}}return i.filter((t=>0===t.level))}function Ft(t){return t[t.length-1]}function Bt(t,e){return Rt(t,e,Qi.UNION)}function Lt(t,e){return Rt(t,e,Qi.INTERSECT)}function Vt(t,e){return Rt(t,e,Qi.SUBTRACT)}function $t(t){t.invert()}function Rt(t,e,r){Wi.startBooleanSession(t,e,r),t=Yt(t),e=Yt(e),Wi.setBooleanWorkingOperands(t,e),r===Qi.SUBTRACT&&($t(e),r=Qi.INTERSECT);const n=tr(t,e);rr(n),Gt(t,e),Nr(t,e),or(t,e);const i=Ht(t,e,r);ar(t,e,r),zt(n,i);for(const t of n)t.op.initGraph();Ir(n);for(const t of n)t.op.detectedLoops=qt(t.surface,t.op);for(const t of n)for(const e of t.op.detectedLoops)e.link();Ut(n);let s=[];for(const t of n)Kt(t,t.op.detectedLoops,s);s=Jt(s);const o=new Mi;return s.forEach((t=>{t.shell=o,o.faces.push(t)})),ir(o),yi.validateToConsole(o),Wi.setBooleanResult(o),o}function Ut(t){function e(t){return!r.has(t)}const r=new Set;for(const e of t)for(const t of e.op.detectedLoops)r.add(t);for(const r of t)r.op.detectedLoops=r.op.detectedLoops.filter((t=>void 0===t.halfEdges.find((t=>e(t.twin().loop)))))}function zt(t,e){function r(t,e){const{decayed:n}=Ar.get(t);n?n.forEach((t=>r(t,e))):e.push(t)}Dr(t,(t=>void 0===e.find((({originFaces:e})=>e.indexOf(t)>-1))));for(const{facePrototypes:n,originFaces:i}of e)for(const{loops:e,surface:s}of n){const n=new mi(s);for(const t of e){const e=[];t.halfEdges.forEach((t=>r(t,e))),t.halfEdges=e,n.innerLoops.push(t),t.face=n,t.link()}nr(n),t.push(n);for(const t of i)t.op.newEdges.forEach((t=>vr(n,t)))}}function Yt(t){const e=t.clone();return Xt(t,e),ir(e),e}function Xt(t,e){for(let r=0;r<t.faces.length;r+=1)e.faces[r].analysisFace=t.faces[r]}function qt(t,e){e.graphEdges.sort(((t,e)=>Sr(t)-Sr(e))),Wi.startBooleanLoopDetection(e);const r=[],n=new Set;for(;;){let i=e.graphEdges.pop();if(!i)break;if(n.has(i))continue;const s=new pi(null);for(Wi.booleanLoopDetectionBeginLoop();i;){if(Wi.booleanLoopDetectionStep(i),n.add(i),s.halfEdges.push(i),s.halfEdges[0].vertexA===i.vertexB){r.push(s),Wi.booleanLoopDetectionSuccess(s);break}let o=e.vertexToEdge.get(i.vertexB);if(!o)break;if(o=o.filter((t=>t.vertexB!==i.vertexA||!jr(t,i))),i=sr(i,o,t),Wi.booleanLoopDetectionNextStep(o,i),n.has(i))break}}return r}function Zt(t,e){function r(t,e){function r(t,e){return t.env2D().pip(t.surface.workingPoint(e)).inside}for(const n of t.edges)if(r(e,n.vertexA.point))return!0;return!1}function n(t,e){const n=t.surface.simpleSurface,i=e.surface.simpleSurface;return!(void 0===n||void 0===i||"plane"!==n.TYPE||n.TYPE!==i.TYPE||!n.coplanarUnsigned(i))&&(r(t,e)||r(e,t))}const i=[];for(const r of t.faces)for(const t of e.faces)if(n(r,t)){let e=i.find((e=>e[0].has(r)||e[1].has(t)));e||(e=[new Set,new Set],i.push(e)),e[Gi].add(r),e[Ji].add(t),r.op.overlaps=e[Ji],t.op.overlaps=e[Gi]}return i}function Ht(t,e,r){const n=Zt(t,e);Wi.setOverlappingFaces(n);const i=[];for(const[t,e]of n){const n=Wt(Array.from(t),Array.from(e),r);i.push(n)}return i}function Wt(t,e,r){function n(t,e){function n(t,e){if(jr(t,e))if(Ar.markCollision(t,e),a.add(t),a.add(e),kr(t.edge),kr(e.edge),t.vertexA===e.vertexA){const r=t.twin().loop.face,n=e.twin().loop.face;if(!r.op.overlaps||!r.op.overlaps.has(n))throw new Yi({kind:Yi.KIND.UNSUPPORTED_CASE,code:"edge collision on face merge",relatedTopoObjects:[t,e],userMessage:"edges can't be coincident for this operation"});o.add(e)}else t.vertexA===e.vertexB&&(o.add(t),o.add(e))}function i(t,e){const n=e.edge.curve.middlePoint();t.rayCast(n).inside&&(kr(e.edge),cr(e.twin(),t,r)?Ar.setPriority(e,10):o.add(e))}function s(t,e){for(const r of t.edges)a.has(r)||i(e,r)}const a=new Set;for(const r of t.edges)for(const t of e.edges)n(r,t);s(t,e),s(e,t)}const i=[...t,...e],s=[];for(const t of i)for(const e of t.edges)s.push(e.vertexA.point);const o=new Set;for(const r of t)for(const t of e)n(r,t);const a=[];let u=null;for(const t of i){const e=new ns;for(const t of i)for(const r of t.edges)o.has(r)||null!=u&&!u.has(r)||e.add(r);u=new Set(e.graphEdges);const r=qt(t.surface,e);for(const t of r)for(const e of t.halfEdges)u.delete(e);0!==r.length&&a.push({loops:r,surface:Ct(s,t.surface.simpleSurface)})}return{facePrototypes:a,originFaces:i}}function Gt(t,e){const r=new Map;for(const n of t.vertices)for(const t of e.vertices)p(n.point,t.point)&&r.set(t,n);for(const t of e.faces)for(const e of t.edges){const t=r.get(e.vertexA),n=r.get(e.vertexB);t&&(e.vertexA=t),n&&(e.vertexB=n)}}function Jt(t){function e(t){for(const e of t.edges)if(Sr(e)>0||Sr(e.twin())>0||!0===Ar.get(e).affected)return!0;return!1}const r=new Set;for(const n of t)Qt(n,(t=>!(!r.has(t)&&!e(t)||(r.add(n),0))));const n=Array.from(r);return Wi.faceFilter(n,t),n}function Qt(t,e){const r=[t],n=new Set;for(;0!==r.length;)if(t=r.pop(),!n.has(t)){if(n.add(t),!0===e(t))return;for(const e of t.loops)for(const t of e.halfEdges){const e=t.twin().loop.face;if(null===e)throw new Yi({kind:Yi.KIND.INTERNAL_ERROR,relatedTopoObjects:[t]});r.push(e)}}}function Kt(t,e,r){const n=Ot(t,e);for(const t of n)r.push(t)}function tr(t,e){function r(t,e){for(const r of t.faces)e.push(r)}const n=[];return r(t,n),r(e,n),n}function rr(t){for(const e of t)nr(e)}function nr(t){t.op=new is(t)}function ir(t){for(const e of t.faces){e.op=null;for(const t of e.edges)Ar.clear(t),delete t.edge.data[es]}}function sr(t,e,r){function n(t){return t.tangent(t.vertexA.point)}e=e.slice();const i=t.tangent(t.vertexB.point).negate(),s=r.normal(t.vertexB.point);return e.sort(((t,e)=>{const r=er(i,n(t),s)-er(i,n(e),s);return g(r,0)?Sr(e)-Sr(t):r})),e[0]}function er(t,e,r){let n=t.dot(e);return g(n,1)?0:(n+=3,0>t.cross(e).dot(r)&&(n=4-n),n)}function or(t,e){function r(t,e){const r=n.get(t);r?e.forEach((t=>r.push(t))):n.set(t,e)}const n=new Map;for(const n of t.edges)for(const t of e.edges){const e=n.curve.intersectCurve(t.curve,Gn);if(0!==e.length){const i=[];r(n,e.map((({u0:t,p0:e})=>({u:t,p:e,vertexHolder:i})))),r(t,e.map((({u1:t,p1:e})=>({u:t,p:e,vertexHolder:i}))))}}for(const[t,e]of n){e.sort(((t,e)=>t.u-e.u));for(const{u:r,vertexHolder:n}of e)n[0]||(n[0]=ts.create(t.curve.point(r)))}for(let[t,e]of n)for(const{vertexHolder:r}of e){const e=gr(t,r[0]);null!==e&&(t=e[1])}}function hr(t,e,r,n){const i=t.middlePoint(),s=t.tangentAtPoint(i),o=e.normal(i),a=r.normal(i),u=o.cross(a);return n===Qi.UNION&&u._negate(),u.dot(s)>0||(t=t.invert()),t}function ur(t,e){const{point:r}=t.halfEdge1.vertexA,n=e.tangentAtPoint(r);Fr("tangent of originated curve and first halfEdge should be the same",f(n,t.halfEdge1.tangent(r))),Fr("tangent of originated curve and second halfEdge should be the opposite",f(n._negate(),t.halfEdge2.tangent(r)))}function ar(t,e,r){for(let n=0;n<t.faces.length;n+=1){const i=t.faces[n];for(let t=0;t<e.faces.length;t+=1){const n=e.faces[t],s=i.surface.intersectSurface(n.surface);for(let t of s){if(wr(t,i)||wr(t,n))continue;t=hr(t,i.surface,n.surface,r);const e=[];pr(t,i,e,Gi),pr(t,n,e,Ji),Wi.booleanFaceIntersection(i,n,t,e);const s=[];Mr(e,t,s,i,n),s.forEach((e=>{ur(e,t),vr(i,e.halfEdge1),vr(n,e.halfEdge2)}))}lr(i,n,r),lr(n,i,r)}}}function cr(t,e,r){const n=t.edge.curve.middlePoint(),i=t.tangent(n),s=t.loop.face.surface.normal(n).cross(i),o=e.surface.normal(n),a=s.dot(o);if(ss(a,0))throw Error("this case should be considered before calling this method");const u=a>0;return r===Qi.INTERSECT!==u}function fr(t,e,r){return cr(t,e,r)?t:t.twin()}function lr(t,e,r){for(const n of t.loops)for(const t of n.halfEdges)if(!Er(t.edge)&&Pr(t,e)){const n=fr(t,e,r);Wi.transferEdge(t,e,n);const i=n.twin();i.loop.face.op.markTransferredFrom(i),kr(i.edge),vr(e,i)}}function vr(t,e){return t.op.newEdges.push(e),Ar.setPriority(e,100),!0}function dr(t,e,r,n,i){let s=t.find((t=>t.point===e));return s||(void 0===r&&(r=n.param(e)),s=new Tr(e,r,i),t.push(s)),s}function wr(t,e){for(const r of e.edges)if(Cr(t,r))return!0;return!1}function pr(t,e,r,n){for(const i of e.loops)mr(t,i,r,n)}function mr(t,e,r,n){const i=new Set,{encloses:s}=e;for(const[e,o,a]of s)if(!i.has(a)&&t.passesThrough(a.point)){const i=_r(t,e,o);if(i===Ki.ENTERS||i===Ki.LEAVES){const e=dr(r,a.point,void 0,t,a);i===Ki.ENTERS?e.enters[n]=!0:e.leaves[n]=!0}}for(const i of e.halfEdges)yr(t,i,r,n)}function yr(t,e,r,n){const i=e.edge.curve.intersectCurve(t);for(const s of i){const{u0:i,u1:o}=s;if(null!==ts.find(s.p0))continue;const a=dr(r,s.p0,o,void 0,null);xr(t,e,a.point)?a.enters[n]=!0:a.leaves[n]=!0,a.edgeSplitInfo={edge:e,u:i}}}function Mr(t,e,r,n,i){function s(t){null!==t.edgeSplitInfo&&Or(c,t.edgeSplitInfo.edge.edge,t)}if(0===t.length)return;t.sort(((t,e)=>t.u-e.u));const o=t[0];let a=n.analysisFace.rayCast(o.point).strictInside,u=i.analysisFace.rayCast(o.point).strictInside,h=null;const c=new Map;for(const n of t){const t=a&&u;let i=!1;if(!0===n.enters[Gi]&&(a=!0,h=n),!0===n.leaves[Gi]&&(a=!1,i=!0),!0===n.enters[Ji]&&(u=!0,h=n),!0===n.leaves[Ji]&&(u=!1,i=!0),t&&i){let t=e;const i=h.vertex(),o=n.vertex();g(h.u,e.uMin)||([,t]=t.split(i.point)),g(n.u,e.uMax)||([t]=t.split(o.point));const a=new Bi(t,i,o);r.push(a),s(h),s(n)}}for(let[t,e]of c){e.sort((({edgeSplitInfo:{u:t}})=>t));for(const r of e)[,t]=gr(t,r.vertex())}}function gr(t,e){function r(t,e,r){const{halfEdges:n}=t.loop;n.splice(n.indexOf(t),1,e,r),e.loop=t.loop,r.loop=t.loop,e.prev=t.prev,e.prev.next=e,e.next=r,r.prev=e,r.next=t.next,r.next.prev=r,Ar.createIfEmpty(t).decayed=[e,r]}function n(t,e){const r=Sr(t);0!==r&&Ar.setPriority(e,r)}if(t.halfEdge1.vertexA===e||t.halfEdge1.vertexB===e)return null;const i=t.curve.split(e.point),s=new Bi(i[0],t.halfEdge1.vertexA,e),o=new Bi(i[1],e,t.halfEdge1.vertexB);return r(t.halfEdge1,s.halfEdge1,o.halfEdge1),r(t.halfEdge2,o.halfEdge2,s.halfEdge2),n(t.halfEdge1,s.halfEdge1),n(t.halfEdge1,o.halfEdge1),n(t.halfEdge2,o.halfEdge2),n(t.halfEdge2,s.halfEdge2),Er(t)&&(kr(s),kr(o)),[s,o]}function br(t,e,r,n,i){if(i&&p(n,e))throw new Yi({relatedTopoObjects:[e]});const s=r.negate();if(i&&p(s,e))throw new Yi({relatedTopoObjects:[e]});return er(s,n,t)>er(s,e,t)}function _r(t,e,r){const n=e.vertexB.point,i=e.loop.face.surface.normal(n),s=t.tangentAtPoint(n),o=e.tangentAtEnd(),a=r.tangentAtStart(),u=m(o,s),h=p(a,s);if(u&&h)return Ki.UNDEFINED;const c=s.negate(),l=m(o,c),f=p(a,c);if(l||f)return Ki.UNDEFINED;let d=Ki.UNDEFINED;if(u||h)return br(i,c,o,a)?Ki.LEAVES:Ki.ENTERS;const v=br(i,s,o,a);return d=v===br(i,c,o,a)?Ki.TANGENTS:v?Ki.ENTERS:Ki.LEAVES,d}function xr(t,e,r){const n=e.loop.face.surface.normal(r);return tt(e.tangent(r),t.tangentAtPoint(r),n)}function Ar(){this.priority=0}function Sr(t){return Ar.get(t).priority||0}function kr(t){let e=t.data[es];e||(e={},t.data[es]=e),e.transfered=!0}function Er(t){const e=t.data[es];return e&&e.transfered}function Tr(t,e,r){this.u=e,this.point=t,this.enters=[!1,!1],this.leaves=[!1,!1],this.edgeSplitInfo=null,this._vertex=r}function Nr(t,e){ts=new rs,ts.addVertices(t.vertices),ts.addVertices(e.vertices)}function jr(t,e){const r=t.tessellate();for(const t of r)if(!p(t,e.edge.curve.point(e.edge.curve.param(t))))return!1;return!0}function Cr(t,e){const r=e.tessellate();let n=0;for(let i=r.length-1;i>=0;i-=1){const s=r[i];if(!p(s,t.point(t.param(s)))){if(n>1)throw new Yi({kind:Yi.KIND.INVALID_INPUT,code:"edge partial tangency",relatedTopoObjects:[e]});return!1}n+=1}return!0}function Pr(t,e){const r=t.tessellate();for(let t=0;t<r.length;t+=1){const n=r[t],[i,s]=e.surface.param(n);if(!p(n,e.surface.point(i,s)))return!1}return e.rayCast(t.edge.curve.middlePoint()).inside}function Ir(t){if(t.find((t=>0!==t.op.collidedEdges.length))){const e=[];for(const r of t)for(const t of r.op.collidedEdges)e.push(t);throw new Yi({kind:Yi.KIND.INVALID_INPUT,relatedTopoObjects:e,userMessage:"unable to process coincident edges for this operation type"})}}function Or(t,e,r){let n=t.get(e);n||(n=[],t.set(e,n)),n.push(r)}function Dr(t,e){for(let r=t.length-1;r>=0;r-=1)e(t[r])||t.splice(r,1)}function Fr(t,e){if(!e)throw Error("ASSERTION FAILED: "+t)}function Br(t){const e=[],r=t=>e.push(t);return r("brep.ptr="+t.ptr),r("brep.valid="+t.valid),t.faces.forEach(((t,e)=>{r(`brep.faces[${e}].inverted=${t.inverted}`),r(`brep.faces[${e}].ptr=${t.ptr}`),r(`brep.faces[${e}].ref=${t.ref}`);const{surface:n,tess:i,loops:s}=t;r(`brep.faces[${e}].surface.TYPE=${n.TYPE}`);const o=n;r(`brep.faces[${e}].surface.direct=${o.direct}`),r(`brep.faces[${e}].surface.normal=[${o.normal}]`),r(`brep.faces[${e}].surface.origin=[${o.origin}]`);const a=n;r(`brep.faces[${e}].surface.degU=${a.degU}`),r(`brep.faces[${e}].surface.degV=${a.degV}`),r(`brep.faces[${e}].surface.knotsU=[${a.knotsU}]`),r(`brep.faces[${e}].surface.knotsV=[${a.knotsV}]`);const{weights:u,cp:h}=a;null==u||u.forEach(((t,n)=>{r(`brep.faces[${e}].surface.weights[${n}]=[${t}]`)})),null==h||h.forEach(((t,n)=>{r(`brep.faces[${e}].surface.cp[${n}]=[${t}]`)})),i&&i.forEach(((t,n)=>{const[i,s]=t;if(i){const t=i[0],s=i[1],o=i[2];r(`brep.faces[${e}].tess[${n}][trig]=[[${t}],[${s}],[${o}]]`)}if(s){const t=s[0],i=s[1],o=s[2];r(`brep.faces[${e}].tess[${n}][norm]=[[${t}],[${i}],[${o}]]`)}})),s.forEach(((t,n)=>{t.forEach(((t,i)=>{r(`brep.faces[${e}].loops[${n}].edge[${i}].edgeRef=${t.edgeRef}`),r(`brep.faces[${e}].loops[${n}].edge[${i}].a=[${t.a}]`),r(`brep.faces[${e}].loops[${n}].edge[${i}].b=[${t.b}]`),r(`brep.faces[${e}].loops[${n}].edge[${i}].inverted=${t.inverted}`);const{curve:s,curveBounds:o,tess:a}=t;r(`brep.faces[${e}].loops[${n}].edge[${i}].curve.TYPE=${s.TYPE}`);const u=s;r(`brep.faces[${e}].loops[${n}].edge[${i}].curve.a=[${u.a}]`),r(`brep.faces[${e}].loops[${n}].edge[${i}].curve.b=[${u.b}]`);const h=s;r(`brep.faces[${e}].loops[${n}].edge[${i}].curve.deg=${h.deg}`),h.cp.forEach(((t,s)=>{r(`brep.faces[${e}].loops[${n}].edge[${i}].curve.cp[${s}]=[${t}]`)})),r(`brep.faces[${e}].loops[${n}].edge[${i}].curve.knots=[${h.knots}]`),r(`brep.faces[${e}].loops[${n}].edge[${i}].curve.weights=[${h.weights}]`),r(`brep.faces[${e}].loops[${n}].edge[${i}].curveBounds=[${o}]`),null==a||a.forEach(((t,s)=>{r(`brep.faces[${e}].loops[${n}].edge[${i}].tess[${s}]=[${t}]`)})),r(`brep.faces[${e}].loops[${n}].edge[${i}].ptr=${t.ptr}`)}))}))})),e.join("\n")}function Lr(t,e,r,n){return $r(Vr(t,e,r),n)}function Vr(t,e,r){const n=(new Xn).set3(t).normalize();let i=new fi(n,n.dot((new Xn).set3(e)));return r&&(i=i.invert()),i}function $r(t,e){const r=new wi,n=t.get2DTransformation();for(const t of e.outerLoop.halfEdges)(t.edge.data.tessellation?t.edge.data.tessellation:t.edge.curve.tessellateToData()).forEach((t=>r.checkData(n.apply3(t))));return r.expand(10),It(r,t)}function Rr(t){const e=new Vi,r=new os;for(const n of t.faces){e.face();const i=!1===n.surface.direct,s=n.inverted!==i;e._face.data.tessellation={format:"verbose",data:Yr(n.tess,s,"PLANE"===n.surface.TYPE?n.surface.normal:void 0)},e._face.data.productionInfo=n.productionInfo,void 0!==n.ref&&(e._face.data.externals={ref:n.ref,ptr:n.ptr});for(const t of n.loops){e.loop();for(const n of t){const t=r.getData(n.inverted?n.b:n.a),i=r.getData(n.inverted?n.a:n.b);e.edge(t,i,(()=>zr(n.curve)),n.inverted,n.edgeRef),e.lastHalfEdge.edge.data.tessellation=n.tess,e.lastHalfEdge.edge.data.externals={ptr:n.ptr}}}try{e._face.surface=Ur(n.surface,n.inverted,s,e._face)}catch(t){e._face.surface=new Di(new hs)}}return e._shell.data.externals={ptr:t.ptr},e.build()}function Ur(t,e,r,n){let i;return"B-SPLINE"===t.TYPE?(i=new Di(Ei.construct(t.degU,t.degV,t.knotsU,t.knotsV,t.cp,t.weights),e),i._mirrored=!t.direct):i="PLANE"===t.TYPE?Lr(t.normal,t.origin,r,n):new Di(new hs),i}function zr(t){if("B-SPLINE"===t.TYPE)return new Ni(ki.construct(t.deg,t.knots,t.cp,t.weights))}function Yr(t,e,r){const n=[];if(!t)return n;for(let r=0;r<t.length;r+=1){let[i,s]=t[r];if(i=i.slice(),s){const t=!s.find((t=>null===t[0]||null===t[1]||null===t[2]));s=t?e?s.map((t=>L(t))):s.slice():void 0}e&&(i.reverse(),s&&s.reverse()),n.push([i,s])}r&&e&&(r=L(r));for(const[t,e]of n)if(e){const r=Z(t);0>V(Xr(e),r)&&(t.reverse(),e.reverse())}else r&&0>V(r,Z(t))&&t.reverse();return n}function Xr(t){const e=[0,0,0];return t.forEach((t=>P(e,t))),z(e),e}function qr(t,e,r,n,i){let s,o,a,u,h=e[0],c=n[0],l=0,f=0;c>h==c>-h?(s=h,h=e[++l]):(s=c,c=n[++f]);let d=0;if(t>l&&r>f)for(c>h==c>-h?(o=h+s,a=s-(o-h),h=e[++l]):(o=c+s,a=s-(o-c),c=n[++f]),s=o,0!==a&&(i[d++]=a);t>l&&r>f;)c>h==c>-h?(o=s+h,u=o-s,a=s-(o-u)+(h-u),h=e[++l]):(o=s+c,u=o-s,a=s-(o-u)+(c-u),c=n[++f]),s=o,0!==a&&(i[d++]=a);for(;t>l;)o=s+h,u=o-s,a=s-(o-u)+(h-u),h=e[++l],s=o,0!==a&&(i[d++]=a);for(;r>f;)o=s+c,u=o-s,a=s-(o-u)+(c-u),c=n[++f],s=o,0!==a&&(i[d++]=a);return 0===s&&0!==d||(i[d++]=s),d}function Zr(t,e){let r=e[0];for(let n=1;t>n;n++)r+=e[n];return r}function Hr(t){return new Float64Array(t)}function Wr(t,e,r,n,i,s,o){let a,u,h,c,l,f,d,p,m,v,g,y,x,_,b,w,S,z;const M=t-i,C=r-i,P=e-s,A=n-s;_=M*A,f=as*M,d=f-(f-M),p=M-d,f=as*A,m=f-(f-A),v=A-m,b=p*v-(_-d*m-p*m-d*v),w=P*C,f=as*P,d=f-(f-P),p=P-d,f=as*C,m=f-(f-C),v=C-m,S=p*v-(w-d*m-p*m-d*v),g=b-S,l=b-g,ds[0]=b-(g+l)+(l-S),y=_+g,l=y-_,x=_-(y-l)+(g-l),g=x-w,l=x-g,ds[1]=x-(g+l)+(l-w),z=y+g,l=z-y,ds[2]=y-(z-l)+(g-l),ds[3]=z;let E=Zr(4,ds),k=ls*o;if(E>=k||-E>=k)return E;if(l=t-M,a=t-(M+l)+(l-i),l=r-C,h=r-(C+l)+(l-i),l=e-P,u=e-(P+l)+(l-s),l=n-A,c=n-(A+l)+(l-s),0===a&&0===u&&0===h&&0===c)return E;if(k=vs*o+cs*Math.abs(E),E+=M*c+A*a-(P*h+C*u),E>=k||-E>=k)return E;_=a*A,f=as*a,d=f-(f-a),p=a-d,f=as*A,m=f-(f-A),v=A-m,b=p*v-(_-d*m-p*m-d*v),w=u*C,f=as*u,d=f-(f-u),p=u-d,f=as*C,m=f-(f-C),v=C-m,S=p*v-(w-d*m-p*m-d*v),g=b-S,l=b-g,ys[0]=b-(g+l)+(l-S),y=_+g,l=y-_,x=_-(y-l)+(g-l),g=x-w,l=x-g,ys[1]=x-(g+l)+(l-w),z=y+g,l=z-y,ys[2]=y-(z-l)+(g-l),ys[3]=z;const T=qr(4,ds,4,ys,ws);_=M*c,f=as*M,d=f-(f-M),p=M-d,f=as*c,m=f-(f-c),v=c-m,b=p*v-(_-d*m-p*m-d*v),w=P*h,f=as*P,d=f-(f-P),p=P-d,f=as*h,m=f-(f-h),v=h-m,S=p*v-(w-d*m-p*m-d*v),g=b-S,l=b-g,ys[0]=b-(g+l)+(l-S),y=_+g,l=y-_,x=_-(y-l)+(g-l),g=x-w,l=x-g,ys[1]=x-(g+l)+(l-w),z=y+g,l=z-y,ys[2]=y-(z-l)+(g-l),ys[3]=z;const N=qr(T,ws,4,ys,ps);_=a*c,f=as*a,d=f-(f-a),p=a-d,f=as*c,m=f-(f-c),v=c-m,b=p*v-(_-d*m-p*m-d*v),w=u*h,f=as*u,d=f-(f-u),p=u-d,f=as*h,m=f-(f-h),v=h-m,S=p*v-(w-d*m-p*m-d*v),g=b-S,l=b-g,ys[0]=b-(g+l)+(l-S),y=_+g,l=y-_,x=_-(y-l)+(g-l),g=x-w,l=x-g,ys[1]=x-(g+l)+(l-w),z=y+g,l=z-y,ys[2]=y-(z-l)+(g-l),ys[3]=z;const I=qr(N,ps,4,ys,ms);return ms[I-1]}function Gr(t,e,r,n,i,s){const o=(e-s)*(r-i),a=(t-i)*(n-s),u=o-a,h=Math.abs(o+a);return fs*h>Math.abs(u)?-Wr(t,e,r,n,i,s,h):u}function Jr(t,e){const r=t/(Math.abs(t)+Math.abs(e));return(e>0?3-r:1+r)/4}function Qr(t,e,r,n){const i=t-r,s=e-n;return i*i+s*s}function Kr(t,e,r,n,i,s,o,a){const u=t-o,h=e-a,c=r-o,l=n-a,f=i-o,d=s-a,p=c*c+l*l,m=f*f+d*d;return 0>u*(l*m-p*d)-h*(c*m-p*f)+(u*u+h*h)*(c*d-l*f)}function tn(t,e,r,n,i,s){const o=r-t,a=n-e,u=i-t,h=s-e,c=o*o+a*a,l=u*u+h*h,f=.5/(o*h-a*u),d=(h*c-a*l)*f,p=(o*l-u*c)*f;return d*d+p*p}function rn(t,e,r,n,i,s){const o=r-t,a=n-e,u=i-t,h=s-e,c=o*o+a*a,l=u*u+h*h,f=.5/(o*h-a*u);return{x:t+(h*c-a*l)*f,y:e+(o*l-u*c)*f}}function nn(t,e,r,n){if(n-r>20){let i=r+1,s=n;sn(t,r+n>>1,i),e[t[r]]>e[t[n]]&&sn(t,r,n),e[t[i]]>e[t[n]]&&sn(t,i,n),e[t[r]]>e[t[i]]&&sn(t,r,i);const o=t[i],a=e[o];for(;;){do{i++}while(e[t[i]]<a);do{s--}while(e[t[s]]>a);if(i>s)break;sn(t,i,s)}t[r+1]=t[s],t[s]=o,s-r>n-i+1?(nn(t,e,r,s-1),nn(t,e,i,n)):(nn(t,e,i,n),nn(t,e,r,s-1))}else for(let i=r+1;n>=i;i++){const n=t[i],s=e[n];let o=i-1;for(;o>=r&&e[t[o]]>s;)t[o+1]=t[o--];t[o+1]=n}}function sn(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}function en(t){return t[0]}function on(t){return t[1]}function hn(t,e,r=2){const n=e&&e.length,i=n?e[0]*r:t.length;let s=un(t,0,i,r,!0);const o=[];if(!s||s.next===s.prev)return o;let a,u,h;if(n&&(s=wn(t,e,s,r)),t.length>80*r){a=1/0,u=1/0;let e=-1/0,n=-1/0;for(let s=r;i>s;s+=r){const r=t[s],i=t[s+1];a>r&&(a=r),u>i&&(u=i),r>e&&(e=r),i>n&&(n=i)}h=Math.max(e-a,n-u),h=0!==h?32767/h:0}return cn(s,o,r,a,u,h,0),o}function un(t,e,r,n,i){let s;if(i===Vn(t,e,r,n)>0)for(let i=e;r>i;i+=n)s=Fn(i/n|0,t[i],t[i+1],s);else for(let i=r-n;i>=e;i-=n)s=Fn(i/n|0,t[i],t[i+1],s);return s&&Tn(s,s.next)&&(Bn(s),s=s.next),s}function an(t,e){if(!t)return t;e||(e=t);let r,n=t;do{if(r=!1,n.steiner||!Tn(n,n.next)&&0!==En(n.prev,n,n.next))n=n.next;else{if(Bn(n),n=e=n.prev,n===n.next)break;r=!0}}while(r||n!==e);return e}function cn(t,e,r,n,i,s,o){if(!t)return;!o&&s&&gn(t,n,i,s);let a=t;for(;t.prev!==t.next;){const u=t.prev,h=t.next;if(s?ln(t,n,i,s):fn(t))e.push(u.i,t.i,h.i),Bn(t),t=h.next,a=h.next;else if((t=h)===a){o?1===o?cn(t=vn(an(t),e),e,r,n,i,s,2):2===o&&dn(t,e,r,n,i,s):cn(an(t),e,r,n,i,s,1);break}}}function fn(t){const e=t.prev,r=t,n=t.next;if(En(e,r,n)>=0)return!1;const i=e.x,s=r.x,o=n.x,a=e.y,u=r.y,h=n.y,c=Math.min(i,s,o),l=Math.min(a,u,h),f=Math.max(i,s,o),d=Math.max(a,u,h);let p=n.next;for(;p!==e;){if(p.x>=c&&p.x<=f&&p.y>=l&&p.y<=d&&Sn(i,a,s,u,o,h,p.x,p.y)&&En(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function ln(t,e,r,n){const i=t.prev,s=t,o=t.next;if(En(i,s,o)>=0)return!1;const a=i.x,u=s.x,h=o.x,c=i.y,l=s.y,f=o.y,d=Math.min(a,u,h),p=Math.min(c,l,f),m=Math.max(a,u,h),v=Math.max(c,l,f),g=_n(d,p,e,r,n),y=_n(m,v,e,r,n);let x=t.prevZ,_=t.nextZ;for(;x&&x.z>=g&&_&&_.z<=y;){if(x.x>=d&&x.x<=m&&x.y>=p&&x.y<=v&&x!==i&&x!==o&&Sn(a,c,u,l,h,f,x.x,x.y)&&En(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,_.x>=d&&_.x<=m&&_.y>=p&&_.y<=v&&_!==i&&_!==o&&Sn(a,c,u,l,h,f,_.x,_.y)&&En(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;x&&x.z>=g;){if(x.x>=d&&x.x<=m&&x.y>=p&&x.y<=v&&x!==i&&x!==o&&Sn(a,c,u,l,h,f,x.x,x.y)&&En(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;_&&_.z<=y;){if(_.x>=d&&_.x<=m&&_.y>=p&&_.y<=v&&_!==i&&_!==o&&Sn(a,c,u,l,h,f,_.x,_.y)&&En(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function vn(t,e){let r=t;do{const n=r.prev,i=r.next.next;!Tn(n,i)&&Nn(n,r,r.next,i)&&In(n,i)&&In(i,n)&&(e.push(n.i,r.i,i.i),Bn(r),Bn(r.next),r=t=i),r=r.next}while(r!==t);return an(r)}function dn(t,e,r,n,i,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&kn(o,t)){let a=Dn(o,t);return o=an(o,o.next),a=an(a,a.next),cn(o,e,r,n,i,s,0),void cn(a,e,r,n,i,s,0)}t=t.next}o=o.next}while(o!==t)}function wn(t,e,r,n){const i=[];for(let r=0,s=e.length;s>r;r++){const o=un(t,e[r]*n,s-1>r?e[r+1]*n:t.length,n,!1);o===o.next&&(o.steiner=!0),i.push(xn(o))}i.sort(pn);for(let t=0;t<i.length;t++)r=mn(i[t],r);return r}function pn(t,e){let r=t.x-e.x;return 0===r&&(r=t.y-e.y,0===r)&&(r=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function mn(t,e){const r=yn(t,e);if(!r)return e;const n=Dn(r,t);return an(n,n.next),an(r,r.next)}function yn(t,e){let r=e;const n=t.x,i=t.y;let s,o=-1/0;if(Tn(t,r))return r;do{if(Tn(t,r.next))return r.next;if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){const t=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(n>=t&&t>o&&(o=t,s=r.x<r.next.x?r:r.next,t===n))return s}r=r.next}while(r!==e);if(!s)return null;const a=s,u=s.x,h=s.y;let c=1/0;r=s;do{if(n>=r.x&&r.x>=u&&n!==r.x&&An(h>i?n:o,i,u,h,h>i?o:n,i,r.x,r.y)){const e=Math.abs(i-r.y)/(n-r.x);In(r,t)&&(c>e||e===c&&(r.x>s.x||r.x===s.x&&Mn(s,r)))&&(s=r,c=e)}r=r.next}while(r!==a);return s}function Mn(t,e){return 0>En(t.prev,t,e.prev)&&0>En(e.next,t,t.next)}function gn(t,e,r,n){let i=t;do{0===i.z&&(i.z=_n(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,bn(i)}function bn(t){let e,r=1;do{let n,i=t;t=null;let s=null;for(e=0;i;){e++;let o=i,a=0;for(let t=0;r>t&&(a++,o=o.nextZ,o);t++);let u=r;for(;a>0||u>0&&o;)0===a||0!==u&&o&&i.z>o.z?(n=o,o=o.nextZ,u--):(n=i,i=i.nextZ,a--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;i=o}s.nextZ=null,r*=2}while(e>1);return t}function _n(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function xn(t){let e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function An(t,e,r,n,i,s,o,a){return(i-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(n-a)>=(r-o)*(e-a)&&(r-o)*(s-a)>=(i-o)*(n-a)}function Sn(t,e,r,n,i,s,o,a){return!(t===o&&e===a)&&An(t,e,r,n,i,s,o,a)}function kn(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Pn(t,e)&&(In(t,e)&&In(e,t)&&On(t,e)&&(En(t.prev,t,e.prev)||En(t,e.prev,e))||Tn(t,e)&&En(t.prev,t,t.next)>0&&En(e.prev,e,e.next)>0)}function En(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Tn(t,e){return t.x===e.x&&t.y===e.y}function Nn(t,e,r,n){const i=Cn(En(t,e,r)),s=Cn(En(t,e,n)),o=Cn(En(r,n,t)),a=Cn(En(r,n,e));return i!==s&&o!==a||!(0!==i||!jn(t,r,e))||!(0!==s||!jn(t,n,e))||!(0!==o||!jn(r,t,n))||!(0!==a||!jn(r,e,n))}function jn(t,e,r){return!(e.x>Math.max(t.x,r.x)||e.x<Math.min(t.x,r.x)||e.y>Math.max(t.y,r.y)||e.y<Math.min(t.y,r.y))}function Cn(t){return t>0?1:0>t?-1:0}function Pn(t,e){let r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Nn(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function In(t,e){return 0>En(t.prev,t,t.next)?En(t,e,t.next)>=0&&En(t,t.prev,e)>=0:0>En(t,e,t.prev)||0>En(t,t.next,e)}function On(t,e){let r=t,n=!1;const i=(t.x+e.x)/2,s=(t.y+e.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&i<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}function Dn(t,e){const r=Ln(t.i,t.x,t.y),n=Ln(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function Fn(t,e,r,n){const i=Ln(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Bn(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ln(t,e,r){return{i:t,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Vn(t,e,r,n){let i=0;for(let s=e,o=r-n;r>s;s+=n)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}function $n(t,e){const r=[],n=[],i=[];xs(r,t);let s=t.length;for(let t=0;t<e.length;t+=1)n.push(s),s+=e[t].length,xs(r,e[t]);const o=hn(As(r),n);for(let t=0;t<o.length;t+=3)i.push(o.slice(t,t+3));return{vertices:r,faces:i}}function Rn(t,e){_s(t),e.forEach(_s);const{vertices:r,faces:n}=$n(t,e),i=[];return n.forEach((t=>i.push(...t))),{vertices:r,faces:n,triangles:i}}function Un(t){const e={x:0,y:0,z:0},r={x:0,y:0,z:0},n=t.length;for(let i=0;n>i;i+=1)e.x+=t[i].x,e.y+=t[i].y,e.z+=t[i].z,r.x+=(t[i].y-t[(i+1)%n].y)*(t[i].z+t[(i+1)%n].z),r.y+=(t[i].z-t[(i+1)%n].z)*(t[i].x+t[(i+1)%n].x),r.z+=(t[i].x-t[(i+1)%n].x)*(t[i].y+t[(i+1)%n].y);if(Es(r.x)&&Es(r.y)&&Es(r.z))return;e.x/=n,e.y/=n,e.z/=n;const i=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);return r.x/=i,r.y/=i,r.z/=i,{normal:r,origin:e}}"function"==typeof SuppressedError&&SuppressedError;const zn=1e-6,Yn=zn*zn;class Xn{constructor(t=0,e=0,r=0){this.x=t||0,this.y=e||0,this.z=r||0}set(t,e,r){return this.x=t||0,this.y=e||0,this.z=r||0,this}set3(t){return this.x=t[0]||0,this.y=t[1]||0,this.z=t[2]||0,this}setV(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}multiply(t){return new Xn(this.x*t,this.y*t,this.z*t)}scale(t){return this.multiply(t)}_multiply(t){return this.set(this.x*t,this.y*t,this.z*t)}_scale(t){return this._multiply(t)}divide(t){return new Xn(this.x/t,this.y/t,this.z/t)}_divide(t){return this.set(this.x/t,this.y/t,this.z/t)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}copy(){return new Xn(this.x,this.y,this.z)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSquared(){return this.dot(this)}distanceToSquared(t){return this.minus(t).lengthSquared()}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}minus(t){return new Xn(this.x-t.x,this.y-t.y,this.z-t.z)}_minus(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}_minusXYZ(t,e,r){return this.x-=t,this.y-=e,this.z-=r,this}plusXYZ(t,e,r){return new Xn(this.x+t,this.y+e,this.z+r)}plus(t){return new Xn(this.x+t.x,this.y+t.y,this.z+t.z)}_plus(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}normalize(){const t=this.length();return 0===t?new Xn(0,0,0):new Xn(this.x/t,this.y/t,this.z/t)}unit(){return this.normalize()}_normalize(){const t=this.length();return 0===t?this.set(0,0,0):this.set(this.x/t,this.y/t,this.z/t)}_unit(){return this._normalize()}cross(t){return this.copy()._cross(t)}_cross(t){return this.set(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}negate(){return this.multiply(-1)}_negate(){return this._multiply(-1)}_perpXY(){return this.set(-this.y,this.x,this.z)}toArray(){return[this.x,this.y,this.z]}data(){return this.toArray()}copyToData(t){t[0]=this.x,t[1]=this.y,t[2]=this.z}angleBetween(t){const e=i(this.dot(t),-1,1),r=i(this.cross(t).length(),-1,1);return Math.atan2(r,e)}asUnitVector(){return h(this.lengthSquared(),1,Yn),this}static fromData(t){return(new Xn).set3(t)}}const{freeze:qn}=Object;qn(new Xn(0,0,0));const Zn=qn({X:qn(new Xn(1,0,0)),Y:qn(new Xn(0,1,0)),Z:qn(new Xn(0,0,1))}),Hn=Xn;class Wn{constructor(t,e){this.isLine=!0,this.p0=t,this.v=e}intersectSurface(t){if(t.isPlane){const e=t.normal.multiply(t.w);return t.normal.dot(e.minus(this.p0))/t.normal.dot(this.v)}throw Error("unsupported")}intersectCurve(t,e){if(t.isLine&&e.isPlane){const r=e.normal.cross(t.v)._normalize();return r.dot(t.p0.minus(this.p0))/r.dot(this.v)}throw Error("unsupported")}point(t){return this.p0.plus(this.v.multiply(t))}t(t){return t.minus(this.p0).dot(this.v)}pointOfSurfaceIntersection(t){this._pointsCache||(this._pointsCache=new Map);let e=this._pointsCache.get(t);if(!e){const r=this.intersectSurface(t);e=this.point(r),this._pointsCache.set(t,e)}return e}translate(t){return new Wn(this.p0.plus(t),this.v)}tessellate(t,e,r,n){}offset(){}}Wn.prototype.isLine=!0,Wn.fromTwoPlanesIntersection=(t,e)=>{const r=t.normal,n=e.normal,i=r.cross(n)._normalize(),s=t.toParametricForm(),o=e.toParametricForm(),a=s.r0.minus(o.r0),u=a.minus(n.multiply(a.dot(n))),h=o.r0.plus(u.multiply(r.dot(a)/r.dot(u)));return new Wn(h,i)},Wn.fromSegment=(t,e)=>new Wn(t,e.minus(t)._normalize());const Gn=.001,Jn=Gn*Gn,Qn=1e-12,Kn=.01*Gn;var ti="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==E?E:"undefined"!=typeof self?self:{},ri={},ni,ii=_(),si=b(ii);class ei{constructor(){this.mxx=1,this.mxy=0,this.mxz=0,this.tx=0,this.myx=0,this.myy=1,this.myz=0,this.ty=0,this.mzx=0,this.mzy=0,this.mzz=1,this.tz=0,this.applyNoTranslation=t=>this.__applyNoTranslation(t,new Xn),this.apply=t=>this.__apply(t,new Xn)}reset(){return this.mxx=1,this.mxy=0,this.mxz=0,this.tx=0,this.myx=0,this.myy=1,this.myz=0,this.ty=0,this.mzx=0,this.mzy=0,this.mzz=1,this.tz=0,this}setBasis(t){const e=t;return this.mxx=e[0].x,this.mxy=e[1].x,this.mxz=e[2].x,this.tx=0,this.myx=e[0].y,this.myy=e[1].y,this.myz=e[2].y,this.ty=0,this.mzx=e[0].z,this.mzy=e[1].z,this.mzz=e[2].z,this.tz=0,this}setBasis3(t){const e=t;return this.mxx=e[0][0],this.mxy=e[1][0],this.mxz=e[2][0],this.tx=0,this.myx=e[0][1],this.myy=e[1][1],this.myz=e[2][1],this.ty=0,this.mzx=e[0][2],this.mzy=e[1][2],this.mzz=e[2][2],this.tz=0,this}setBasisAxises(t,e,r){return this.mxx=t.x,this.mxy=e.x,this.mxz=r.x,this.tx=0,this.myx=t.y,this.myy=e.y,this.myz=r.y,this.ty=0,this.mzx=t.z,this.mzy=e.z,this.mzz=r.z,this.tz=0,this}setBasisAndTranslation(t,e){return this.setBasis(t),this.tx=e.x,this.ty=e.y,this.tz=e.z,this}setBasisAndTranslation3(t,e){return this.setBasis3(t),this.tx=e[0],this.ty=e[1],this.tz=e[2],this}getBasis3(){return[[this.mxx,this.myx,this.mzx],[this.mxy,this.myy,this.mzy],[this.mxz,this.myz,this.mzz]]}getTranslation3(){return[this.tx,this.ty,this.tz]}scale(t,e,r){return this.mxx*=t,this.myy*=e,this.mzz*=r,this}translate(t,e,r){return this.tx+=t,this.ty+=e,this.tz+=r,this}translateVec({x:t,y:e,z:r}){return this.tx+=t,this.ty+=e,this.tz+=r,this}set3x3(t,e,r,n,i,s,o,a,u){return this.mxx=t,this.mxy=e,this.mxz=r,this.myx=n,this.myy=i,this.myz=s,this.mzx=o,this.mzy=a,this.mzz=u,this}set3x4(t,e,r,n,i,s,o,a,u,h,c,l){return this.mxx=t,this.mxy=e,this.mxz=r,this.tx=n,this.myx=i,this.myy=s,this.myz=o,this.ty=a,this.mzx=u,this.mzy=h,this.mzz=c,this.tz=l,this}setMatrix(t){return this.mxx=t.mxx,this.mxy=t.mxy,this.mxz=t.mxz,this.tx=t.tx,this.myx=t.myx,this.myy=t.myy,this.myz=t.myz,this.ty=t.ty,this.mzx=t.mzx,this.mzy=t.mzy,this.mzz=t.mzz,this.tz=t.tz,this}setToMatrix4x4(t){t.set(this.mxx,this.mxy,this.mxz,this.tx,this.myx,this.myy,this.myz,this.ty,this.mzx,this.mzy,this.mzz,this.tz,0,0,0,1)}toArray(){return[[this.mxx,this.mxy,this.mxz,this.tx],[this.myx,this.myy,this.myz,this.ty],[this.mzx,this.mzy,this.mzz,this.tz]]}toFlatArray(){return[this.mxx,this.mxy,this.mxz,this.tx,this.myx,this.myy,this.myz,this.ty,this.mzx,this.mzy,this.mzz,this.tz]}invert(){return this.__invert(new ei)}_invert(){return this.__invert(this)}normalize(){return this.__normalize(new ei)}_normalize(){return this.__normalize(this)}__normalize(t){const e=this.getBasis3(),r=this.getTranslation3();return e.forEach(z),t.setBasisAndTranslation3(e,r),t}__invert(t){const e=this.mxx*(this.myy*this.mzz-this.mzy*this.myz)+this.mxy*(this.myz*this.mzx-this.mzz*this.myx)+this.mxz*(this.myx*this.mzy-this.mzx*this.myy);if(0===e)return null;const r=this.myy*this.mzz-this.myz*this.mzy,n=-this.myx*this.mzz+this.myz*this.mzx,i=this.myx*this.mzy-this.myy*this.mzx,s=-this.mxy*(this.myz*this.tz-this.mzz*this.ty)-this.mxz*(this.ty*this.mzy-this.tz*this.myy)-this.tx*(this.myy*this.mzz-this.mzy*this.myz),o=-this.mxy*this.mzz+this.mxz*this.mzy,a=this.mxx*this.mzz-this.mxz*this.mzx,u=-this.mxx*this.mzy+this.mxy*this.mzx,h=this.mxx*(this.myz*this.tz-this.mzz*this.ty)+this.mxz*(this.ty*this.mzx-this.tz*this.myx)+this.tx*(this.myx*this.mzz-this.mzx*this.myz),c=this.mxy*this.myz-this.mxz*this.myy,l=-this.mxx*this.myz+this.mxz*this.myx,f=this.mxx*this.myy-this.mxy*this.myx,d=-this.mxx*(this.myy*this.tz-this.mzy*this.ty)-this.mxy*(this.ty*this.mzx-this.tz*this.myx)-this.tx*(this.myx*this.mzy-this.mzx*this.myy);return t.mxx=r/e,t.mxy=o/e,t.mxz=c/e,t.tx=s/e,t.myx=n/e,t.myy=a/e,t.myz=l/e,t.ty=h/e,t.mzx=i/e,t.mzy=u/e,t.mzz=f/e,t.tz=d/e,t}combine(t,e){const r=t.mxx,n=t.mxy,i=t.mxz,s=t.tx,o=t.myx,a=t.myy,u=t.myz,h=t.ty,c=t.mzx,l=t.mzy,f=t.mzz,d=t.tz,p=e||new ei;return p.mxx=this.mxx*r+this.mxy*o+this.mxz*c,p.mxy=this.mxx*n+this.mxy*a+this.mxz*l,p.mxz=this.mxx*i+this.mxy*u+this.mxz*f,p.tx=this.mxx*s+this.mxy*h+this.mxz*d+this.tx,p.myx=this.myx*r+this.myy*o+this.myz*c,p.myy=this.myx*n+this.myy*a+this.myz*l,p.myz=this.myx*i+this.myy*u+this.myz*f,p.ty=this.myx*s+this.myy*h+this.myz*d+this.ty,p.mzx=this.mzx*r+this.mzy*o+this.mzz*c,p.mzy=this.mzx*n+this.mzy*a+this.mzz*l,p.mzz=this.mzx*i+this.mzy*u+this.mzz*f,p.tz=this.mzx*s+this.mzy*h+this.mzz*d+this.tz,p}combine3x3(t,e){const r=t.mxx,n=t.mxy,i=t.mxz,s=t.myx,o=t.myy,a=t.myz,u=t.mzx,h=t.mzy,c=t.mzz,l=e||new ei;return l.mxx=this.mxx*r+this.mxy*s+this.mxz*u,l.mxy=this.mxx*n+this.mxy*o+this.mxz*h,l.mxz=this.mxx*i+this.mxy*a+this.mxz*c,l.myx=this.myx*r+this.myy*s+this.myz*u,l.myy=this.myx*n+this.myy*o+this.myz*h,l.myz=this.myx*i+this.myy*a+this.myz*c,l.mzx=this.mzx*r+this.mzy*s+this.mzz*u,l.mzy=this.mzx*n+this.mzy*o+this.mzz*h,l.mzz=this.mzx*i+this.mzy*a+this.mzz*c,l}__applyNoTranslation(t,e){const{x:r}=t,{y:n}=t,{z:i}=t;return e.x=this.mxx*r+this.mxy*n+this.mxz*i,e.y=this.myx*r+this.myy*n+this.myz*i,e.z=this.mzx*r+this.mzy*n+this.mzz*i,e}_applyNoTranslation(t){return this.__applyNoTranslation(t,t)}_apply(t){return this.__apply(t,t)}__apply(t,e){const{x:r}=t,{y:n}=t,{z:i}=t;return e.x=this.mxx*r+this.mxy*n+this.mxz*i+this.tx,e.y=this.myx*r+this.myy*n+this.myz*i+this.ty,e.z=this.mzx*r+this.mzy*n+this.mzz*i+this.tz,e}apply3(t){return this.__apply3(t,[0,0,0])}_apply3(t){return this.__apply3(t,t)}__apply3([t,e,r],n){return n[0]=this.mxx*t+this.mxy*e+this.mxz*r+this.tx,n[1]=this.myx*t+this.myy*e+this.myz*r+this.ty,n[2]=this.mzx*t+this.mzy*e+this.mzz*r+this.tz,n}rotateWithSphericalAxis(t,e,r,n){const i=new Xn(Math.sin(t)*Math.cos(e),Math.sin(t)*Math.sin(e),Math.cos(t));return ei.rotateMatrix(r,i,n,this)}rotate(t,e,r){return ei.rotateMatrix(t,e,r,this)}static rotateMatrix(t,e,r,n){const i=Math.sin(t),s=Math.cos(t);return ei.rotationMatrix(s,i,e,r,n)}static rotationFromVectorToVector(t,e,r,n){const i=t.cross(e),s=t.dot(e),o=i.length();return ei.rotationMatrix(s,o,i,r,n)}static rotationMatrix(t,e,r,n,i){let s,o,a;const u=i||new ei;if(r===Zn.X||r===Zn.Y||r===Zn.Z)s=r.x,o=r.y,a=r.z;else{const t=r.length();if(0===t)return u;s=r.x/t,o=r.y/t,a=r.z/t}const h=n.x,c=n.y,l=n.z;return u.mxx=t+s*s*(1-t),u.mxy=s*o*(1-t)-a*e,u.mxz=s*a*(1-t)+o*e,u.tx=h*(1-u.mxx)-c*u.mxy-l*u.mxz,u.myx=o*s*(1-t)+a*e,u.myy=t+o*o*(1-t),u.myz=o*a*(1-t)-s*e,u.ty=c*(1-u.myy)-h*u.myx-l*u.myz,u.mzx=a*s*(1-t)-o*e,u.mzy=a*o*(1-t)+s*e,u.mzz=t+a*a*(1-t),u.tz=l*(1-u.mzz)-h*u.mzx-c*u.mzy,u}setTranslation(t,e,r){return this.tx=t,this.ty=e,this.tz=r,this}}Object.freeze(new ei);const oi=Object.freeze([Zn.X,Zn.Y,Zn.Z]);var hi,ui,ai,ci;Object.freeze({XY:oi,XZ:[Zn.X,Zn.Z,Zn.Y],ZY:[Zn.Z,Zn.Y,Zn.X]});class fi{static by3Points(t,e,r){const n=e.minus(t),i=r.minus(t),s=n.cross(i)._normalize(),o=t.dot(s);return new fi(s,o)}constructor(t,e){hi.set(this,void 0),ui.set(this,void 0),ai.set(this,void 0),ci.set(this,void 0),this.normal=t,this.w=e}calculateBasis(){return H(this.normal)}basis(){return r(this,hi,"f")||n(this,hi,this.calculateBasis(),"f"),r(this,hi,"f")}intersectForSameClass(t){return Wn.fromTwoPlanesIntersection(this,t)}translate(t){return new fi(this.normal,this.normal.dot(this.normal.multiply(this.w)._plus(t)))}invert(){return new fi(this.normal.multiply(-1),-this.w)}get2DTransformation(){return r(this,ui,"f")||n(this,ui,this.get3DTransformation().invert(),"f"),r(this,ui,"f")}get3DTransformation(){if(!r(this,ai,"f")){const t=(new ei).setBasis(this.basis()),e=new ei;e.tz=this.w,n(this,ai,t.combine(e),"f")}return r(this,ai,"f")}coplanarUnsigned(t){return p(this.normal.multiply(this.w),t.normal.multiply(t.w))}equalsForSameClass(t){return p(this.normal,t.normal)&&v(this.w,t.w)}toParametricForm(){if(!r(this,ci,"f")){const[t,e,r]=H(this.normal);n(this,ci,new li(this.normal.multiply(this.w),t,e),"f")}return r(this,ci,"f")}toUV(t){return this.get2DTransformation().apply(t)}fromUV(t,e){return this.get3DTransformation()._apply(new Hn(t,e,0))}domainU(){return[5e-324,Number.MAX_VALUE]}domainV(){return[5e-324,Number.MAX_VALUE]}tangentPlane(){return this}middle(){return[0,0]}}hi=new WeakMap,ui=new WeakMap,ai=new WeakMap,ci=new WeakMap,fi.XY=new fi(Zn.Z,0),fi.XZ=new fi(Zn.Y,0),fi.YZ=new fi(Zn.X,0),fi.prototype.TYPE="plane",fi.prototype.isPlane=!0;class li{constructor(t,e,r){this.r0=t,this.r1=e,this.r2=r}equation(t,e){return this.r0+this.r1.multiply(t)+this.r2.multiply(e)}}let vi=0;class di{constructor(){this.data={},this.op=null,Object.defineProperty(this,"refId",{value:vi++,writable:!1})}}class wi{constructor(){this.minX=Number.MAX_VALUE,this.minY=Number.MAX_VALUE,this.minZ=Number.MAX_VALUE,this.maxX=-Number.MAX_VALUE,this.maxY=-Number.MAX_VALUE,this.maxZ=-Number.MAX_VALUE}checkBounds(t,e,r=0){this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,e),this.minZ=Math.min(this.minZ,r),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,e),this.maxZ=Math.max(this.maxZ,r)}checkPoint(t){this.checkBounds(t.x,t.y,t.z)}checkData([t,e,r]){this.checkBounds(t,e,r)}center(){return new Xn(this.minX+(this.maxX-this.minX)/2,this.minY+(this.maxY-this.minY)/2,this.minZ+(this.maxZ-this.minZ)/2)}min(){return new Xn(this.minX,this.minY,this.minZ)}max(){return new Xn(this.maxX,this.maxY,this.maxZ)}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}depth(){return this.maxZ-this.minZ}expand(t){this.minX-=t,this.minY-=t,this.minZ-=t,this.maxX+=t,this.maxY+=t,this.maxZ+=t}toPolygon(){return[new Xn(this.minX,this.minY,0),new Xn(this.maxX,this.minY,0),new Xn(this.maxX,this.maxY,0),new Xn(this.minX,this.maxY,0)]}}class pi extends di{constructor(t){super(),this.encloses={[Symbol.iterator]:()=>Q(this.halfEdges)},this.face=t,this.halfEdges=[]}isCCW(t){return pi.isPolygonCCWOnSurface(this.asPolygon(),t)}asPolygon(){return this.halfEdges.map((t=>t.vertexA.point))}link(){const{length:t}=this.halfEdges;for(let e=0;t>e;e+=1){const r=(e+1)%t,n=this.halfEdges[e],i=this.halfEdges[r];n.next=i,i.prev=n,n.loop=this}}tess(){const t=[];for(const e of this.halfEdges){const r=e.edge.curve.tessellate();e.inverted&&r.reverse(),r.pop();for(const e of r)t.push(e)}return t}static isPolygonCCWOnSurface(t,e){const r=e.simpleSurface.get2DTransformation(),n=J(t.map((t=>r.apply(t)))),i=t.length,s=(n+1)%i,o=(i+n-1)%i,a=t[n],u=t[s].minus(a);return a.minus(t[o]).cross(u).dot(e.normal)>=0}}class mi extends di{constructor(t){super(),this.loops={[Symbol.iterator]:()=>rt(this)},this.edges={[Symbol.iterator]:()=>nt(this)},this.surface=t,this.shell=null,this.outerLoop=new pi(this),this.innerLoops=[]}get id(){return this.data.id}set id(t){this.data.id=t}createWorkingPolygon(){return[this.outerLoop,...this.innerLoops].map((t=>t.tess().map((t=>this.surface.workingPoint(t)))))}env2D(){if(void 0===this.__2d){const t=this.createWorkingPolygon(),[e,...r]=t;this.__2d={pip:K(e,r),workingPolygon:t}}return this.__2d}getAnyHalfEdge(){let t=this.outerLoop.halfEdges[0];return!t&&this.innerLoops[0]&&(t=this.innerLoops[0].halfEdges[0]),t}getAnyVertex(){return this.getAnyHalfEdge().vertexA}rayCast(t,e){function r(e){return e.edge.curve.point(e.edge.curve.param(t))}e=e||this.surface;for(const e of this.edges)if(p(t,e.vertexA.point))return{inside:!0,strictInside:!1,vertex:e.vertexA};for(const e of this.edges)if(e.edge.curve.passesThrough(t))return{inside:!0,strictInside:!1,edge:e};let n=null;for(const e of this.edges){const i=r(e),s=t.distanceToSquared(i);(null===n||s<n.dist)&&(n={dist:s,pt:i,edge:e})}let i=null;p(n.pt,n.edge.vertexA.point)?i=[n.edge.prev,n.edge,n.edge.vertexA]:p(n.pt,n.edge.vertexB.point)&&(i=[n.edge,n.edge.next,n.edge.vertexB]);const s=e.normal(n.pt),o=(i?i[2].point:n.pt).minus(t)._normalize();let a;if(null!==i){const[t,e]=i;a=t.tangentAtEnd().plus(e.tangentAtStart())._normalize()}else a=n.edge.tangent(n.pt);const u=!tt(a,o,s);return{inside:u,strictInside:u}}}class yi{constructor(){this.errors=[]}validateShell(t){for(const e of t.faces)e.shell!==t&&this.addError("FACE_REFERS_TO_WRONG_SHELL","face refers to a shell it doesn't belong to",{face:e,shell:t}),this.validateFace(e)}validateFace(t){for(const e of[t.outerLoop,...t.innerLoops])t!==e.face&&this.addError("LOOP_REFERS_TO_WRONG_FACE","loop refers to different face it belongs to",{loop:e,face:t}),this.validateLoop(e)}validateLoop(t){const{halfEdges:e}=t,r=e.length;if(0!==r)for(let n=0;r>n;n+=1){const i=(n+1)%r,s=e[n],o=e[i];if(s.loop!==t&&this.addError("HALF_EDGE_REFERS_TO_WRONG_LOOP","half edge refers to different loop it belongs to",{loop:t,he:s}),s.vertexB!==o.vertexA&&this.addError("VERTICES_OF_HALF_EDGE_NOT_CONNECTED","starting point of the following half edge should identically the same as ending of a half edge",{curr:s,next:o}),s.next!==o&&this.addError("HALF_EDGE_NEXT_POINTER_INCORRECT","half edge's next pointer doesn't refer to real next half edge",{curr:s,next:o}),o.prev!==s&&this.addError("HALF_EDGE_PREV_POINTER_INCORRECT","half edge's prev pointer doesn't refer to prior half edge",{next:o,curr:s}),s.edge){const t=s.twin();s.edge!==t.edge&&this.addError("EDGE_OF_TWIN_DIFFERENT","edge of twin doesn't match to the half edge's edge",{he:s,twin:t}),t.vertexB!==s.vertexA&&this.addError("TWIN_START_VERTEX_INCORRECT","a twin has incorrect start vertex, should be identical to the end vertex of the half edge",{he:s,twin:t}),t.vertexA!==s.vertexB&&this.addError("TWIN_END_VERTEX_INCORRECT","a twin has incorrect end vertex, should be identical to the start vertex of the half edge",{he:s,twin:t})}else this.addError("EDGE_FOR_HALF_EDGE_NOT_SET","half edge doesn't refer to an edge",{he:s})}}addError(t,e,r){Object.assign(r,{code:t,message:e}),this.errors.push(r)}}yi.validateToConsole=t=>{const e=new yi;e.validateShell(t);for(const t of e.errors);e.errors.length},yi.validate=t=>{const e=new yi;return e.validateShell(t),e.errors};class Mi extends di{constructor(){super(),this.vertices={[Symbol.iterator]:()=>it(this)},this.edges={[Symbol.iterator]:()=>st(this.faces)},this.faces=[]}clone(){const t=new Map;for(const e of this.edges)t.set(e,e.clone());const e=new Mi;for(const r of this.faces){const n=new mi(r.surface);Object.assign(n.data,r.data);const i=(e,r)=>{for(const n of e.halfEdges){const e=t.get(n.edge);r.halfEdges.push(n.inverted?e.halfEdge2:e.halfEdge1)}r.link(),Object.assign(r.data,e.data)};i(r.outerLoop,n.outerLoop);for(const t of r.innerLoops){const e=new pi(n);i(t,e),n.innerLoops.push(e)}e.faces.push(n)}return e.faces.forEach((t=>t.shell=e)),Object.assign(e.data,this.data),e}transform(t){for(const e of this.vertices)e.point=t.apply(e.point);const e=new Set;for(const r of this.edges)e.has(r.curve)||(e.add(r.curve),r.curve=r.curve.transform(t));for(const r of this.faces)e.has(r.surface)||(e.add(r.surface),r.surface=r.surface.transform(t))}invert(){for(const t of this.faces){t.surface=t.surface.invert();for(const t of this.edges)t.invert();for(const e of t.loops){for(let t=0;t<e.halfEdges.length;t+=1)e.halfEdges[t]=e.halfEdges[t].twin();e.halfEdges.reverse(),e.link()}}if(this.data.inverted=!this.data.inverted,0!==yi.validate(this).length)throw Error("unable to invert")}traverse(t){for(const e of this.faces)t(e);for(const e of this.edges)t(e);for(const e of this.vertices)t(e)}}class gi extends di{constructor(t){super(),this.point=t}}var bi={exports:{}},_i,xi=ot(),Ai=b(xi);const Si=Ai;Si.eval.Analyze.rationalSurfaceClosestParam;class ki{static construct(t,e,r,n){return new ki(Si.geom.NurbsCurve.byKnotsControlPointsWeights(t,e,r,n))}static deserialize({degree:t,knots:e,cp:r,weights:n}){return ki.construct(t,e,r,n)}constructor(t){this.nurbs=t,this.data=t.asNurbs()}domain(){return ht(this.data)}degree(){return this.data.degree}transform(t){const e=this.nurbs.transform(t);return new ki(e)}point(t){return this.nurbs.point(t)}param(t){return this.nurbs.closestParam(t)}eval(t,e){return Si.eval.Eval.rationalCurveDerivatives(this.data,t,e)}knots(){return ut(this.data.knots)}invert(){const t=wt(this.data);return dt(t),new ki(new Si.geom.NurbsCurve(t))}split(t){const e=Si.eval.Divide.curveSplit(this.data,t);e.forEach((t=>vt(t)));const r=e.map((t=>new ki(new Si.geom.NurbsCurve(t))));return[r[0],r[1]]}serialize(){return{degree:this.nurbs.degree(),knots:this.nurbs.knots(),cp:this.nurbs.controlPoints(),weights:this.nurbs.weights()}}asCurveBSplineData(){return{TYPE:"B-SPLINE",deg:this.nurbs.degree(),knots:this.nurbs.knots(),cp:this.nurbs.controlPoints(),weights:this.nurbs.weights()}}}class Ei{static construct(t,e,r,n,i,s){return new Ei(Si.geom.NurbsSurface.byKnotsControlPointsWeights(t,e,r,n,i,s))}constructor(t){this.isMirrored=!1,this.data=t.asNurbs(),this.verb=t;const{min:e,max:r}=t.domainU(),{min:n,max:i}=t.domainV();this.uMin=e,this.uMax=r,this.vMin=n,this.vMax=i,this.domainU=[e,r],this.domainV=[n,i],this.knotsU=ut(this.verb.knotsU()),this.knotsV=ut(this.verb.knotsV())}degreeU(){return this.verb.degreeU()}degreeV(){return this.verb.degreeV()}param(t){return this.verb.closestParam(t)}point(t,e){return this.verb.point(t,e)}eval(t,e,r){return this.verb.derivatives(t,e,r)}normal(t,e){return this.verb.normal(t,e)}isoCurve(t,e){const r=Si.eval.Make.surfaceIsocurve(this.data,t,e),n=new Si.geom.NurbsCurve(r);return new ki(n)}static loft(t,e){return new Ei(Si.geom.NurbsSurface.byLoftingCurves([t.impl.nurbs,e.impl.nurbs],1))}transform(t){return new Ei(this.verb.transform(t))}asSurfaceBSplineData(){return{TYPE:"B-SPLINE",degU:this.verb.degreeU(),degV:this.verb.degreeV(),knotsU:this.verb.knotsU(),knotsV:this.verb.knotsV(),weights:this.verb.weights(),cp:this.verb.controlPoints()}}}const Ti=Si.eval.Tess.rationalSurfaceAdaptive;Si.eval.Tess.rationalSurfaceAdaptive=(t,e)=>pt("tess",[e?e.maxDepth:"undefined"],t,(()=>Ti(t,e)));class Ni{constructor(t,e,r){this.impl=t,[e,r]=this.impl.domain(),this.uMin=e,this.uMax=r,this.uMid=.5*(r-e)}get degree(){return this.impl.degree()}translate(t){const e=(new ei).translate(t.x,t.y,t.z);return this.transform(e)}transform(t){return new Ni(this.impl.transform(t.toArray()),this.uMin,this.uMax)}tangentAtPoint(t){let e=this.impl.param(t.data());return h(e,this.uMax,.001)&&(e-=.001),this.tangentAtParam(e)}tangentAtParam(t){return kt(this.impl.eval(t,1)[1])._normalize()}param(t){return this.impl.param(t.data())}split(t){return this.splitByParam(this.param(t))}splitByParam(t){return g(t,this.uMin)||g(t,this.uMax)||t<this.uMin||t>this.uMax?null:this.impl.split(t).map((t=>new Ni(t)))}point(t){return kt(this.impl.point(t))}tessellateToData(t,e){return ji(this.impl,this.uMin,this.uMax,t,e)}tessellate(t,e){return this.tessellateToData(t||1,e||1).map((t=>kt(t)))}boundary(){return[this.uMin,this.uMax]}intersectCurve(t){function e(t){for(const e of n)if(i(t.p0,e.p0))return;n.push(t)}function r(r,n,s){const o=r.impl.point(s),a=n.impl.param(o);if(!n.isInside(a))return;const u=n.impl.point(a);i(o,u)&&e(r===t?{u0:a,u1:s,p0:u,p1:o}:{u0:s,u1:a,p0:o,p1:u})}let n=[];const i=y;return r(this,t,this.uMin),r(this,t,this.uMax),r(t,this,t.uMin),r(t,this,t.uMax),yt(this.impl,t.impl,this.boundary(),t.boundary(),ji).forEach((t=>e(t))),n.forEach((t=>{t.p0=kt(t.p0),t.p1=kt(t.p1)})),n=n.filter((({u0:e,u1:r})=>{const n=this.tangentAtParam(e),i=t.tangentAtParam(r);return!p(n,i)&&!m(n,i)})),n}isInside(t){return t>=this.uMin&&t<=this.uMax}invert(){return new Ni(this.impl.invert())}startPoint(){return this.point(this.uMin)}endPoint(){return this.point(this.uMax)}middlePoint(){return this.__middlePoint||(this.__middlePoint=this.point(this.uMid))}passesThrough(t){return d(0,t.distanceToSquared(this.point(this.param(t))))}static createLinearCurve(t,e){const r=Si.geom.NurbsCurve.byKnotsControlPointsWeights(1,[0,0,1,1],[t.data(),e.data()]);return new Ni(new ki(r))}}const ji=(t,e,r,n,i)=>pt("tess",[e,r,n,i],t,(()=>Et(t,e,r,n,i)));class Ci{constructor(t){this.curve=t;const[e,r]=this.curve.domain();this.uMin=e,this.uMax=r}wrapParam(t){return this.uMax-(t-this.uMin)}domain(){return this.curve.domain()}degree(){return this.curve.degree()}transform(t){return new Ci(this.curve.transform(t))}point(t){return this.curve.point(this.wrapParam(t))}param(t){return this.wrapParam(this.curve.param(t))}eval(t,e){const r=this.curve.eval(this.wrapParam(t),e);return r.length>1&&B(r[1]),r}knots(){return this.curve.knots()}invert(){return this.curve}split(t){return this.curve.split(this.wrapParam(t)).map((t=>new Ci(t))).reverse()}}class Pi{constructor(t,e,r){this.curve=t,this.boundA=e,this.boundB=r,this._knots=[e],t.knots().forEach((t=>t>e&&r>t&&this._knots.push(t))),this._knots.push(r)}boundParam(t){return Math.min(this.boundB,Math.max(this.boundA,t))}domain(){return[this.boundA,this.boundB]}degree(){return this.curve.degree()}transform(t){return new Pi(this.curve.transform(t),this.boundA,this.boundB)}point(t){return this.curve.point(this.boundParam(t))}param(t){return this.boundParam(this.curve.param(t))}eval(t,e){return this.curve.eval(this.boundParam(t),e)}knots(){return this._knots}invert(){return new Ci(this.curve)}split(t){return[new Pi(this.curve,this.boundA,t),new Pi(this.curve,t,this.boundB)]}static splitCurve(t,e){const[r,n]=t.domain();return[new Pi(t,r,e),new Pi(t,e,n)]}}class Ii{constructor(t,e){this.surface=t,this.u=e}domain(){return[this.surface.vMin,this.surface.vMax]}transform(t){throw Error("unsupported")}point(t){return this.surface.point(this.u,t)}param(t){return this.surface.param(t)[1]}eval(t,e){const r=this.surface.eval(this.u,t,e),n=[];for(let t=0;e>t;t+=1)n[t]=r[t][0];return n}knots(){return this.surface.knotsV}invert(){return new Ci(this)}split(t){return Pi.splitCurve(this,t)}degree(){return this.surface.degreeV()}}class Oi{constructor(t,e){this.surface=t,this.v=e}domain(){return[this.surface.uMin,this.surface.uMax]}transform(t){throw Error("unsupported")}point(t){return this.surface.point(t,this.v)}param(t){return this.surface.param(t)[0]}eval(t,e){const r=this.surface.eval(t,this.v,e),n=[];for(let t=0;e>t;t+=1)n[t]=r[t][1];return n}knots(){return this.surface.knotsU}invert(){return new Ci(this)}split(t){return Pi.splitCurve(this,t)}degree(){return this.surface.degreeU()}}class Di{constructor(t,e){this.uScale=1,this.vScale=1,this.impl=t;const[r,n]=t.domainU,[i,s]=t.domainV;this.uMin=this.uMax=this.vMin=this.vMax=this.uMid=this.vMid=0,Object.assign(this,{uMin:r,uMax:n,vMin:i,vMax:s,uMid:.5*(n-r),vMid:.5*(s-i)}),this.inverted=!0===e}get simpleSurface(){return this._simpleSurface||(this._simpleSurface=Nt(this))}get mirrored(){return this._mirrored||(this._mirrored=Di.isMirrored(this))}normal(t){const e=this.impl.param(t.data()),r=Tt(this.impl.normal(e[0],e[1]));return this.inverted&&r._negate(),r._normalize(),r}normalUV(t,e){const r=Tt(this.impl.normal(t,e));return this.inverted&&r._negate(),r._normalize()}normalInMiddle(){return this.normalUV(this.uMid,this.vMid)}pointInMiddle(){return this.point(this.uMid,this.vMid)}southWestPoint(){return this.point(this.uMin,this.vMin)}southEastPoint(){return this.point(this.uMax,this.vMin)}northEastPoint(){return this.point(this.uMax,this.vMax)}northWestPoint(){return this.point(this.uMin,this.vMax)}param(t){return this.impl.param(t.data())}point(t,e){return Tt(this.impl.point(t,e))}workingPoint(t){return this.createWorkingPoint(this.impl.param(t.data()),t)}createWorkingPoint(t,e){const r=new Xn(t[0],t[1],0)._multiply(Di.WORKING_POINT_SCALE_FACTOR);return this.mirrored&&(r.x*=-1),r.__3D=e,r}workingPointTo3D(t){if(void 0===t.__3D){const e=t.multiply(Di.WORKING_POINT_UNSCALE_FACTOR);this.mirrored&&(e.x*=-1),t.__3D=this.point(e.x,e.y)}return t.__3D}static isMirrored(t){if(void 0!==t.impl.isMirrored)return t.impl.isMirrored;const e=t.isoCurveAlignU(t.uMin).tangentAtParam(t.uMin),r=t.isoCurveAlignV(t.vMin).tangentAtParam(t.vMin);return 0>e.cross(r).dot(t.normalUV(t.uMin,t.vMin))}intersectSurface(t,e){return mt(this.impl,t.impl,this.inverted!==t.inverted).map((t=>new Ni(t)))}invert(){const t=new Di(this.impl,!this.inverted);return t.uScale=this.uScale,t.vScale=this.vScale,t}isoCurve(t,e){let r;return r=this.impl.isoCurve?this.impl.isoCurve(t,e):e?new Oi(this.impl,t):new Ii(this.impl,t),new Ni(r)}isoCurveAlignU(t){return this.isoCurve(t,!0)}isoCurveAlignV(t){return this.isoCurve(t,!1)}tangentPlane(t,e){const r=this.normalUV(t,e);return new fi(r,r.dot(this.point(t,e)))}tangentPlaneInMiddle(){return this.tangentPlane(this.uMid,this.vMid)}transform(t){const e=t.toArray();return new Di(this.impl.transform(e),this.inverted)}}Di.WORKING_POINT_SCALE_FACTOR=1e3,Di.WORKING_POINT_UNSCALE_FACTOR=1/Di.WORKING_POINT_SCALE_FACTOR;class Fi extends di{constructor(t,e,r,n){super(),this.edge=t,this.inverted=e,this.vertexA=r,this.vertexB=n,this.loop=null,this.next=null,this.prev=null}twin(){return this.edge.halfEdge1===this?this.edge.halfEdge2:this.edge.halfEdge1}tangentAtStart(){return this.tangent(this.vertexA.point)}tangentAtEnd(){return this.tangent(this.vertexB.point)}tangent(t){const e=this.edge.curve.tangentAtPoint(t)._normalize();return this.inverted&&e._negate(),e}tessellate(t,e){let r=this.edge.curve.tessellate(t,e);return this.inverted&&(r=r.slice().reverse()),r}insertAfter(t){t.loop=this.loop;const{next:e}=this;this.next=t,t.next=e,e.prev=t,t.prev=this;const r=this.loop.halfEdges.indexOf(this);this.loop.halfEdges.splice(r+1,0,t)}delete(){const{next:t}=this,{prev:e}=this;e.next=t,t.prev=e,this.loop.halfEdges=this.loop.halfEdges.filter((t=>t!==this))}replace(t){this.edge.halfEdge1===this?this.edge.halfEdge1=t:this.edge.halfEdge2=t,t.edge=this.edge,t.loop=this.loop,t.prev=this.prev,t.prev.next=t,t.next=this.next,t.next.prev=t}}class Bi extends di{constructor(t,e,r){super(),this.curve=t,this.halfEdge1=new Fi(this,!1,e,r),this.halfEdge2=new Fi(this,!0,r,e)}static fromCurve(t){const e=new gi(t.startPoint()),r=new gi(t.endPoint());return new Bi(t,e,r)}invert(){const t=this.halfEdge1;this.halfEdge1=this.halfEdge2,this.halfEdge2=t,this.halfEdge1.inverted=!1,this.halfEdge2.inverted=!0,this.curve=this.curve.invert()}clone(){const t=new Bi(this.curve,this.halfEdge1.vertexA,this.halfEdge1.vertexB);return Object.assign(t.data,this.data),Object.assign(t.halfEdge1.data,this.halfEdge1.data),Object.assign(t.halfEdge2.data,this.halfEdge2.data),t}splitByPoint(t){const[e,r]=this.curve.split(t),n=Bi.fromCurve(e),i=Bi.fromCurve(r);this.halfEdge1.insertAfter(n.halfEdge1),n.halfEdge1.insertAfter(i.halfEdge1);let s=this.halfEdge2.loop.halfEdges.indexOf(this.halfEdge2)-1;-1===s&&(s=this.halfEdge2.loop.halfEdges.length-1),this.halfEdge2.loop.halfEdges[s].insertAfter(i.halfEdge2),i.halfEdge2.insertAfter(n.halfEdge2),this.halfEdge2.delete(),this.halfEdge1.delete()}getHalfEdge(t){return t(this.halfEdge1)?this.halfEdge1:t(this.halfEdge2)?this.halfEdge2:null}}class Li{constructor(){this.index=new Map}addEdge(t,e){t.halfEdge1&&this.addHalfEdge(t.halfEdge1,e),t.halfEdge2&&this.addHalfEdge(t.halfEdge2,e)}addHalfEdge(t,e){this._edgesForVertex(t.vertexA).add([t,e])}_edgesForVertex(t){let e=this.index.get(t);return e||(e=new Set,this.index.set(t,e)),e}getHalfEdge(t,e,r){const n=this.index.get(t);if(n)for(const[t,i]of n)if(t.vertexB===e&&(void 0===r||r===i))return t;return null}getOrCreateHalfEdge(t,e,r,n,i){let s=this.getHalfEdge(t,e,i);if(null===s){let o;r&&(o=r()),o||(o=Ni.createLinearCurve(t.point,e.point));const a=new Bi(o,n?e:t,n?t:e);s=n?a.halfEdge2:a.halfEdge1,this.addEdge(a,i)}return s}}class Vi{constructor(){this._shell=new Mi,this._face=null,this._loop=null,this.edgeIndex=new Li}get lastHalfEdge(){return this._loop.halfEdges[this._loop.halfEdges.length-1]}face(t){return this._face=new mi(t||null),this._shell.faces.push(this._face),this._loop=null,this}loop(t){if(null===this._loop?this._loop=this._face.outerLoop:(this._loop=new pi(null),this._face.innerLoops.push(this._loop)),this._loop.face=this._face,t)for(let e=0;e<t.length;e+=1)this.edge(t[e],t[(e+1)%t.length]);return this}edgeTrim(t,e,r){return this.edge(t,e,(()=>{const n=r.param(t.point),i=(r=r.splitByParam(n)[1]).param(e.point);return r=r.splitByParam(i)[0]})),this}edge(t,e,r,n,i){const s=this.edgeIndex.getOrCreateHalfEdge(t,e,r,n,i);return this._loop.halfEdges.push(s),this}vertex(t,e,r){return new gi(new Hn(t,e,r))}build(){for(const t of this._shell.faces){t.shell=this._shell;for(const e of t.loops)e.link();null===t.surface&&(t.surface=Ct(t.outerLoop.tess()))}for(const t of this._shell.faces)for(const e of t.edges){const r=e.twin();if(null===r.loop){const e=new mi(t.surface);e.outerLoop.halfEdges.push(r),e.outerLoop.link()}}return this._shell}}class $i{static line(t,e){return new Ai.geom.Line(t,e)}static arc(t,e,r,n,i,s){return new Ai.geom.Arc(t,e,r,n,i,s)}static freeSurface(t,e,r,n){return Ai.geom.NurbsSurface.byKnotsControlPointsWeights(t,e,r,n)}static sweptSurface(t,e){return new Ai.geom.SweptSurface(t,e)}}class Ri extends ki{static constructLine(t,e){return new ki($i.line(t,e))}}class Ui extends ki{static constructArc(t,e,r,n,i,s){return new ki($i.arc(t,e,r,n,i,s))}}class zi extends Ei{static constructSwept(t,e){return new Ei(new Si.geom.SweptSurface(t,e))}}class Yi extends Error{constructor({kind:t,code:e,relatedTopoObjects:r,userMessage:n}=Xi){super(`[${t}] ${e||""} ${n}`),this.kind=t||Yi.KIND.INTERNAL_ERROR,this.code=e,this.relatedTopoObjects=r,this.userMessage=n}TYPE=Yi}const Xi={};Yi.KIND={INTERNAL_ERROR:"INTERNAL_ERROR",UNSUPPORTED_CASE:"UNSUPPORTED_CASE",INVALID_INPUT:"INVALID_INPUT",INVALID_PARAMS:"INVALID_PARAMS"},Yi.ALGORITHM_ERROR_KINDS=["INTERNAL_ERROR","UNSUPPORTED_CASE","INVALID_INPUT"];class qi{constructor(){this.booleanSessions=[]}startBooleanSession(t,e,r){this.currentBooleanSession=new Zi(t,e,r),this.booleanSessions.push(this.currentBooleanSession)}setBooleanWorkingOperands(t,e){this.currentBooleanSession.workingOperandA=t,this.currentBooleanSession.workingOperandB=e}setBooleanResult(t){this.currentBooleanSession.result=t}startBooleanLoopDetection(t){this.currentBooleanSession.loopDetection.push({id:this.currentBooleanSession.loopDetection.length+1,steps:[],detectedLoops:[],graph:t.graphEdges.slice()})}booleanLoopDetectionBeginLoop(){Ft(this.currentBooleanSession.loopDetection).steps.push({type:"TRY_LOOP"})}booleanLoopDetectionStep(t){Ft(this.currentBooleanSession.loopDetection).steps.push({type:"TRY_EDGE",edge:t})}booleanLoopDetectionSuccess(t){const e=Ft(this.currentBooleanSession.loopDetection);e.detectedLoops.push(t),e.steps.push({type:"LOOP_FOUND"})}booleanLoopDetectionNextStep(t,e){Ft(this.currentBooleanSession.loopDetection).steps.push({type:"NEXT_STEP_ANALYSIS",candidates:t,winner:e})}transferEdge(t,e,r){this.currentBooleanSession.transferedEdges.push({edge:t,face:e,chosenEdge:r})}faceFilter(t,e){this.currentBooleanSession.faceFilter.connectedToAffectedFaces=t,this.currentBooleanSession.faceFilter.allFaces=e}setOverlappingFaces(t){this.currentBooleanSession.overlappingFacesGroups=t}booleanFaceIntersection(t,e,r,n){this.currentBooleanSession.faceIntersections.push({faceA:t,faceB:e,curve:r,nodes:n})}markEdge(t,e,r){this.currentBooleanSession.markedEdges.push({id:t,edge:e,color:r})}}class Zi{constructor(t,e,r){this.id=Hi++,this.type=r,this.inputOperandA=t,this.inputOperandB=e,this.loopDetection=[],this.transferedEdges=[],this.mergeFacesLoopDetection=[],this.currentLoopDetection=null,this.overlappingFacesGroups=[],this.markedEdges=[],this.faceIntersections=[],this.faceFilter={connectedToAffectedFaces:null,allFaces:null}}}let Hi=1;var Wi=new qi;const Gi=0,Ji=1,Qi={UNION:"UNION",INTERSECT:"INTERSECT",SUBTRACT:"SUBTRACT"},Ki={UNDEFINED:0,ENTERS:1,LEAVES:2,TANGENTS:3};Ar.EMPTY=new Ar,Ar.get=function(t){return t.data[es]?t.data[es]:Ar.EMPTY},Ar.createIfEmpty=function(t){return t.data[es]||(t.data[es]=new Ar),t.data[es]},Ar.clear=function(t){delete t.data[es]},Ar.setPriority=function(t,e){Ar.createIfEmpty(t).priority=e},Ar.markAffected=function(t){Ar.createIfEmpty(t).affected=!0},Ar.markCollision=function(t,e){function r(t){Ar.markAffected(t),Ar.markAffected(t.next),Ar.markAffected(t.prev)}r(t),r(e)},Ar.addPriority=function(t,e){Ar.createIfEmpty(t).priority+=e},Tr.prototype.vertex=function(){return this._vertex||(this._vertex=ts.create(this.point)),this._vertex};let ts=null,rs=class{constructor(){this.vertices=[]}addVertices(t){for(const e of t)this.vertices.push(e)}find(t){for(const e of this.vertices)if(p(t,e.point))return e;return null}create(t,e){let r=this.find(t);if(null===r)r=new gi(t),this.vertices.push(r);else if(void 0!==e)return e(r);return r}};class ns{constructor(){this.vertexToEdge=new Map,this.graphEdges=[]}add(t){Or(this.vertexToEdge,t.vertexA,t),this.graphEdges.push(t)}}class is extends ns{constructor(t){super(),this.face=t,this.newEdges=[],this.collidedEdges=[],this.overlaps=null}markTransferredFrom(t){this.transferedFrom||(this.transferedFrom=new Set),this.transferedFrom.add(t)}initGraph(){this.vertexToEdge.clear();for(const t of this.face.edges)this.addToGraph(t);for(const t of this.newEdges)this.addToGraph(t)}addToGraph(t){if(this.transferedFrom&&this.transferedFrom.has(t))return;const e=this.findOppositeEdge(t);e&&this.collidedEdges.push(e,t);let r=this.vertexToEdge.get(t.vertexA);if(r)for(const e of r)t.vertexB===e.vertexB&&jr(t,e)&&this.collidedEdges.push(e,t);else r=[],this.vertexToEdge.set(t.vertexA,r);r.push(t),this.graphEdges.push(t)}findOppositeEdge(t){const e=this.vertexToEdge.get(t.vertexB);if(e)for(const r of e)if(t.vertexA===r.vertexB&&jr(t,r))return r;return null}}const ss=v,es="__BOOLEAN_ALGORITHM_DATA__";class os{constructor(){this.vertices=[]}get(t,e,r){for(const n of this.vertices){const{x:i,y:s,z:o}=n.point;if(M(t,e,r,i,s,o))return n}const n=new gi(new Hn(t,e,r));return this.vertices.push(n),n}getPoint({x:t,y:e,z:r}){return this.get(t,e,r)}getData([t,e,r]){return this.get(t,e,r)}}class hs{constructor(){this.uMax=this.uMin=this.vMax=this.vMin=0,this.domainU=[0,1],this.domainV=[0,1],this.knotsU=[0,1],this.knotsV=[0,1],this.isMirrored=!1}degreeU(){return 1}degreeV(){return 1}param(t){return[0,0]}point(t,e){return[0,0,0]}eval(t,e,r){return[[0,0,0]]}normal(t,e){return[0,0,1]}transform(t){return this}}const us=11102230246251565e-32,as=134217729,cs=(3+8*us)*us,fs=(3+16*us)*us,ls=(2+12*us)*us,vs=(9+64*us)*us*us,ds=Hr(4),ws=Hr(8),ps=Hr(12),ms=Hr(16),ys=Hr(4),Ms=Math.pow(2,-52),gs=new Uint32Array(512);class bs{static from(t,e=en,r=on){const n=t.length,i=new Float64Array(2*n);for(let s=0;n>s;s++){const n=t[s];i[2*s]=e(n),i[2*s+1]=r(n)}return new bs(i)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw Error("Expected coords to contain numbers.");this.coords=t;const r=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*r),this._halfedges=new Int32Array(3*r),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:r,_hullTri:n,_hullHash:i}=this,s=t.length>>1;let o=1/0,a=1/0,u=-1/0,h=-1/0;for(let e=0;s>e;e++){const r=t[2*e],n=t[2*e+1];o>r&&(o=r),a>n&&(a=n),r>u&&(u=r),n>h&&(h=n),this._ids[e]=e}const c=(o+u)/2,l=(a+h)/2;let f,d,p;for(let e=0,r=1/0;s>e;e++){const n=Qr(c,l,t[2*e],t[2*e+1]);r>n&&(f=e,r=n)}const m=t[2*f],v=t[2*f+1];for(let e=0,r=1/0;s>e;e++){if(e===f)continue;const n=Qr(m,v,t[2*e],t[2*e+1]);r>n&&n>0&&(d=e,r=n)}let g=t[2*d],y=t[2*d+1],x=1/0;for(let e=0;s>e;e++){if(e===f||e===d)continue;const r=tn(m,v,g,y,t[2*e],t[2*e+1]);x>r&&(p=e,x=r)}let _=t[2*p],b=t[2*p+1];if(x===1/0){for(let e=0;s>e;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];nn(this._ids,this._dists,0,s-1);const e=new Uint32Array(s);let r=0;for(let t=0,n=-1/0;s>t;t++){const i=this._ids[t],s=this._dists[i];s>n&&(e[r++]=i,n=s)}return this.hull=e.subarray(0,r),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(0>Gr(m,v,g,y,_,b)){const t=d,e=g,r=y;d=p,g=_,y=b,p=t,_=e,b=r}const w=rn(m,v,g,y,_,b);this._cx=w.x,this._cy=w.y;for(let e=0;s>e;e++)this._dists[e]=Qr(t[2*e],t[2*e+1],w.x,w.y);nn(this._ids,this._dists,0,s-1),this._hullStart=f;let S=3;r[f]=e[p]=d,r[d]=e[f]=p,r[p]=e[d]=f,n[f]=0,n[d]=1,n[p]=2,i.fill(-1),i[this._hashKey(m,v)]=f,i[this._hashKey(g,y)]=d,i[this._hashKey(_,b)]=p,this.trianglesLen=0,this._addTriangle(f,d,p,-1,-1,-1);for(let s,o,a=0;a<this._ids.length;a++){const u=this._ids[a],h=t[2*u],c=t[2*u+1];if(a>0&&Ms>=Math.abs(h-s)&&Ms>=Math.abs(c-o))continue;if(s=h,o=c,u===f||u===d||u===p)continue;let l=0;for(let t=0,e=this._hashKey(h,c);t<this._hashSize&&(l=i[(e+t)%this._hashSize],-1===l||l===r[l]);t++);l=e[l];let m,v=l;for(;m=r[v],Gr(h,c,t[2*v],t[2*v+1],t[2*m],t[2*m+1])>=0;)if(v=m,v===l){v=-1;break}if(-1===v)continue;let g=this._addTriangle(v,u,r[v],-1,-1,n[v]);n[u]=this._legalize(g+2),n[v]=g,S++;let y=r[v];for(;m=r[y],0>Gr(h,c,t[2*y],t[2*y+1],t[2*m],t[2*m+1]);)g=this._addTriangle(y,u,m,n[u],-1,n[y]),n[u]=this._legalize(g+2),r[y]=y,S--,y=m;if(v===l)for(;m=e[v],0>Gr(h,c,t[2*m],t[2*m+1],t[2*v],t[2*v+1]);)g=this._addTriangle(m,u,v,-1,n[v],n[m]),this._legalize(g+2),n[m]=g,r[v]=v,S--,v=m;this._hullStart=e[u]=v,r[v]=e[y]=u,r[u]=y,i[this._hashKey(h,c)]=u,i[this._hashKey(t[2*v],t[2*v+1])]=v}this.hull=new Uint32Array(S);for(let t=0,e=this._hullStart;S>t;t++)this.hull[t]=e,e=r[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(Jr(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:r,coords:n}=this;let i=0,s=0;for(;;){const o=r[t],a=t-t%3;if(s=a+(t+2)%3,-1===o){if(0===i)break;t=gs[--i];continue}const u=o-o%3,h=a+(t+1)%3,c=u+(o+2)%3,l=e[s],f=e[t],d=e[h],p=e[c];if(Kr(n[2*l],n[2*l+1],n[2*f],n[2*f+1],n[2*d],n[2*d+1],n[2*p],n[2*p+1])){e[t]=p,e[o]=l;const n=r[c];if(-1===n){let e=this._hullStart;do{if(this._hullTri[e]===c){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,n),this._link(o,r[s]),this._link(s,c);const a=u+(o+1)%3;i<gs.length&&(gs[i++]=a)}else{if(0===i)break;t=gs[--i]}}return s}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,r,n,i,s){const o=this.trianglesLen;return this._triangles[o]=t,this._triangles[o+1]=e,this._triangles[o+2]=r,this._link(o,n),this._link(o+1,i),this._link(o+2,s),this.trianglesLen+=3,o}}const _s=t=>{const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()},xs=(t,e)=>{t.push(...e)},As=t=>{const e=[];for(let r=0;r<t.length;r+=1)e.push(t[r].x),e.push(t[r].y);return e};class Ss{constructor(t,e){this.x=0,this.y=0,this.x=t||0,this.y=e||0}equals(t){const e=this.x-t.x,r=this.y-t.y;return zn*zn>e*e+r*r}}class ks{static tessellateShell(t,e=[1,1]){const r=t=>{for(let e=0;e+2<t.length;e+=3){const r=t[e+1];t[e+1]=t[e+2],t[e+2]=r}},n=t.faces.filter((t=>t.surface.impl instanceof hs)).map((t=>{const{tessellation:e}=t.data,r=[];e.data.forEach((t=>{const[e,n]=t;for(let t=0;3>t;t+=1){const i=e[t],s=n[t];r.push({position:i,normal:s})}}));const n=[];for(let t=0;t<r.length;t+=1)n[t]=t;return{points:r,triangles:n}})),i=t.faces.filter((t=>!(t.surface.impl instanceof hs))).map((t=>{const n=(t=>[t.outerLoop,...t.innerLoops].map((e=>e.tess().map((e=>t.surface.param(e))))))(t);if(1===n.length){const i=n[0],s=(t=>{for(let i=0;i<t.length;i+=1){const s=(i+1)%t.length;if(e=t[0>i-1?i-1+t.length:i-1],r=t[i],0>((n=t[s])[1]-e[1])*(r[0]-n[0])-(n[0]-e[0])*(r[1]-n[1]))return i}var e,r,n;return-1})(i);if(0>s){const n=i.map((r=>{const n=r,i=t.surface.point(n[0],n[1]),s=[i.x,i.y,i.z],o=t.surface.normal(i),a=[o.x,o.y,o.z];return n[0]*=t.surface.uScale*e[0],n[1]*=t.surface.vScale*e[1],{position:s,normal:a,uv:n}})),{triangles:s}=bs.from(n.map((t=>t.uv)));return!0!==t.surface.inverted&&r(s),{points:n,triangles:[...s]}}}const i=t=>new Ss(t[0],t[1]),[s,...o]=n,a=s.map(i),u=o.map((t=>t.map(i))),{vertices:h,triangles:c}=Rn(a,u);return t.surface.inverted&&r(c),{points:h.map((r=>{const n=[r.x,r.y],i=t.surface.point(n[0],n[1]),s=[i.x,i.y,i.z],o=t.surface.normal(i),a=[o.x,o.y,o.z];return n[0]*=t.surface.uScale*e[0],n[1]*=t.surface.vScale*e[1],{position:s,normal:a,uv:n}})),triangles:c}})),s=[];return n.length>0&&s.push(this.produceTessGeometryFor(n)),i.length>0&&s.push(this.produceTessGeometryFor(i)),s}static produceTessGeometryFor(t){for(;t.length>1;){const e=t.shift(),r=t.shift();e&&r&&t.push(this.combineTessTriangles(e,r))}return t[0]}static combineTessTriangles(t,e){const r=[...e.triangles];for(let n=0;n<e.triangles.length;n+=1)r[n]+=t.points.length;return{points:[...t.points,...e.points],triangles:[...t.triangles,...r]}}}const Es=t=>zn>Math.abs(t);t.BREPValidator=yi,t.BrepBuilder=Vi,t.BrepCurve=Ni,t.BrepSurface=Di,t.Edge=Bi,t.Face=mi,t.NurbsArc=Ui,t.NurbsCurve=ki,t.NurbsLine=Ri,t.NurbsSurface=Ei,t.NurbsSweptSurface=zi,t.Plane=fi,t.Shell=Mi,t.TessellateShell=ks,t.Vertex=gi,t.VertexFactory=os,t.dumpBrepOutputData=Br,t.getApproximatePlane=Un,t.getPlaneNurbsForm=Lr,t.intersect=Lt,t.readBrep=Rr,t.subtract=Vt,t.union=Bt},n(r)}(Pr,Pr.exports)),Pr.exports}function _(t,e,r,n){const i=[];for(let t=0;t<e.getCurveCount();t+=1)for(let n=0;n<r.getCurveCount();n+=1){const s=e.getCurveSegment(t),o=r.getCurveSegment(n);if(void 0===s||void 0===o)return[];{const a=s.overlap(o);if(a){const u=o.overlap(s);u&&i.push(new zr(new Yr(e,t,a),new Yr(r,n,u)))}else{const a=s.intersect(o);if(a.length>1)throw Error("multi intersecting curve not implemented.");if(1===a.length){const s=a[0];i.push(new Xr(new qr(e,t,s.tA),new qr(r,n,s.tB)))}}}}i.sort(((t,e)=>Wr(t,e,1)));const s=[...i].sort(((t,e)=>Wr(t,e,0))),o=new Map,a=new Set,u=[],h=[...i];for(let r=500;r>0&&h.length>1;r-=1){const r=e.clone(t.clone()).drop(0),c=h[0],l=$r.start;let f=c,d=l,p=en(f,!0,d),m=5e3;do{m-=1;const e=on(f,d,p,n);!e&&f instanceof zr&&(d=f.getOtherSpanSide(Hr(!0),d));const u=nn(t,r,o,a,e?i:s,e,f,d),h=r.findEntryIndex();if(h!==r.getNILIndex()){r.drop(0,h);break}if(!u)break;f=u.nextIntersectPnt,d=u.nextSide,p=en(f,e,d),!e&&f instanceof zr&&(d=f.getOtherSpanSide(Hr(!0),d))}while(m>0&&0==(f===c&&d===l));const v=new Set;for(let t=0;t<r.getCurveCount();t+=1){const e=o.get(r.getCurveSegment(t));if(void 0!==e){const t=e.currentIntersectPnt.getLoop(Hr(e.traceTargetOrTool));h.filter((r=>Kr(t,e.traceTargetOrTool,e.currentSide,r,e.currentIntersectPnt)||r instanceof zr&&(Kr(t,e.traceTargetOrTool,$r.start,r,e.currentIntersectPnt)||Kr(t,e.traceTargetOrTool,$r.end,r,e.currentIntersectPnt)))).forEach((t=>v.add(t)))}}r.getCurveCount()>0&&u.push(r.combineColinearCurves(t,n).clone(t,n)),v.forEach((t=>{const e=h.indexOf(t);0>e||h.splice(e,1),a.add(t)}))}return u}function x(t,e,r,n){const i=_(t,e,r,n);return m((()=>hn(t,i,e,r,n)),"reverse joint error."),i}function A(t,e,r,n){let i=!1;const s=[],o=new Set;for(let a=0;a<e.length;a+=1)for(let u=0;u<r.length;u+=1)if(e[a]!==r[u]){const h=e[a].getEnvelope(),c=r[u].getEnvelope();if(!h||!c||h.intersects(c)){const h=x(t,e[a],r[u],n);h.length>0&&(o.add(e[a]),o.add(r[u]),i=!0),s.push(...h)}}return s.push(...e.filter((t=>!o.has(t)))),s.push(...r.filter((t=>!o.has(t)))),{unionLoops:s,hasIntersect:i}}function S(t,e){return!!v(t.radius,e.radius)&&t.center.distanceToSquared(e.center.as())<=V.tolerence*V.tolerence&&t.normal.distanceToSquared(e.normal.as())<=V.tolerence*V.tolerence}"function"==typeof SuppressedError&&SuppressedError;class k{constructor(){this.table={}}keys(){return Object.keys(this.table)}get(t){const e=this.table[t];if(void 0!==e)return e}has(t){return t in this.table}set(t,e){this.table[t]=e}delete(t){delete this.table[t]}}var E="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},N={exports:{}},j,C=n(),P;!function(t){t.Vector2d="Vector2d",t.Vector3d="Vector3d",t.Point2d="Point2d",t.Point3d="Point3d",t.ParamUV="ParamUV",t.Circle="Circle",t.Line="Line",t.Curve="Curve",t.CurveData="CurveData",t.CurveId="CurveId",t.CurvePnt="CurvePnt",t.Surface="Surface",t.SurfaceData="SurfaceData",t.Plane="Plane",t.Envelope="Envelope",t.CurveLoop="CurveLoop",t.CurveSegment="CurveSegment",t.CurveSegmentId="CurveSegmentId",t.CurveSegmentData="CurveSegmentData",t.CurveSegmentPnt="CurveSegmentPnt",t.LineSegment="LineSegment",t.ArcSegment="ArcSegment",t.NameEngine="NameEngine"}(P||(P={}));class I{constructor(){this.hash={}}getHashObject(){return this.hash}getProp(t){return this.hash[t]}setProp(t,e){return this.hash[t]=e,this.hash[t]}}const O=-1,D=-1;let F=class extends I{constructor(t){super(),this.id=void 0!==t?t:O}Id(){return this.id}getHashKey(){return this.id.toString()}};r([C.DeclareProperty],F.prototype,"id",void 0),F=r([C.DeclareObject(P.CurveId)],F);let B=class extends I{constructor(t){super(),this.id=void 0!==t?t:D}Id(){return this.id}getHashKey(){return this.id.toString()}};var L;r([C.DeclareProperty],B.prototype,"id",void 0),B=r([C.DeclareObject(P.CurveSegmentId)],B),t.NameEngine=L=class extends I{constructor(){super(...arguments),this.currentCurveId=O,this.currentCurveSegmentId=D,this.curveHash=new k,this.curveSegmentHash=new k}clone(){const t=new L;return t.currentCurveId=this.currentCurveId,t.currentCurveSegmentId=this.currentCurveSegmentId,t}restore(t){for(let e=this.getCurrentCurveId().Id();e<t.getCurrentCurveId().Id();e+=1){const t=this.getCurve(new F(e));t&&this.deleteCurve(t)}for(let e=this.getCurrentCurveSegmentId().Id();e<t.getCurrentCurveSegmentId().Id();e+=1){const t=this.getCurveSegment(new B(e));t&&this.deleteCurveSegment(t)}return t.getCurrentCurveId().Id()<this.currentCurveId&&(this.currentCurveId=t.getCurrentCurveId().Id()),t.getCurrentCurveSegmentId().Id()<this.currentCurveSegmentId&&(this.currentCurveSegmentId=t.getCurrentCurveSegmentId().Id()),this}getCurrentCurveId(){return new F(this.currentCurveId)}allocCurveId(){return this.currentCurveId+=1,new F(this.currentCurveId)}getCurrentCurveSegmentId(){return new B(this.currentCurveSegmentId)}allocCurveSegmentId(){return this.currentCurveSegmentId+=1,new B(this.currentCurveSegmentId)}addCurve(t){const e=t.getData();if(e){const r=e.getId().getHashKey();this.curveHash.set(r,t)}}deleteCurve(t){const e=t.getData();if(e){const t=e.getId().getHashKey();this.curveHash.delete(t)}}getCurve(t){return this.curveHash.get(t.getHashKey())}addCurveSegment(t){const e=t.getData();if(e){const r=e.getId().getHashKey();this.curveSegmentHash.set(r,t)}}deleteCurveSegment(t){const e=t.getData();if(e){const t=e.getId().getHashKey();this.curveSegmentHash.delete(t)}}getCurveSegment(t){return this.curveSegmentHash.get(t.getHashKey())}},r([C.DeclareProperty],t.NameEngine.prototype,"currentCurveId",void 0),r([C.DeclareProperty],t.NameEngine.prototype,"currentCurveSegmentId",void 0),r([C.DeclareProperty],t.NameEngine.prototype,"curveHash",void 0),r([C.DeclareProperty],t.NameEngine.prototype,"curveSegmentHash",void 0),t.NameEngine=L=r([C.DeclareObject(P.NameEngine)],t.NameEngine);class V{}V.tolerence=1e-6;class ${constructor(t,e){t>e?(this.end=t,this.start=e):(this.start=t,this.end=e)}intersects(t){if(t.start+V.tolerence<this.end&&this.start+V.tolerence<t.end)return new $(Math.max(this.start,t.start),Math.min(this.end,t.end))}contians(t){return this.start<=t.start&&t.end<=this.end}}let R=class extends I{};R=r([C.DeclareObject(P.Curve)],R);
/**
     * @license
     * Copyright 2010-2023 Three.js Authors
     * SPDX-License-Identifier: MIT
     */
const U="152",z=300,Y=1e3,X=1001,q=1002,Z=1006,H=1008,W=1009,G=1023,J=3e3,Q=3001,K="",tt="srgb",rt=35044,nt=35048;class it{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const r=this._listeners[t];if(void 0!==r){const t=r.indexOf(e);-1!==t&&r.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const r=e.slice(0);for(let e=0,n=r.length;n>e;e++)r[e].call(this,t);t.target=null}}}const st=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];class et{constructor(t=0,e=0){et.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,r=this.y,n=t.elements;return this.x=n[0]*e+n[3]*r+n[6],this.y=n[1]*e+n[4]*r+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const r=this.dot(t)/e;return Math.acos(s(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,r=this.y-t.y;return e*e+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const r=Math.cos(e),n=Math.sin(e),i=this.x-t.x,s=this.y-t.y;return this.x=i*r-s*n+t.x,this.y=i*n+s*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ot{constructor(){ot.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,r,n,i,s,o,a,u){const h=this.elements;return h[0]=t,h[1]=n,h[2]=o,h[3]=e,h[4]=i,h[5]=a,h[6]=r,h[7]=s,h[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this}extractBasis(t,e,r){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const r=t.elements,n=e.elements,i=this.elements,s=r[0],o=r[3],a=r[6],u=r[1],h=r[4],c=r[7],l=r[2],f=r[5],d=r[8],p=n[0],m=n[3],v=n[6],g=n[1],y=n[4],x=n[7],_=n[2],b=n[5],w=n[8];return i[0]=s*p+o*g+a*_,i[3]=s*m+o*y+a*b,i[6]=s*v+o*x+a*w,i[1]=u*p+h*g+c*_,i[4]=u*m+h*y+c*b,i[7]=u*v+h*x+c*w,i[2]=l*p+f*g+d*_,i[5]=l*m+f*y+d*b,i[8]=l*v+f*x+d*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],s=t[4],o=t[5],a=t[6],u=t[7],h=t[8];return e*s*h-e*o*u-r*i*h+r*o*a+n*i*u-n*s*a}invert(){const t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],s=t[4],o=t[5],a=t[6],u=t[7],h=t[8],c=h*s-o*u,l=o*a-h*i,f=u*i-s*a,d=e*c+r*l+n*f;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const p=1/d;return t[0]=c*p,t[1]=(n*u-h*r)*p,t[2]=(o*r-n*s)*p,t[3]=l*p,t[4]=(h*e-n*a)*p,t[5]=(n*i-o*e)*p,t[6]=f*p,t[7]=(r*a-u*e)*p,t[8]=(s*e-r*i)*p,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,r,n,i,s,o){const a=Math.cos(i),u=Math.sin(i);return this.set(r*a,r*u,-r*(a*s+u*o)+s+t,-n*u,n*a,-n*(-u*s+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(ht.makeScale(t,e)),this}rotate(t){return this.premultiply(ht.makeRotation(-t)),this}translate(t,e){return this.premultiply(ht.makeTranslation(t,e)),this}makeTranslation(t,e){return this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,r,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,r=t.elements;for(let t=0;9>t;t++)if(e[t]!==r[t])return!1;return!0}fromArray(t,e=0){for(let r=0;9>r;r++)this.elements[r]=t[r+e];return this}toArray(t=[],e=0){const r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const ht=new ot,ut={};let at;class ct{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===at&&(at=u("canvas")),at.width=t.width,at.height=t.height;const r=at.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),e=at}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=u("canvas");e.width=t.width,e.height=t.height;const r=e.getContext("2d");r.drawImage(t,0,0,t.width,t.height);const n=r.getImageData(0,0,t.width,t.height),i=n.data;for(let t=0;t<i.length;t++)i[t]=255*c(i[t]/255);return r.putImageData(n,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*c(e[t]/255)):e[t]=c(e[t]);return{data:e,width:t.width,height:t.height}}return t}}class ft{constructor(t=null){this.isSource=!0,this.uuid=i(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const r={uuid:this.uuid,url:""},n=this.data;if(null!==n){let t;if(Array.isArray(n)){t=[];for(let e=0,r=n.length;r>e;e++)n[e].isDataTexture?t.push(f(n[e].image)):t.push(f(n[e]))}else t=f(n);r.url=t}return e||(t.images[this.uuid]=r),r}}let lt=0;class vt extends it{constructor(t=vt.DEFAULT_IMAGE,e=vt.DEFAULT_MAPPING,r=X,n=X,s=Z,o=H,u=G,h=W,c=vt.DEFAULT_ANISOTROPY,l=K){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:lt++}),this.uuid=i(),this.name="",this.source=new ft(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=r,this.wrapT=n,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=u,this.internalFormat=null,this.type=h,this.offset=new et(0,0),this.repeat=new et(1,1),this.center=new et(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ot,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof l?this.colorSpace=l:(a("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=l===Q?tt:K),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),e||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==z)return t;if(t.applyMatrix3(this.matrix),0>t.x||t.x>1)switch(this.wrapS){case Y:t.x=t.x-Math.floor(t.x);break;case X:t.x=0>t.x?0:1;break;case q:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(0>t.y||t.y>1)switch(this.wrapT){case Y:t.y=t.y-Math.floor(t.y);break;case X:t.y=0>t.y?0:1;break;case q:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return a("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===tt?Q:J}set encoding(t){a("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===Q?tt:K}}vt.DEFAULT_IMAGE=null,vt.DEFAULT_MAPPING=z,vt.DEFAULT_ANISOTROPY=1;class dt{constructor(t=0,e=0,r=0,n=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=r,this._w=n}static slerpFlat(t,e,r,n,i,s,o){let a=r[n+0],u=r[n+1],h=r[n+2],c=r[n+3];const l=i[s+0],f=i[s+1],d=i[s+2],p=i[s+3];if(0===o)return t[e+0]=a,t[e+1]=u,t[e+2]=h,void(t[e+3]=c);if(1===o)return t[e+0]=l,t[e+1]=f,t[e+2]=d,void(t[e+3]=p);if(c!==p||a!==l||u!==f||h!==d){let t=1-o;const e=a*l+u*f+h*d+c*p,r=0>e?-1:1,n=1-e*e;if(n>Number.EPSILON){const i=Math.sqrt(n),s=Math.atan2(i,e*r);t=Math.sin(t*s)/i,o=Math.sin(o*s)/i}const i=o*r;if(a=a*t+l*i,u=u*t+f*i,h=h*t+d*i,c=c*t+p*i,t===1-o){const t=1/Math.sqrt(a*a+u*u+h*h+c*c);a*=t,u*=t,h*=t,c*=t}}t[e]=a,t[e+1]=u,t[e+2]=h,t[e+3]=c}static multiplyQuaternionsFlat(t,e,r,n,i,s){const o=r[n],a=r[n+1],u=r[n+2],h=r[n+3],c=i[s],l=i[s+1],f=i[s+2],d=i[s+3];return t[e]=o*d+h*c+a*f-u*l,t[e+1]=a*d+h*l+u*c-o*f,t[e+2]=u*d+h*f+o*l-a*c,t[e+3]=h*d-o*c-a*l-u*f,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const r=t._x,n=t._y,i=t._z,s=t._order,o=Math.cos,a=Math.sin,u=o(r/2),h=o(n/2),c=o(i/2),l=a(r/2),f=a(n/2),d=a(i/2);switch(s){case"XYZ":this._x=l*h*c+u*f*d,this._y=u*f*c-l*h*d,this._z=u*h*d+l*f*c,this._w=u*h*c-l*f*d;break;case"YXZ":this._x=l*h*c+u*f*d,this._y=u*f*c-l*h*d,this._z=u*h*d-l*f*c,this._w=u*h*c+l*f*d;break;case"ZXY":this._x=l*h*c-u*f*d,this._y=u*f*c+l*h*d,this._z=u*h*d+l*f*c,this._w=u*h*c-l*f*d;break;case"ZYX":this._x=l*h*c-u*f*d,this._y=u*f*c+l*h*d,this._z=u*h*d-l*f*c,this._w=u*h*c+l*f*d;break;case"YZX":this._x=l*h*c+u*f*d,this._y=u*f*c+l*h*d,this._z=u*h*d-l*f*c,this._w=u*h*c-l*f*d;break;case"XZY":this._x=l*h*c-u*f*d,this._y=u*f*c-l*h*d,this._z=u*h*d+l*f*c,this._w=u*h*c+l*f*d}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const r=e/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,r=e[0],n=e[4],i=e[8],s=e[1],o=e[5],a=e[9],u=e[2],h=e[6],c=e[10],l=r+o+c;if(l>0){const t=.5/Math.sqrt(l+1);this._w=.25/t,this._x=(h-a)*t,this._y=(i-u)*t,this._z=(s-n)*t}else if(r>o&&r>c){const t=2*Math.sqrt(1+r-o-c);this._w=(h-a)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(i+u)/t}else if(o>c){const t=2*Math.sqrt(1+o-r-c);this._w=(i-u)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(a+h)/t}else{const t=2*Math.sqrt(1+c-r-o);this._w=(s-n)/t,this._x=(i+u)/t,this._y=(a+h)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let r=t.dot(e)+1;return Number.EPSILON>r?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=r),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(s(this.dot(t),-1,1)))}rotateTowards(t,e){const r=this.angleTo(t);if(0===r)return this;const n=Math.min(1,e/r);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const r=t._x,n=t._y,i=t._z,s=t._w,o=e._x,a=e._y,u=e._z,h=e._w;return this._x=r*h+s*o+n*u-i*a,this._y=n*h+s*a+i*o-r*u,this._z=i*h+s*u+r*a-n*o,this._w=s*h-r*o-n*a-i*u,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const r=this._x,n=this._y,i=this._z,s=this._w;let o=s*t._w+r*t._x+n*t._y+i*t._z;if(0>o?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=r,this._y=n,this._z=i,this;const a=1-o*o;if(Number.EPSILON>=a){const t=1-e;return this._w=t*s+e*this._w,this._x=t*r+e*this._x,this._y=t*n+e*this._y,this._z=t*i+e*this._z,this.normalize(),this._onChangeCallback(),this}const u=Math.sqrt(a),h=Math.atan2(u,o),c=Math.sin((1-e)*h)/u,l=Math.sin(e*h)/u;return this._w=s*c+this._w*l,this._x=r*c+this._x*l,this._y=n*c+this._y*l,this._z=i*c+this._z*l,this._onChangeCallback(),this}slerpQuaternions(t,e,r){return this.copy(t).slerp(e,r)}random(){const t=Math.random(),e=Math.sqrt(1-t),r=Math.sqrt(t),n=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(e*Math.cos(n),r*Math.sin(i),r*Math.cos(i),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class wt{constructor(t=0,e=0,r=0){wt.prototype.isVector3=!0,this.x=t,this.y=e,this.z=r}set(t,e,r){return void 0===r&&(r=this.z),this.x=t,this.y=e,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(mt.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(mt.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6]*n,this.y=i[1]*e+i[4]*r+i[7]*n,this.z=i[2]*e+i[5]*r+i[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,r=this.y,n=this.z,i=t.elements,s=1/(i[3]*e+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*e+i[4]*r+i[8]*n+i[12])*s,this.y=(i[1]*e+i[5]*r+i[9]*n+i[13])*s,this.z=(i[2]*e+i[6]*r+i[10]*n+i[14])*s,this}applyQuaternion(t){const e=this.x,r=this.y,n=this.z,i=t.x,s=t.y,o=t.z,a=t.w,u=a*e+s*n-o*r,h=a*r+o*e-i*n,c=a*n+i*r-s*e,l=-i*e-s*r-o*n;return this.x=u*a+l*-i+h*-o-c*-s,this.y=h*a+l*-s+c*-i-u*-o,this.z=c*a+l*-o+u*-s-h*-i,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[4]*r+i[8]*n,this.y=i[1]*e+i[5]*r+i[9]*n,this.z=i[2]*e+i[6]*r+i[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const r=t.x,n=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=n*a-i*o,this.y=i*s-r*a,this.z=r*o-n*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const r=t.dot(this)/e;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return pt.copy(this).projectOnVector(t),this.sub(pt)}reflect(t){return this.sub(pt.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const r=this.dot(t)/e;return Math.acos(s(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return e*e+r*r+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,r){const n=Math.sin(e)*t;return this.x=n*Math.sin(r),this.y=Math.cos(e)*t,this.z=n*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,r){return this.x=t*Math.sin(e),this.y=r,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,r=Math.sqrt(1-t**2);return this.x=r*Math.cos(e),this.y=r*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const pt=new wt,mt=new dt;class yt{constructor(t=new wt(1/0,1/0,1/0),e=new wt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,r=t.length;r>e;e+=3)this.expandByPoint(gt.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,r=t.count;r>e;e++)this.expandByPoint(gt.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,r=t.length;r>e;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const r=gt.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){if(t.updateWorldMatrix(!1,!1),void 0!==t.boundingBox)null===t.boundingBox&&t.computeBoundingBox(),bt.copy(t.boundingBox),bt.applyMatrix4(t.matrixWorld),this.union(bt);else{const r=t.geometry;if(void 0!==r)if(e&&void 0!==r.attributes&&void 0!==r.attributes.position){const e=r.attributes.position;for(let r=0,n=e.count;n>r;r++)gt.fromBufferAttribute(e,r).applyMatrix4(t.matrixWorld),this.expandByPoint(gt)}else null===r.boundingBox&&r.computeBoundingBox(),bt.copy(r.boundingBox),bt.applyMatrix4(t.matrixWorld),this.union(bt)}const r=t.children;for(let t=0,n=r.length;n>t;t++)this.expandByObject(r[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return!(this.min.x>t.min.x||t.max.x>this.max.x||this.min.y>t.min.y||t.max.y>this.max.y||this.min.z>t.min.z||t.max.z>this.max.z)}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,gt),gt.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,r;return t.normal.x>0?(e=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),e<=-t.constant&&r>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Tt),Nt.subVectors(this.max,Tt),_t.subVectors(t.a,Tt),xt.subVectors(t.b,Tt),At.subVectors(t.c,Tt),St.subVectors(xt,_t),kt.subVectors(At,xt),Et.subVectors(_t,At);let e=[0,-St.z,St.y,0,-kt.z,kt.y,0,-Et.z,Et.y,St.z,0,-St.x,kt.z,0,-kt.x,Et.z,0,-Et.x,-St.y,St.x,0,-kt.y,kt.x,0,-Et.y,Et.x,0];return!!l(e,_t,xt,At,Nt)&&(e=[1,0,0,0,1,0,0,0,1],!!l(e,_t,xt,At,Nt)&&(jt.crossVectors(St,kt),e=[jt.x,jt.y,jt.z],l(e,_t,xt,At,Nt)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,gt).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(gt).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Mt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Mt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Mt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Mt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Mt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Mt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Mt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Mt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Mt)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Mt=[new wt,new wt,new wt,new wt,new wt,new wt,new wt,new wt],gt=new wt,bt=new yt,_t=new wt,xt=new wt,At=new wt,St=new wt,kt=new wt,Et=new wt,Tt=new wt,Nt=new wt,jt=new wt,Ct=new wt,Pt=new yt,It=new wt,Ot=new wt;class Dt{constructor(t=new wt,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const r=this.center;void 0!==e?r.copy(e):Pt.setFromPoints(t).getCenter(r);let n=0;for(let e=0,i=t.length;i>e;e++)n=Math.max(n,r.distanceToSquared(t[e]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return 0>this.radius}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const r=this.center.distanceToSquared(t);return e.copy(t),r>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;It.subVectors(t,this.center);const e=It.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),r=.5*(t-this.radius);this.center.addScaledVector(It,r/t),this.radius+=r}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(Ot.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(It.copy(t.center).add(Ot)),this.expandByPoint(It.copy(t.center).sub(Ot))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}class Ft{constructor(){Ft.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,r,n,i,s,o,a,u,h,c,l,f,d,p,m){const v=this.elements;return v[0]=t,v[4]=e,v[8]=r,v[12]=n,v[1]=i,v[5]=s,v[9]=o,v[13]=a,v[2]=u,v[6]=h,v[10]=c,v[14]=l,v[3]=f,v[7]=d,v[11]=p,v[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ft).fromArray(this.elements)}copy(t){const e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this}copyPosition(t){const e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,r=t.elements,n=1/Bt.setFromMatrixColumn(t,0).length(),i=1/Bt.setFromMatrixColumn(t,1).length(),s=1/Bt.setFromMatrixColumn(t,2).length();return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=0,e[4]=r[4]*i,e[5]=r[5]*i,e[6]=r[6]*i,e[7]=0,e[8]=r[8]*s,e[9]=r[9]*s,e[10]=r[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,r=t.x,n=t.y,i=t.z,s=Math.cos(r),o=Math.sin(r),a=Math.cos(n),u=Math.sin(n),h=Math.cos(i),c=Math.sin(i);if("XYZ"===t.order){const t=s*h,r=s*c,n=o*h,i=o*c;e[0]=a*h,e[4]=-a*c,e[8]=u,e[1]=r+n*u,e[5]=t-i*u,e[9]=-o*a,e[2]=i-t*u,e[6]=n+r*u,e[10]=s*a}else if("YXZ"===t.order){const t=a*h,r=a*c,n=u*h,i=u*c;e[0]=t+i*o,e[4]=n*o-r,e[8]=s*u,e[1]=s*c,e[5]=s*h,e[9]=-o,e[2]=r*o-n,e[6]=i+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*h,r=a*c,n=u*h,i=u*c;e[0]=t-i*o,e[4]=-s*c,e[8]=n+r*o,e[1]=r+n*o,e[5]=s*h,e[9]=i-t*o,e[2]=-s*u,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*h,r=s*c,n=o*h,i=o*c;e[0]=a*h,e[4]=n*u-r,e[8]=t*u+i,e[1]=a*c,e[5]=i*u+t,e[9]=r*u-n,e[2]=-u,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,r=s*u,n=o*a,i=o*u;e[0]=a*h,e[4]=i-t*c,e[8]=n*c+r,e[1]=c,e[5]=s*h,e[9]=-o*h,e[2]=-u*h,e[6]=r*c+n,e[10]=t-i*c}else if("XZY"===t.order){const t=s*a,r=s*u,n=o*a,i=o*u;e[0]=a*h,e[4]=-c,e[8]=u*h,e[1]=t*c+i,e[5]=s*h,e[9]=r*c-n,e[2]=n*c-r,e[6]=o*h,e[10]=i*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Vt,t,$t)}o(t,e,r){const n=this.elements;return zt.subVectors(t,e),0===zt.lengthSq()&&(zt.z=1),zt.normalize(),Rt.crossVectors(r,zt),0===Rt.lengthSq()&&(1===Math.abs(r.z)?zt.x+=1e-4:zt.z+=1e-4,zt.normalize(),Rt.crossVectors(r,zt)),Rt.normalize(),Ut.crossVectors(zt,Rt),n[0]=Rt.x,n[4]=Ut.x,n[8]=zt.x,n[1]=Rt.y,n[5]=Ut.y,n[9]=zt.y,n[2]=Rt.z,n[6]=Ut.z,n[10]=zt.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const r=t.elements,n=e.elements,i=this.elements,s=r[0],o=r[4],a=r[8],u=r[12],h=r[1],c=r[5],l=r[9],f=r[13],d=r[2],p=r[6],m=r[10],v=r[14],g=r[3],y=r[7],x=r[11],_=r[15],b=n[0],w=n[4],S=n[8],z=n[12],M=n[1],C=n[5],P=n[9],A=n[13],E=n[2],k=n[6],T=n[10],N=n[14],I=n[3],V=n[7],D=n[11],B=n[15];return i[0]=s*b+o*M+a*E+u*I,i[4]=s*w+o*C+a*k+u*V,i[8]=s*S+o*P+a*T+u*D,i[12]=s*z+o*A+a*N+u*B,i[1]=h*b+c*M+l*E+f*I,i[5]=h*w+c*C+l*k+f*V,i[9]=h*S+c*P+l*T+f*D,i[13]=h*z+c*A+l*N+f*B,i[2]=d*b+p*M+m*E+v*I,i[6]=d*w+p*C+m*k+v*V,i[10]=d*S+p*P+m*T+v*D,i[14]=d*z+p*A+m*N+v*B,i[3]=g*b+y*M+x*E+_*I,i[7]=g*w+y*C+x*k+_*V,i[11]=g*S+y*P+x*T+_*D,i[15]=g*z+y*A+x*N+_*B,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],s=t[1],o=t[5],a=t[9],u=t[13],h=t[2],c=t[6],l=t[10],f=t[14];return t[3]*(+i*a*c-n*u*c-i*o*l+r*u*l+n*o*f-r*a*f)+t[7]*(+e*a*f-e*u*l+i*s*l-n*s*f+n*u*h-i*a*h)+t[11]*(+e*u*c-e*o*f-i*s*c+r*s*f+i*o*h-r*u*h)+t[15]*(-n*o*h-e*a*c+e*o*l+n*s*c-r*s*l+r*a*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,r){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=r),this}invert(){const t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],s=t[4],o=t[5],a=t[6],u=t[7],h=t[8],c=t[9],l=t[10],f=t[11],d=t[12],p=t[13],m=t[14],v=t[15],g=c*m*u-p*l*u+p*a*f-o*m*f-c*a*v+o*l*v,y=d*l*u-h*m*u-d*a*f+s*m*f+h*a*v-s*l*v,x=h*p*u-d*c*u+d*o*f-s*p*f-h*o*v+s*c*v,_=d*c*a-h*p*a-d*o*l+s*p*l+h*o*m-s*c*m,b=e*g+r*y+n*x+i*_;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return t[0]=g*w,t[1]=(p*l*i-c*m*i-p*n*f+r*m*f+c*n*v-r*l*v)*w,t[2]=(o*m*i-p*a*i+p*n*u-r*m*u-o*n*v+r*a*v)*w,t[3]=(c*a*i-o*l*i-c*n*u+r*l*u+o*n*f-r*a*f)*w,t[4]=y*w,t[5]=(h*m*i-d*l*i+d*n*f-e*m*f-h*n*v+e*l*v)*w,t[6]=(d*a*i-s*m*i-d*n*u+e*m*u+s*n*v-e*a*v)*w,t[7]=(s*l*i-h*a*i+h*n*u-e*l*u-s*n*f+e*a*f)*w,t[8]=x*w,t[9]=(d*c*i-h*p*i-d*r*f+e*p*f+h*r*v-e*c*v)*w,t[10]=(s*p*i-d*o*i+d*r*u-e*p*u-s*r*v+e*o*v)*w,t[11]=(h*o*i-s*c*i-h*r*u+e*c*u+s*r*f-e*o*f)*w,t[12]=_*w,t[13]=(h*p*n-d*c*n+d*r*l-e*p*l-h*r*m+e*c*m)*w,t[14]=(d*o*n-s*p*n-d*r*a+e*p*a+s*r*m-e*o*m)*w,t[15]=(s*c*n-h*o*n+h*r*a-e*c*a-s*r*l+e*o*l)*w,this}scale(t){const e=this.elements,r=t.x,n=t.y,i=t.z;return e[0]*=r,e[4]*=n,e[8]*=i,e[1]*=r,e[5]*=n,e[9]*=i,e[2]*=r,e[6]*=n,e[10]*=i,e[3]*=r,e[7]*=n,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,r,n))}makeTranslation(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const r=Math.cos(e),n=Math.sin(e),i=1-r,s=t.x,o=t.y,a=t.z,u=i*s,h=i*o;return this.set(u*s+r,u*o-n*a,u*a+n*o,0,u*o+n*a,h*o+r,h*a-n*s,0,u*a-n*o,h*a+n*s,i*a*a+r,0,0,0,0,1),this}makeScale(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,e,r,n,i,s){return this.set(1,r,i,0,t,1,s,0,e,n,1,0,0,0,0,1),this}compose(t,e,r){const n=this.elements,i=e._x,s=e._y,o=e._z,a=e._w,u=i+i,h=s+s,c=o+o,l=i*u,f=i*h,d=i*c,p=s*h,m=s*c,v=o*c,g=a*u,y=a*h,x=a*c,_=r.x,b=r.y,w=r.z;return n[0]=(1-(p+v))*_,n[1]=(f+x)*_,n[2]=(d-y)*_,n[3]=0,n[4]=(f-x)*b,n[5]=(1-(l+v))*b,n[6]=(m+g)*b,n[7]=0,n[8]=(d+y)*w,n[9]=(m-g)*w,n[10]=(1-(l+p))*w,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,r){const n=this.elements;let i=Bt.set(n[0],n[1],n[2]).length();const s=Bt.set(n[4],n[5],n[6]).length(),o=Bt.set(n[8],n[9],n[10]).length();0>this.determinant()&&(i=-i),t.x=n[12],t.y=n[13],t.z=n[14],Lt.copy(this);const a=1/i,u=1/s,h=1/o;return Lt.elements[0]*=a,Lt.elements[1]*=a,Lt.elements[2]*=a,Lt.elements[4]*=u,Lt.elements[5]*=u,Lt.elements[6]*=u,Lt.elements[8]*=h,Lt.elements[9]*=h,Lt.elements[10]*=h,e.setFromRotationMatrix(Lt),r.x=i,r.y=s,r.z=o,this}makePerspective(t,e,r,n,i,s){const o=this.elements,a=2*i/(e-t),u=2*i/(r-n),h=(e+t)/(e-t),c=(r+n)/(r-n),l=-(s+i)/(s-i),f=-2*s*i/(s-i);return o[0]=a,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=u,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=l,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,r,n,i,s){const o=this.elements,a=1/(e-t),u=1/(r-n),h=1/(s-i),c=(e+t)*a,l=(r+n)*u,f=(s+i)*h;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-l,o[2]=0,o[6]=0,o[10]=-2*h,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,r=t.elements;for(let t=0;16>t;t++)if(e[t]!==r[t])return!1;return!0}fromArray(t,e=0){for(let r=0;16>r;r++)this.elements[r]=t[r+e];return this}toArray(t=[],e=0){const r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}}const Bt=new wt,Lt=new Ft,Vt=new wt(0,0,0),$t=new wt(1,1,1),Rt=new wt,Ut=new wt,zt=new wt,Yt=new Ft,Xt=new dt;class qt{constructor(t=0,e=0,r=0,n=qt.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=r,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,r,n=this._order){return this._x=t,this._y=e,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,r=!0){const n=t.elements,i=n[0],o=n[4],a=n[8],u=n[1],h=n[5],c=n[9],l=n[2],f=n[6],d=n[10];switch(e){case"XYZ":this._y=Math.asin(s(a,-1,1)),.9999999>Math.abs(a)?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(f,h),this._z=0);break;case"YXZ":this._x=Math.asin(-s(c,-1,1)),.9999999>Math.abs(c)?(this._y=Math.atan2(a,d),this._z=Math.atan2(u,h)):(this._y=Math.atan2(-l,i),this._z=0);break;case"ZXY":this._x=Math.asin(s(f,-1,1)),.9999999>Math.abs(f)?(this._y=Math.atan2(-l,d),this._z=Math.atan2(-o,h)):(this._y=0,this._z=Math.atan2(u,i));break;case"ZYX":this._y=Math.asin(-s(l,-1,1)),.9999999>Math.abs(l)?(this._x=Math.atan2(f,d),this._z=Math.atan2(u,i)):(this._x=0,this._z=Math.atan2(-o,h));break;case"YZX":this._z=Math.asin(s(u,-1,1)),.9999999>Math.abs(u)?(this._x=Math.atan2(-c,h),this._y=Math.atan2(-l,i)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-s(o,-1,1)),.9999999>Math.abs(o)?(this._x=Math.atan2(f,h),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-c,d),this._y=0)}return this._order=e,!0===r&&this._onChangeCallback(),this}setFromQuaternion(t,e,r){return Yt.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Yt,e,r)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Xt.setFromEuler(this),this.setFromQuaternion(Xt,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}qt.DEFAULT_ORDER="XYZ";class Zt{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let Ht=0;const Wt=new wt,Gt=new dt,Jt=new Ft,Qt=new wt,Kt=new wt,tr=new wt,rr=new dt,nr=new wt(1,0,0),ir=new wt(0,1,0),sr=new wt(0,0,1),er={type:"added"},or={type:"removed"};class hr extends it{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Ht++}),this.uuid=i(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=hr.DEFAULT_UP.clone();const t=new wt,e=new qt,r=new dt,n=new wt(1,1,1);e._onChange((function(){r.setFromEuler(e,!1)})),r._onChange((function(){e.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Ft},normalMatrix:{value:new ot}}),this.matrix=new Ft,this.matrixWorld=new Ft,this.matrixAutoUpdate=hr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=hr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Zt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Gt.setFromAxisAngle(t,e),this.quaternion.multiply(Gt),this}rotateOnWorldAxis(t,e){return Gt.setFromAxisAngle(t,e),this.quaternion.premultiply(Gt),this}rotateX(t){return this.rotateOnAxis(nr,t)}rotateY(t){return this.rotateOnAxis(ir,t)}rotateZ(t){return this.rotateOnAxis(sr,t)}translateOnAxis(t,e){return Wt.copy(t).applyQuaternion(this.quaternion),this.position.add(Wt.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(nr,t)}translateY(t){return this.translateOnAxis(ir,t)}translateZ(t){return this.translateOnAxis(sr,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Jt.copy(this.matrixWorld).invert())}o(t,e,r){t.isVector3?Qt.copy(t):Qt.set(t,e,r);const n=this.parent;this.updateWorldMatrix(!0,!1),Kt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Jt.o(Kt,Qt,this.up):Jt.o(Qt,Kt,this.up),this.quaternion.setFromRotationMatrix(Jt),n&&(Jt.extractRotation(n.matrixWorld),Gt.setFromRotationMatrix(Jt),this.quaternion.premultiply(Gt.invert()))}add(t){if(arguments.length>1){for(let t=0;arguments.length>t;t++)this.add(arguments[t]);return this}return t===this||t&&t.isObject3D&&(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(er)),this}remove(t){if(arguments.length>1){for(let t=0;arguments.length>t;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(or)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(or)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Jt.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Jt.multiply(t.parent.matrixWorld)),t.applyMatrix4(Jt),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let r=0,n=this.children.length;n>r;r++){const n=this.children[r].getObjectByProperty(t,e);if(void 0!==n)return n}}getObjectsByProperty(t,e){let r=[];this[t]===e&&r.push(this);for(let n=0,i=this.children.length;i>n;n++){const i=this.children[n].getObjectsByProperty(t,e);i.length>0&&(r=r.concat(i))}return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Kt,t,tr),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Kt,rr,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let r=0,n=e.length;n>r;r++)e[r].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let r=0,n=e.length;n>r;r++)e[r].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let r=0,n=e.length;n>r;r++){const n=e[r];!0!==n.matrixWorldAutoUpdate&&!0!==t||n.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const r=this.parent;if(!0===t&&null!==r&&!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,r=t.length;r>e;e++){const r=t[e];!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!1,!0)}}}toJSON(t){function e(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}function r(t){const e=[];for(const r in t){const n=t[r];delete n.metadata,e.push(n)}return e}const n=void 0===t||"string"==typeof t,i={};n&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=e(t.geometries,this.geometry);const r=this.geometry.parameters;if(void 0!==r&&void 0!==r.shapes){const n=r.shapes;if(Array.isArray(n))for(let r=0,i=n.length;i>r;r++){const i=n[r];e(t.shapes,i)}else e(t.shapes,n)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(e(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const r=[];for(let n=0,i=this.material.length;i>n;n++)r.push(e(t.materials,this.material[n]));s.material=r}else s.material=e(t.materials,this.material);if(this.children.length>0){s.children=[];for(let e=0;e<this.children.length;e++)s.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let r=0;r<this.animations.length;r++){const n=this.animations[r];s.animations.push(e(t.animations,n))}}if(n){const e=r(t.geometries),n=r(t.materials),s=r(t.textures),o=r(t.images),a=r(t.shapes),u=r(t.skeletons),h=r(t.animations),c=r(t.nodes);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),s.length>0&&(i.textures=s),o.length>0&&(i.images=o),a.length>0&&(i.shapes=a),u.length>0&&(i.skeletons=u),h.length>0&&(i.animations=h),c.length>0&&(i.nodes=c)}return i.object=s,i}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const r=t.children[e];this.add(r.clone())}return this}}hr.DEFAULT_UP=new wt(0,1,0),hr.DEFAULT_MATRIX_AUTO_UPDATE=!0,hr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ur=new wt,ar=new et;class cr{constructor(t,e,r=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=r,this.usage=rt,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,r){t*=this.itemSize,r*=e.itemSize;for(let n=0,i=this.itemSize;i>n;n++)this.array[t+n]=e.array[r+n];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,r=this.count;r>e;e++)ar.fromBufferAttribute(this,e),ar.applyMatrix3(t),this.setXY(e,ar.x,ar.y);else if(3===this.itemSize)for(let e=0,r=this.count;r>e;e++)ur.fromBufferAttribute(this,e),ur.applyMatrix3(t),this.setXYZ(e,ur.x,ur.y,ur.z);return this}applyMatrix4(t){for(let e=0,r=this.count;r>e;e++)ur.fromBufferAttribute(this,e),ur.applyMatrix4(t),this.setXYZ(e,ur.x,ur.y,ur.z);return this}applyNormalMatrix(t){for(let e=0,r=this.count;r>e;e++)ur.fromBufferAttribute(this,e),ur.applyNormalMatrix(t),this.setXYZ(e,ur.x,ur.y,ur.z);return this}transformDirection(t){for(let e=0,r=this.count;r>e;e++)ur.fromBufferAttribute(this,e),ur.transformDirection(t),this.setXYZ(e,ur.x,ur.y,ur.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){let r=this.array[t*this.itemSize];return this.normalized&&(r=e(r,this.array)),r}setX(t,e){return this.normalized&&(e=o(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let r=this.array[t*this.itemSize+1];return this.normalized&&(r=e(r,this.array)),r}setY(t,e){return this.normalized&&(e=o(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let r=this.array[t*this.itemSize+2];return this.normalized&&(r=e(r,this.array)),r}setZ(t,e){return this.normalized&&(e=o(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let r=this.array[t*this.itemSize+3];return this.normalized&&(r=e(r,this.array)),r}setW(t,e){return this.normalized&&(e=o(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,r){return t*=this.itemSize,this.normalized&&(e=o(e,this.array),r=o(r,this.array)),this.array[t+0]=e,this.array[t+1]=r,this}setXYZ(t,e,r,n){return t*=this.itemSize,this.normalized&&(e=o(e,this.array),r=o(r,this.array),n=o(n,this.array)),this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=n,this}setXYZW(t,e,r,n,i){return t*=this.itemSize,this.normalized&&(e=o(e,this.array),r=o(r,this.array),n=o(n,this.array),i=o(i,this.array)),this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=i,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==rt&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}copyColorsArray(){}copyVector2sArray(){}copyVector3sArray(){}copyVector4sArray(){}}class fr extends cr{constructor(t,e,r){super(new Uint16Array(t),e,r)}}class lr extends cr{constructor(t,e,r){super(new Uint32Array(t),e,r)}}class vr extends cr{constructor(t,e,r){super(new Float32Array(t),e,r)}}let dr=0;const wr=new Ft,pr=new hr,mr=new wt,yr=new yt,Mr=new yt,gr=new wt;class br extends it{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:dr++}),this.uuid=i(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return this.index=Array.isArray(t)?new(h(t)?lr:fr)(t,1):t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,r=0){this.groups.push({start:t,count:e,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const r=this.attributes.normal;if(void 0!==r){const e=(new ot).getNormalMatrix(t);r.applyNormalMatrix(e),r.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return wr.makeRotationFromQuaternion(t),this.applyMatrix4(wr),this}rotateX(t){return wr.makeRotationX(t),this.applyMatrix4(wr),this}rotateY(t){return wr.makeRotationY(t),this.applyMatrix4(wr),this}rotateZ(t){return wr.makeRotationZ(t),this.applyMatrix4(wr),this}translate(t,e,r){return wr.makeTranslation(t,e,r),this.applyMatrix4(wr),this}scale(t,e,r){return wr.makeScale(t,e,r),this.applyMatrix4(wr),this}o(t){return pr.o(t),pr.updateMatrix(),this.applyMatrix4(pr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(mr).negate(),this.translate(mr.x,mr.y,mr.z),this}setFromPoints(t){const e=[];for(let r=0,n=t.length;n>r;r++){const n=t[r];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new vr(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new yt);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)this.boundingBox.set(new wt(-1/0,-1/0,-1/0),new wt(1/0,1/0,1/0));else{if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,r=e.length;r>t;t++){const r=e[t];yr.setFromBufferAttribute(r),this.morphTargetsRelative?(gr.addVectors(this.boundingBox.min,yr.min),this.boundingBox.expandByPoint(gr),gr.addVectors(this.boundingBox.max,yr.max),this.boundingBox.expandByPoint(gr)):(this.boundingBox.expandByPoint(yr.min),this.boundingBox.expandByPoint(yr.max))}}else this.boundingBox.makeEmpty();isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||this.boundingBox.min.z}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Dt);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)this.boundingSphere.set(new wt,1/0);else if(t){const r=this.boundingSphere.center;if(yr.setFromBufferAttribute(t),e)for(let t=0,r=e.length;r>t;t++){const r=e[t];Mr.setFromBufferAttribute(r),this.morphTargetsRelative?(gr.addVectors(yr.min,Mr.min),yr.expandByPoint(gr),gr.addVectors(yr.max,Mr.max),yr.expandByPoint(gr)):(yr.expandByPoint(Mr.min),yr.expandByPoint(Mr.max))}yr.getCenter(r);let n=0;for(let e=0,i=t.count;i>e;e++)gr.fromBufferAttribute(t,e),n=Math.max(n,r.distanceToSquared(gr));if(e)for(let i=0,s=e.length;s>i;i++){const s=e[i],o=this.morphTargetsRelative;for(let e=0,i=s.count;i>e;e++)gr.fromBufferAttribute(s,e),o&&(mr.fromBufferAttribute(t,e),gr.add(mr)),n=Math.max(n,r.distanceToSquared(gr))}this.boundingSphere.radius=Math.sqrt(n),this.boundingSphere.radius}}computeTangents(){function t(t,e,r){f.fromArray(s,3*t),d.fromArray(s,3*e),p.fromArray(s,3*r),m.fromArray(a,2*t),v.fromArray(a,2*e),g.fromArray(a,2*r),d.sub(f),p.sub(f),v.sub(m),g.sub(m);const n=1/(v.x*g.y-g.x*v.y);isFinite(n)&&(y.copy(d).multiplyScalar(g.y).addScaledVector(p,-v.y).multiplyScalar(n),x.copy(p).multiplyScalar(v.x).addScaledVector(d,-g.x).multiplyScalar(n),c[t].add(y),c[e].add(y),c[r].add(y),l[t].add(x),l[e].add(x),l[r].add(x))}function e(t){S.fromArray(o,3*t),z.copy(S);const e=c[t];b.copy(e),b.sub(S.multiplyScalar(S.dot(e))).normalize(),w.crossVectors(z,e);const r=0>w.dot(l[t])?-1:1;h[4*t]=b.x,h[4*t+1]=b.y,h[4*t+2]=b.z,h[4*t+3]=r}const r=this.index,n=this.attributes;if(null===r||void 0===n.position||void 0===n.normal||void 0===n.uv)return;const i=r.array,s=n.position.array,o=n.normal.array,a=n.uv.array,u=s.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new cr(new Float32Array(4*u),4));const h=this.getAttribute("tangent").array,c=[],l=[];for(let t=0;u>t;t++)c[t]=new wt,l[t]=new wt;const f=new wt,d=new wt,p=new wt,m=new et,v=new et,g=new et,y=new wt,x=new wt;let _=this.groups;0===_.length&&(_=[{start:0,count:i.length}]);for(let e=0,r=_.length;r>e;++e){const r=_[e],n=r.start;for(let e=n,s=n+r.count;s>e;e+=3)t(i[e+0],i[e+1],i[e+2])}const b=new wt,w=new wt,S=new wt,z=new wt;for(let t=0,r=_.length;r>t;++t){const r=_[t],n=r.start;for(let t=n,s=n+r.count;s>t;t+=3)e(i[t+0]),e(i[t+1]),e(i[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let r=this.getAttribute("normal");if(void 0===r)r=new cr(new Float32Array(3*e.count),3),this.setAttribute("normal",r);else for(let t=0,e=r.count;e>t;t++)r.setXYZ(t,0,0,0);const n=new wt,i=new wt,s=new wt,o=new wt,a=new wt,u=new wt,h=new wt,c=new wt;if(t)for(let l=0,f=t.count;f>l;l+=3){const f=t.getX(l+0),d=t.getX(l+1),p=t.getX(l+2);n.fromBufferAttribute(e,f),i.fromBufferAttribute(e,d),s.fromBufferAttribute(e,p),h.subVectors(s,i),c.subVectors(n,i),h.cross(c),o.fromBufferAttribute(r,f),a.fromBufferAttribute(r,d),u.fromBufferAttribute(r,p),o.add(h),a.add(h),u.add(h),r.setXYZ(f,o.x,o.y,o.z),r.setXYZ(d,a.x,a.y,a.z),r.setXYZ(p,u.x,u.y,u.z)}else for(let t=0,o=e.count;o>t;t+=3)n.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),h.subVectors(s,i),c.subVectors(n,i),h.cross(c),r.setXYZ(t+0,h.x,h.y,h.z),r.setXYZ(t+1,h.x,h.y,h.z),r.setXYZ(t+2,h.x,h.y,h.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(){return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,r=t.count;r>e;e++)gr.fromBufferAttribute(t,e),gr.normalize(),t.setXYZ(e,gr.x,gr.y,gr.z)}toNonIndexed(){function t(t,e){const r=t.array,n=t.itemSize,i=t.normalized,s=new r.constructor(e.length*n);let o=0,a=0;for(let i=0,u=e.length;u>i;i++){o=t.isInterleavedBufferAttribute?e[i]*t.data.stride+t.offset:e[i]*n;for(let t=0;n>t;t++)s[a++]=r[o++]}return new cr(s,n,i)}if(null===this.index)return this;const e=new br,r=this.index.array,n=this.attributes;for(const i in n){const s=t(n[i],r);e.setAttribute(i,s)}const i=this.morphAttributes;for(const n in i){const s=[],o=i[n];for(let e=0,n=o.length;n>e;e++){const n=t(o[e],r);s.push(n)}e.morphAttributes[n]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,r=s.length;r>t;t++){const r=s[t];e.addGroup(r.start,r.count,r.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const r in e)void 0!==e[r]&&(t[r]=e[r]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:[].slice.call(e.array)});const r=this.attributes;for(const e in r){const n=r[e];t.data.attributes[e]=n.toJSON(t.data)}const n={};let i=!1;for(const e in this.morphAttributes){const r=this.morphAttributes[e],s=[];for(let e=0,n=r.length;n>e;e++){const n=r[e];s.push(n.toJSON(t.data))}s.length>0&&(n[e]=s,i=!0)}i&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const r=t.index;null!==r&&this.setIndex(r.clone(e));const n=t.attributes;for(const t in n){const r=n[t];this.setAttribute(t,r.clone(e))}const i=t.morphAttributes;for(const t in i){const r=[],n=i[t];for(let t=0,i=n.length;i>t;t++)r.push(n[t].clone(e));this.morphAttributes[t]=r}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;e>t;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:U}})),"undefined"!=typeof window&&(window.__THREE__||(window.__THREE__=U)),t.Vector3d=class extends I{constructor(t,e,r){super(),this.x=0,this.y=0,this.z=0,this.x=t||0,this.y=e||0,this.z=r||0}setX(t){this.x=t}setY(t){this.y=t}setZ(t){this.z=t}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}as(){return new wt(this.x,this.y,this.z)}add(t){return this.copy(this.as().add(t))}sub(t){return this.copy(this.as().sub(t))}normalize(){return this.copy(this.as().normalize())}multiplyScalar(t){return this.copy(this.as().multiplyScalar(t))}cross(t){return this.copy(this.as().cross(t))}applyQuaternion(t){return this.copy(this.as().applyQuaternion(t))}applyMatrix4(t){return this.copy(this.as().applyMatrix4(t))}dot(t){return this.as().dot(t)}length(){return this.as().length()}lengthSq(){return this.as().lengthSq()}distanceToSquared(t){return this.as().distanceToSquared(t)}distanceTo(t){return this.as().distanceTo(t)}},r([C.DeclareProperty],t.Vector3d.prototype,"x",void 0),r([C.DeclareProperty],t.Vector3d.prototype,"y",void 0),r([C.DeclareProperty],t.Vector3d.prototype,"z",void 0),t.Vector3d=r([C.DeclareObject(P.Vector3d)],t.Vector3d),t.Point3d=class extends t.Vector3d{coincideWith(t,e){return this.as().distanceToSquared(t.as())<e*e}},t.Point3d=r([C.DeclareObject(P.Point3d)],t.Point3d);const _r=1e-6;let xr=class extends I{};var Ar,Sr;xr=r([C.DeclareObject(P.Surface)],xr),t.Vector2d=class extends I{constructor(t,e){super(),this.x=0,this.y=0,this.x=t||0,this.y=e||0}setX(t){this.x=t}setY(t){this.y=t}copy(t){return this.x=t.x,this.y=t.y,this}as(){return new et(this.x,this.y)}distanceTo(t){return this.as().distanceTo(t)}},r([C.DeclareProperty],t.Vector2d.prototype,"x",void 0),r([C.DeclareProperty],t.Vector2d.prototype,"y",void 0),t.Vector2d=r([C.DeclareObject(P.Vector2d)],t.Vector2d),t.Point2d=class extends t.Vector2d{coincideWith(t,e){return this.as().distanceToSquared(t.as())<e*e}},t.Point2d=r([C.DeclareObject(P.Point2d)],t.Point2d),t.ParamUV=class extends t.Point2d{},t.ParamUV=r([C.DeclareObject(P.ParamUV)],t.ParamUV),t.Plane=Ar=class extends xr{constructor(){super(),this.origin=new t.Point3d,this.vecU=new t.Vector3d,this.vecV=new t.Vector3d,this.normal=new t.Vector3d}static construct(t,e,r){const n=new Ar;return n.origin.copy(t.as()),m((()=>Math.abs(e.lengthSq()-1)<V.tolerence*V.tolerence),"vecU should be normalized."),m((()=>Math.abs(r.lengthSq()-1)<V.tolerence*V.tolerence),"vecV should be normalized."),m((()=>e.dot(r.as())<V.tolerence),"vecU should be perpendicular to vecV."),n.normal.copy(e.as().cross(r.as()).normalize()),n.vecU.copy(e.as()),n.vecV.copy(r.as()),n}static createByOriginAndNormal(e,r){const n=[new wt(1,0,0),new wt(0,1,0),new wt(0,0,1)],i=d(r,n[0])?d(r,n[1])?n[2]:n[1]:n[0],s=(new t.Vector3d).copy(i.clone().cross(r).normalize()),o=(new t.Vector3d).copy(r.clone().cross(s.as()).normalize());return Ar.construct(e,s,o)}applyMatrix(e){this.origin.applyMatrix4(e);const r=new wt,n=new dt,i=new wt;return e.decompose(r,n,i),this.vecU.applyQuaternion(n).normalize(),this.vecV.applyQuaternion(n).normalize(),this.normal=(new t.Vector3d).copy(this.vecU.as().cross(this.vecV.as()).normalize()),m((()=>void 0!==Ar.construct(this.origin,this.vecU,this.vecV)),"incorrect basis of plane."),this}evaluate(e){const r=this.vecU.as();r.multiplyScalar(e.x);const n=this.origin.as().add(r);return r.copy(this.vecV.as()),r.multiplyScalar(e.y),(new t.Point3d).copy(n.add(r))}project(e){const{origin:r,normal:n}=this,i=n.as(),s=r.as(),o=e.as(),a=o.clone().sub(s),u=i.multiplyScalar(a.dot(i)/i.dot(i)),h=o.sub(u).sub(s);return new t.ParamUV(this.vecU.dot(h),this.vecV.dot(h))}projectPnt(t){return this.evaluate(this.project(t))}parallelTo(t){return d(this.normal.as(),t.normal.as(),V.tolerence)}distanceTo(t){if(!this.parallelTo(t))return 0;const{origin:e}=t;return this.evaluate(this.project(e)).distanceTo(e.as())}setData(t){return this.data=t,this.data}getData(){return this.data}},r([C.DeclareProperty],t.Plane.prototype,"origin",void 0),r([C.DeclareProperty],t.Plane.prototype,"vecU",void 0),r([C.DeclareProperty],t.Plane.prototype,"vecV",void 0),r([C.DeclareProperty],t.Plane.prototype,"normal",void 0),r([C.DeclareProperty],t.Plane.prototype,"data",void 0),t.Plane=Ar=r([C.DeclareObject(P.Plane)],t.Plane),t.Line=Sr=class extends R{constructor(){super(),this.origin=new t.Point3d,this.dir=new t.Vector3d}static construct(t,e,r,n){const i=new Sr;return i.origin.copy(e.as()),i.dir.copy(r.normalize().as()),i.data=n,t.addCurve(i),i}clone(t){var e;return Sr.construct(t,this.origin,this.dir,null===(e=this.data)||void 0===e?void 0:e.clone(t))}evaluate(e){return(new t.Point3d).copy(this.dir.as()).multiplyScalar(e).add(this.origin.as())}derivate(e,r=1){return 1===r?(new t.Vector3d).copy(this.dir.as()):new t.Vector3d}parameter(t){return t.as().sub(this.origin.as()).dot(this.dir.as())}project(t){return this.parameter(t)}projectPnt(t){return this.evaluate(this.project(t))}isPointOnCurve(t){return this.evaluate(this.project(t)).distanceToSquared(t.as())<V.tolerence*V.tolerence}parallelTo(t){return d(this.dir.as(),t.dir.as(),V.tolerence)}intersect(t){return t instanceof Sr?M(this,t):(m((()=>!1),"Not implemented."),[])}overlap(t){return t instanceof Sr?g(this,t):(m((()=>!1),"Not implemented."),!1)}reverse(){return this.dir.multiplyScalar(-1),this}offset(t,e){return this.origin.add(e),this}move(t){return this.origin.add(t),this}setData(t){return this.data=t,this.data}getData(){return this.data}debugDump(){const{origin:t,dir:e}=this;return{origin:t,dir:e}}},r([C.DeclareProperty],t.Line.prototype,"origin",void 0),r([C.DeclareProperty],t.Line.prototype,"dir",void 0),r([C.DeclareProperty],t.Line.prototype,"data",void 0),t.Line=Sr=r([C.DeclareObject(P.Line)],t.Line);let kr=class extends I{constructor(){super(),this.t=[]}static constructBy(t,e,r,n,i){if(r>=n)throw Error("Parameter direction should be increasing gradually. Please review the unbounded curve formula definition.");return t.t.push(r,n),t.data=i,e.addCurveSegment(t),t}bound(t){return t[0]<t[1]&&([...this.t]=t),m((()=>this.t[0]<this.t[1]),"reverse curve error."),this}isCongruentTo(t){return this.getCurve().overlap(t.getCurve())&&this.getEndPoint(0).coincideWith(t.getEndPoint(0),V.tolerence)&&this.getEndPoint(1).coincideWith(t.getEndPoint(1),V.tolerence)}getEndParam(t){switch(t){case 0:case 1:return this.t[t];default:return 0}}getEndPoint(t){return this.getCurve().evaluate(this.getEndParam(t))}paramWithIn(t){return this.t[0]<t&&t<this.t[1]||this.t[1]<t&&t<this.t[0]}paramAtEnd(t,e){return Math.abs(this.t[e]-t)<V.tolerence}paramOnCurve(t){return this.paramAtEnd(t,0)||this.paramAtEnd(t,1)||this.paramWithIn(t)}isPointOnCurve(t){if(!this.getCurve().isPointOnCurve(t))return!1;const e=this.getCurve().parameter(t);return this.paramOnCurve(e)}intersect(t){if(this.getCurve().overlap(t.getCurve())){const e=[0,1].map((e=>t.getEndPoint(e))).map((t=>this.getCurve().project(t)));if(void 0===new $(e[0],e[1]).intersects(new $(this.getEndParam(0),this.getEndParam(1)))){if(Math.abs(this.getEndParam(0)-e[0])<V.tolerence)return[{tA:this.getEndParam(0),tB:t.getEndParam(0)}];if(Math.abs(this.getEndParam(0)-e[1])<V.tolerence)return[{tA:this.getEndParam(0),tB:t.getEndParam(1)}];if(Math.abs(this.getEndParam(1)-e[0])<V.tolerence)return[{tA:this.getEndParam(1),tB:t.getEndParam(0)}];if(Math.abs(this.getEndParam(1)-e[1])<V.tolerence)return[{tA:this.getEndParam(1),tB:t.getEndParam(1)}]}}return this.getCurve().intersect(t.getCurve()).filter((e=>this.paramOnCurve(e.tA)&&t.paramOnCurve(e.tB)))}overlap(t){if(this.getCurve().overlap(t.getCurve())){const e=[0,1].map((e=>t.getEndPoint(e))).map((t=>this.getCurve().project(t)));return new $(e[0],e[1]).intersects(new $(this.getEndParam(0),this.getEndParam(1)))}}reverse(){const t=[this.getEndPoint(0),this.getEndPoint(1)],e=this.getCurve().reverse();return this.t[0]=e.project(t[1]),this.t[1]=e.project(t[0]),m((()=>this.t[0]<this.t[1]),"reverse curve error."),this}setData(t){return this.data=t,this.data}getData(){return this.data}debugDump(){const{t:t}=this;return{curve:this.getCurve().debugDump(),t:t}}};var Er,Tr;r([C.DeclareProperty],kr.prototype,"t",void 0),r([C.DeclareProperty],kr.prototype,"data",void 0),kr=r([C.DeclareObject(P.CurveSegment)],kr),function(t){t.copy="copy"}(Er||(Er={}));let Nr=Tr=class extends I{constructor(){super(),this.id=new B}static construct(t){const e=new Tr;return e.id=t.allocCurveSegmentId(),e}getId(){return this.id}clone(t){const e=Tr.construct(t);return e.deriveType=Er.copy,e.deriveFrom=this.getId(),e}getDeriveFromId(){return this.deriveFrom}getDeriveType(){return this.deriveType}};var jr;r([C.DeclareProperty],Nr.prototype,"id",void 0),r([C.DeclareProperty],Nr.prototype,"deriveType",void 0),r([C.DeclareProperty],Nr.prototype,"deriveFrom",void 0),Nr=Tr=r([C.DeclareObject(P.CurveSegmentData)],Nr);let Cr=jr=class extends I{constructor(){super(),this.id=new F}static construct(t){const e=new jr;return e.id=t.allocCurveId(),e}getId(){return this.id}clone(t){const e=jr.construct(t);return e.deriveType=Er.copy,e.deriveFrom=this.getId(),e}getDeriveFromId(){return this.deriveFrom}getDeriveType(){return this.deriveType}};r([C.DeclareProperty],Cr.prototype,"id",void 0),r([C.DeclareProperty],Cr.prototype,"deriveType",void 0),r([C.DeclareProperty],Cr.prototype,"deriveFrom",void 0),Cr=jr=r([C.DeclareObject(P.CurveData)],Cr);var Pr={exports:{}},Ir=Pr.exports,Or,Dr=b(),Fr,Br;t.LineSegment=Fr=class extends kr{constructor(){super(),this.curve=new t.Line}static construct(t,e,r,n,i){const s=new Fr;return s.curve=e,kr.constructBy(s,t,r,n,i),s}clone(t){var e;return Fr.construct(t,this.curve.clone(t),this.t[0],this.t[1],null===(e=this.data)||void 0===e?void 0:e.clone(t))}static createByEnds(e,r,n){const i=t.Line.construct(e,r,(new t.Vector3d).copy(n.as().sub(r.as())),Cr.construct(e)),s=i.parameter(n);return Fr.construct(e,i,0,s,Nr.construct(e))}getTessParams(t){return this.t}getCurve(){return this.curve}offset(t,e){return this.getCurve().offset(t,e),this}move(t){return this.getCurve().move(t),this}getNurbsForm(){return Dr.NurbsLine.constructLine(this.getEndPoint(0).as().toArray(),this.getEndPoint(1).as().toArray())}},r([C.DeclareProperty],t.LineSegment.prototype,"curve",void 0),t.LineSegment=Fr=r([C.DeclareObject(P.LineSegment)],t.LineSegment);let Lr=Br=class extends I{constructor(){super(),this.maxUV=new t.ParamUV,this.minUV=new t.ParamUV}static construct(t){const e=new Br;return e.minUV.copy(t.as()),e.maxUV.copy(t.as()),e}static createFromPnts(...t){const e=Br.construct(t[0]),[r,...n]=t;return e.expand(...n),e}expand(...t){t.forEach((t=>{this.maxUV.x<t.x&&this.maxUV.setX(t.x),this.maxUV.y<t.y&&this.maxUV.setY(t.y),t.x<this.minUV.x&&this.minUV.setX(t.x),t.y<this.minUV.y&&this.minUV.setY(t.y)}))}intersects(t){return t.minUV.x+V.tolerence<this.maxUV.x&&this.minUV.x+V.tolerence<t.maxUV.x&&t.minUV.y+V.tolerence<this.maxUV.y&&this.minUV.y+V.tolerence<t.maxUV.y}};var Vr,$r,Rr;r([C.DeclareProperty],Lr.prototype,"minUV",void 0),r([C.DeclareProperty],Lr.prototype,"maxUV",void 0),Lr=Br=r([C.DeclareObject(P.Envelope)],Lr),t.CurveLoop=Vr=class extends I{constructor(){super(),this.curveSegments=[]}static construct(t,e){const r=new Vr;r.curveSegments=t||[],m((()=>r.curveSegments.length>0),"why empty loop?");for(let t=0;t<r.curveSegments.length;t+=1){const e=r.curveSegments[t].getEndPoint(1),n=r.curveSegments[(t+1)%r.curveSegments.length].getEndPoint(0);m((()=>n.distanceToSquared(e.as())<V.tolerence*V.tolerence),"discontinuous loop segment?")}return e&&r.updateEnvelope(e),r}clone(t,e){return Vr.construct([...this.curveSegments.map((e=>e.clone(t)))],e)}drop(t,e,r){return void 0===e?this.curveSegments.splice(t):e>0&&this.curveSegments.splice(t,e),r&&this.updateEnvelope(r),this}append(t,e){return this.curveSegments.push(...t),e&&this.updateEnvelope(e),this}getCurveCount(){return this.curveSegments.length}getCurveSegment(t){return this.curveSegments[t]}isCongruentTo(t){if(this.getCurveCount()!==t.getCurveCount())return!1;for(let e=0;e<this.getCurveCount();e+=1)if(!this.getCurveSegment(e).isCongruentTo(t.getCurveSegment(e)))return!1;return!0}reverse(){return this.curveSegments.reverse().forEach((t=>t.reverse())),this}getNILIndex(){return-1}getNextIndex(t){const e=this.getNILIndex();if(t>e&&t<this.getCurveCount()){const e=this.curveSegments[t].getEndPoint(1);for(let t=0;t<this.curveSegments.length;t+=1)if(this.curveSegments[t].getEndPoint(0).distanceToSquared(e.as())<V.tolerence*V.tolerence)return t}return e}findEntryIndex(){const t=this.getNILIndex();if(1>this.getCurveCount())return t;let e=0,r=0;for(;r!==t;){if(this.getNextIndex(r)===t)return t;if(e=this.getNextIndex(e),r=this.getNextIndex(this.getNextIndex(r)),r===e){for(r=0;r!==e;)e=this.getNextIndex(e),r=this.getNextIndex(r);return r}}return t}combineColinearCurves(t,e){const r=this.clone(t,e);for(let e=0;e<r.getCurveCount()-1;e+=1){const n=e+1,i=r.getCurveSegment(e);for(;n<r.getCurveCount()&&i.getCurve().overlap(r.getCurveSegment(n).getCurve());){const e=r.getCurveSegment(n),s=e.getEndPoint(1),o=i.getCurve().project(s);i.bound([i.getEndParam(0),o]),r.drop(n,1),t.deleteCurve(e.getCurve()),t.deleteCurveSegment(e)}}if(r.getCurveCount()>1){const e=r.getCurveCount()-1,n=r.getCurveSegment(0),i=r.getCurveSegment(e);if(n.getCurve().overlap(i.getCurve())){const s=i.getEndPoint(0),o=n.getCurve().project(s);n.bound([o,n.getEndParam(1)]),r.drop(e,1),t.deleteCurve(i.getCurve()),t.deleteCurveSegment(i)}}return r}projectTo(t,e){const r=this.clone(t,e);for(let t=0;t<r.getCurveCount();t+=1){const n=r.getCurveSegment(t),i=n.getEndPoint(0),s=e.projectPnt(i).as().sub(i.as());n.move(s)}return r.updateEnvelope(e),r}getVertices(t){const e=[];for(let r=0;r<this.getCurveCount();r+=1){const n=this.getCurveSegment(r),i=n.getEndParam(0),s=n.getEndParam(1),o=[i,...n.getTessParams(t).filter((t=>t>i&&s>t))];for(let t=0;t+1<o.length;t+=1)if(o[t]>o[t+1])throw Error("Parameter tessellation direction should be increasing gradually. Please review the unbounded curve formula definition.");const a=o.map((t=>n.getCurve().evaluate(t)));e.push(...a)}return e}updateEnvelope(t){return this.envelope=this.getCurveCount()>0?Lr.createFromPnts(...this.getVertices(.1).map((e=>t.project(e)))):void 0,this.envelope}getEnvelope(){return this.envelope}debugDump(){return{curveSegments:this.curveSegments.map((t=>t.debugDump()))}}},r([C.DeclareProperty],t.CurveLoop.prototype,"curveSegments",void 0),r([C.DeclareProperty],t.CurveLoop.prototype,"envelope",void 0),t.CurveLoop=Vr=r([C.DeclareObject(P.CurveLoop)],t.CurveLoop);class Ur{getLoop(t){throw Error("Not implemented.")}getCurveSegIndex(t){throw Error("Not implemented.")}getSortParam(t){throw Error("Not implemented.")}getParam(t,e){throw Error("Not implemented.")}}!function(t){t.start="start",t.end="end"}($r||($r={}));class zr extends Ur{constructor(t,e){super(),this.aLoopSpan=t,this.bLoopSpan=e}getLoop(t){return 1===t?this.aLoopSpan.loop:this.bLoopSpan.loop}getCurveSegIndex(t){return 1===t?this.aLoopSpan.curveSegIndex:this.bLoopSpan.curveSegIndex}getSortParam(t){return 1===t?.5*(this.aLoopSpan.span.start+this.aLoopSpan.span.end):.5*(this.bLoopSpan.span.start+this.bLoopSpan.span.end)}getParam(t,e){const r=1===t?this.aLoopSpan.span:this.bLoopSpan.span;return e===$r.start?r.start:r.end}getLoopSpan(t){return 1===t?this.aLoopSpan:this.bLoopSpan}getOtherLoopSpan(t){return 0===t?this.aLoopSpan:this.bLoopSpan}getOtherSpanSide(t,e){const r=this.getLoopSpan(t),n=e===$r.start?r.span.start:r.span.end,i=r.loop.getCurveSegment(r.curveSegIndex).getCurve().evaluate(n),s=this.getOtherLoopSpan(t),o=s.loop.getCurveSegment(s.curveSegIndex).getCurve(),a=o.evaluate(s.span.start),u=o.evaluate(s.span.end);return a.distanceToSquared(i.as())<u.distanceToSquared(i.as())?$r.start:$r.end}}class Yr{constructor(t,e,r){this.loop=t,this.curveSegIndex=e,this.span=r}}class Xr extends Ur{constructor(t,e){super(),this.aLoopPnt=t,this.bLoopPnt=e}getLoop(t){return 1===t?this.aLoopPnt.loop:this.bLoopPnt.loop}getCurveSegIndex(t){return 1===t?this.aLoopPnt.curveSegIndex:this.bLoopPnt.curveSegIndex}getSortParam(t){return 1===t?this.aLoopPnt.t:this.bLoopPnt.t}getParam(t,e){return 1===t?this.aLoopPnt.t:this.bLoopPnt.t}}class qr{constructor(t,e,r){this.loop=t,this.curveSegIndex=e,this.t=r}}let Zr=Rr=class extends I{constructor(){super(),this.curveSeg=new t.LineSegment,this.t=0}static construct(t,e){const r=new Rr;return r.curveSeg=t,r.t=e,r}};r([C.DeclareProperty],Zr.prototype,"curveSeg",void 0),r([C.DeclareProperty],Zr.prototype,"t",void 0),Zr=Rr=r([C.DeclareObject(P.CurveSegmentPnt)],Zr);const Hr=t=>t?1:0,Wr=(t,e,r)=>t.getCurveSegIndex(r)===e.getCurveSegIndex(r)?t.getSortParam(r)-e.getSortParam(r):t.getCurveSegIndex(r)-e.getCurveSegIndex(r),Gr=(t,e)=>t.derivate(e,1).as(),Jr=(t,e,r,n,i,s)=>{const o=[];if(r===i&&n+V.tolerence<s){const i=e.getCurveSegment(r).clone(t);i.bound([n,s]),o.push(i)}if(i>r){if(n+V.tolerence<e.getCurveSegment(r).getEndParam(1)){const i=e.getCurveSegment(r).clone(t);i.bound([n,i.getEndParam(1)]),o.push(i)}for(let n=r+1;i>n;n+=1)o.push(e.getCurveSegment(n).clone(t));if(e.getCurveSegment(i).getEndParam(0)+V.tolerence<s){const r=e.getCurveSegment(i).clone(t);r.bound([r.getEndParam(0),s]),o.push(r)}}if(r>i||r===i&&s+V.tolerence<n){if(n+V.tolerence<e.getCurveSegment(r).getEndParam(1)){const i=e.getCurveSegment(r).clone(t);i.bound([n,i.getEndParam(1)]),o.push(i)}for(let n=r+1;n<e.getCurveCount();n+=1)o.push(e.getCurveSegment(n).clone(t));for(let r=0;i>r;r+=1)o.push(e.getCurveSegment(r).clone(t));if(e.getCurveSegment(i).getEndParam(0)+V.tolerence<s){const r=e.getCurveSegment(i).clone(t);r.bound([r.getEndParam(0),s]),o.push(r)}}return y((()=>o.length>0),"no progress?"),o},Qr=(t,e,r,n,i)=>{if(e===n&&Math.abs(r-i)<V.tolerence)return!0;if(n>e){let s=t.getCurveSegment(e).getEndParam(1)-r;for(let r=e+1;n>r;r+=1)s+=t.getCurveSegment(r).getEndParam(1)-t.getCurveSegment(r).getEndParam(0);return s+=i-t.getCurveSegment(n).getEndParam(0),Math.abs(s)<V.tolerence}if(e>n||e===n&&i+V.tolerence<r){let s=t.getCurveSegment(e).getEndParam(1)-r;for(let r=e+1;r<t.getCurveCount();r+=1)s+=t.getCurveSegment(r).getEndParam(1)-t.getCurveSegment(r).getEndParam(0);for(let e=0;n>e;e+=1)s+=t.getCurveSegment(e).getEndParam(1)-t.getCurveSegment(e).getEndParam(0);return s+=i-t.getCurveSegment(n).getEndParam(0),Math.abs(s)<V.tolerence}return!1},Kr=(t,e,r,n,i)=>Qr(t,n.getCurveSegIndex(Hr(e)),n.getParam(Hr(e),r),i.getCurveSegIndex(Hr(e)),i.getParam(Hr(e),r)),tn=(t,e,r)=>{const n=t.getLoop(Hr(e)),i=t.getCurveSegIndex(Hr(e)),s=n.getCurveSegment(i),o=t.getParam(Hr(e),r);if(s.paramAtEnd(o,1)){const t=(i+1)%n.getCurveCount(),e=n.getCurveSegment(t),r=e.getEndParam(0);return Zr.construct(e,r)}return Zr.construct(s,o)},rn=(t,e,r,n)=>{if(2>t.length)return;if(r instanceof zr&&n===$r.start)return{nextIntersectPnt:r,nextSide:$r.end};const i=r.getCurveSegIndex(Hr(e)),s=r.getParam(Hr(e),n);for(let n=t.indexOf(r)+1;n<t.length;n+=1){const r=t[n],o=r.getCurveSegIndex(Hr(e)),a=r.getParam(Hr(e),$r.start);if(o>i||i===o&&s+V.tolerence<a)return{nextIntersectPnt:r,nextSide:$r.start}}return t.length>0?{nextIntersectPnt:t[0],nextSide:$r.start}:void 0},nn=(t,e,r,n,i,s,o,a)=>{const u=o.getCurveSegIndex(Hr(s)),h=o.getParam(Hr(s),a),c=rn(i.filter((t=>!n.has(t))),s,o,a);if(c){const n=o.getLoop(Hr(s)),i=c.nextIntersectPnt.getCurveSegIndex(Hr(s)),l=c.nextIntersectPnt.getParam(Hr(s),c.nextSide),f=Jr(t,n,u,h,i,l);f.length>0&&(e.append(f),f.forEach((t=>r.set(t,{currentIntersectPnt:o,currentSide:a,traceTargetOrTool:s}))))}return c},sn=(t,e,r)=>{const n=tn(t,e,r);return Gr(n.curveSeg.getCurve(),n.t)},en=(t,e,r)=>{const n=t.getLoop(Hr(e)),i=t.getCurveSegIndex(Hr(e)),s=n.getCurveSegment(i),o=t.getParam(Hr(e),r);return Gr(s.getCurve(),o)},on=(t,e,r,n)=>{const i=t,s=sn(t,!0,e),o=i instanceof zr&&i.getOtherSpanSide(Hr(!0),e)||$r.start,a=sn(t,!1,o);if(w(s,r,n.normal.as(),V.tolerence)&&w(r,a,n.normal.as(),V.tolerence))return!1;if(w(a,r,n.normal.as(),V.tolerence)&&w(r,s,n.normal.as(),V.tolerence))return!0;if(p(a,r,n.normal.as(),V.tolerence)&&p(r,s,n.normal.as(),V.tolerence)){const t=r.dot(s),e=r.dot(a);return t>0&&0>e||t>=0||0>=e}return!w(s,a,n.normal.as(),V.tolerence)},hn=(t,e,r,n,i)=>{const s=_(t,n,r,i);m((()=>e.length===s.length),"reverse joint with different loop count");const o=(t,e)=>t.getCurveCount()-e.getCurveCount();e.sort(o),s.sort(o);for(let t=0;t<e.length;t+=1)m((()=>e[t].getCurveCount()===s[t].getCurveCount()),"reverse joint to different curve count.");return!0};class un{constructor(t,e,r){this.loop=e,this.vertices=[...e.getVertices(r).map((e=>t.project(e)))]}isPntInside(t){const{vertices:e}=this,r=e.length;if(1>=r)return 0;let n=0,i=e[r-1];for(let s=0;r>s;s+=1){const r=e[s];i.y<t.y!=r.y<t.y&&(i.x<t.x!=r.x<t.x?(i.x-t.x)*(r.y-t.y)-(i.y-t.y)*(r.x-t.x)>0==r.y>i.y&&(n=1-n):i.x<t.x||r.x<t.x||(n=1-n)),i=r}return n}}class an{getClassName(){return C.BasicSerializeType.HashTable}isSerializable(t){return t instanceof k}serialize(t,e){const r=this.getClassName(),n=[];return Object.keys(e.table).forEach((r=>n.push({hash:r,item:t.serializeAny(e.get(r))}))),{class:r,table:n}}deserialize(t,e){if(void 0===e)return;const{table:r}=e,n=new k;return r.forEach((e=>{const{hash:r,item:i}=e;n.set(r,t.deserializeAny(i))})),n}}class cn{static run(t,e=new br){const{points:r,triangles:n}=t,i=new Float32Array(3*r.length),s=new Float32Array(3*r.length),o=new Float32Array(2*r.length);let a=!1,u=!1,h=!1;for(let t=0;t<r.length;t+=1){const{position:e,normal:n,uv:c}=r[t];if(e){a=!0;for(let r=0;3>r;r+=1)i[3*t+r]=e[r]}if(n){u=!0;for(let e=0;3>e;e+=1)s[3*t+e]=n[e]}if(c){h=!0;for(let e=0;2>e;e+=1)o[2*t+e]=c[e]}}const c=new Uint32Array(n.length);for(let t=0;t<n.length;t+=1)c[t]=n[t];const l=n.length;return a&&(e.setAttribute("position",new cr(i,3).setUsage(nt)),e.attributes.position.needsUpdate=!0),u&&(e.setAttribute("normal",new cr(s,3).setUsage(nt)),e.attributes.normal.needsUpdate=!0),h&&(e.setAttribute("uv",new cr(o,2).setUsage(nt)),e.attributes.uv.needsUpdate=!0),e.setIndex(new cr(c,1).setUsage(nt)),e.index&&(e.index.needsUpdate=!0),e.setDrawRange(0,l),e}}class fn{static getGeometry(t,e=[1,1]){return Dr.TessellateShell.tessellateShell(t,e).map((t=>cn.run(t)))}}let ln=class{static boolUnion(t,e){return Dr.union(t,e)}static boolIntersect(t,e){return Dr.intersect(t,e)}static boolCut(t,e){return Dr.subtract(t,e)}};class vn{static construct(e,r){const n=new Dr.BREPValidator,i=new Dr.VertexFactory,s=t=>i.getData([t.x,t.y,t.z]),o=[];for(let t=0;t<e.getCurveCount();t+=1){const r=e.getCurveSegment(t);o.push(r.getEndPoint(0))}const a=r.as(),u=a.clone().multiplyScalar(-1),h=o.map((e=>new t.Point3d(e.x,e.y,e.z))).map((t=>t.add(a))),c=new Dr.BrepBuilder,l=[],f=[],d=[Dr.NurbsLine.constructLine(o[0].as().toArray(),h[0].as().toArray())];for(let t=0;t<e.getCurveCount();t+=1){const r=(t+1)%e.getCurveCount();c.face(),c.loop();const n=e.getCurveSegment(t),i=n.getNurbsForm();l.push(i),n.move(a);const p=n.getNurbsForm();f.push(p),n.move(u);const m=d[t],v=Dr.NurbsLine.constructLine(o[r].as().toArray(),h[r].as().toArray());d.push(v),c.edge(s(o[t]),s(o[r]),(()=>new Dr.BrepCurve(i)),!1),c.edge(s(o[r]),s(h[r]),(()=>new Dr.BrepCurve(v)),!1),c.edge(s(h[r]),s(h[t]),(()=>new Dr.BrepCurve(p)),!0),c.edge(s(h[t]),s(o[t]),(()=>new Dr.BrepCurve(m)),!0);const g=new Dr.BrepSurface(Dr.NurbsSweptSurface.constructSwept(i.nurbs,m.nurbs));g.uScale=i.nurbs.length(),g.vScale=m.nurbs.length(),c._face.surface=g}const p=Dr.getApproximatePlane(o.map((t=>t.as())));if(p){const t=[p.normal.x,p.normal.y,p.normal.z],r=[p.origin.x,p.origin.y,p.origin.z];c.face(),c.loop();for(let t=l.length-1;t>-1;t-=1){const r=l[t],n=(t+1)%e.getCurveCount();c.edge(s(o[n]),s(o[t]),(()=>new Dr.BrepCurve(r)),!0)}c._face.surface=Dr.getPlaneNurbsForm(t,r,!0,c._face),c.face(),c.loop();for(let t=0;t<f.length;t+=1){const r=f[t],n=(t+1)%e.getCurveCount();c.edge(s(h[t]),s(h[n]),(()=>new Dr.BrepCurve(r)),!1)}r[0]+=a.x,r[1]+=a.y,r[2]+=a.z,c._face.surface=Dr.getPlaneNurbsForm(t,r,!1,c._face)}const m=c.build();return n.validateShell(m),m}}var dn;let wn=dn=class extends R{constructor(){super(),this.center=new t.Point3d,this.normal=new t.Vector3d,this.axisU=new t.Vector3d,this.axisV=new t.Vector3d,this.radius=0}static construct(t,e,r,n,i,s){const o=new dn;return o.center.copy(e.as()),o.normal.copy(r.normalize().as()),o.axisV.copy(r.as().cross(n.as()).normalize()),o.axisU.copy(o.axisV.as().cross(r.as()).normalize()),o.radius=i,o.data=s,t.addCurve(o),o}clone(t){var e;return dn.construct(t,this.center,this.normal,this.axisU,this.radius,null===(e=this.data)||void 0===e?void 0:e.clone(t))}evaluate(e){return(new t.Point3d).copy(this.center.as()).add(this.axisU.as().multiplyScalar(this.radius*Math.cos(e))).add(this.axisV.as().multiplyScalar(this.radius*Math.sin(e)))}derivate(e,r=1){if(1===r){const r=this.evaluate(e).as().sub(this.center.as());return(new t.Vector3d).copy(this.normal.as().cross(r).normalize())}return new t.Vector3d}parameter(t){const e=t.as().sub(this.center.as()),r=this.normal.as().cross(e).cross(this.normal.as()).normalize(),n=this.axisU.as(),i=r.dot(n),s=r.cross(n).length();let o=Math.atan2(s,i);return 0>o&&(o+=2*Math.PI),o}project(t){return this.parameter(t)}projectPnt(t){return this.evaluate(this.project(t))}isPointOnCurve(t){return this.evaluate(this.project(t)).distanceToSquared(t.as())<V.tolerence*V.tolerence}intersect(t){return m((()=>!1),"Not implemented."),[]}overlap(t){return t instanceof dn?S(this,t):(m((()=>!1),"Not implemented."),!1)}reverse(){this.normal.multiplyScalar(-1);const t=this.axisV.as();return this.axisV.copy(this.axisU.as()),this.axisU.copy(t),this}offset(t,e){const r=t.add(e).sub(this.center.as());return this.radius=r.length(),this}move(t){return this.center.add(t),this}setData(t){return this.data=t,this.data}getData(){return this.data}debugDump(){const{center:t,normal:e}=this;return{origin:t,dir:e}}};var pn;r([C.DeclareProperty],wn.prototype,"center",void 0),r([C.DeclareProperty],wn.prototype,"normal",void 0),r([C.DeclareProperty],wn.prototype,"axisU",void 0),r([C.DeclareProperty],wn.prototype,"axisV",void 0),r([C.DeclareProperty],wn.prototype,"radius",void 0),r([C.DeclareProperty],wn.prototype,"data",void 0),wn=dn=r([C.DeclareObject(P.Circle)],wn),t.ArcSegment=pn=class extends kr{constructor(){super(),this.curve=new wn}static construct(t,e,r,n,i){const s=new pn;return s.curve=e,kr.constructBy(s,t,r,n,i),s}clone(t){var e;return pn.construct(t,this.curve.clone(t),this.t[0],this.t[1],null===(e=this.data)||void 0===e?void 0:e.clone(t))}static createByEndsRadius(e,r,n,i,s){const o=n.as(),a=i.as().sub(o),u=.5*Math.sqrt(4*s*s-a.lengthSq()),h=r.as().cross(a).normalize().multiplyScalar(u),c=a.multiplyScalar(.5).add(h).add(o),l=o.sub(c),f=wn.construct(e,(new t.Point3d).copy(c),r,(new t.Vector3d).copy(l),s,Cr.construct(e)),d=f.parameter(i);return pn.construct(e,f,0,d,Nr.construct(e))}getTessParams(t){const e=[],r=2*Math.acos(1-t/this.getCurve().radius);for(let t=this.t[0];t*r<=this.t[1];t+=r)e.push(t);return e}getCurve(){return this.curve}offset(t,e){return this.getCurve().offset(t,e),this}move(t){return this.getCurve().move(t),this}getNurbsForm(){const t=this.getCurve();return Dr.NurbsArc.constructArc(t.center.as().toArray(),t.axisU.as().toArray(),t.axisV.as().toArray(),t.radius,this.t[0],this.t[1])}},r([C.DeclareProperty],t.ArcSegment.prototype,"curve",void 0),t.ArcSegment=pn=r([C.DeclareObject(P.ArcSegment)],t.ArcSegment),t.Boolean=ln,t.Extrusion=vn,t.GeometryHelper=fn,t.HashTableSerializer=an,t.Interval=$,t.Polygon=un,t.Shell=Dr.Shell,t.TessellateShell=Dr.TessellateShell,t.Tolerence=V,t.dumpBrepOutputData=Dr.dumpBrepOutputData,t.loopUnion=A,t.readBrep=Dr.readBrep,t.singleLoopUnion=x}));
